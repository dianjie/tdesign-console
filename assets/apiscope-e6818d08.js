import{ar as E,d as J,f as n,Q as W,ai as re,a7 as q,W as Q,r as l,o as O,m as le,w as t,a as e,s as oe,$ as ne,q as T,a0 as de,as as ce,at as pe,M as G,b as p,e as R,au as me,av as fe,i as ve,aw as _e,c as ae,t as be,ax as ge}from"./index-357a89bc.js";import{u as ye}from"./useSetting-8eb1f197.js";import{u as he}from"./useDesign-16212514.js";import{u as se}from"./useRequset-d4265618.js";import{u as z}from"./index-1d3f8cec.js";const we=(f,S,b)=>E.get({url:"/blade-system/api-scope/list",params:{...b,current:f,size:S}},{joinTime:!1}),Ce=f=>E.get({url:"/blade-system/api-scope/detail",params:{id:f}}),ke=f=>E.post({url:"/blade-system/api-scope/remove",params:{ids:f}},{joinParamsToUrl:!0,errorMessageMode:"message"}),Ve=f=>E.post({url:"/blade-system/api-scope/submit",data:f},{errorMessageMode:"message"}),xe=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"权限名称",colKey:"scopeName",ellipsis:!0,width:200},{title:"权限编号",colKey:"resourceCode",ellipsis:!0,width:200},{title:"权限路径",colKey:"scopePath",ellipsis:!0,width:200},{title:"接口类型",colKey:"scopeTypeName",ellipsis:!0,width:200},{fixed:"right",width:180,colKey:"op",title:"操作",align:"center"}],De=J({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""},rowData:{type:Object,default:()=>({})}},emits:["update:visible","update:editId","update:actionType","submit"],setup(f,{emit:S}){const b={scopeName:"",resourceCode:"",scopePath:"",scopeType:"",remark:""},g=f,F=n({scopeName:[{required:!0,message:"请输入权限编号",type:"error",trigger:"blur"}],resourceCode:[{required:!0,message:"请输入权限编号",type:"error",trigger:"blur"}],scopePath:[{required:!0,message:"请输入权限路径",type:"error",trigger:"blur"}],scopeType:[{required:!0,message:"请选择接口类型",type:"error",trigger:"change"}]}),k=W(()=>`${{view:"查看",edit:"编辑",add:"新增"}[g.actionType]||""}接口权限`),V=W(()=>({view:!0,edit:!1})[g.actionType]||!1),y=n([]);async function h(){const u=await ce("api_scope_type");y.value=pe(u)}re(()=>{h()});const r=n(!1),o=n({...b}),N=n(null),v=n(!1),x=S,M=({firstError:u})=>{if(u)G.warning(u);else{v.value=!0;const a={...o.value,menuId:g.rowData.id,id:g.editId};Ve(a).then(()=>{x("submit",a),G.success("提交成功"),r.value=!1}).finally(()=>{v.value=!1})}},A=()=>{o.value={...b},Q(()=>{x("update:editId",""),x("update:actionType","")})},I=()=>{r.value=!1};return q(()=>r.value,u=>{x("update:visible",u)}),q(()=>g.visible,u=>{u&&g.editId&&Q(()=>{Ce(g.editId).then(a=>{o.value={...a}})}),Q(()=>{var a;(a=N.value)==null||a.clearValidate()}),r.value=u}),(u,a)=>{const _=l("t-input"),m=l("t-form-item"),w=l("t-col"),D=l("t-select"),L=l("t-textarea"),U=l("t-button"),j=l("t-row"),$=l("t-form"),K=l("t-dialog");return O(),le(K,{visible:r.value,"onUpdate:visible":a[5]||(a[5]=d=>r.value=d),header:k.value,width:780,footer:!1,onClosed:A},{body:t(()=>[e($,{ref_key:"form",ref:N,class:oe({"xy-form__detail":f.actionType==="view"}),data:o.value,rules:F.value,"label-width":100,disabled:V.value||v.value,onSubmit:M},{default:t(()=>[e(j,{gutter:[0,28]},{default:t(()=>[e(w,{span:6},{default:t(()=>[e(m,{label:"权限名称",name:"scopeName"},{default:t(()=>[e(_,{modelValue:o.value.scopeName,"onUpdate:modelValue":a[0]||(a[0]=d=>o.value.scopeName=d),placeholder:"请输入权限名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:6},{default:t(()=>[e(m,{label:"权限编号",name:"resourceCode"},{default:t(()=>[e(_,{modelValue:o.value.resourceCode,"onUpdate:modelValue":a[1]||(a[1]=d=>o.value.resourceCode=d),placeholder:"请输入权限编号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:6},{default:t(()=>[e(m,{label:"权限路径",name:"scopePath"},{default:t(()=>[e(_,{modelValue:o.value.scopePath,"onUpdate:modelValue":a[2]||(a[2]=d=>o.value.scopePath=d),placeholder:"请输入权限路径",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:6},{default:t(()=>[e(m,{label:"接口类型",name:"scopeType"},{default:t(()=>[e(D,{modelValue:o.value.scopeType,"onUpdate:modelValue":a[3]||(a[3]=d=>o.value.scopeType=d),options:y.value,keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择接口类型"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(w,{span:12},{default:t(()=>[e(m,{label:"备注",name:"remark"},{default:t(()=>[e(L,{modelValue:o.value.remark,"onUpdate:modelValue":a[4]||(a[4]=d=>o.value.remark=d),placeholder:"请输入备注",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),ne(e(w,{span:12},{default:t(()=>[e(m,{style:{float:"right"}},{default:t(()=>[e(U,{variant:"outline",onClick:I},{default:t(()=>[T("取消")]),_:1}),e(U,{theme:"primary",type:"submit"},{default:t(()=>[T("确定")]),_:1})]),_:1})]),_:1},512),[[de,!V.value]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),Te={class:"table-wrapper"},Ue=["onClick"],Ke=["onClick"],Ne=["onClick"],Se=J({__name:"DialogAuthority",props:{visible:{type:Boolean,default:!1},rowData:{type:Object,default:()=>({})}},emits:["update:visible"],setup(f,{emit:S}){const b=f,g=W(()=>`[${b.rowData.name}]接口权限配置`),F=S,k={scopeName:"",resourceCode:""},V=n([]),y=n(!1),h=n({...k}),r=n(!1),o=n(!1),N=n(""),v=n(""),{fetchData:x,data:M,dataLoading:A,pagination:I}=se(we,{},()=>{V.value=[]}),u=()=>{x({...h.value,menuId:b.rowData.id})},a=({row:c},s)=>{N.value=c.id,v.value=s,o.value=!0},_=({row:c})=>{$.value=c.id,K.value="one",r.value=!0},m=z(()=>{u()},300),w=c=>{V.value=c},D=c=>{I.value={...I.value,current:c.current||1,pageSize:c.pageSize},m()},U=z(async c=>{try{await ke(c),r.value=!1,G.success("删除成功"),d(),m()}catch{r.value=!1}},300),j=()=>{V.value.length&&(K.value="check",r.value=!0)},$=n(-1),K=n(),d=()=>{$.value=-1,K.value=""},C=()=>{K.value==="check"&&U(V.value),K.value==="one"&&U([`${$.value}`])},X=()=>{d()};return q(()=>y.value,c=>{F("update:visible",c)}),q(()=>b.visible,c=>{c&&u(),y.value=c}),(c,s)=>{const Y=l("t-input"),Z=l("t-form-item"),B=l("t-col"),H=l("t-row"),P=l("t-button"),ie=l("t-form"),ue=l("t-table"),ee=l("t-dialog");return O(),le(ee,{visible:y.value,"onUpdate:visible":s[7]||(s[7]=i=>y.value=i),header:g.value,width:1080,footer:!1},{default:t(()=>[e(ie,{ref:"form",data:h.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:p(m),onSubmit:p(m)},{default:t(()=>[e(H,null,{default:t(()=>[e(B,{span:10},{default:t(()=>[e(H,{gutter:[16,24]},{default:t(()=>[e(B,{span:4},{default:t(()=>[e(Z,{label:"权限名称",name:"scopeName"},{default:t(()=>[e(Y,{modelValue:h.value.scopeName,"onUpdate:modelValue":s[0]||(s[0]=i=>h.value.scopeName=i),clearable:"",placeholder:"请输入权限名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(B,{span:4},{default:t(()=>[e(Z,{label:"权限编号",name:"resourceCode"},{default:t(()=>[e(Y,{modelValue:h.value.resourceCode,"onUpdate:modelValue":s[1]||(s[1]=i=>h.value.resourceCode=i),clearable:"",placeholder:"请输入权限编号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(B,{span:2,class:"operation-wrapper"},{default:t(()=>[e(P,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[T(" 查询 ")]),_:1}),e(P,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[T(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),R("div",Te,[e(ue,{data:p(M),columns:p(xe),hover:!0,loading:p(A),pagination:p(I),"selected-row-keys":V.value,"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:D,onSelectChange:w},{"top-content":t(()=>[e(H,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(B,{flex:"0 0 auto"},{default:t(()=>[e(P,{onClick:s[2]||(s[2]=i=>a({row:{}},"add"))},{default:t(()=>[T("新增")]),_:1}),e(P,{theme:"danger",onClick:j},{default:t(()=>[T("删除")]),_:1})]),_:1})]),_:1})]),op:t(i=>[R("a",{class:"t-button-link",onClick:te=>a(i,"view")},"查看",8,Ue),R("a",{class:"t-button-link",onClick:te=>a(i,"edit")},"编辑",8,Ke),R("a",{class:"t-button-link",onClick:te=>_(i)},"删除",8,Ne)]),_:1},8,["data","columns","loading","pagination","selected-row-keys"]),e(ee,{visible:r.value,"onUpdate:visible":s[3]||(s[3]=i=>r.value=i),header:"确认删除当前所选数据？","on-cancel":X,onConfirm:C},null,8,["visible"]),e(De,{visible:o.value,"onUpdate:visible":s[4]||(s[4]=i=>o.value=i),editId:N.value,"onUpdate:editId":s[5]||(s[5]=i=>N.value=i),actionType:v.value,"onUpdate:actionType":s[6]||(s[6]=i=>v.value=i),"row-data":b.rowData,onSubmit:p(m)},null,8,["visible","editId","actionType","row-data","onSubmit"])])]),_:1},8,["visible","header"])}}}),Ie=[{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"菜单名称",colKey:"name",ellipsis:!0,width:200},{title:"路由地址",colKey:"path",ellipsis:!0,width:200},{title:"菜单图标",colKey:"source",width:80,ellipsis:!0,align:"center"},{title:"菜单编号",colKey:"code",width:150,ellipsis:!0},{title:"菜单别名",colKey:"alias",width:80,ellipsis:!0},{title:"菜单排序",width:80,colKey:"sort",ellipsis:!0},{fixed:"right",width:80,colKey:"op",title:"操作",align:"center"}],$e={class:"table-wrapper"},Ae=["onClick"],Fe=J({__name:"apiscope",setup(f){const{tableVar:S}=he(),{getTableHeaderAffixedTop:b,getLayoutContainer:g}=ye(),k=n({...{name:"",code:""}}),V=me({childrenKey:"children",treeNodeColumnIndex:1}),y=n(!1),h=n({}),{fetchData:r,data:o,dataLoading:N}=se(fe,k.value,ge,!1);ve(()=>{r()});const v=n(!1),x=n(null),M=()=>{v.value=!v.value,v.value?x.value.expandAll():x.value.foldAll()},A=z(()=>{r()},300),I=z(M,300),u=({row:a})=>{h.value=a,y.value=!0};return(a,_)=>{const m=l("t-input"),w=l("t-form-item"),D=l("t-col"),L=l("t-row"),U=l("t-button"),j=l("t-form"),$=l("t-icon"),K=l("t-enhanced-table"),d=_e("auth");return O(),ae("div",{class:oe(p(S))},[e(j,{ref:"form",data:k.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:p(A),onSubmit:p(A)},{default:t(()=>[e(L,null,{default:t(()=>[e(D,{span:10},{default:t(()=>[e(L,{gutter:[16,24]},{default:t(()=>[e(D,{span:4},{default:t(()=>[e(w,{label:"菜单名称",name:"name"},{default:t(()=>[e(m,{modelValue:k.value.name,"onUpdate:modelValue":_[0]||(_[0]=C=>k.value.name=C),placeholder:"请输入菜单名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(D,{span:4},{default:t(()=>[e(w,{label:"菜单编号",name:"code"},{default:t(()=>[e(m,{modelValue:k.value.code,"onUpdate:modelValue":_[1]||(_[1]=C=>k.value.code=C),placeholder:"请输入菜单编号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(D,{span:2,class:"operation-wrapper"},{default:t(()=>[e(U,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[T(" 查询 ")]),_:1}),e(U,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[T(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),R("div",$e,[e(K,{ref_key:"enhancedTable",ref:x,data:p(o),columns:p(Ie),hover:!0,loading:p(N),tree:V,"header-affixed-top":{offsetTop:p(b),container:p(g)},"vertical-align":"top","row-key":"id",bordered:"",stripe:""},{"top-content":t(()=>[e(L,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(D,{flex:"0 0 auto"}),e(D,{flex:"0 0 auto"},{default:t(()=>[e(U,{theme:"default",onClick:p(I)},{default:t(()=>[T(be(v.value?"收起全部":"展开全部"),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),source:t(({row:C})=>[e($,{name:C.source},null,8,["name"])]),op:t(C=>[ne((O(),ae("a",{class:"t-button-link",onClick:X=>u(C)},[T("权限配置")],8,Ae)),[[d,"api_scope_setting"]])]),_:1},8,["data","columns","loading","tree","header-affixed-top"]),e(Se,{visible:y.value,"onUpdate:visible":_[2]||(_[2]=C=>y.value=C),"row-data":h.value},null,8,["visible","row-data"])])],2)}}});export{Fe as default};
