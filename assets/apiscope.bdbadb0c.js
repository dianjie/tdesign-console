import{a1 as O,d as Q,r as l,C as J,X as re,ax as R,av as G,e as u,f as P,g as ue,w as t,m as de,l as e,q as oe,j as n,J as le,p as C,K as ce,aC as pe,aD as me,M as X,_ as W,n as j,aE as fe,aF as ve,a as _e,aG as be,i as ae,t as ge,aH as Fe}from"./index.8ed3877a.js";import{u as ye}from"./useDesign.9d0ca2bc.js";import{u as he}from"./useSetting.01b849d1.js";import{u as ne}from"./useRequset.50973ce5.js";import{u as q}from"./index.74383c1c.js";const De=[{colKey:"serial-number",title:"\u5E8F\u53F7",width:80,align:"center",fixed:"left"},{title:"\u83DC\u5355\u540D\u79F0",colKey:"name",ellipsis:!0,width:200},{title:"\u8DEF\u7531\u5730\u5740",colKey:"path",ellipsis:!0,width:200},{title:"\u83DC\u5355\u56FE\u6807",colKey:"source",width:80,ellipsis:!0,align:"center"},{title:"\u83DC\u5355\u7F16\u53F7",colKey:"code",width:150,ellipsis:!0},{title:"\u83DC\u5355\u522B\u540D",colKey:"alias",width:80,ellipsis:!0},{title:"\u83DC\u5355\u6392\u5E8F",width:80,colKey:"sort",ellipsis:!0},{fixed:"right",width:80,colKey:"op",title:"\u64CD\u4F5C",align:"center"}],Ce=(v,h,p)=>O.get({url:"/blade-system/api-scope/list",params:{...p,current:v,size:h}},{joinTime:!1}),we=v=>O.get({url:"/blade-system/api-scope/detail",params:{id:v}}),Be=v=>O.post({url:"/blade-system/api-scope/remove",params:{ids:v}},{joinParamsToUrl:!0,errorMessageMode:"message"}),Ee=v=>O.post({url:"/blade-system/api-scope/submit",data:v},{errorMessageMode:"message"}),Ve=Q({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""},rowData:{type:Object,default:()=>({})}},emits:["update:visible","update:editId","update:actionType","submit"],setup(v,{emit:h}){const p=v,N={scopeName:"",resourceCode:"",scopePath:"",scopeType:"",remark:""},L=l({scopeName:[{required:!0,message:"\u8BF7\u8F93\u5165\u6743\u9650\u7F16\u53F7",type:"error",trigger:"blur"}],resourceCode:[{required:!0,message:"\u8BF7\u8F93\u5165\u6743\u9650\u7F16\u53F7",type:"error",trigger:"blur"}],scopePath:[{required:!0,message:"\u8BF7\u8F93\u5165\u6743\u9650\u8DEF\u5F84",type:"error",trigger:"blur"}],scopeType:[{required:!0,message:"\u8BF7\u9009\u62E9\u63A5\u53E3\u7C7B\u578B",type:"error",trigger:"change"}]}),f=J(()=>`${{view:"\u67E5\u770B",edit:"\u7F16\u8F91",add:"\u65B0\u589E"}[p.actionType]||""}\u63A5\u53E3\u6743\u9650`),w=J(()=>({view:!0,edit:!1})[p.actionType]||!1),_=l([]);async function g(){const d=await pe("api_scope_type");_.value=me(d)}re(()=>{g()});const b=l(!1),o=l({...N}),k=l(null),D=l(!1),A=({firstError:d})=>{if(d)X.warning(d);else{D.value=!0;const a={...o.value,menuId:p.rowData.id,id:p.editId};Ee(a).then(()=>{h("submit",a),X.success("\u63D0\u4EA4\u6210\u529F"),b.value=!1}).finally(()=>{D.value=!1})}},I=()=>{o.value={...N},G(()=>{h("update:editId",""),h("update:actionType","")})},x=()=>{b.value=!1};return R(()=>b.value,d=>{h("update:visible",d)}),R(()=>p.visible,d=>{d&&p.editId&&G(()=>{we(p.editId).then(a=>{o.value={...a}})}),G(()=>{var a;(a=k.value)==null||a.clearValidate()}),b.value=d}),(d,a)=>{const T=u("t-input"),s=u("t-form-item"),F=u("t-col"),U=u("t-select"),B=u("t-textarea"),E=u("t-button"),S=u("t-row"),K=u("t-form"),V=u("t-dialog");return P(),ue(V,{visible:b.value,"onUpdate:visible":a[5]||(a[5]=m=>b.value=m),header:n(f),width:780,footer:!1,onClosed:I},{body:t(()=>[de(" \u8868\u5355\u5185\u5BB9 "),e(K,{ref_key:"form",ref:k,class:oe({"xy-form__detail":v.actionType==="view"}),data:o.value,rules:L.value,"label-width":100,disabled:n(w)||D.value,onSubmit:A},{default:t(()=>[e(S,{gutter:[0,28]},{default:t(()=>[e(F,{span:6},{default:t(()=>[e(s,{label:"\u6743\u9650\u540D\u79F0",name:"scopeName"},{default:t(()=>[e(T,{modelValue:o.value.scopeName,"onUpdate:modelValue":a[0]||(a[0]=m=>o.value.scopeName=m),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u540D\u79F0",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(F,{span:6},{default:t(()=>[e(s,{label:"\u6743\u9650\u7F16\u53F7",name:"resourceCode"},{default:t(()=>[e(T,{modelValue:o.value.resourceCode,"onUpdate:modelValue":a[1]||(a[1]=m=>o.value.resourceCode=m),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u7F16\u53F7",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(F,{span:6},{default:t(()=>[e(s,{label:"\u6743\u9650\u8DEF\u5F84",name:"scopePath"},{default:t(()=>[e(T,{modelValue:o.value.scopePath,"onUpdate:modelValue":a[2]||(a[2]=m=>o.value.scopePath=m),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u8DEF\u5F84",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(F,{span:6},{default:t(()=>[e(s,{label:"\u63A5\u53E3\u7C7B\u578B",name:"scopeType"},{default:t(()=>[e(U,{modelValue:o.value.scopeType,"onUpdate:modelValue":a[3]||(a[3]=m=>o.value.scopeType=m),options:_.value,keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"\u8BF7\u9009\u62E9\u63A5\u53E3\u7C7B\u578B"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(F,{span:12},{default:t(()=>[e(s,{label:"\u5907\u6CE8",name:"remark"},{default:t(()=>[e(B,{modelValue:o.value.remark,"onUpdate:modelValue":a[4]||(a[4]=m=>o.value.remark=m),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),le(e(F,{span:12},{default:t(()=>[e(s,{style:{float:"right"}},{default:t(()=>[e(E,{variant:"outline",onClick:x},{default:t(()=>[C("\u53D6\u6D88")]),_:1}),e(E,{theme:"primary",type:"submit"},{default:t(()=>[C("\u786E\u5B9A")]),_:1})]),_:1})]),_:1},512),[[ce,!n(w)]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),ke=W(Ve,[["__file","D:/Study/tdesign-console/src/viewsBusiness/authority/components/apiscope/DialogForm.vue"]]),xe=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"\u5E8F\u53F7",width:80,align:"center",fixed:"left"},{title:"\u6743\u9650\u540D\u79F0",colKey:"scopeName",ellipsis:!0,width:200},{title:"\u6743\u9650\u7F16\u53F7",colKey:"resourceCode",ellipsis:!0,width:200},{title:"\u6743\u9650\u8DEF\u5F84",colKey:"scopePath",ellipsis:!0,width:200},{title:"\u63A5\u53E3\u7C7B\u578B",colKey:"scopeTypeName",ellipsis:!0,width:200},{fixed:"right",width:180,colKey:"op",title:"\u64CD\u4F5C",align:"center"}],Te={class:"table-wrapper"},Ae=["onClick"],Se=["onClick"],Ke=["onClick"],Ne=Q({__name:"DialogAuthority",props:{visible:{type:Boolean,default:!1},rowData:{type:Object,default:()=>({})}},emits:["update:visible"],setup(v,{emit:h}){const p=v,N=J(()=>`[${p.rowData.name}]\u63A5\u53E3\u6743\u9650\u914D\u7F6E`),L={scopeName:"",resourceCode:""},f=l([]),w=l(!1),_=l({...L}),g=l(!1),b=l(!1),o=l(""),k=l(""),{fetchData:D,data:A,dataLoading:I,pagination:x}=ne(Ce,{},()=>{f.value=[]}),d=()=>{D({..._.value,menuId:p.rowData.id})},a=({row:c},i)=>{o.value=c.id,k.value=i,b.value=!0},T=({row:c})=>{K.value=c.id,V.value="one",g.value=!0},s=q(()=>{d()},300),F=c=>{f.value=c},U=c=>{x.value={...x.value,current:c.current||1,pageSize:c.pageSize},s()},E=q(async c=>{try{await Be(c),g.value=!1,X.success("\u5220\u9664\u6210\u529F"),m(),s()}catch{g.value=!1}},300),S=()=>{!f.value.length||(V.value="check",g.value=!0)},K=l(-1),V=l(),m=()=>{K.value=-1,V.value=""},z=()=>{V.value==="check"&&E(f.value),V.value==="one"&&E([`${K.value}`])},y=()=>{m()};return R(()=>w.value,c=>{h("update:visible",c)}),R(()=>p.visible,c=>{c&&d(),w.value=c}),(c,i)=>{const Y=u("t-input"),Z=u("t-form-item"),$=u("t-col"),H=u("t-row"),M=u("t-button"),se=u("t-form"),ie=u("t-table"),ee=u("t-dialog");return P(),ue(ee,{visible:w.value,"onUpdate:visible":i[7]||(i[7]=r=>w.value=r),header:n(N),width:1080,footer:!1},{default:t(()=>[e(se,{ref:"form",data:_.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:n(s),onSubmit:n(s)},{default:t(()=>[e(H,null,{default:t(()=>[e($,{span:10},{default:t(()=>[e(H,{gutter:[16,24]},{default:t(()=>[e($,{span:4},{default:t(()=>[e(Z,{label:"\u6743\u9650\u540D\u79F0",name:"scopeName"},{default:t(()=>[e(Y,{modelValue:_.value.scopeName,"onUpdate:modelValue":i[0]||(i[0]=r=>_.value.scopeName=r),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1}),e($,{span:4},{default:t(()=>[e(Z,{label:"\u6743\u9650\u7F16\u53F7",name:"resourceCode"},{default:t(()=>[e(Y,{modelValue:_.value.resourceCode,"onUpdate:modelValue":i[1]||(i[1]=r=>_.value.resourceCode=r),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u7F16\u53F7"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e($,{span:2,class:"operation-wrapper"},{default:t(()=>[e(M,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[C(" \u67E5\u8BE2 ")]),_:1}),e(M,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[C(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),j("div",Te,[e(ie,{data:n(A),columns:n(xe),hover:!0,loading:n(I),pagination:n(x),"selected-row-keys":f.value,"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:U,onSelectChange:F},{"top-content":t(()=>[e(H,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e($,{flex:"0 0 auto"},{default:t(()=>[e(M,{onClick:i[2]||(i[2]=r=>a({row:{}},"add"))},{default:t(()=>[C("\u65B0\u589E")]),_:1}),e(M,{theme:"danger",onClick:S},{default:t(()=>[C("\u5220\u9664")]),_:1})]),_:1})]),_:1})]),op:t(r=>[j("a",{class:"t-button-link",onClick:te=>a(r,"view")},"\u67E5\u770B",8,Ae),j("a",{class:"t-button-link",onClick:te=>a(r,"edit")},"\u7F16\u8F91",8,Se),j("a",{class:"t-button-link",onClick:te=>T(r)},"\u5220\u9664",8,Ke)]),_:1},8,["data","columns","loading","pagination","selected-row-keys"]),e(ee,{visible:g.value,"onUpdate:visible":i[3]||(i[3]=r=>g.value=r),header:"\u786E\u8BA4\u5220\u9664\u5F53\u524D\u6240\u9009\u6570\u636E\uFF1F","on-cancel":y,onConfirm:z},null,8,["visible"]),e(ke,{visible:b.value,"onUpdate:visible":i[4]||(i[4]=r=>b.value=r),editId:o.value,"onUpdate:editId":i[5]||(i[5]=r=>o.value=r),actionType:k.value,"onUpdate:actionType":i[6]||(i[6]=r=>k.value=r),"row-data":p.rowData,onSubmit:n(s)},null,8,["visible","editId","actionType","row-data","onSubmit"])])]),_:1},8,["visible","header"])}}}),Ue=W(Ne,[["__file","D:/Study/tdesign-console/src/viewsBusiness/authority/components/apiscope/DialogAuthority.vue"]]),Ie={class:"table-wrapper"},$e=["onClick"],je=Q({__name:"apiscope",setup(v){const{tableVar:h}=ye(),{getTableHeaderAffixedTop:p,getLayoutContainer:N}=he(),f=l({...{name:"",code:""}}),w=fe({childrenKey:"children",treeNodeColumnIndex:1}),_=l(!1),g=l({}),{fetchData:b,data:o,dataLoading:k}=ne(ve,f.value,Fe,!1);_e(()=>{b()});const D=l(!1),A=l(null),I=()=>{D.value=!D.value,D.value?A.value.expandAll():A.value.foldAll()},x=q(()=>{b()},300),d=q(I,300),a=({row:T})=>{g.value=T,_.value=!0};return(T,s)=>{const F=u("t-input"),U=u("t-form-item"),B=u("t-col"),E=u("t-row"),S=u("t-button"),K=u("t-form"),V=u("t-icon"),m=u("t-enhanced-table"),z=be("auth");return P(),ae("div",{class:oe(n(h))},[e(K,{ref:"form",data:f.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:n(x),onSubmit:n(x)},{default:t(()=>[e(E,null,{default:t(()=>[e(B,{span:10},{default:t(()=>[e(E,{gutter:[16,24]},{default:t(()=>[e(B,{span:4},{default:t(()=>[e(U,{label:"\u83DC\u5355\u540D\u79F0",name:"name"},{default:t(()=>[e(F,{modelValue:f.value.name,"onUpdate:modelValue":s[0]||(s[0]=y=>f.value.name=y),placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(B,{span:4},{default:t(()=>[e(U,{label:"\u83DC\u5355\u7F16\u53F7",name:"code"},{default:t(()=>[e(F,{modelValue:f.value.code,"onUpdate:modelValue":s[1]||(s[1]=y=>f.value.code=y),placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u7F16\u53F7",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(B,{span:2,class:"operation-wrapper"},{default:t(()=>[e(S,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[C(" \u67E5\u8BE2 ")]),_:1}),e(S,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[C(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),j("div",Ie,[e(m,{ref_key:"enhancedTable",ref:A,data:n(o),columns:n(De),hover:!0,loading:n(k),tree:w,"header-affixed-top":{offsetTop:n(p),container:n(N)},"vertical-align":"top","row-key":"id",bordered:"",stripe:""},{"top-content":t(()=>[e(E,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(B,{flex:"0 0 auto"}),e(B,{flex:"0 0 auto"},{default:t(()=>[e(S,{theme:"default",onClick:n(d)},{default:t(()=>[C(ge(D.value?"\u6536\u8D77\u5168\u90E8":"\u5C55\u5F00\u5168\u90E8"),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),source:t(({row:y})=>[e(V,{name:y.source},null,8,["name"])]),op:t(y=>[le((P(),ae("a",{class:"t-button-link",onClick:c=>a(y)},[C("\u6743\u9650\u914D\u7F6E")],8,$e)),[[z,"api_scope_setting"]])]),_:1},8,["data","columns","loading","tree","header-affixed-top"]),e(Ue,{visible:_.value,"onUpdate:visible":s[2]||(s[2]=y=>_.value=y),"row-data":g.value},null,8,["visible","row-data"])])],2)}}}),Oe=W(je,[["__file","D:/Study/tdesign-console/src/views/authority/apiscope.vue"]]);export{Oe as default};
