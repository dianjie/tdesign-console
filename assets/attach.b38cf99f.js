import{d as I,r as m,ax as P,e as o,f as E,g as j,w as t,m as W,l as e,j as r,p as _,M as x,_ as O,a1 as G,a as X,aG as Y,i as $,n as Z,J as L,q as ee}from"./index.c2521a03.js";import{u as te}from"./useDesign.9d0ca2bc.js";import{u as ae}from"./useSetting.65510119.js";import{u as oe}from"./useRequset.5f7a0394.js";import{a as ue}from"./oss.3475358d.js";import{u as U}from"./index.d71d3bee.js";const le=I({__name:"DialogUpload",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","submit"],setup(v,{emit:b}){const h=v,S={attachFile:[]},A=m({attachFile:[{required:!0,message:"\u8BF7\u9009\u62E9\u9644\u4EF6",type:"error",trigger:"change"}]}),n=m(!1),l=m({...S}),p=m(null),c=m(!1),D=m(),K=U(({firstError:a})=>{a?x.warning(a):(c.value=!0,D.value.uploadFiles())},300),y=()=>{var a;(a=p.value)==null||a.reset()},N=()=>{n.value=!1};P(()=>n.value,a=>{b("update:visible",a)}),P(()=>h.visible,a=>{n.value=a});const R=({file:a})=>{x.error(`\u6587\u4EF6 ${a.name} \u4E0A\u4F20\u5931\u8D25`),c.value=!1},F=async a=>{try{const d=await ue({file:a.raw});return{status:"success",response:{...d,url:d.link}}}catch{return{status:"fail",error:"\u4E0A\u4F20\u5931\u8D25"}}},T=()=>{b("submit",{}),x.success("\u4E0A\u4F20\u6210\u529F"),c.value=!1};return(a,d)=>{const z=o("t-upload"),C=o("t-form-item"),B=o("t-col"),k=o("t-button"),s=o("t-row"),u=o("t-form"),w=o("t-dialog");return E(),j(w,{visible:n.value,"onUpdate:visible":d[1]||(d[1]=f=>n.value=f),header:"\u5BF9\u8C61\u5B58\u50A8\u4E0A\u4F20\u8C03\u8BD5",width:580,footer:!1,onClosed:y},{body:t(()=>[W(" \u8868\u5355\u5185\u5BB9 "),e(u,{ref_key:"form",ref:p,data:l.value,rules:A.value,"label-width":100,disabled:c.value,onSubmit:r(K)},{default:t(()=>[e(s,{gutter:[0,28]},{default:t(()=>[e(B,{span:12},{default:t(()=>[e(C,{label:"\u9644\u4EF6\u4E0A\u4F20",name:"attachFile"},{default:t(()=>[e(z,{ref_key:"uploadRef",ref:D,modelValue:l.value.attachFile,"onUpdate:modelValue":d[0]||(d[0]=f=>l.value.attachFile=f),"auto-upload":!1,"request-method":F,disabled:c.value,onFail:R,onSuccess:T},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(B,{span:12},{default:t(()=>[e(C,{style:{float:"right"}},{default:t(()=>[e(k,{variant:"outline",onClick:N},{default:t(()=>[_("\u5173\u95ED")]),_:1}),e(k,{theme:"primary",disabled:c.value,type:"submit"},{default:t(()=>[_("\u4E0A\u4F20")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled","onSubmit"])]),_:1},8,["visible"])}}}),ne=O(le,[["__file","D:/Study/tdesign-console/src/viewsBusiness/resource/components/attach/DialogUpload.vue"]]),se=(v,b,h)=>G.get({url:"/blade-resource/attach/list",params:{...h,current:v,size:b}},{joinTime:!1}),ie=v=>G.post({url:"/blade-resource/attach/remove",params:{ids:v}},{joinParamsToUrl:!0,errorMessageMode:"message"}),re=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"\u5E8F\u53F7",width:80,align:"center",fixed:"left"},{title:"\u9644\u4EF6\u5730\u5740",colKey:"link"},{title:"\u9644\u4EF6\u57DF\u540D",colKey:"domainUrl"},{title:"\u9644\u4EF6\u540D\u79F0",colKey:"name"},{title:"\u9644\u4EF6\u539F\u540D",colKey:"originalName"},{title:"\u9644\u4EF6\u62D3\u5C55\u540D",colKey:"extension"},{title:"\u9644\u4EF6\u5927\u5C0F(KB)",colKey:"attachSize"},{fixed:"right",width:100,colKey:"op",title:"\u64CD\u4F5C",align:"center"}],ce={class:"table-wrapper"},de=["onClick"],me=I({__name:"attach",setup(v){const{tableVar:b}=te(),{getTableHeaderAffixedTop:h,getLayoutContainer:S}=ae(),A={domainUrl:"",name:"",originalName:""},n=m([]),l=m({...A}),p=m(!1),c=m(!1),{fetchData:D,data:K,pagination:y,dataLoading:N}=oe(se,l.value,()=>{n.value=[]});X(()=>{D()});const R=({row:s})=>{window.open(`${s.link}`)},F=U(()=>{D()},300),T=s=>{n.value=s},a=s=>{y.value={...y.value,current:s.current||1,pageSize:s.pageSize},F()},d=()=>{!n.value.length||(p.value=!0)},C=U(async s=>{try{await ie(s),p.value=!1,x.success("\u5220\u9664\u6210\u529F"),F()}catch{p.value=!1}},300),B=()=>{C(n.value)},k=U(()=>{c.value=!0},300);return(s,u)=>{const w=o("t-input"),f=o("t-form-item"),g=o("t-col"),M=o("t-row"),V=o("t-button"),H=o("t-form"),J=o("t-table"),Q=o("t-dialog"),q=Y("auth");return E(),$("div",{class:ee(r(b))},[e(H,{ref:"form",data:l.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:r(F),onSubmit:r(F)},{default:t(()=>[e(M,null,{default:t(()=>[e(g,{span:10},{default:t(()=>[e(M,{gutter:[16,24]},{default:t(()=>[e(g,{span:4},{default:t(()=>[e(f,{label:"\u9644\u4EF6\u57DF\u540D",name:"domainUrl"},{default:t(()=>[e(w,{modelValue:l.value.domainUrl,"onUpdate:modelValue":u[0]||(u[0]=i=>l.value.domainUrl=i),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9644\u4EF6\u57DF\u540D"},null,8,["modelValue"])]),_:1})]),_:1}),e(g,{span:4},{default:t(()=>[e(f,{label:"\u9644\u4EF6\u540D\u79F0",name:"name"},{default:t(()=>[e(w,{modelValue:l.value.name,"onUpdate:modelValue":u[1]||(u[1]=i=>l.value.name=i),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9644\u4EF6\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1}),e(g,{span:4},{default:t(()=>[e(f,{label:"\u9644\u4EF6\u539F\u540D",name:"originalName"},{default:t(()=>[e(w,{modelValue:l.value.originalName,"onUpdate:modelValue":u[2]||(u[2]=i=>l.value.originalName=i),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u9644\u4EF6\u539F\u540D"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(g,{span:2,class:"operation-wrapper"},{default:t(()=>[e(V,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[_(" \u67E5\u8BE2 ")]),_:1}),e(V,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[_(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),Z("div",ce,[e(J,{data:r(K),columns:r(re),hover:!0,loading:r(N),pagination:r(y),"selected-row-keys":n.value,"header-affixed-top":{offsetTop:r(h),container:r(S)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:a,onSelectChange:T},{"top-content":t(()=>[e(M,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(g,{flex:"0 0 auto"},{default:t(()=>[L((E(),j(V,{onClick:r(k)},{default:t(()=>[_("\u4E0A\u4F20")]),_:1},8,["onClick"])),[[q,"attach_upload"]]),L((E(),j(V,{theme:"danger",onClick:d},{default:t(()=>[_("\u5220\u9664")]),_:1})),[[q,"attach_delete"]])]),_:1})]),_:1})]),op:t(i=>[L((E(),$("a",{class:"t-button-link",onClick:pe=>R(i)},[_("\u4E0B\u8F7D")],8,de)),[[q,"attach_download"]])]),_:1},8,["data","columns","loading","pagination","selected-row-keys","header-affixed-top"]),e(Q,{visible:p.value,"onUpdate:visible":u[3]||(u[3]=i=>p.value=i),header:"\u786E\u8BA4\u5220\u9664\u5F53\u524D\u6240\u9009\u6570\u636E\uFF1F",onConfirm:B},null,8,["visible"]),e(ne,{visible:c.value,"onUpdate:visible":u[4]||(u[4]=i=>c.value=i)},null,8,["visible"])])],2)}}}),he=O(me,[["__file","D:/Study/tdesign-console/src/views/resource/attach.vue"]]);export{he as default};
