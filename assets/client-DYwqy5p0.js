import{an as j,d as ee,f as c,J as E,a2 as Y,Q as O,r,o as h,m as P,w as t,a as e,s as te,b,W as U,q as y,X as ne,M as H,i as re,as as ue,c as N,e as ie}from"./index-CqGaQ7t4.js";import{u as se}from"./useSetting-CnYQd1RY.js";import{u as de}from"./useDesign-CbWcZHFZ.js";import{u as me}from"./useRequset-Bj5fiv5N.js";import{u as Z}from"./index-BidCcHov.js";const pe=(f,x,I)=>j.get({url:"/blade-system/client/list",params:{...I,current:f,size:x}}),ce=f=>j.get({url:"/blade-system/client/detail",params:{id:f}}),fe=f=>j.post({url:"/blade-system/client/remove",params:{ids:f}},{joinParamsToUrl:!0,errorMessageMode:"message"}),ve=f=>j.post({url:"/blade-system/client/submit",data:f}),be=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"应用ID",colKey:"clientId"},{title:"应用密钥",colKey:"clientSecret"},{title:"授权类型",colKey:"authorizedGrantTypes"},{title:"授权范围",colKey:"scope"},{title:"令牌秒数",colKey:"accessTokenValidity"},{fixed:"right",width:180,colKey:"op",title:"操作",align:"center"}],_e=[{label:"全选",checkAll:!0},{value:"refresh_token",label:"refresh_token"},{value:"password",label:"password"},{value:"authorization_code",label:"authorization_code"},{value:"captcha",label:"captcha"},{value:"social",label:"social"}],ye=ee({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","submit"],setup(f,{emit:x}){const I={clientId:"",clientSecret:"",authorizedGrantTypes:["refresh_token","password","authorization_code"],scope:"all",accessTokenValidity:3600,refreshTokenValidity:604800,webServerRedirectUri:"",resourceIds:"",authorities:"",autoapprove:"",additionalInformation:""},g=f,A=c({clientId:[{required:!0,message:"请输入应用ID",type:"error",trigger:"blur"}],clientSecret:[{required:!0,message:"请输入应用密钥",type:"error",trigger:"blur"}],authorizedGrantTypes:[{required:!0,message:"请选择授权类型",type:"error",trigger:"change"}],scope:[{required:!0,message:"请输入授权范围",type:"error",trigger:"blur"}],accessTokenValidity:[{required:!0,message:"请输入令牌秒数",type:"error",trigger:"blur"}],refreshTokenValidity:[{required:!0,message:"请输入刷新秒数",type:"error",trigger:"blur"}],webServerRedirectUri:[{required:!0,message:"请输入回调地址",type:"error",trigger:"blur"}]}),V=E(()=>`${{view:"查看",edit:"编辑",add:"新增"}[g.actionType]||""}应用`),_=E(()=>({view:!0,edit:!1})[g.actionType]||!1),m=c(!1),a=c({...I}),C=c(null),k=c(!1),w=x,B=({firstError:i})=>{if(i)H.warning(i);else{k.value=!0;const l={...a.value,authorizedGrantTypes:a.value.authorizedGrantTypes.join(","),id:g.editId};ve(l).then(()=>{w("submit",l),H.success("提交成功"),m.value=!1}).finally(()=>{k.value=!1})}},D=()=>{a.value={...I},O(()=>{w("update:editId",""),w("update:actionType","")})},$=()=>{m.value=!1};return Y(()=>m.value,i=>{w("update:visible",i)}),Y(()=>g.visible,i=>{i&&g.editId&&O(()=>{ce(g.editId).then(l=>{a.value={...l,authorizedGrantTypes:l.authorizedGrantTypes.split(",")}})}),O(()=>{var l;(l=C.value)==null||l.clearValidate()}),m.value=i}),(i,l)=>{const p=r("t-input"),s=r("t-form-item"),d=r("t-col"),J=r("t-checkbox-group"),z=r("t-input-number"),L=r("t-textarea"),S=r("t-button"),T=r("t-row"),G=r("t-form"),M=r("t-dialog");return h(),P(M,{visible:m.value,"onUpdate:visible":l[11]||(l[11]=n=>m.value=n),header:V.value,width:780,footer:!1,onClosed:D},{body:t(()=>[e(G,{ref_key:"form",ref:C,class:te({"xy-form__detail":f.actionType==="view"}),data:a.value,rules:A.value,"label-width":100,disabled:_.value||k.value,onSubmit:B},{default:t(()=>[e(T,{gutter:[0,28]},{default:t(()=>[e(d,{span:6},{default:t(()=>[e(s,{label:"应用ID",name:"clientId"},{default:t(()=>[e(p,{modelValue:a.value.clientId,"onUpdate:modelValue":l[0]||(l[0]=n=>a.value.clientId=n),placeholder:"请输入应用ID",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"应用密钥",name:"clientSecret"},{default:t(()=>[e(p,{modelValue:a.value.clientSecret,"onUpdate:modelValue":l[1]||(l[1]=n=>a.value.clientSecret=n),placeholder:"请输入应用密钥",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"授权类型",name:"authorizedGrantTypes"},{default:t(()=>[e(J,{modelValue:a.value.authorizedGrantTypes,"onUpdate:modelValue":l[2]||(l[2]=n=>a.value.authorizedGrantTypes=n),options:b(_e),placeholder:"请选择授权类型"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"授权范围",name:"scope"},{default:t(()=>[e(p,{modelValue:a.value.scope,"onUpdate:modelValue":l[3]||(l[3]=n=>a.value.scope=n),placeholder:"请输入授权范围",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"令牌秒数",name:"accessTokenValidity"},{default:t(()=>[e(z,{modelValue:a.value.accessTokenValidity,"onUpdate:modelValue":l[4]||(l[4]=n=>a.value.accessTokenValidity=n),theme:"column",placeholder:"请输入令牌秒数",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"刷新秒数",name:"refreshTokenValidity"},{default:t(()=>[e(z,{modelValue:a.value.refreshTokenValidity,"onUpdate:modelValue":l[5]||(l[5]=n=>a.value.refreshTokenValidity=n),theme:"column",placeholder:"请输入刷新秒数",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"回调地址",name:"webServerRedirectUri"},{default:t(()=>[e(p,{modelValue:a.value.webServerRedirectUri,"onUpdate:modelValue":l[6]||(l[6]=n=>a.value.webServerRedirectUri=n),placeholder:"请输入回调地址",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"资源集合",name:"resourceIds"},{default:t(()=>[e(p,{modelValue:a.value.resourceIds,"onUpdate:modelValue":l[7]||(l[7]=n=>a.value.resourceIds=n),placeholder:"请输入资源集合",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"权限",name:"authorities"},{default:t(()=>[e(p,{modelValue:a.value.authorities,"onUpdate:modelValue":l[8]||(l[8]=n=>a.value.authorities=n),placeholder:"请输入权限",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"自动授权",name:"autoapprove"},{default:t(()=>[e(p,{modelValue:a.value.autoapprove,"onUpdate:modelValue":l[9]||(l[9]=n=>a.value.autoapprove=n),placeholder:"请输入自动授权",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"附加说明",name:"additionalInformation"},{default:t(()=>[e(L,{modelValue:a.value.additionalInformation,"onUpdate:modelValue":l[10]||(l[10]=n=>a.value.additionalInformation=n),placeholder:"请输入附加说明",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),U(e(d,{span:12},{default:t(()=>[e(s,{style:{float:"right"}},{default:t(()=>[e(S,{variant:"outline",onClick:$},{default:t(()=>l[12]||(l[12]=[y("取消")])),_:1}),e(S,{theme:"primary",type:"submit"},{default:t(()=>l[13]||(l[13]=[y("确定")])),_:1})]),_:1})]),_:1},512),[[ne,!_.value]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),ge={class:"table-wrapper"},Ve=["onClick"],ke=["onClick"],we=["onClick"],Ue=ee({__name:"client",setup(f){const{tableVar:x}=de(),{getTableHeaderAffixedTop:I,getLayoutContainer:g}=se(),A={paramName:"",paramValue:""},V=c([]),_=c({...A}),m=c(!1),a=c(!1),C=c(""),k=c(""),{fetchData:w,data:B,pagination:D,dataLoading:$}=me(pe,_.value,()=>{V.value=[]});re(()=>{w()});const i=({row:v},o)=>{C.value=v.id,k.value=o,a.value=!0},l=({row:v})=>{S.value=v.id,T.value="one",m.value=!0},p=Z(()=>{w()},300),s=v=>{V.value=v},d=v=>{D.value={...D.value,current:v.current||1,pageSize:v.pageSize},p()},z=Z(async v=>{try{await fe(v),m.value=!1,H.success("删除成功"),G(),p()}catch{m.value=!1}},300),L=()=>{V.value.length&&(T.value="check",m.value=!0)},S=c(-1),T=c(),G=()=>{S.value=-1,T.value=""},M=()=>{T.value==="check"&&z(V.value),T.value==="one"&&z([`${S.value}`])},n=()=>{G()};return(v,o)=>{const Q=r("t-input"),W=r("t-form-item"),R=r("t-col"),F=r("t-row"),K=r("t-button"),le=r("t-form"),ae=r("t-table"),oe=r("t-dialog"),q=ue("auth");return h(),N("div",{class:te(b(x))},[e(le,{ref:"form",data:_.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:b(p),onSubmit:b(p)},{default:t(()=>[e(F,null,{default:t(()=>[e(R,{span:10},{default:t(()=>[e(F,{gutter:[16,24]},{default:t(()=>[e(R,{span:4},{default:t(()=>[e(W,{label:"应用ID",name:"paramName"},{default:t(()=>[e(Q,{modelValue:_.value.paramName,"onUpdate:modelValue":o[0]||(o[0]=u=>_.value.paramName=u),clearable:"",placeholder:"请输入应用ID"},null,8,["modelValue"])]),_:1})]),_:1}),e(R,{span:4},{default:t(()=>[e(W,{label:"应用密钥",name:"paramValue"},{default:t(()=>[e(Q,{modelValue:_.value.paramValue,"onUpdate:modelValue":o[1]||(o[1]=u=>_.value.paramValue=u),clearable:"",placeholder:"请输入应用密钥"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(R,{span:2,class:"operation-wrapper"},{default:t(()=>[e(K,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>o[7]||(o[7]=[y(" 查询 ")])),_:1}),e(K,{type:"reset",variant:"base",theme:"default"},{default:t(()=>o[8]||(o[8]=[y(" 重置 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),ie("div",ge,[e(ae,{data:b(B),columns:b(be),hover:!0,loading:b($),pagination:b(D),"selected-row-keys":V.value,"header-affixed-top":{offsetTop:b(I),container:b(g)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:d,onSelectChange:s},{"top-content":t(()=>[e(F,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(R,{flex:"0 0 auto"},{default:t(()=>[U((h(),P(K,{onClick:o[2]||(o[2]=u=>i({row:{}},"add"))},{default:t(()=>o[9]||(o[9]=[y("新增")])),_:1})),[[q,"client_add"]]),U((h(),P(K,{theme:"danger",onClick:L},{default:t(()=>o[10]||(o[10]=[y("删除")])),_:1})),[[q,"client_delete"]])]),_:1})]),_:1})]),op:t(u=>[U((h(),N("a",{class:"t-button-link",onClick:X=>i(u,"view")},o[11]||(o[11]=[y("查看")]),8,Ve)),[[q,"client_view"]]),U((h(),N("a",{class:"t-button-link",onClick:X=>i(u,"edit")},o[12]||(o[12]=[y("编辑")]),8,ke)),[[q,"client_edit"]]),U((h(),N("a",{class:"t-button-link",onClick:X=>l(u)},o[13]||(o[13]=[y("删除")]),8,we)),[[q,"client_delete"]])]),_:1},8,["data","columns","loading","pagination","selected-row-keys","header-affixed-top"]),e(oe,{visible:m.value,"onUpdate:visible":o[3]||(o[3]=u=>m.value=u),header:"确认删除当前所选数据？","on-cancel":n,onConfirm:M},null,8,["visible"]),e(ye,{visible:a.value,"onUpdate:visible":o[4]||(o[4]=u=>a.value=u),editId:C.value,"onUpdate:editId":o[5]||(o[5]=u=>C.value=u),actionType:k.value,"onUpdate:actionType":o[6]||(o[6]=u=>k.value=u),onSubmit:b(p)},null,8,["visible","editId","actionType","onSubmit"])])],2)}}});export{Ue as default};
