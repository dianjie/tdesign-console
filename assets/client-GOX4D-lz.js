import{ar as $,d as ee,f as p,Q as X,a7 as Y,W as O,r as n,o as T,m as P,w as t,a as e,s as te,b,$ as U,q as y,a0 as ne,M as H,i as re,aw as ue,c as N,e as ie}from"./index-vRs8n-Jv.js";import{u as se}from"./useSetting-Bw9xnvhA.js";import{u as de}from"./useDesign-CbWcZHFZ.js";import{u as ce}from"./useRequset-B1q_FhTb.js";import{u as Z}from"./index-4Wxy_Ir-.js";const me=(f,x,I)=>$.get({url:"/blade-system/client/list",params:{...I,current:f,size:x}}),pe=f=>$.get({url:"/blade-system/client/detail",params:{id:f}}),fe=f=>$.post({url:"/blade-system/client/remove",params:{ids:f}},{joinParamsToUrl:!0,errorMessageMode:"message"}),ve=f=>$.post({url:"/blade-system/client/submit",data:f}),be=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"应用ID",colKey:"clientId"},{title:"应用密钥",colKey:"clientSecret"},{title:"授权类型",colKey:"authorizedGrantTypes"},{title:"授权范围",colKey:"scope"},{title:"令牌秒数",colKey:"accessTokenValidity"},{fixed:"right",width:180,colKey:"op",title:"操作",align:"center"}],_e=[{label:"全选",checkAll:!0},{value:"refresh_token",label:"refresh_token"},{value:"password",label:"password"},{value:"authorization_code",label:"authorization_code"},{value:"captcha",label:"captcha"},{value:"social",label:"social"}],ye=ee({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","submit"],setup(f,{emit:x}){const I={clientId:"",clientSecret:"",authorizedGrantTypes:["refresh_token","password","authorization_code"],scope:"all",accessTokenValidity:3600,refreshTokenValidity:604800,webServerRedirectUri:"",resourceIds:"",authorities:"",autoapprove:"",additionalInformation:""},g=f,j=p({clientId:[{required:!0,message:"请输入应用ID",type:"error",trigger:"blur"}],clientSecret:[{required:!0,message:"请输入应用密钥",type:"error",trigger:"blur"}],authorizedGrantTypes:[{required:!0,message:"请选择授权类型",type:"error",trigger:"change"}],scope:[{required:!0,message:"请输入授权范围",type:"error",trigger:"blur"}],accessTokenValidity:[{required:!0,message:"请输入令牌秒数",type:"error",trigger:"blur"}],refreshTokenValidity:[{required:!0,message:"请输入刷新秒数",type:"error",trigger:"blur"}],webServerRedirectUri:[{required:!0,message:"请输入回调地址",type:"error",trigger:"blur"}]}),V=X(()=>`${{view:"查看",edit:"编辑",add:"新增"}[g.actionType]||""}应用`),_=X(()=>({view:!0,edit:!1})[g.actionType]||!1),c=p(!1),l=p({...I}),C=p(null),h=p(!1),k=x,A=({firstError:i})=>{if(i)H.warning(i);else{h.value=!0;const a={...l.value,authorizedGrantTypes:l.value.authorizedGrantTypes.join(","),id:g.editId};ve(a).then(()=>{k("submit",a),H.success("提交成功"),c.value=!1}).finally(()=>{h.value=!1})}},D=()=>{l.value={...I},O(()=>{k("update:editId",""),k("update:actionType","")})},B=()=>{c.value=!1};return Y(()=>c.value,i=>{k("update:visible",i)}),Y(()=>g.visible,i=>{i&&g.editId&&O(()=>{pe(g.editId).then(a=>{l.value={...a,authorizedGrantTypes:a.authorizedGrantTypes.split(",")}})}),O(()=>{var a;(a=C.value)==null||a.clearValidate()}),c.value=i}),(i,a)=>{const m=n("t-input"),s=n("t-form-item"),d=n("t-col"),Q=n("t-checkbox-group"),z=n("t-input-number"),L=n("t-textarea"),S=n("t-button"),w=n("t-row"),G=n("t-form"),M=n("t-dialog");return T(),P(M,{visible:c.value,"onUpdate:visible":a[11]||(a[11]=o=>c.value=o),header:V.value,width:780,footer:!1,onClosed:D},{body:t(()=>[e(G,{ref_key:"form",ref:C,class:te({"xy-form__detail":f.actionType==="view"}),data:l.value,rules:j.value,"label-width":100,disabled:_.value||h.value,onSubmit:A},{default:t(()=>[e(w,{gutter:[0,28]},{default:t(()=>[e(d,{span:6},{default:t(()=>[e(s,{label:"应用ID",name:"clientId"},{default:t(()=>[e(m,{modelValue:l.value.clientId,"onUpdate:modelValue":a[0]||(a[0]=o=>l.value.clientId=o),placeholder:"请输入应用ID",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"应用密钥",name:"clientSecret"},{default:t(()=>[e(m,{modelValue:l.value.clientSecret,"onUpdate:modelValue":a[1]||(a[1]=o=>l.value.clientSecret=o),placeholder:"请输入应用密钥",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"授权类型",name:"authorizedGrantTypes"},{default:t(()=>[e(Q,{modelValue:l.value.authorizedGrantTypes,"onUpdate:modelValue":a[2]||(a[2]=o=>l.value.authorizedGrantTypes=o),options:b(_e),placeholder:"请选择授权类型"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"授权范围",name:"scope"},{default:t(()=>[e(m,{modelValue:l.value.scope,"onUpdate:modelValue":a[3]||(a[3]=o=>l.value.scope=o),placeholder:"请输入授权范围",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"令牌秒数",name:"accessTokenValidity"},{default:t(()=>[e(z,{modelValue:l.value.accessTokenValidity,"onUpdate:modelValue":a[4]||(a[4]=o=>l.value.accessTokenValidity=o),theme:"column",placeholder:"请输入令牌秒数",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"刷新秒数",name:"refreshTokenValidity"},{default:t(()=>[e(z,{modelValue:l.value.refreshTokenValidity,"onUpdate:modelValue":a[5]||(a[5]=o=>l.value.refreshTokenValidity=o),theme:"column",placeholder:"请输入刷新秒数",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"回调地址",name:"webServerRedirectUri"},{default:t(()=>[e(m,{modelValue:l.value.webServerRedirectUri,"onUpdate:modelValue":a[6]||(a[6]=o=>l.value.webServerRedirectUri=o),placeholder:"请输入回调地址",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"资源集合",name:"resourceIds"},{default:t(()=>[e(m,{modelValue:l.value.resourceIds,"onUpdate:modelValue":a[7]||(a[7]=o=>l.value.resourceIds=o),placeholder:"请输入资源集合",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"权限",name:"authorities"},{default:t(()=>[e(m,{modelValue:l.value.authorities,"onUpdate:modelValue":a[8]||(a[8]=o=>l.value.authorities=o),placeholder:"请输入权限",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"自动授权",name:"autoapprove"},{default:t(()=>[e(m,{modelValue:l.value.autoapprove,"onUpdate:modelValue":a[9]||(a[9]=o=>l.value.autoapprove=o),placeholder:"请输入自动授权",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:6},{default:t(()=>[e(s,{label:"附加说明",name:"additionalInformation"},{default:t(()=>[e(L,{modelValue:l.value.additionalInformation,"onUpdate:modelValue":a[10]||(a[10]=o=>l.value.additionalInformation=o),placeholder:"请输入附加说明",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),U(e(d,{span:12},{default:t(()=>[e(s,{style:{float:"right"}},{default:t(()=>[e(S,{variant:"outline",onClick:B},{default:t(()=>[y("取消")]),_:1}),e(S,{theme:"primary",type:"submit"},{default:t(()=>[y("确定")]),_:1})]),_:1})]),_:1},512),[[ne,!_.value]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),ge={class:"table-wrapper"},Ve=["onClick"],he=["onClick"],ke=["onClick"],Ue=ee({__name:"client",setup(f){const{tableVar:x}=de(),{getTableHeaderAffixedTop:I,getLayoutContainer:g}=se(),j={paramName:"",paramValue:""},V=p([]),_=p({...j}),c=p(!1),l=p(!1),C=p(""),h=p(""),{fetchData:k,data:A,pagination:D,dataLoading:B}=ce(me,_.value,()=>{V.value=[]});re(()=>{k()});const i=({row:v},r)=>{C.value=v.id,h.value=r,l.value=!0},a=({row:v})=>{S.value=v.id,w.value="one",c.value=!0},m=Z(()=>{k()},300),s=v=>{V.value=v},d=v=>{D.value={...D.value,current:v.current||1,pageSize:v.pageSize},m()},z=Z(async v=>{try{await fe(v),c.value=!1,H.success("删除成功"),G(),m()}catch{c.value=!1}},300),L=()=>{V.value.length&&(w.value="check",c.value=!0)},S=p(-1),w=p(),G=()=>{S.value=-1,w.value=""},M=()=>{w.value==="check"&&z(V.value),w.value==="one"&&z([`${S.value}`])},o=()=>{G()};return(v,r)=>{const W=n("t-input"),E=n("t-form-item"),R=n("t-col"),F=n("t-row"),K=n("t-button"),ae=n("t-form"),le=n("t-table"),oe=n("t-dialog"),q=ue("auth");return T(),N("div",{class:te(b(x))},[e(ae,{ref:"form",data:_.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:b(m),onSubmit:b(m)},{default:t(()=>[e(F,null,{default:t(()=>[e(R,{span:10},{default:t(()=>[e(F,{gutter:[16,24]},{default:t(()=>[e(R,{span:4},{default:t(()=>[e(E,{label:"应用ID",name:"paramName"},{default:t(()=>[e(W,{modelValue:_.value.paramName,"onUpdate:modelValue":r[0]||(r[0]=u=>_.value.paramName=u),clearable:"",placeholder:"请输入应用ID"},null,8,["modelValue"])]),_:1})]),_:1}),e(R,{span:4},{default:t(()=>[e(E,{label:"应用密钥",name:"paramValue"},{default:t(()=>[e(W,{modelValue:_.value.paramValue,"onUpdate:modelValue":r[1]||(r[1]=u=>_.value.paramValue=u),clearable:"",placeholder:"请输入应用密钥"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(R,{span:2,class:"operation-wrapper"},{default:t(()=>[e(K,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[y(" 查询 ")]),_:1}),e(K,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[y(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),ie("div",ge,[e(le,{data:b(A),columns:b(be),hover:!0,loading:b(B),pagination:b(D),"selected-row-keys":V.value,"header-affixed-top":{offsetTop:b(I),container:b(g)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:d,onSelectChange:s},{"top-content":t(()=>[e(F,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(R,{flex:"0 0 auto"},{default:t(()=>[U((T(),P(K,{onClick:r[2]||(r[2]=u=>i({row:{}},"add"))},{default:t(()=>[y("新增")]),_:1})),[[q,"client_add"]]),U((T(),P(K,{theme:"danger",onClick:L},{default:t(()=>[y("删除")]),_:1})),[[q,"client_delete"]])]),_:1})]),_:1})]),op:t(u=>[U((T(),N("a",{class:"t-button-link",onClick:J=>i(u,"view")},[y("查看")],8,Ve)),[[q,"client_view"]]),U((T(),N("a",{class:"t-button-link",onClick:J=>i(u,"edit")},[y("编辑")],8,he)),[[q,"client_edit"]]),U((T(),N("a",{class:"t-button-link",onClick:J=>a(u)},[y("删除")],8,ke)),[[q,"client_delete"]])]),_:1},8,["data","columns","loading","pagination","selected-row-keys","header-affixed-top"]),e(oe,{visible:c.value,"onUpdate:visible":r[3]||(r[3]=u=>c.value=u),header:"确认删除当前所选数据？","on-cancel":o,onConfirm:M},null,8,["visible"]),e(ye,{visible:l.value,"onUpdate:visible":r[4]||(r[4]=u=>l.value=u),editId:C.value,"onUpdate:editId":r[5]||(r[5]=u=>C.value=u),actionType:h.value,"onUpdate:actionType":r[6]||(r[6]=u=>h.value=u),onSubmit:b(m)},null,8,["visible","editId","actionType","onSubmit"])])],2)}}});export{Ue as default};
