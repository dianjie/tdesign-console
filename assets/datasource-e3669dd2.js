import{ar as A,d as Z,f as i,Q as J,a7 as X,W as Q,r,o as D,m as P,w as t,a as e,s as ee,b as c,$ as S,q as g,a0 as se,M as E,i as ue,aw as de,c as $,e as ie}from"./index-357a89bc.js";import{u as ce}from"./useSetting-8eb1f197.js";import{u as me}from"./useDesign-16212514.js";import{u as pe}from"./useRequset-d4265618.js";import{u as Y}from"./index-1d3f8cec.js";const ve=(m,j,h)=>A.get({url:"/blade-develop/datasource/list",params:{...h,current:m,size:j}},{joinTime:!1}),fe=m=>A.get({url:"/blade-develop/datasource/detail",params:{id:m}}),be=m=>A.post({url:"/blade-develop/datasource/remove",params:{ids:m}},{joinParamsToUrl:!0,errorMessageMode:"message"}),_e=m=>A.post({url:"/blade-develop/datasource/submit",data:m},{errorMessageMode:"message"}),ge=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"名称",colKey:"name"},{title:"驱动类",colKey:"driverClass"},{title:"用户名",colKey:"username"},{title:"连接地址",colKey:"url"},{fixed:"right",width:180,colKey:"op",title:"操作",align:"center"}],te=[{dictKey:"com.mysql.cj.jdbc.Driver",dictValue:"com.mysql.cj.jdbc.Driver"},{dictKey:"org.postgresql.Driver",dictValue:"org.postgresql.Driver"},{dictKey:"oracle.jdbc.OracleDriver",dictValue:"oracle.jdbc.OracleDriver"},{dictKey:"com.microsoft.sqlserver.jdbc.SQLServerDriver",dictValue:"com.microsoft.sqlserver.jdbc.SQLServerDriver"},{dictKey:"dm.jdbc.driver.DmDriver",dictValue:"dm.jdbc.driver.DmDriver"}],ye=Z({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","submit"],setup(m,{emit:j}){const h={name:"",driverClass:"",username:"",password:"",url:"",remark:""},y=m,B=i({name:[{required:!0,message:"请输入名称",type:"error",trigger:"blur"}],driverClass:[{required:!0,message:"请选择驱动类",type:"error",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",type:"error",trigger:"blur"}],password:[{required:!0,message:"请输入密码",type:"error",trigger:"blur"}],url:[{required:!0,message:"请输入连接地址",type:"error",trigger:"blur"}]}),V=J(()=>`${{view:"查看",edit:"编辑",add:"新增"}[y.actionType]||""}数据源`),p=J(()=>({view:!0,edit:!1})[y.actionType]||!1),d=i(!1),l=i({...h}),x=i(null),C=i(!1),w=j,N=({firstError:u})=>{if(u)E.warning(u);else{C.value=!0;const a={...l.value,id:y.editId};_e(a).then(()=>{w("submit",a),E.success("提交成功"),d.value=!1}).finally(()=>{C.value=!1})}},U=()=>{l.value={...h},Q(()=>{w("update:editId",""),w("update:actionType","")})},F=()=>{d.value=!1};return X(()=>d.value,u=>{w("update:visible",u)}),X(()=>y.visible,u=>{u&&y.editId&&Q(()=>{fe(y.editId).then(a=>{l.value={...a}})}),Q(()=>{var a;(a=x.value)==null||a.clearValidate()}),d.value=u}),(u,a)=>{const f=r("t-input"),b=r("t-form-item"),_=r("t-col"),H=r("t-select"),I=r("t-textarea"),L=r("t-button"),K=r("t-row"),k=r("t-form"),R=r("t-dialog");return D(),P(R,{visible:d.value,"onUpdate:visible":a[6]||(a[6]=s=>d.value=s),header:V.value,width:780,footer:!1,onClosed:U},{body:t(()=>[e(k,{ref_key:"form",ref:x,class:ee({"xy-form__detail":m.actionType==="view"}),data:l.value,rules:B.value,"label-width":100,disabled:p.value||C.value,onSubmit:N},{default:t(()=>[e(K,{gutter:[0,28]},{default:t(()=>[e(_,{span:6},{default:t(()=>[e(b,{label:"名称",name:"name"},{default:t(()=>[e(f,{modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=s=>l.value.name=s),clearable:"",placeholder:"请输入名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:t(()=>[e(b,{label:"驱动类",name:"driverClass"},{default:t(()=>[e(H,{modelValue:l.value.driverClass,"onUpdate:modelValue":a[1]||(a[1]=s=>l.value.driverClass=s),options:c(te),keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择驱动类"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(_,{span:6},{default:t(()=>[e(b,{label:"用户名",name:"username"},{default:t(()=>[e(f,{modelValue:l.value.username,"onUpdate:modelValue":a[2]||(a[2]=s=>l.value.username=s),clearable:"",placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:6},{default:t(()=>[e(b,{label:"密码",name:"password"},{default:t(()=>[e(f,{modelValue:l.value.password,"onUpdate:modelValue":a[3]||(a[3]=s=>l.value.password=s),clearable:"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(b,{label:"连接地址",name:"url"},{default:t(()=>[e(I,{modelValue:l.value.url,"onUpdate:modelValue":a[4]||(a[4]=s=>l.value.url=s),placeholder:"请输入连接地址",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(_,{span:12},{default:t(()=>[e(b,{label:"备注",name:"remark"},{default:t(()=>[e(I,{modelValue:l.value.remark,"onUpdate:modelValue":a[5]||(a[5]=s=>l.value.remark=s),placeholder:"请输入备注",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),S(e(_,{span:12},{default:t(()=>[e(b,{style:{float:"right"}},{default:t(()=>[e(L,{variant:"outline",onClick:F},{default:t(()=>[g("取消")]),_:1}),e(L,{theme:"primary",type:"submit"},{default:t(()=>[g("确定")]),_:1})]),_:1})]),_:1},512),[[se,!p.value]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),Ve={class:"table-wrapper"},Ce=["onClick"],we=["onClick"],ke=["onClick"],je=Z({__name:"datasource",setup(m){const{tableVar:j}=me(),{getTableHeaderAffixedTop:h,getLayoutContainer:y}=ce(),B={name:"",driverClass:"",username:""},V=i([]),p=i({...B}),d=i(!1),l=i(!1),x=i(""),C=i(""),{fetchData:w,data:N,pagination:U,dataLoading:F}=pe(ve,p.value,()=>{V.value=[]});ue(()=>{w()});const u=({row:v},o)=>{x.value=v.id,C.value=o,l.value=!0},a=({row:v})=>{K.value=v.id,k.value="one",d.value=!0},f=Y(()=>{w()},300),b=v=>{V.value=v},_=v=>{U.value={...U.value,current:v.current||1,pageSize:v.pageSize},f()},I=Y(async v=>{try{await be(v),d.value=!1,E.success("删除成功"),R(),f()}catch{d.value=!1}},300),L=()=>{V.value.length&&(k.value="check",d.value=!0)},K=i(-1),k=i(),R=()=>{K.value=-1,k.value=""},s=()=>{k.value==="check"&&I(V.value),k.value==="one"&&I([`${K.value}`])},ae=()=>{R()};return(v,o)=>{const W=r("t-input"),z=r("t-form-item"),T=r("t-col"),le=r("t-select"),O=r("t-row"),M=r("t-button"),oe=r("t-form"),ne=r("t-table"),re=r("t-dialog"),q=de("auth");return D(),$("div",{class:ee(c(j))},[e(oe,{ref:"form",data:p.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:c(f),onSubmit:c(f)},{default:t(()=>[e(O,null,{default:t(()=>[e(T,{span:10},{default:t(()=>[e(O,{gutter:[16,24]},{default:t(()=>[e(T,{span:4},{default:t(()=>[e(z,{label:"名称",name:"name"},{default:t(()=>[e(W,{modelValue:p.value.name,"onUpdate:modelValue":o[0]||(o[0]=n=>p.value.name=n),clearable:"",placeholder:"请输入名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(T,{span:4},{default:t(()=>[e(z,{label:"驱动类",name:"driverClass"},{default:t(()=>[e(le,{modelValue:p.value.driverClass,"onUpdate:modelValue":o[1]||(o[1]=n=>p.value.driverClass=n),options:c(te),keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择驱动类"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(T,{span:4},{default:t(()=>[e(z,{label:"用户名",name:"username"},{default:t(()=>[e(W,{modelValue:p.value.username,"onUpdate:modelValue":o[2]||(o[2]=n=>p.value.username=n),clearable:"",placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(T,{span:2,class:"operation-wrapper"},{default:t(()=>[e(M,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[g(" 查询 ")]),_:1}),e(M,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[g(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),ie("div",Ve,[e(ne,{data:c(N),columns:c(ge),hover:!0,loading:c(F),pagination:c(U),"selected-row-keys":V.value,"header-affixed-top":{offsetTop:c(h),container:c(y)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:_,onSelectChange:b},{"top-content":t(()=>[e(O,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(T,{flex:"0 0 auto"},{default:t(()=>[S((D(),P(M,{onClick:o[3]||(o[3]=n=>u({row:{}},"add"))},{default:t(()=>[g("新增")]),_:1})),[[q,"datasource_add"]]),S((D(),P(M,{theme:"danger",onClick:L},{default:t(()=>[g("删除")]),_:1})),[[q,"datasource_delete"]])]),_:1})]),_:1})]),op:t(n=>[S((D(),$("a",{class:"t-button-link",onClick:G=>u(n,"view")},[g("查看")],8,Ce)),[[q,"datasource_view"]]),S((D(),$("a",{class:"t-button-link",onClick:G=>u(n,"edit")},[g("编辑")],8,we)),[[q,"datasource_edit"]]),S((D(),$("a",{class:"t-button-link",onClick:G=>a(n)},[g("删除")],8,ke)),[[q,"datasource_delete"]])]),_:1},8,["data","columns","loading","pagination","selected-row-keys","header-affixed-top"]),e(re,{visible:d.value,"onUpdate:visible":o[4]||(o[4]=n=>d.value=n),header:"确认删除当前所选数据？","on-cancel":ae,onConfirm:s},null,8,["visible"]),e(ye,{visible:l.value,"onUpdate:visible":o[5]||(o[5]=n=>l.value=n),editId:x.value,"onUpdate:editId":o[6]||(o[6]=n=>x.value=n),actionType:C.value,"onUpdate:actionType":o[7]||(o[7]=n=>C.value=n),onSubmit:c(f)},null,8,["visible","editId","actionType","onSubmit"])])],2)}}});export{je as default};
