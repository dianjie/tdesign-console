import{d as B}from"./flow-B7-XLsLu.js";import{g as T}from"./tenant-BMboSEoV.js";import{u as A}from"./useDesign-CbWcZHFZ.js";import{d as O,aH as j,g as c,aj as L,r as n,o as b,c as R,a as e,w as t,b as i,s as f,n as z,q as H,v as K,M as _}from"./index-xQy0Awhn.js";import{g as P}from"./flowHelper-4SXkDRtc.js";import{u as $}from"./index-vN_i3xzp.js";const Z=O({__name:"deploy",setup(E){const{tableVar:y}=A(),V=j().getFlowDict,g=c([]);async function w(){const l=await T();g.value=l}L(()=>{w()});const h={categoryValue:"",flowMode:1,tenantId:[],attachFile:[]},F=c({categoryValue:[{required:!0,message:"请选择流程类型",type:"error",trigger:"change"}],flowMode:[{required:!0,message:"请选择流程模式",type:"error",trigger:"change"}],tenantId:[{required:!0,message:"请选择所属租户",type:"error",trigger:"change"}],attachFile:[{required:!0,message:"请选择附件",type:"error",trigger:"change"}]}),a=c({...h}),I=c(null),d=c(!1),v=c(),M=$(({firstError:l})=>{l?_.warning(l):(d.value=!0,v.value.uploadFiles())},300),k=({file:l})=>{_.error(`流程 ${l.name} 部署失败`),d.value=!1},q=async l=>{try{const{categoryValue:o,flowMode:m,tenantId:s}=i(a),u={tenantId:m===2?s.join(","):""};return{status:"success",response:{...await B(P(o),u.tenantId,l.raw),url:"success"}}}catch{return{status:"fail",error:"部署失败"}}},D=()=>{_.success("部署成功"),d.value=!1};return(l,o)=>{const m=n("t-select"),s=n("t-form-item"),u=n("t-col"),p=n("t-radio"),S=n("t-radio-group"),C=n("t-upload"),x=n("t-button"),N=n("t-row"),U=n("t-form");return b(),R("div",{class:K(i(y))},[e(U,{ref_key:"form",ref:I,data:a.value,rules:F.value,"label-width":100,disabled:d.value,onSubmit:i(M)},{default:t(()=>[e(N,{gutter:[0,28]},{default:t(()=>[e(u,{span:6},{default:t(()=>[e(s,{label:"流程类型",name:"categoryValue"},{default:t(()=>[e(m,{modelValue:a.value.categoryValue,"onUpdate:modelValue":o[0]||(o[0]=r=>a.value.categoryValue=r),options:i(V),keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择流程类型"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(u,{span:12},{default:t(()=>[e(s,{label:"流程模式",name:"flowMode"},{default:t(()=>[e(S,{modelValue:a.value.flowMode,"onUpdate:modelValue":o[1]||(o[1]=r=>a.value.flowMode=r)},{default:t(()=>[e(p,{value:1},{default:t(()=>[f("通用流程")]),_:1}),e(p,{value:2},{default:t(()=>[f("定制流程")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a.value.flowMode===2?(b(),z(u,{key:0,span:6},{default:t(()=>[e(s,{label:"所属租户",name:"tenantId"},{default:t(()=>[e(m,{modelValue:a.value.tenantId,"onUpdate:modelValue":o[2]||(o[2]=r=>a.value.tenantId=r),multiple:"",options:g.value,keys:{value:"tenantId",label:"tenantName"},clearable:"",placeholder:"请选择所属租户"},null,8,["modelValue","options"])]),_:1})]),_:1})):H("",!0),e(u,{span:12},{default:t(()=>[e(s,{label:"附件上传",name:"attachFile"},{default:t(()=>[e(C,{ref_key:"uploadRef",ref:v,modelValue:a.value.attachFile,"onUpdate:modelValue":o[3]||(o[3]=r=>a.value.attachFile=r),tips:"请上传 bpmn20.xml 标准格式文件","auto-upload":!1,"request-method":q,disabled:d.value,onFail:k,onSuccess:D},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(u,{span:12},{default:t(()=>[e(s,null,{default:t(()=>[e(x,{theme:"primary",disabled:d.value,type:"submit"},{default:t(()=>[f("部署")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled","onSubmit"])],2)}}});export{Z as default};
