import{d as x,aO as N,r as c,X as U,e as l,f as v,i as O,l as e,w as t,j as m,p as f,g as T,m as j,q as L,M as _,_ as R}from"./index.ec7ccd34.js";import{u as z}from"./useDesign.9d0ca2bc.js";import{g as K}from"./tenant.7ddd33a6.js";import{g as P}from"./flowHelper.982d6905.js";import{d as X}from"./flow.775cb724.js";import{u as $}from"./index.6fae05ac.js";const G=x({__name:"deploy",setup(H){const{tableVar:y}=z(),B=N().getFlowDict,g=c([]);async function b(){const o=await K();g.value=o}U(()=>{b()});const V={categoryValue:"",flowMode:1,tenantId:[],attachFile:[]},w=c({categoryValue:[{required:!0,message:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u7C7B\u578B",type:"error",trigger:"change"}],flowMode:[{required:!0,message:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u6A21\u5F0F",type:"error",trigger:"change"}],tenantId:[{required:!0,message:"\u8BF7\u9009\u62E9\u6240\u5C5E\u79DF\u6237",type:"error",trigger:"change"}],attachFile:[{required:!0,message:"\u8BF7\u9009\u62E9\u9644\u4EF6",type:"error",trigger:"change"}]}),u=c({...V}),D=c(null),d=c(!1),F=c(),E=$(({firstError:o})=>{o?_.warning(o):(d.value=!0,F.value.uploadFiles())},300),A=({file:o})=>{_.error(`\u6D41\u7A0B ${o.name} \u90E8\u7F72\u5931\u8D25`),d.value=!1},C=async o=>{try{const{categoryValue:a,flowMode:i,tenantId:n}=m(u),s={tenantId:i===2?n.join(","):""};return{status:"success",response:{...await X(P(a),s.tenantId,o.raw),url:"success"}}}catch{return{status:"fail",error:"\u90E8\u7F72\u5931\u8D25"}}},h=()=>{_.success("\u90E8\u7F72\u6210\u529F"),d.value=!1};return(o,a)=>{const i=l("t-select"),n=l("t-form-item"),s=l("t-col"),p=l("t-radio"),I=l("t-radio-group"),M=l("t-upload"),k=l("t-button"),S=l("t-row"),q=l("t-form");return v(),O("div",{class:L(m(y))},[e(q,{ref_key:"form",ref:D,data:u.value,rules:w.value,"label-width":100,disabled:d.value,onSubmit:m(E)},{default:t(()=>[e(S,{gutter:[0,28]},{default:t(()=>[e(s,{span:6},{default:t(()=>[e(n,{label:"\u6D41\u7A0B\u7C7B\u578B",name:"categoryValue"},{default:t(()=>[e(i,{modelValue:u.value.categoryValue,"onUpdate:modelValue":a[0]||(a[0]=r=>u.value.categoryValue=r),options:m(B),keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u7C7B\u578B"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(s,{span:12},{default:t(()=>[e(n,{label:"\u6D41\u7A0B\u6A21\u5F0F",name:"flowMode"},{default:t(()=>[e(I,{modelValue:u.value.flowMode,"onUpdate:modelValue":a[1]||(a[1]=r=>u.value.flowMode=r)},{default:t(()=>[e(p,{value:1},{default:t(()=>[f("\u901A\u7528\u6D41\u7A0B")]),_:1}),e(p,{value:2},{default:t(()=>[f("\u5B9A\u5236\u6D41\u7A0B")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),u.value.flowMode===2?(v(),T(s,{key:0,span:6},{default:t(()=>[e(n,{label:"\u6240\u5C5E\u79DF\u6237",name:"tenantId"},{default:t(()=>[e(i,{modelValue:u.value.tenantId,"onUpdate:modelValue":a[2]||(a[2]=r=>u.value.tenantId=r),multiple:"",options:g.value,keys:{value:"tenantId",label:"tenantName"},clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6240\u5C5E\u79DF\u6237"},null,8,["modelValue","options"])]),_:1})]),_:1})):j("v-if",!0),e(s,{span:12},{default:t(()=>[e(n,{label:"\u9644\u4EF6\u4E0A\u4F20",name:"attachFile"},{default:t(()=>[e(M,{ref_key:"uploadRef",ref:F,modelValue:u.value.attachFile,"onUpdate:modelValue":a[3]||(a[3]=r=>u.value.attachFile=r),tips:"\u8BF7\u4E0A\u4F20 bpmn20.xml \u6807\u51C6\u683C\u5F0F\u6587\u4EF6","auto-upload":!1,"request-method":C,disabled:d.value,onFail:A,onSuccess:h},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(s,{span:12},{default:t(()=>[e(n,null,{default:t(()=>[e(k,{theme:"primary",disabled:d.value,type:"submit"},{default:t(()=>[f("\u90E8\u7F72")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled","onSubmit"])],2)}}}),te=R(G,[["__file","D:/Study/tdesign-console/src/views/flow/deploy.vue"]]);export{te as default};
