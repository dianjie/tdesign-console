import{d as se,r as n,C as ne,aJ as ye,ax as Z,av as P,e as s,f as F,g as ae,w as t,m as de,l as e,q as ie,j as r,J as k,p as c,K as Fe,M as le,_ as re,aK as Ce,aE as De,aL as he,X as Ie,a as we,aG as Be,i as O,n as ke,t as ee,aM as Ae,aI as Ve,aC as Ee,aD as xe}from"./index.c2521a03.js";import{u as Ne}from"./useDesign.9d0ca2bc.js";import{u as Te}from"./useSetting.65510119.js";import{u as Se}from"./useRequset.5f7a0394.js";import{g as Ue}from"./tenant.5b276736.js";import{g as Ke,s as Oe,a as Le,b as Re,r as $e}from"./dept.c8149e7b.js";import{u as te}from"./index.d71d3bee.js";const je=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"\u5E8F\u53F7",width:80,align:"center",fixed:"left"},{title:"\u673A\u6784\u540D\u79F0",colKey:"deptName",ellipsis:!0,width:200},{title:"\u6240\u5C5E\u79DF\u6237",colKey:"tenantId",ellipsis:!0,width:200},{title:"\u673A\u6784\u5168\u79F0",colKey:"fullName",ellipsis:!0,width:200},{title:"\u673A\u6784\u7C7B\u578B",colKey:"deptCategory",width:150,ellipsis:!0},{title:"\u6392\u5E8F",width:80,colKey:"sort",ellipsis:!0},{fixed:"right",width:180,colKey:"op",title:"\u64CD\u4F5C",align:"center"}],qe=se({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""},parentId:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","update:parentId","submit"],setup(j,{emit:C}){const f=j,L={deptName:"",fullName:"",parentId:null,deptCategory:void 0,sort:void 0,remark:""},q=n({deptName:[{required:!0,message:"\u8BF7\u8F93\u5165\u673A\u6784\u540D\u79F0",type:"error",trigger:"blur"}],fullName:[{required:!0,message:"\u8BF7\u8F93\u5165\u673A\u6784\u5168\u79F0",type:"error",trigger:"blur"}],deptCategory:[{required:!0,message:"\u8BF7\u9009\u62E9\u673A\u6784\u7C7B\u578B",type:"error",trigger:"change"}],sort:[{required:!0,message:"\u8BF7\u8F93\u5165\u6392\u5E8F",type:"error",trigger:"blur"}]}),M=ne(()=>`${{view:"\u67E5\u770B",edit:"\u7F16\u8F91",add:"\u65B0\u589E"}[f.actionType]||""}\u673A\u6784`),b=ne(()=>({view:!0,edit:!1})[f.actionType]||!1),v=ye("deptCategoryOptions")||[],g=n(!1),o=n({...L}),D=n([]),I=n(null),y=n(!1),A=({firstError:i})=>{if(i)le.warning(i);else{y.value=!0;const a={...o.value,id:f.editId};Oe(a).then(()=>{C("submit",a),le.success("\u63D0\u4EA4\u6210\u529F"),g.value=!1}).finally(()=>{y.value=!1})}},V=()=>{o.value={...L},P(()=>{C("update:editId",""),C("update:actionType",""),C("update:parentId","")})},E=()=>{g.value=!1},x=()=>{Le().then(i=>{D.value=i})};return Z(()=>g.value,i=>{C("update:visible",i)}),Z(()=>f.parentId,i=>{o.value.parentId=i}),Z(()=>f.visible,i=>{i&&x(),i&&f.editId&&P(()=>{Ke(f.editId).then(a=>{o.value={...a}})}),P(()=>{var a;(a=I.value)==null||a.clearValidate()}),g.value=i}),(i,a)=>{const R=s("t-input"),_=s("t-form-item"),m=s("t-col"),z=s("t-tree-select"),J=s("t-select"),w=s("t-input-number"),B=s("t-textarea"),$=s("t-button"),N=s("t-row"),G=s("t-form"),H=s("t-dialog");return F(),ae(H,{visible:g.value,"onUpdate:visible":a[6]||(a[6]=p=>g.value=p),header:r(M),width:780,footer:!1,onClosed:V},{body:t(()=>[de(" \u8868\u5355\u5185\u5BB9 "),e(G,{ref_key:"form",ref:I,class:ie({"xy-form__detail":j.actionType==="view"}),data:o.value,rules:q.value,"label-width":100,disabled:r(b)||y.value,onSubmit:A},{default:t(()=>[e(N,{gutter:[0,28]},{default:t(()=>[e(m,{span:6},{default:t(()=>[e(_,{label:"\u673A\u6784\u540D\u79F0",name:"deptName"},{default:t(()=>[e(R,{modelValue:o.value.deptName,"onUpdate:modelValue":a[0]||(a[0]=p=>o.value.deptName=p),placeholder:"\u8BF7\u8F93\u5165\u673A\u6784\u540D\u79F0",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(_,{label:"\u673A\u6784\u5168\u79F0",name:"fullName"},{default:t(()=>[e(R,{modelValue:o.value.fullName,"onUpdate:modelValue":a[1]||(a[1]=p=>o.value.fullName=p),placeholder:"\u8BF7\u8F93\u5165\u673A\u6784\u5168\u79F0",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(_,{label:"\u4E0A\u7EA7\u673A\u6784",name:"parentId"},{default:t(()=>[e(z,{modelValue:o.value.parentId,"onUpdate:modelValue":a[2]||(a[2]=p=>o.value.parentId=p),data:D.value,"popup-props":{overlayStyle:{width:"300px"},overlayInnerStyle:{width:"300px"}},"tree-props":{keys:{label:"title",value:"id",children:"children"}},disabled:!!f.parentId,clearable:"",placeholder:"\u8BF7\u9009\u62E9\u4E0A\u7EA7\u673A\u6784"},null,8,["modelValue","data","disabled"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(_,{label:"\u673A\u6784\u7C7B\u578B",name:"deptCategory"},{default:t(()=>[e(J,{modelValue:o.value.deptCategory,"onUpdate:modelValue":a[3]||(a[3]=p=>o.value.deptCategory=p),options:r(v),keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"\u8BF7\u9009\u62E9\u673A\u6784\u7C7B\u578B"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(_,{label:"\u6392\u5E8F",name:"sort"},{default:t(()=>[e(w,{modelValue:o.value.sort,"onUpdate:modelValue":a[4]||(a[4]=p=>o.value.sort=p),theme:"column",placeholder:"\u8BF7\u8F93\u5165\u6392\u5E8F",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:t(()=>[e(_,{label:"\u5907\u6CE8",name:"remark"},{default:t(()=>[e(B,{modelValue:o.value.remark,"onUpdate:modelValue":a[5]||(a[5]=p=>o.value.remark=p),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),k(e(m,{span:12},{default:t(()=>[e(_,{style:{float:"right"}},{default:t(()=>[e($,{variant:"outline",onClick:E},{default:t(()=>[c("\u53D6\u6D88")]),_:1}),e($,{theme:"primary",type:"submit"},{default:t(()=>[c("\u786E\u5B9A")]),_:1})]),_:1})]),_:1},512),[[Fe,!r(b)]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),Me=re(qe,[["__file","D:/Study/tdesign-console/src/viewsBusiness/system/components/dept/DialogForm.vue"]]),ze={class:"table-wrapper"},Je=["onClick"],Ge=["onClick"],He=["onClick"],Xe=["onClick"],Qe=se({__name:"dept",setup(j){const{tableVar:C}=Ne(),{getTableHeaderAffixedTop:f,getLayoutContainer:L}=Te(),{hasRole:q}=Ce(),M={deptName:"",fullName:"",tenantId:"",parentId:""},b=n([]),v=n({...M}),g=De({childrenKey:"children",treeNodeColumnIndex:2}),o=n(!1),D=n(!1),I=n(""),y=n(""),A=n(""),V=n({}),E=n([]),x=n([]);async function i(){const d=await Ue(),l=await Ee("org_category");E.value=d,x.value=xe(l)}he("deptCategoryOptions",x),Ie(()=>{i()});const{fetchData:a,data:R,dataLoading:_}=Se(Re,v.value,()=>{b.value=[]},!1);we(()=>{a()});const m=({row:d},l)=>{V.value=d,I.value=d.id,y.value=l,D.value=!0},z=({row:d})=>{A.value=d.id,y.value="add",D.value=!0},J=({row:d})=>{X.value=d.id,T.value="one",o.value=!0},w=n(!1),B=n(null),$=()=>{w.value=!w.value,w.value?B.value.expandAll():B.value.foldAll()},N=te(()=>{a()},300),G=te($,300),H=d=>{b.value=d},ue=te(async d=>{try{await $e(d),o.value=!1,le.success("\u5220\u9664\u6210\u529F"),oe(),N()}catch{o.value=!1}},300),pe=()=>{!b.value.length||(T.value="check",o.value=!0)},X=n(-1),T=n(),oe=()=>{X.value=-1,T.value=""},ce=()=>{T.value==="check"&&ue(b.value),T.value==="one"&&ue([`${X.value}`])},me=()=>{oe()},fe=d=>{var S;const{parentId:l}=r(V.value);d.parentId!==l?a():d.id&&((S=B.value)==null||S.setData(d.id,{...V.value,...d}))};return(d,l)=>{const S=s("t-input"),Q=s("t-form-item"),h=s("t-col"),ve=s("t-select"),W=s("t-row"),U=s("t-button"),_e=s("t-form"),be=s("t-enhanced-table"),ge=s("t-dialog"),K=Be("auth");return F(),O("div",{class:ie(r(C))},[e(_e,{ref:"form",data:v.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:r(N),onSubmit:r(N)},{default:t(()=>[e(W,null,{default:t(()=>[e(h,{span:10},{default:t(()=>[e(W,{gutter:[16,24]},{default:t(()=>[e(h,{span:4},{default:t(()=>[e(Q,{label:"\u673A\u6784\u540D\u79F0",name:"deptName"},{default:t(()=>[e(S,{modelValue:v.value.deptName,"onUpdate:modelValue":l[0]||(l[0]=u=>v.value.deptName=u),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u673A\u6784\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1}),e(h,{span:4},{default:t(()=>[e(Q,{label:"\u6240\u5C5E\u79DF\u6237",name:"tenantId"},{default:t(()=>[e(ve,{modelValue:v.value.tenantId,"onUpdate:modelValue":l[1]||(l[1]=u=>v.value.tenantId=u),options:E.value,keys:{value:"tenantId",label:"tenantName"},clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6240\u5C5E\u79DF\u6237"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(h,{span:4},{default:t(()=>[e(Q,{label:"\u673A\u6784\u5168\u79F0",name:"fullName"},{default:t(()=>[e(S,{modelValue:v.value.fullName,"onUpdate:modelValue":l[2]||(l[2]=u=>v.value.fullName=u),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u673A\u6784\u5168\u79F0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(h,{span:2,class:"operation-wrapper"},{default:t(()=>[e(U,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[c(" \u67E5\u8BE2 ")]),_:1}),e(U,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[c(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),ke("div",ze,[e(be,{ref_key:"enhancedTable",ref:B,data:r(R),columns:r(je),hover:!0,loading:r(_),tree:g,"selected-row-keys":b.value,"header-affixed-top":{offsetTop:r(f),container:r(L)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onSelectChange:H},{"top-content":t(()=>[e(W,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(h,{flex:"0 0 auto"},{default:t(()=>[k((F(),ae(U,{onClick:l[3]||(l[3]=u=>m({row:{}},"add"))},{default:t(()=>[c("\u65B0\u589E")]),_:1})),[[K,"dept_add"]]),k((F(),ae(U,{theme:"danger",onClick:pe},{default:t(()=>[c("\u5220\u9664")]),_:1})),[[K,"dept_delete"]])]),_:1}),e(h,{flex:"0 0 auto"},{default:t(()=>[e(U,{theme:"default",onClick:r(G)},{default:t(()=>[c(ee(w.value?"\u6536\u8D77\u5168\u90E8":"\u5C55\u5F00\u5168\u90E8"),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),tenantId:t(({row:u})=>[c(ee(r(Ae)(E.value,u.tenantId,{id:"tenantId",name:"tenantName"})),1)]),deptCategory:t(({row:u})=>[c(ee(r(Ve)(x.value,u.deptCategory)),1)]),op:t(u=>[k((F(),O("a",{class:"t-button-link",onClick:Y=>m(u,"view")},[c("\u67E5\u770B")],8,Je)),[[K,"dept_view"]]),k((F(),O("a",{class:"t-button-link",onClick:Y=>m(u,"edit")},[c("\u7F16\u8F91")],8,Ge)),[[K,"dept_edit"]]),k((F(),O("a",{class:"t-button-link",onClick:Y=>J(u)},[c("\u5220\u9664")],8,He)),[[K,"dept_delete"]]),r(q)(["administrator","admin"])?(F(),O("a",{key:0,class:"t-button-link",onClick:Y=>z(u)}," \u65B0\u589E\u5B50\u9879 ",8,Xe)):de("v-if",!0)]),_:1},8,["data","columns","loading","tree","selected-row-keys","header-affixed-top"]),e(ge,{visible:o.value,"onUpdate:visible":l[4]||(l[4]=u=>o.value=u),header:"\u786E\u8BA4\u5220\u9664\u5F53\u524D\u6240\u9009\u6570\u636E\uFF1F","on-cancel":me,onConfirm:ce},null,8,["visible"]),e(Me,{visible:D.value,"onUpdate:visible":l[5]||(l[5]=u=>D.value=u),editId:I.value,"onUpdate:editId":l[6]||(l[6]=u=>I.value=u),actionType:y.value,"onUpdate:actionType":l[7]||(l[7]=u=>y.value=u),parentId:A.value,"onUpdate:parentId":l[8]||(l[8]=u=>A.value=u),onSubmit:fe},null,8,["visible","editId","actionType","parentId"])])],2)}}}),lt=re(Qe,[["__file","D:/Study/tdesign-console/src/views/system/dept.vue"]]);export{lt as default};
