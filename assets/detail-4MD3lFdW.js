import{d as P,f as v,V as W,Q as x,i as X,r as o,o as n,c as r,a as t,w as a,b as g,q as Y,F as Z,R as $,p as i,s as w,S as ee,l as te,ao as ae,ap as se,aq as oe,m as ne,e as V,t as u,x as le,y as re,_ as ie}from"./index-vRs8n-Jv.js";import{g as ue}from"./flow-DfK7Fo4-.js";import{a as ce}from"./leave-CC6exzmZ.js";import{h as de}from"./process-yHOvCS1u.js";import{u as me}from"./useSetting-Bw9xnvhA.js";import{u as pe}from"./useDesign-CbWcZHFZ.js";import{u as _e}from"./index-4Wxy_Ir-.js";const fe=m=>(le("data-v-2de2a1ae"),m=m(),re(),m),ve=fe(()=>V("div",{class:"form__title",style:{margin:"22px 0"}},"请假流程详情",-1)),ge={class:"process_content"},ye={key:0},he={key:1},be={key:2},ke={key:3},Te={key:4},Ie={key:5},xe={key:6},Ve=["src"],Ne=P({__name:"detail",setup(m){const{tableVar:N}=pe(),{getTableHeaderAffixedTop:A,getLayoutContainer:C}=me(),D={assigneeName:"",startTime:"",endTime:"",reason:"",comment:""},S=v({comment:[{required:!0,message:"请输入批复意见",type:"error",trigger:"blur"}]}),l=v({...D}),p=ee(),R=te(),h=W(),{tabRouters:U}=h,b=x(()=>p.params.processInstanceId||""),B=x(()=>p.params.businessId||""),L=_e(()=>{const c=U.findIndex(s=>s.path===p.path);h.subtractCurrentTabRouter({path:p.path,routeIdx:c}),R.replace({path:"/work/start"})},300),k=v([]),_=v(""),F=async()=>{const c=await ce(B.value);l.value={...c,assigneeName:c.flow.assigneeName};const s=await de(b.value);k.value=s},q=()=>{const c=ue({processInstanceId:b.value});ae(c).then(s=>{_.value=se(s)}).catch(()=>{_.value=oe})};return X(()=>{F(),q()}),(c,s)=>{const d=o("t-col"),j=o("t-button"),T=o("t-row"),z=o("t-affix"),E=o("t-input"),f=o("t-form-item"),I=o("t-date-picker"),H=o("t-textarea"),M=o("t-form"),y=o("t-collapse-panel"),Q=o("t-comment"),G=o("t-list-item"),J=o("t-list"),K=o("t-collapse");return n(),r("div",{class:w(g(N))},[t(z,{ref:"affix","offset-top":g(A)+15,container:g(C)},{default:a(()=>[t(T,{justify:"space-between",align:"center",style:{position:"relative",top:"-15px","background-color":"#fff"}},{default:a(()=>[t(d,{flex:"0 0 auto"},{default:a(()=>[ve]),_:1}),t(d,{flex:"0 0 auto"},{default:a(()=>[t(j,{theme:"default",variant:"outline",onClick:g(L)},{default:a(()=>[Y("关闭")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["offset-top","container"]),t(K,{"default-expand-all":!0},{default:a(()=>[t(y,{value:"0",header:"审批信息",class:"reset_panel-body-background"},{default:a(()=>[t(M,{ref:"form",data:l.value,"label-width":80,disabled:!0,rules:S.value},{default:a(()=>[t(T,{gutter:[0,28]},{default:a(()=>[t(d,{span:12},{default:a(()=>[t(f,{label:"申请人",name:"assigneeName"},{default:a(()=>[t(E,{modelValue:l.value.assigneeName,"onUpdate:modelValue":s[0]||(s[0]=e=>l.value.assigneeName=e),placeholder:"请输入申请人",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:12},{default:a(()=>[t(f,{label:"开始时间",name:"startTime"},{default:a(()=>[t(I,{modelValue:l.value.startTime,"onUpdate:modelValue":s[1]||(s[1]=e=>l.value.startTime=e),"enable-time-picker":"","allow-input":"",clearable:"",placeholder:"请选择开始时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:12},{default:a(()=>[t(f,{label:"结束时间",name:"endTime"},{default:a(()=>[t(I,{modelValue:l.value.endTime,"onUpdate:modelValue":s[2]||(s[2]=e=>l.value.endTime=e),"enable-time-picker":"","allow-input":"",clearable:"",placeholder:"请选择结束时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:12},{default:a(()=>[t(f,{label:"请假理由",name:"reason"},{default:a(()=>[t(H,{modelValue:l.value.reason,"onUpdate:modelValue":s[3]||(s[3]=e=>l.value.reason=e),placeholder:"请输入请假理由"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules"])]),_:1}),t(y,{value:"1",header:"流程信息",class:"reset_panel-body-background"},{default:a(()=>[t(J,{split:!0},{default:a(()=>[(n(!0),r(Z,null,$(k.value,(e,O)=>(n(),ne(G,{key:e.id},{content:a(()=>[t(Q,{author:e.assigneeName,datetime:e.createTime},{content:a(()=>[V("div",ge,[!e.assignee&&e.historyActivityId==="start"?(n(),r("p",ye," 在 ["+u(e.createTime)+"] 发起流程 ",1)):i("",!0),!e.assignee&&O!==0&&!e.endTime?(n(),r("p",he," ["+u(e.historyActivityName)+"] 环节等待签收 ",1)):i("",!0),!e.assignee&&e.historyActivityId==="end"&&e.endTime?(n(),r("p",be," ["+u(e.endTime)+"] 流程结束 ",1)):i("",!0),e.assignee?(n(),r("p",ke," 在 ["+u(e.createTime)+"] 开始处理 ["+u(e.historyActivityName)+"] 环节 ",1)):i("",!0),e.historyActivityDurationTime!==""?(n(),r("p",Te," 任务历时：["+u(e.historyActivityDurationTime)+"] ",1)):i("",!0),e.comment!==""?(n(),r("p",Ie,"批复意见：["+u(e.comment)+"]",1)):i("",!0),e.endTime!==""&&e.assignee?(n(),r("p",xe,"结束时间：["+u(e.endTime)+"]",1)):i("",!0)])]),_:2},1032,["author","datetime"])]),_:2},1024))),128))]),_:1})]),_:1}),t(y,{value:"2",header:"流程跟踪",class:"reset_panel-body-background"},{default:a(()=>[_.value?(n(),r("img",{key:0,src:_.value,alt:"流程跟踪",style:{display:"block",padding:"25px 0"}},null,8,Ve)):i("",!0)]),_:1})]),_:1})],2)}}}),Le=ie(Ne,[["__scopeId","data-v-2de2a1ae"]]);export{Le as default};
