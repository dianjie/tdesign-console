import{d as O,f,P as Q,J as I,i as W,r as o,o as n,c as r,a as t,w as a,e as x,b as g,q as X,F as Y,K as Z,p as i,s as $,L as w,l as ee,ak as te,al as ae,am as se,m as oe,t as u,_ as ne}from"./index-CqGaQ7t4.js";import{g as le}from"./flow-DzSZmebQ.js";import{a as re}from"./leave-Cm3ggJQt.js";import{h as ie}from"./process-BwRJad0J.js";import{u as ue}from"./useSetting-CnYQd1RY.js";import{u as me}from"./useDesign-CbWcZHFZ.js";import{u as de}from"./index-BidCcHov.js";const ce={class:"process_content"},pe={key:0},_e={key:1},fe={key:2},ge={key:3},ve={key:4},ye={key:5},be={key:6},he=["src"],ke=O({__name:"detail",setup(Te){const{tableVar:V}=me(),{getTableHeaderAffixedTop:N,getLayoutContainer:A}=ue(),C={assigneeName:"",startTime:"",endTime:"",reason:"",comment:""},D=f({comment:[{required:!0,message:"请输入批复意见",type:"error",trigger:"blur"}]}),l=f({...C}),c=w(),U=ee(),y=Q(),{tabRouters:L}=y,b=I(()=>c.params.processInstanceId||""),R=I(()=>c.params.businessId||""),B=de(()=>{const m=L.findIndex(s=>s.path===c.path);y.subtractCurrentTabRouter({path:c.path,routeIdx:m}),U.replace({path:"/work/start"})},300),h=f([]),p=f(""),F=async()=>{const m=await re(R.value);l.value={...m,assigneeName:m.flow.assigneeName};const s=await ie(b.value);h.value=s},S=()=>{const m=le({processInstanceId:b.value});te(m).then(s=>{p.value=ae(s)}).catch(()=>{p.value=se})};return W(()=>{F(),S()}),(m,s)=>{const d=o("t-col"),q=o("t-button"),k=o("t-row"),j=o("t-affix"),z=o("t-input"),_=o("t-form-item"),T=o("t-date-picker"),E=o("t-textarea"),H=o("t-form"),v=o("t-collapse-panel"),J=o("t-comment"),K=o("t-list-item"),M=o("t-list"),P=o("t-collapse");return n(),r("div",{class:$(g(V))},[t(j,{ref:"affix","offset-top":g(N)+15,container:g(A)},{default:a(()=>[t(k,{justify:"space-between",align:"center",style:{position:"relative",top:"-15px","background-color":"#fff"}},{default:a(()=>[t(d,{flex:"0 0 auto"},{default:a(()=>s[4]||(s[4]=[x("div",{class:"form__title",style:{margin:"22px 0"}},"请假流程详情",-1)])),_:1}),t(d,{flex:"0 0 auto"},{default:a(()=>[t(q,{theme:"default",variant:"outline",onClick:g(B)},{default:a(()=>s[5]||(s[5]=[X("关闭")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["offset-top","container"]),t(P,{"default-expand-all":!0},{default:a(()=>[t(v,{value:"0",header:"审批信息",class:"reset_panel-body-background"},{default:a(()=>[t(H,{ref:"form",data:l.value,"label-width":80,disabled:!0,rules:D.value},{default:a(()=>[t(k,{gutter:[0,28]},{default:a(()=>[t(d,{span:12},{default:a(()=>[t(_,{label:"申请人",name:"assigneeName"},{default:a(()=>[t(z,{modelValue:l.value.assigneeName,"onUpdate:modelValue":s[0]||(s[0]=e=>l.value.assigneeName=e),placeholder:"请输入申请人",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:12},{default:a(()=>[t(_,{label:"开始时间",name:"startTime"},{default:a(()=>[t(T,{modelValue:l.value.startTime,"onUpdate:modelValue":s[1]||(s[1]=e=>l.value.startTime=e),"enable-time-picker":"","allow-input":"",clearable:"",placeholder:"请选择开始时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:12},{default:a(()=>[t(_,{label:"结束时间",name:"endTime"},{default:a(()=>[t(T,{modelValue:l.value.endTime,"onUpdate:modelValue":s[2]||(s[2]=e=>l.value.endTime=e),"enable-time-picker":"","allow-input":"",clearable:"",placeholder:"请选择结束时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(d,{span:12},{default:a(()=>[t(_,{label:"请假理由",name:"reason"},{default:a(()=>[t(E,{modelValue:l.value.reason,"onUpdate:modelValue":s[3]||(s[3]=e=>l.value.reason=e),placeholder:"请输入请假理由"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules"])]),_:1}),t(v,{value:"1",header:"流程信息",class:"reset_panel-body-background"},{default:a(()=>[t(M,{split:!0},{default:a(()=>[(n(!0),r(Y,null,Z(h.value,(e,G)=>(n(),oe(K,{key:e.id},{content:a(()=>[t(J,{author:e.assigneeName,datetime:e.createTime},{content:a(()=>[x("div",ce,[!e.assignee&&e.historyActivityId==="start"?(n(),r("p",pe," 在 ["+u(e.createTime)+"] 发起流程 ",1)):i("",!0),!e.assignee&&G!==0&&!e.endTime?(n(),r("p",_e," ["+u(e.historyActivityName)+"] 环节等待签收 ",1)):i("",!0),!e.assignee&&e.historyActivityId==="end"&&e.endTime?(n(),r("p",fe," ["+u(e.endTime)+"] 流程结束 ",1)):i("",!0),e.assignee?(n(),r("p",ge," 在 ["+u(e.createTime)+"] 开始处理 ["+u(e.historyActivityName)+"] 环节 ",1)):i("",!0),e.historyActivityDurationTime!==""?(n(),r("p",ve," 任务历时：["+u(e.historyActivityDurationTime)+"] ",1)):i("",!0),e.comment!==""?(n(),r("p",ye,"批复意见：["+u(e.comment)+"]",1)):i("",!0),e.endTime!==""&&e.assignee?(n(),r("p",be,"结束时间：["+u(e.endTime)+"]",1)):i("",!0)])]),_:2},1032,["author","datetime"])]),_:2},1024))),128))]),_:1})]),_:1}),t(v,{value:"2",header:"流程跟踪",class:"reset_panel-body-background"},{default:a(()=>[p.value?(n(),r("img",{key:0,src:p.value,alt:"流程跟踪",style:{display:"block",padding:"25px 0"}},null,8,he)):i("",!0)]),_:1})]),_:1})],2)}}}),Ue=ne(ke,[["__scopeId","data-v-2de2a1ae"]]);export{Ue as default};
