import{an as L,d as j,f as p,J as q,a2 as S,Q as C,r,o as H,m as R,w as t,a as e,s as F,i as $,as as M,c as B,q as A,b as m,e as P,W as E,at as J}from"./index-CqGaQ7t4.js";import{u as O}from"./useSetting-CnYQd1RY.js";import{u as Q}from"./useDesign-CbWcZHFZ.js";import{u as W}from"./useRequset-Bj5fiv5N.js";import{u as G}from"./index-BidCcHov.js";const X=(c,T,V)=>L.get({url:"/blade-log/error/list",params:{...V,current:c,size:T}},{joinTime:!1}),Y=c=>L.get({url:"/blade-log/error/detail",params:{id:c}}),Z=j({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType"],setup(c,{emit:T}){const V={serviceId:"",serverHost:"",serverIp:"",env:"",method:"",requestUri:"",createTime:"",userAgent:"",params:"",stackTrace:""},_=c,K=p({}),v=q(()=>`${{view:"查看",edit:"编辑",add:"新增"}[_.actionType]||""}错误日志`),I=q(()=>({view:!0,edit:!1})[_.actionType]||!1),f=p(!1),o=p({...V}),U=p(null),k=p(!1),b=T,D=()=>{o.value={...V},C(()=>{b("update:editId",""),b("update:actionType","")})};return S(()=>f.value,d=>{b("update:visible",d)}),S(()=>_.visible,d=>{d&&_.editId&&C(()=>{Y(_.editId).then(a=>{o.value={...a}})}),C(()=>{var a;(a=U.value)==null||a.clearValidate()}),f.value=d}),(d,a)=>{const i=r("t-input"),s=r("t-form-item"),l=r("t-col"),g=r("t-textarea"),w=r("t-row"),y=r("t-form"),x=r("t-dialog");return H(),R(x,{visible:f.value,"onUpdate:visible":a[10]||(a[10]=n=>f.value=n),header:v.value,width:780,footer:!1,onClosed:D},{body:t(()=>[e(y,{ref_key:"form",ref:U,class:F({"xy-form__detail":c.actionType==="view"}),data:o.value,rules:K.value,"label-width":100,disabled:I.value||k.value},{default:t(()=>[e(w,{gutter:[0,28]},{default:t(()=>[e(l,{span:6},{default:t(()=>[e(s,{label:"服务id",name:"serviceId"},{default:t(()=>[e(i,{modelValue:o.value.serviceId,"onUpdate:modelValue":a[0]||(a[0]=n=>o.value.serviceId=n)},null,8,["modelValue"])]),_:1})]),_:1}),e(l,{span:6},{default:t(()=>[e(s,{label:"服务host",name:"serverHost"},{default:t(()=>[e(i,{modelValue:o.value.serverHost,"onUpdate:modelValue":a[1]||(a[1]=n=>o.value.serverHost=n)},null,8,["modelValue"])]),_:1})]),_:1}),e(l,{span:6},{default:t(()=>[e(s,{label:"服务ip",name:"serverIp"},{default:t(()=>[e(i,{modelValue:o.value.serverIp,"onUpdate:modelValue":a[2]||(a[2]=n=>o.value.serverIp=n)},null,8,["modelValue"])]),_:1})]),_:1}),e(l,{span:6},{default:t(()=>[e(s,{label:"软件环境",name:"env"},{default:t(()=>[e(i,{modelValue:o.value.env,"onUpdate:modelValue":a[3]||(a[3]=n=>o.value.env=n)},null,8,["modelValue"])]),_:1})]),_:1}),e(l,{span:6},{default:t(()=>[e(s,{label:"请求方法",name:"method"},{default:t(()=>[e(i,{modelValue:o.value.method,"onUpdate:modelValue":a[4]||(a[4]=n=>o.value.method=n)},null,8,["modelValue"])]),_:1})]),_:1}),e(l,{span:6},{default:t(()=>[e(s,{label:"请求接口",name:"requestUri"},{default:t(()=>[e(i,{modelValue:o.value.requestUri,"onUpdate:modelValue":a[5]||(a[5]=n=>o.value.requestUri=n)},null,8,["modelValue"])]),_:1})]),_:1}),e(l,{span:6},{default:t(()=>[e(s,{label:"日志时间",name:"createTime"},{default:t(()=>[e(i,{modelValue:o.value.createTime,"onUpdate:modelValue":a[6]||(a[6]=n=>o.value.createTime=n)},null,8,["modelValue"])]),_:1})]),_:1}),e(l,{span:12},{default:t(()=>[e(s,{label:"用户代理",name:"userAgent"},{default:t(()=>[e(g,{modelValue:o.value.userAgent,"onUpdate:modelValue":a[7]||(a[7]=n=>o.value.userAgent=n)},null,8,["modelValue"])]),_:1})]),_:1}),e(l,{span:12},{default:t(()=>[e(s,{label:"请求数据",name:"params"},{default:t(()=>[e(g,{modelValue:o.value.params,"onUpdate:modelValue":a[8]||(a[8]=n=>o.value.params=n)},null,8,["modelValue"])]),_:1})]),_:1}),e(l,{span:12},{default:t(()=>[e(s,{label:"日志数据",name:"stackTrace"},{default:t(()=>[e(g,{modelValue:o.value.stackTrace,"onUpdate:modelValue":a[9]||(a[9]=n=>o.value.stackTrace=n)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),ee=[{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"服务id",colKey:"serviceId"},{title:"服务host",colKey:"serverHost"},{title:"服务ip",colKey:"serverIp"},{title:"软件环境",colKey:"env"},{title:"请求方法",colKey:"method"},{title:"请求接口",colKey:"requestUri"},{title:"日志时间",colKey:"createTime"},{fixed:"right",width:80,colKey:"op",title:"操作",align:"center"}],te={class:"table-wrapper"},ae=["onClick"],de=j({__name:"error",setup(c){const{tableVar:T}=Q(),{getTableHeaderAffixedTop:V,getLayoutContainer:_}=O(),v=p({...{serviceId:"",serverHost:""}}),I=p(!1),f=p(""),o=p(""),{fetchData:U,data:k,pagination:b,dataLoading:D}=W(X,v.value,J);$(()=>{U()});const d=({row:s},l)=>{f.value=s.id,o.value=l,I.value=!0},a=G(()=>{U()},300),i=s=>{b.value={...b.value,current:s.current||1,pageSize:s.pageSize},a()};return(s,l)=>{const g=r("t-input"),w=r("t-form-item"),y=r("t-col"),x=r("t-row"),n=r("t-button"),N=r("t-form"),h=r("t-table"),z=M("auth");return H(),B("div",{class:F(m(T))},[e(N,{ref:"form",data:v.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:m(a),onSubmit:m(a)},{default:t(()=>[e(x,null,{default:t(()=>[e(y,{span:10},{default:t(()=>[e(x,{gutter:[16,24]},{default:t(()=>[e(y,{span:4},{default:t(()=>[e(w,{label:"服务id",name:"serviceId"},{default:t(()=>[e(g,{modelValue:v.value.serviceId,"onUpdate:modelValue":l[0]||(l[0]=u=>v.value.serviceId=u),clearable:"",placeholder:"请输入服务id"},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{span:4},{default:t(()=>[e(w,{label:"服务host",name:"serverHost"},{default:t(()=>[e(g,{modelValue:v.value.serverHost,"onUpdate:modelValue":l[1]||(l[1]=u=>v.value.serverHost=u),clearable:"",placeholder:"请输入服务host"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(y,{span:2,class:"operation-wrapper"},{default:t(()=>[e(n,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>l[5]||(l[5]=[A(" 查询 ")])),_:1}),e(n,{type:"reset",variant:"base",theme:"default"},{default:t(()=>l[6]||(l[6]=[A(" 重置 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),P("div",te,[e(h,{data:m(k),columns:m(ee),hover:!0,loading:m(D),pagination:m(b),"header-affixed-top":{offsetTop:m(V),container:m(_)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:i},{op:t(u=>[E((H(),B("a",{class:"t-button-link",onClick:le=>d(u,"view")},l[7]||(l[7]=[A("查看")]),8,ae)),[[z,"log_error_view"]])]),_:1},8,["data","columns","loading","pagination","header-affixed-top"]),e(Z,{visible:I.value,"onUpdate:visible":l[2]||(l[2]=u=>I.value=u),editId:f.value,"onUpdate:editId":l[3]||(l[3]=u=>f.value=u),actionType:o.value,"onUpdate:actionType":l[4]||(l[4]=u=>o.value=u)},null,8,["visible","editId","actionType"])])],2)}}});export{de as default};
