import{d as $,f as v,P as E,J as T,i as w,r as o,o as u,c as r,e as R,a,w as s,b as y,q as V,F as ee,K as te,p as m,s as ae,L as se,l as ne,ak as le,al as oe,am as ue,m as re,t as i,M as f,_ as me}from"./index-CqGaQ7t4.js";import{g as ie}from"./flow-DzSZmebQ.js";import{a as de}from"./leave-Cm3ggJQt.js";import{h as ce}from"./process-BwRJad0J.js";import{c as S}from"./work-EOGau8jX.js";import{u as pe}from"./useDesign-CbWcZHFZ.js";import{u as N}from"./index-BidCcHov.js";const _e={class:"process_content"},ve={key:0},be={key:1},ge={key:2},ye={key:3},fe={key:4},ke={key:5},he={key:6},Ie=["src"],Te=$({__name:"handle",setup(Ve){const{tableVar:B}=pe(),L={assigneeName:"",startTime:"",endTime:"",reason:"",comment:""},F=v({comment:[{required:!0,message:"请输入批复意见",type:"error",trigger:"blur"}]}),n=v({...L}),d=v(!1),_=se(),M=ne(),D=E(),{tabRouters:q}=D,x=T(()=>_.params.taskId||""),b=T(()=>_.params.processInstanceId||""),P=T(()=>_.params.businessId||""),k=N(()=>{const l=q.findIndex(t=>t.path===_.path);D.subtractCurrentTabRouter({path:_.path,routeIdx:l}),M.replace({path:"/work/start"})},300),z=N(({firstError:l})=>{if(l)f.warning(l);else{d.value=!0;const t={taskId:x.value,processInstanceId:b.value,flag:"ok",comment:n.value.comment};S(t).then(()=>{f.success("提交成功"),k()}).finally(()=>{d.value=!1})}},300),J=N(({firstError:l})=>{if(l)f.warning(l);else{d.value=!0;const t={taskId:x.value,processInstanceId:b.value,comment:n.value.comment};S(t).then(()=>{f.success("驳回成功"),k()}).finally(()=>{d.value=!1})}},300),C=v([]),g=v(""),K=async()=>{d.value=!0;const l=await de(P.value);n.value={...l,assigneeName:l.flow.assigneeName};const t=await ce(b.value);C.value=t,d.value=!1},j=()=>{const l=ie({processInstanceId:b.value});le(l).then(t=>{g.value=oe(t)}).catch(()=>{g.value=ue})};return w(()=>{K(),j()}),(l,t)=>{const G=o("t-input"),c=o("t-form-item"),p=o("t-col"),A=o("t-date-picker"),U=o("t-textarea"),h=o("t-button"),H=o("t-row"),O=o("t-form"),I=o("t-collapse-panel"),Q=o("t-comment"),W=o("t-list-item"),X=o("t-list"),Y=o("t-collapse");return u(),r("div",{class:ae(y(B))},[t[8]||(t[8]=R("p",{class:"form__title"},"处理请假",-1)),a(Y,{"default-expand-all":!0},{default:s(()=>[a(I,{value:"0",header:"审批信息",class:"reset_panel-body-background"},{default:s(()=>[a(O,{ref:"form",data:n.value,"label-width":80,disabled:d.value,rules:F.value,onSubmit:y(z)},{default:s(()=>[a(H,{gutter:[0,28]},{default:s(()=>[a(p,{span:12},{default:s(()=>[a(c,{label:"申请人",name:"assigneeName"},{default:s(()=>[a(G,{modelValue:n.value.assigneeName,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value.assigneeName=e),disabled:!0,placeholder:"请输入申请人",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(p,{span:12},{default:s(()=>[a(c,{label:"开始时间",name:"startTime"},{default:s(()=>[a(A,{modelValue:n.value.startTime,"onUpdate:modelValue":t[1]||(t[1]=e=>n.value.startTime=e),disabled:!0,"enable-time-picker":"","allow-input":"",clearable:"",placeholder:"请选择开始时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(p,{span:12},{default:s(()=>[a(c,{label:"结束时间",name:"endTime"},{default:s(()=>[a(A,{modelValue:n.value.endTime,"onUpdate:modelValue":t[2]||(t[2]=e=>n.value.endTime=e),disabled:!0,"enable-time-picker":"","allow-input":"",clearable:"",placeholder:"请选择结束时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(p,{span:12},{default:s(()=>[a(c,{label:"请假理由",name:"reason"},{default:s(()=>[a(U,{modelValue:n.value.reason,"onUpdate:modelValue":t[3]||(t[3]=e=>n.value.reason=e),disabled:!0,placeholder:"请输入请假理由"},null,8,["modelValue"])]),_:1})]),_:1}),a(p,{span:12},{default:s(()=>[a(c,{label:"批复意见",name:"comment"},{default:s(()=>[a(U,{modelValue:n.value.comment,"onUpdate:modelValue":t[4]||(t[4]=e=>n.value.comment=e),placeholder:"请输入批复意见"},null,8,["modelValue"])]),_:1})]),_:1}),a(p,{span:12},{default:s(()=>[a(c,null,{default:s(()=>[a(h,{theme:"primary",type:"submit"},{default:s(()=>t[5]||(t[5]=[V("同意")])),_:1}),a(h,{theme:"danger",onClick:y(J)},{default:s(()=>t[6]||(t[6]=[V("驳回")])),_:1},8,["onClick"]),a(h,{theme:"default",variant:"outline",onClick:y(k)},{default:s(()=>t[7]||(t[7]=[V("关闭")])),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","disabled","rules","onSubmit"])]),_:1}),a(I,{value:"1",header:"流程信息",class:"reset_panel-body-background"},{default:s(()=>[a(X,{split:!0},{default:s(()=>[(u(!0),r(ee,null,te(C.value,(e,Z)=>(u(),re(W,{key:e.id},{content:s(()=>[a(Q,{author:e.assigneeName,datetime:e.createTime},{content:s(()=>[R("div",_e,[!e.assignee&&e.historyActivityId==="start"?(u(),r("p",ve," 在 ["+i(e.createTime)+"] 发起流程 ",1)):m("",!0),!e.assignee&&Z!==0&&!e.endTime?(u(),r("p",be," ["+i(e.historyActivityName)+"] 环节等待签收 ",1)):m("",!0),!e.assignee&&e.historyActivityId==="end"&&e.endTime?(u(),r("p",ge," ["+i(e.endTime)+"] 流程结束 ",1)):m("",!0),e.assignee?(u(),r("p",ye," 在 ["+i(e.createTime)+"] 开始处理 ["+i(e.historyActivityName)+"] 环节 ",1)):m("",!0),e.historyActivityDurationTime!==""?(u(),r("p",fe," 任务历时：["+i(e.historyActivityDurationTime)+"] ",1)):m("",!0),e.comment!==""?(u(),r("p",ke,"批复意见：["+i(e.comment)+"]",1)):m("",!0),e.endTime!==""&&e.assignee?(u(),r("p",he,"结束时间：["+i(e.endTime)+"]",1)):m("",!0)])]),_:2},1032,["author","datetime"])]),_:2},1024))),128))]),_:1})]),_:1}),a(I,{value:"2",header:"流程跟踪",class:"reset_panel-body-background"},{default:s(()=>[g.value?(u(),r("img",{key:0,src:g.value,alt:"流程跟踪",style:{display:"block",padding:"25px 0"}},null,8,Ie)):m("",!0)]),_:1})]),_:1})],2)}}}),Se=me(Te,[["__scopeId","data-v-4c06e9fd"]]);export{Se as default};
