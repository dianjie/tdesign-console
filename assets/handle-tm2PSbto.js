import{d as E,f as v,V as w,Q as V,i as ee,r as l,o as u,c as r,a as t,w as a,b as y,q as N,F as te,R as ae,p as i,s as se,S as ne,l as oe,ao as le,ap as ue,aq as re,m as ie,e as B,t as m,x as me,y as de,M as f,_ as ce}from"./index-CEBUqFKN.js";import{g as pe}from"./flow-BxjYLdzT.js";import{a as _e}from"./leave-C_Q_Xv1P.js";import{h as ve}from"./process-DmULqCYD.js";import{c as R}from"./work-B_qMzv1t.js";import{u as be}from"./useDesign-CbWcZHFZ.js";import{u as D}from"./index-BPVHnpx-.js";const he=b=>(me("data-v-4c06e9fd"),b=b(),de(),b),ge=he(()=>B("p",{class:"form__title"},"处理请假",-1)),ye={class:"process_content"},fe={key:0},ke={key:1},Ie={key:2},Te={key:3},Ve={key:4},Ne={key:5},De={key:6},xe=["src"],Ce=E({__name:"handle",setup(b){const{tableVar:F}=be(),L={assigneeName:"",startTime:"",endTime:"",reason:"",comment:""},q=v({comment:[{required:!0,message:"请输入批复意见",type:"error",trigger:"blur"}]}),n=v({...L}),d=v(!1),_=ne(),M=oe(),x=w(),{tabRouters:z}=x,C=V(()=>_.params.taskId||""),h=V(()=>_.params.processInstanceId||""),P=V(()=>_.params.businessId||""),k=D(()=>{const o=z.findIndex(s=>s.path===_.path);x.subtractCurrentTabRouter({path:_.path,routeIdx:o}),M.replace({path:"/work/start"})},300),Q=D(({firstError:o})=>{if(o)f.warning(o);else{d.value=!0;const s={taskId:C.value,processInstanceId:h.value,flag:"ok",comment:n.value.comment};R(s).then(()=>{f.success("提交成功"),k()}).finally(()=>{d.value=!1})}},300),j=D(({firstError:o})=>{if(o)f.warning(o);else{d.value=!0;const s={taskId:C.value,processInstanceId:h.value,comment:n.value.comment};R(s).then(()=>{f.success("驳回成功"),k()}).finally(()=>{d.value=!1})}},300),S=v([]),g=v(""),G=async()=>{d.value=!0;const o=await _e(P.value);n.value={...o,assigneeName:o.flow.assigneeName};const s=await ve(h.value);S.value=s,d.value=!1},H=()=>{const o=pe({processInstanceId:h.value});le(o).then(s=>{g.value=ue(s)}).catch(()=>{g.value=re})};return ee(()=>{G(),H()}),(o,s)=>{const J=l("t-input"),c=l("t-form-item"),p=l("t-col"),A=l("t-date-picker"),U=l("t-textarea"),I=l("t-button"),K=l("t-row"),O=l("t-form"),T=l("t-collapse-panel"),W=l("t-comment"),X=l("t-list-item"),Y=l("t-list"),Z=l("t-collapse");return u(),r("div",{class:se(y(F))},[ge,t(Z,{"default-expand-all":!0},{default:a(()=>[t(T,{value:"0",header:"审批信息",class:"reset_panel-body-background"},{default:a(()=>[t(O,{ref:"form",data:n.value,"label-width":80,disabled:d.value,rules:q.value,onSubmit:y(Q)},{default:a(()=>[t(K,{gutter:[0,28]},{default:a(()=>[t(p,{span:12},{default:a(()=>[t(c,{label:"申请人",name:"assigneeName"},{default:a(()=>[t(J,{modelValue:n.value.assigneeName,"onUpdate:modelValue":s[0]||(s[0]=e=>n.value.assigneeName=e),disabled:!0,placeholder:"请输入申请人",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(p,{span:12},{default:a(()=>[t(c,{label:"开始时间",name:"startTime"},{default:a(()=>[t(A,{modelValue:n.value.startTime,"onUpdate:modelValue":s[1]||(s[1]=e=>n.value.startTime=e),disabled:!0,"enable-time-picker":"","allow-input":"",clearable:"",placeholder:"请选择开始时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(p,{span:12},{default:a(()=>[t(c,{label:"结束时间",name:"endTime"},{default:a(()=>[t(A,{modelValue:n.value.endTime,"onUpdate:modelValue":s[2]||(s[2]=e=>n.value.endTime=e),disabled:!0,"enable-time-picker":"","allow-input":"",clearable:"",placeholder:"请选择结束时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(p,{span:12},{default:a(()=>[t(c,{label:"请假理由",name:"reason"},{default:a(()=>[t(U,{modelValue:n.value.reason,"onUpdate:modelValue":s[3]||(s[3]=e=>n.value.reason=e),disabled:!0,placeholder:"请输入请假理由"},null,8,["modelValue"])]),_:1})]),_:1}),t(p,{span:12},{default:a(()=>[t(c,{label:"批复意见",name:"comment"},{default:a(()=>[t(U,{modelValue:n.value.comment,"onUpdate:modelValue":s[4]||(s[4]=e=>n.value.comment=e),placeholder:"请输入批复意见"},null,8,["modelValue"])]),_:1})]),_:1}),t(p,{span:12},{default:a(()=>[t(c,null,{default:a(()=>[t(I,{theme:"primary",type:"submit"},{default:a(()=>[N("同意")]),_:1}),t(I,{theme:"danger",onClick:y(j)},{default:a(()=>[N("驳回")]),_:1},8,["onClick"]),t(I,{theme:"default",variant:"outline",onClick:y(k)},{default:a(()=>[N("关闭")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","disabled","rules","onSubmit"])]),_:1}),t(T,{value:"1",header:"流程信息",class:"reset_panel-body-background"},{default:a(()=>[t(Y,{split:!0},{default:a(()=>[(u(!0),r(te,null,ae(S.value,(e,$)=>(u(),ie(X,{key:e.id},{content:a(()=>[t(W,{author:e.assigneeName,datetime:e.createTime},{content:a(()=>[B("div",ye,[!e.assignee&&e.historyActivityId==="start"?(u(),r("p",fe," 在 ["+m(e.createTime)+"] 发起流程 ",1)):i("",!0),!e.assignee&&$!==0&&!e.endTime?(u(),r("p",ke," ["+m(e.historyActivityName)+"] 环节等待签收 ",1)):i("",!0),!e.assignee&&e.historyActivityId==="end"&&e.endTime?(u(),r("p",Ie," ["+m(e.endTime)+"] 流程结束 ",1)):i("",!0),e.assignee?(u(),r("p",Te," 在 ["+m(e.createTime)+"] 开始处理 ["+m(e.historyActivityName)+"] 环节 ",1)):i("",!0),e.historyActivityDurationTime!==""?(u(),r("p",Ve," 任务历时：["+m(e.historyActivityDurationTime)+"] ",1)):i("",!0),e.comment!==""?(u(),r("p",Ne,"批复意见：["+m(e.comment)+"]",1)):i("",!0),e.endTime!==""&&e.assignee?(u(),r("p",De,"结束时间：["+m(e.endTime)+"]",1)):i("",!0)])]),_:2},1032,["author","datetime"])]),_:2},1024))),128))]),_:1})]),_:1}),t(T,{value:"2",header:"流程跟踪",class:"reset_panel-body-background"},{default:a(()=>[g.value?(u(),r("img",{key:0,src:g.value,alt:"流程跟踪",style:{display:"block",padding:"25px 0"}},null,8,xe)):i("",!0)]),_:1})]),_:1})],2)}}}),qe=ce(Ce,[["__scopeId","data-v-4c06e9fd"]]);export{qe as default};
