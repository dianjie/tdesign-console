import{d as $,r as v,a2 as w,c as ee,a3 as te,C as I,a as ae,e as o,f as l,i,l as t,w as a,j as b,p as k,F as ue,H as se,m as r,q as ne,a5 as oe,a6 as le,a7 as ie,g as re,n as S,t as c,v as ce,x as de,M as g,_ as me}from"./index.8ed3877a.js";import{u as _e}from"./useDesign.9d0ca2bc.js";import{c as x}from"./work.eedae2d5.js";import{a as pe}from"./leave.7b34ae02.js";import{h as ve}from"./process.be057b9e.js";import{g as Fe}from"./flow.efe49ab3.js";import{u as A}from"./index.74383c1c.js";const he=F=>(ce("data-v-39172c0e"),F=F(),de(),F),fe=he(()=>S("p",{class:"form__title"},"\u5904\u7406\u8BF7\u5047",-1)),be={class:"process_content"},ge={key:0},ye={key:1},De={key:2},Be={key:3},Ie={key:4},ke={key:5},Ae={key:6},Te=["src"],Ve=$({__name:"handle",setup(F){const{tableVar:U}=_e(),R={assigneeName:"",startTime:"",endTime:"",reason:"",comment:""},L=v({comment:[{required:!0,message:"\u8BF7\u8F93\u5165\u6279\u590D\u610F\u89C1",type:"error",trigger:"blur"}]}),s=v({...R}),d=v(!1),p=w(),M=ee(),T=te(),{tabRouters:q}=T,V=I(()=>p.params.taskId||""),h=I(()=>p.params.processInstanceId||""),j=I(()=>p.params.businessId||""),y=A(()=>{const n=q.findIndex(u=>u.path===p.path);T.subtractCurrentTabRouter({path:p.path,routeIdx:n}),M.replace({path:"/work/start"})},300),z=A(({firstError:n})=>{if(n)g.warning(n);else{d.value=!0;const u={taskId:V.value,processInstanceId:h.value,flag:"ok",comment:s.value.comment};x(u).then(()=>{g.success("\u63D0\u4EA4\u6210\u529F"),y()}).finally(()=>{d.value=!1})}},300),H=A(({firstError:n})=>{if(n)g.warning(n);else{d.value=!0;const u={taskId:V.value,processInstanceId:h.value,comment:s.value.comment};x(u).then(()=>{g.success("\u9A73\u56DE\u6210\u529F"),y()}).finally(()=>{d.value=!1})}},300),C=v([]),f=v(""),P=async()=>{d.value=!0;const n=await pe(j.value);s.value={...n,assigneeName:n.flow.assigneeName};const u=await ve(h.value);C.value=u,d.value=!1},G=()=>{const n=Fe({processInstanceId:h.value});oe(n).then(u=>{f.value=le(u)}).catch(()=>{f.value=ie})};return ae(()=>{P(),G()}),(n,u)=>{const J=o("t-input"),m=o("t-form-item"),_=o("t-col"),E=o("t-date-picker"),N=o("t-textarea"),D=o("t-button"),K=o("t-row"),O=o("t-form"),B=o("t-collapse-panel"),Q=o("t-comment"),W=o("t-list-item"),X=o("t-list"),Y=o("t-collapse");return l(),i("div",{class:ne(b(U))},[fe,t(Y,{"default-expand-all":!0},{default:a(()=>[t(B,{value:"0",header:"\u5BA1\u6279\u4FE1\u606F",class:"reset_panel-body-background"},{default:a(()=>[t(O,{ref:"form",data:s.value,"label-width":80,disabled:d.value,rules:L.value,onSubmit:b(z)},{default:a(()=>[t(K,{gutter:[0,28]},{default:a(()=>[t(_,{span:12},{default:a(()=>[t(m,{label:"\u7533\u8BF7\u4EBA",name:"assigneeName"},{default:a(()=>[t(J,{modelValue:s.value.assigneeName,"onUpdate:modelValue":u[0]||(u[0]=e=>s.value.assigneeName=e),disabled:!0,placeholder:"\u8BF7\u8F93\u5165\u7533\u8BF7\u4EBA",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(_,{span:12},{default:a(()=>[t(m,{label:"\u5F00\u59CB\u65F6\u95F4",name:"startTime"},{default:a(()=>[t(E,{modelValue:s.value.startTime,"onUpdate:modelValue":u[1]||(u[1]=e=>s.value.startTime=e),disabled:!0,"enable-time-picker":"","allow-input":"",clearable:"",placeholder:"\u8BF7\u9009\u62E9\u5F00\u59CB\u65F6\u95F4",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(_,{span:12},{default:a(()=>[t(m,{label:"\u7ED3\u675F\u65F6\u95F4",name:"endTime"},{default:a(()=>[t(E,{modelValue:s.value.endTime,"onUpdate:modelValue":u[2]||(u[2]=e=>s.value.endTime=e),disabled:!0,"enable-time-picker":"","allow-input":"",clearable:"",placeholder:"\u8BF7\u9009\u62E9\u7ED3\u675F\u65F6\u95F4",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(_,{span:12},{default:a(()=>[t(m,{label:"\u8BF7\u5047\u7406\u7531",name:"reason"},{default:a(()=>[t(N,{modelValue:s.value.reason,"onUpdate:modelValue":u[3]||(u[3]=e=>s.value.reason=e),disabled:!0,placeholder:"\u8BF7\u8F93\u5165\u8BF7\u5047\u7406\u7531"},null,8,["modelValue"])]),_:1})]),_:1}),t(_,{span:12},{default:a(()=>[t(m,{label:"\u6279\u590D\u610F\u89C1",name:"comment"},{default:a(()=>[t(N,{modelValue:s.value.comment,"onUpdate:modelValue":u[4]||(u[4]=e=>s.value.comment=e),placeholder:"\u8BF7\u8F93\u5165\u6279\u590D\u610F\u89C1"},null,8,["modelValue"])]),_:1})]),_:1}),t(_,{span:12},{default:a(()=>[t(m,null,{default:a(()=>[t(D,{theme:"primary",type:"submit"},{default:a(()=>[k("\u540C\u610F")]),_:1}),t(D,{theme:"danger",onClick:b(H)},{default:a(()=>[k("\u9A73\u56DE")]),_:1},8,["onClick"]),t(D,{theme:"default",variant:"outline",onClick:b(y)},{default:a(()=>[k("\u5173\u95ED")]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","disabled","rules","onSubmit"])]),_:1}),t(B,{value:"1",header:"\u6D41\u7A0B\u4FE1\u606F",class:"reset_panel-body-background"},{default:a(()=>[t(X,{split:!0},{default:a(()=>[(l(!0),i(ue,null,se(C.value,(e,Z)=>(l(),re(W,{key:e.id},{content:a(()=>[t(Q,{author:e.assigneeName,datetime:e.createTime},{content:a(()=>[S("div",be,[r(" historyActivityId \u6D41\u7A0B\u8282\u70B9\u7684\u4E3B\u952EID "),!e.assignee&&e.historyActivityId==="start"?(l(),i("p",ge," \u5728 ["+c(e.createTime)+"] \u53D1\u8D77\u6D41\u7A0B ",1)):r("v-if",!0),!e.assignee&&Z!==0&&!e.endTime?(l(),i("p",ye," ["+c(e.historyActivityName)+"] \u73AF\u8282\u7B49\u5F85\u7B7E\u6536 ",1)):r("v-if",!0),!e.assignee&&e.historyActivityId==="end"&&e.endTime?(l(),i("p",De," ["+c(e.endTime)+"] \u6D41\u7A0B\u7ED3\u675F ",1)):r("v-if",!0),e.assignee?(l(),i("p",Be," \u5728 ["+c(e.createTime)+"] \u5F00\u59CB\u5904\u7406 ["+c(e.historyActivityName)+"] \u73AF\u8282 ",1)):r("v-if",!0),e.historyActivityDurationTime!==""?(l(),i("p",Ie," \u4EFB\u52A1\u5386\u65F6\uFF1A["+c(e.historyActivityDurationTime)+"] ",1)):r("v-if",!0),e.comment!==""?(l(),i("p",ke,"\u6279\u590D\u610F\u89C1\uFF1A["+c(e.comment)+"]",1)):r("v-if",!0),e.endTime!==""&&e.assignee?(l(),i("p",Ae,"\u7ED3\u675F\u65F6\u95F4\uFF1A["+c(e.endTime)+"]",1)):r("v-if",!0)])]),_:2},1032,["author","datetime"])]),_:2},1024))),128))]),_:1})]),_:1}),t(B,{value:"2",header:"\u6D41\u7A0B\u8DDF\u8E2A",class:"reset_panel-body-background"},{default:a(()=>[f.value?(l(),i("img",{key:0,src:f.value,alt:"\u6D41\u7A0B\u8DDF\u8E2A",style:{display:"block",padding:"25px 0"}},null,8,Te)):r("v-if",!0)]),_:1})]),_:1})],2)}}});const Le=me(Ve,[["__scopeId","data-v-39172c0e"],["__file","D:/Study/tdesign-console/src/views/process/leave/handle.vue"]]);export{Le as default};
