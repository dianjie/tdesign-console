import{m as oe,b as le,c as ne}from"./flow-DzSZmebQ.js";import{_ as se}from"./index.vue_vue_type_script_setup_true_lang-ojmq6q2F.js";import{u as ie}from"./useSetting-CnYQd1RY.js";import{u as re}from"./useDesign-CbWcZHFZ.js";import{u as ue}from"./useRequset-Bj5fiv5N.js";import{d as de,f as i,aC as me,i as ce,r as n,as as pe,o as v,c as g,a as t,w as a,b as s,q as r,e as fe,W as x,t as S,s as ve,ab as ge,M as B,at as _e}from"./index-CqGaQ7t4.js";import{g as ye}from"./flowHelper-BpDILVBW.js";import{u as M}from"./index-BidCcHov.js";const be=[{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"租户编号",colKey:"tenantId"},{title:"流程主键",colKey:"id"},{title:"流程标识",colKey:"key"},{title:"流程名称",colKey:"name"},{title:"流程分类",colKey:"categoryName"},{title:"流程版本",colKey:"version"},{title:"状态",colKey:"suspensionState"},{title:"部署时间",colKey:"deploymentTime"},{fixed:"right",width:210,colKey:"op",title:"操作",align:"center"}],we={class:"table-wrapper"},he=["onClick"],Ce=["onClick"],ke=["onClick"],Ne=de({__name:"manager",setup(De){const{tableVar:R}=re(),{getTableHeaderAffixedTop:$,getLayoutContainer:q}=ie(),u=i({...{key:"",category:""}}),p=i(!1),z=me().getFlowDict,_=i("1"),{fetchData:O,data:P,pagination:y,dataLoading:j}=ue(oe,u.value,_e),I=()=>{O({...u.value,category:ye(u.value.category),mode:_.value})};ce(()=>{I()});const d=M(()=>{I()},300),E=l=>{y.value={...y.value,current:l.current||1,pageSize:l.pageSize},d()},H=({row:l})=>{const e=ge.confirm({header:"提示",theme:"warning",body:"确认删除当前所选数据?",onConfirm:M(async()=>{await le(l.deploymentId),B.success("删除成功"),e.destroy(),d()},300)})},W={type:""},G=i({type:[{required:!0,message:"请选择流程状态",type:"error",trigger:"change"}]}),J=[{value:"active",label:"激活"},{value:"suspend",label:"挂起"}],m=i(!1),f=i({...W}),b=i(null),w=i(""),Q=()=>{var l;(l=b.value)==null||l.validate({fields:["type"]}).then(async e=>{if(e===!0){m.value=!0;try{await ne({processId:w.value,state:f.value.type}),p.value=!1,m.value=!1,B.success("变更成功"),d()}catch{m.value=!1}}})},X=()=>{var l;(l=b.value)==null||l.reset(),w.value=""},Y=({row:l})=>{w.value=l.id,p.value=!0},h=i(!1),K=i({}),Z=({row:l})=>{K.value=l,h.value=!0};return(l,e)=>{const F=n("t-input"),C=n("t-form-item"),c=n("t-col"),T=n("t-select"),k=n("t-row"),U=n("t-button"),L=n("t-form"),N=n("t-radio-button"),ee=n("t-radio-group"),D=n("t-tag"),te=n("t-table"),ae=n("t-dialog"),V=pe("auth");return v(),g("div",{class:ve(s(R))},[t(L,{ref:"form",data:u.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:s(d),onSubmit:s(d)},{default:a(()=>[t(k,null,{default:a(()=>[t(c,{span:10},{default:a(()=>[t(k,{gutter:[16,24]},{default:a(()=>[t(c,{span:4},{default:a(()=>[t(C,{label:"流程标识",name:"key"},{default:a(()=>[t(F,{modelValue:u.value.key,"onUpdate:modelValue":e[0]||(e[0]=o=>u.value.key=o),clearable:"",placeholder:"请输入流程标识"},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{span:4},{default:a(()=>[t(C,{label:"流程分类",name:"category"},{default:a(()=>[t(T,{modelValue:u.value.category,"onUpdate:modelValue":e[1]||(e[1]=o=>u.value.category=o),options:s(z),keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择流程分类"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1}),t(c,{span:2,class:"operation-wrapper"},{default:a(()=>[t(U,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:a(()=>e[6]||(e[6]=[r(" 查询 ")])),_:1}),t(U,{type:"reset",variant:"base",theme:"default"},{default:a(()=>e[7]||(e[7]=[r(" 重置 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),fe("div",we,[t(te,{data:s(P),columns:s(be),hover:!0,loading:s(j),pagination:s(y),"header-affixed-top":{offsetTop:s($),container:s(q)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:E},{"top-content":a(()=>[t(k,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:a(()=>[t(c,{flex:"0 0 auto"},{default:a(()=>[t(ee,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=o=>_.value=o),onChange:s(d)},{default:a(()=>[t(N,{value:"1"},{default:a(()=>e[8]||(e[8]=[r("通用流程")])),_:1}),t(N,{value:"2"},{default:a(()=>e[9]||(e[9]=[r("定制流程")])),_:1})]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1})]),op:a(o=>[x((v(),g("a",{class:"t-button-link",onClick:A=>Y(o)},e[10]||(e[10]=[r("变更状态")]),8,he)),[[V,"flow_manager_state"]]),x((v(),g("a",{class:"t-button-link",onClick:A=>Z(o)},e[11]||(e[11]=[r("流程图")]),8,Ce)),[[V,"flow_manager_image"]]),x((v(),g("a",{class:"t-button-link",onClick:A=>H(o)},e[12]||(e[12]=[r("删除")]),8,ke)),[[V,"flow_manager_remove"]])]),tenantId:a(({row:o})=>[t(D,{theme:"primary",variant:"light"},{default:a(()=>[r(S(o.tenantId?o.tenantId:"通用"),1)]),_:2},1024)]),version:a(({row:o})=>[t(D,{theme:"primary",variant:"light"},{default:a(()=>[r("v"+S(o.version),1)]),_:2},1024)]),suspensionState:a(({row:o})=>[t(D,{theme:"primary",variant:"light"},{default:a(()=>[r(S(o.suspensionState===1?"激活":"挂起"),1)]),_:2},1024)]),_:1},8,["data","columns","loading","pagination","header-affixed-top"]),t(ae,{visible:p.value,"onUpdate:visible":e[4]||(e[4]=o=>p.value=o),header:"流程变更","confirm-btn":{loading:m.value},onConfirm:Q,onClosed:X},{body:a(()=>[t(L,{ref_key:"form2",ref:b,data:f.value,rules:G.value,"label-width":100,disabled:m.value,style:{padding:"25px 0"}},{default:a(()=>[t(C,{label:"流程状态",name:"type"},{default:a(()=>[t(T,{modelValue:f.value.type,"onUpdate:modelValue":e[3]||(e[3]=o=>f.value.type=o),options:J,placeholder:"请选择流程状态",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["data","rules","disabled"])]),_:1},8,["visible","confirm-btn"]),t(se,{visible:h.value,"onUpdate:visible":e[5]||(e[5]=o=>h.value=o),"row-data":K.value},null,8,["visible","row-data"])])],2)}}});export{Ne as default};
