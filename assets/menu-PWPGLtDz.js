import{d as de,g as d,R as re,a3 as z,X as ae,aV as _e,r as n,o as v,n as I,w as t,a as e,v as ie,s as m,q as E,c as D,F as be,S as ge,e as ce,a0 as O,a1 as ye,aW as he,M as oe,aX as Ve,aB as ke,av as we,aY as Ie,j as xe,ax as Ce,b as f,t as Te,aZ as Se}from"./index-C3aixgX8.js";import{u as Ue}from"./useSetting-oU45HIOI.js";import{u as De}from"./useDesign-CbWcZHFZ.js";import{u as Oe}from"./useRequset-DXnVyzrU.js";import{m as qe}from"./manifest-DE5it_94.js";import{u as le}from"./index-C0FKHvC_.js";const Ae=de({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""},parentId:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","update:parentId","submit"],setup(X,{emit:H}){const F={name:"",path:"",parentId:null,source:null,code:"",category:void 0,alias:"",sort:void 0,isOpen:null,remark:""},_=X,q=d({name:[{required:!0,message:"请输入菜单名称",type:"error",trigger:"blur"}],path:[{required:!1,message:"请输入路由地址",type:"error",trigger:"blur"}],source:[{required:!0,message:"请选择菜单图标",type:"error",trigger:"change"}],code:[{required:!0,message:"请输入菜单编号",type:"error",trigger:"blur"}],category:[{required:!0,message:"请选择菜单类型",type:"error",trigger:"change"}],alias:[{required:!0,message:"请输入菜单别名",type:"error",trigger:"blur"}],sort:[{required:!0,message:"请输入菜单排序",type:"error",trigger:"blur"}],isOpen:[{required:!0,message:"请选择是否新开窗口",type:"error",trigger:"change"}]}),W=re(()=>`${{view:"查看",edit:"编辑",add:"新增"}[_.actionType]||""}菜单`),g=re(()=>({view:!0,edit:!1})[_.actionType]||!1),y=d(qe),h=d(!1),a=d({...F}),w=d([]),x=d(null),V=d(!1),b=H,A=({firstError:s})=>{if(s)oe.warning(s);else{V.value=!0;const l={...a.value,id:_.editId};he(l).then(()=>{b("submit",l),oe.success("提交成功"),h.value=!1}).finally(()=>{V.value=!1})}},K=()=>{a.value={...F},ae(()=>{b("update:editId",""),b("update:actionType",""),b("update:parentId","")})},Y=()=>{h.value=!1},Z=()=>{Ve().then(s=>{w.value=s})};return z(()=>h.value,s=>{b("update:visible",s)}),z(()=>_.parentId,s=>{a.value.parentId=s}),z(()=>_.visible,s=>{s&&Z(),s&&_.editId&&ae(()=>{_e(_.editId).then(l=>{a.value={...l}})}),ae(()=>{var l;(l=x.value)==null||l.clearValidate()}),h.value=s}),z(()=>a.value.category,s=>{q.value.path[0].required=s===1,q.value.source[0].required=s===1}),(s,l)=>{const C=n("t-input"),i=n("t-form-item"),c=n("t-col"),T=n("t-radio"),S=n("t-radio-group"),G=n("t-tree-select"),M=n("t-icon"),ne=n("t-option"),N=n("t-select"),J=n("t-input-number"),R=n("t-textarea"),k=n("t-button"),j=n("t-row"),Q=n("t-form"),P=n("t-dialog");return v(),I(P,{visible:h.value,"onUpdate:visible":l[10]||(l[10]=o=>h.value=o),header:W.value,width:780,footer:!1,onClosed:K},{body:t(()=>[e(Q,{ref_key:"form",ref:x,class:ie({"xy-form__detail":X.actionType==="view"}),data:a.value,rules:q.value,"label-width":100,disabled:g.value||V.value,onSubmit:A},{default:t(()=>[e(j,{gutter:[0,28]},{default:t(()=>[e(c,{span:6},{default:t(()=>[e(i,{label:"菜单名称",name:"name"},{default:t(()=>[e(C,{modelValue:a.value.name,"onUpdate:modelValue":l[0]||(l[0]=o=>a.value.name=o),placeholder:"请输入菜单名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:6},{default:t(()=>[e(i,{label:"菜单类型",name:"category",placeholder:"请选择菜单类型"},{default:t(()=>[e(S,{modelValue:a.value.category,"onUpdate:modelValue":l[1]||(l[1]=o=>a.value.category=o)},{default:t(()=>[e(T,{value:1},{default:t(()=>[m("菜单")]),_:1}),e(T,{value:2},{default:t(()=>[m("按钮")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(c,{span:6},{default:t(()=>[e(i,{label:"上级菜单",name:"parentId"},{default:t(()=>[e(G,{modelValue:a.value.parentId,"onUpdate:modelValue":l[2]||(l[2]=o=>a.value.parentId=o),data:w.value,"popup-props":{overlayStyle:{width:"300px"},overlayInnerStyle:{width:"300px"}},"tree-props":{keys:{label:"title",value:"id",children:"children"}},clearable:"",placeholder:"请选择上级菜单"},null,8,["modelValue","data"])]),_:1})]),_:1}),e(c,{span:6},{default:t(()=>[e(i,{label:"路由地址",name:"path"},{default:t(()=>[e(C,{modelValue:a.value.path,"onUpdate:modelValue":l[3]||(l[3]=o=>a.value.path=o),placeholder:"请输入路由地址",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:6},{default:t(()=>[e(i,{label:"菜单图标",name:"source"},{default:t(()=>[e(N,{modelValue:a.value.source,"onUpdate:modelValue":l[4]||(l[4]=o=>a.value.source=o),placeholder:"请选择菜单图标",clearable:"","popup-props":{overlayStyle:{width:"350px"},overlayInnerStyle:{width:"350px"}}},{prefixIcon:t(()=>[a.value.source?(v(),I(M,{key:0,name:a.value.source,style:{marginRight:"8px"}},null,8,["name"])):E("",!0)]),default:t(()=>[(v(!0),D(be,null,ge(y.value,o=>(v(),I(ne,{key:o.stem,value:o.stem,label:o.stem,style:{display:"inline-block","font-size":"20px"}},{default:t(()=>[ce("div",null,[e(M,{name:o.stem},null,8,["name"])])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(c,{span:6},{default:t(()=>[e(i,{label:"菜单编号",name:"code"},{default:t(()=>[e(C,{modelValue:a.value.code,"onUpdate:modelValue":l[5]||(l[5]=o=>a.value.code=o),theme:"column",placeholder:"请输入菜单编号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:6},{default:t(()=>[e(i,{label:"菜单别名",name:"alias"},{default:t(()=>[e(C,{modelValue:a.value.alias,"onUpdate:modelValue":l[6]||(l[6]=o=>a.value.alias=o),placeholder:"请输入菜单别名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:6},{default:t(()=>[e(i,{label:"菜单排序",name:"sort"},{default:t(()=>[e(J,{modelValue:a.value.sort,"onUpdate:modelValue":l[7]||(l[7]=o=>a.value.sort=o),theme:"column",placeholder:"请输入菜单排序",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(c,{span:6},{default:t(()=>[e(i,{label:"是否新窗口",name:"isOpen"},{default:t(()=>[e(S,{modelValue:a.value.isOpen,"onUpdate:modelValue":l[8]||(l[8]=o=>a.value.isOpen=o),placeholder:"请选择是否新窗口"},{default:t(()=>[e(T,{value:0},{default:t(()=>[m("否")]),_:1}),e(T,{value:1},{default:t(()=>[m("是")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(c,{span:12},{default:t(()=>[e(i,{label:"菜单备注",name:"remark"},{default:t(()=>[e(R,{modelValue:a.value.remark,"onUpdate:modelValue":l[9]||(l[9]=o=>a.value.remark=o),placeholder:"请输入菜单备注",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),O(e(c,{span:12},{default:t(()=>[e(i,{style:{float:"right"}},{default:t(()=>[e(k,{variant:"outline",onClick:Y},{default:t(()=>[m("取消")]),_:1}),e(k,{theme:"primary",type:"submit"},{default:t(()=>[m("确定")]),_:1})]),_:1})]),_:1},512),[[ye,!g.value]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),Ke=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"菜单名称",colKey:"name",ellipsis:!0,width:200},{title:"路由地址",colKey:"path",ellipsis:!0,width:200},{title:"菜单图标",colKey:"source",width:80,ellipsis:!0,align:"center"},{title:"菜单编号",colKey:"code",width:150,ellipsis:!0},{title:"新窗口",colKey:"isOpen",width:80,ellipsis:!0},{title:"菜单排序",width:80,colKey:"sort",ellipsis:!0},{fixed:"right",width:180,colKey:"op",title:"操作",align:"center"}],Re={class:"table-wrapper"},Be=["onClick"],Le=["onClick"],$e=["onClick"],Fe=["onClick"],He=de({__name:"menu",setup(X){const{tableVar:H}=De(),{getTableHeaderAffixedTop:F,getLayoutContainer:_}=Ue(),{hasRole:q}=ke(),W={name:"",code:""},g=d([]),y=d({...W}),h=we({childrenKey:"children",treeNodeColumnIndex:2}),a=d(!1),w=d(!1),x=d(""),V=d(""),b=d(""),A=d({}),{fetchData:K,data:Y,dataLoading:Z}=Oe(Ie,y.value,()=>{g.value=[]},!1);xe(()=>{K()});const s=({row:p},r)=>{A.value=p,x.value=p.id,V.value=r,w.value=!0},l=({row:p})=>{b.value=p.id,V.value="add",w.value=!0},C=({row:p})=>{R.value=p.id,k.value="one",a.value=!0},i=d(!1),c=d(null),T=()=>{i.value=!i.value,i.value?c.value.expandAll():c.value.foldAll()},S=le(()=>{K()},300),G=le(T,300),M=p=>{g.value=p},N=le(async p=>{try{await Se(p),a.value=!1,oe.success("删除成功"),j(),S()}catch{a.value=!1}},300),J=()=>{g.value.length&&(k.value="check",a.value=!0)},R=d(-1),k=d(),j=()=>{R.value=-1,k.value=""},Q=()=>{k.value==="check"&&N(g.value),k.value==="one"&&N([`${R.value}`])},P=()=>{j()},o=p=>{var B;const{parentId:r}=f(A.value);p.parentId!==r?K():p.id&&((B=c.value)==null||B.setData(p.id,{...A.value,...p}))};return(p,r)=>{const B=n("t-input"),ue=n("t-form-item"),U=n("t-col"),ee=n("t-row"),L=n("t-button"),pe=n("t-form"),me=n("t-icon"),se=n("t-tag"),ve=n("t-enhanced-table"),fe=n("t-dialog"),$=Ce("auth");return v(),D("div",{class:ie(f(H))},[e(pe,{ref:"form",data:y.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:f(S),onSubmit:f(S)},{default:t(()=>[e(ee,null,{default:t(()=>[e(U,{span:10},{default:t(()=>[e(ee,{gutter:[16,24]},{default:t(()=>[e(U,{span:4},{default:t(()=>[e(ue,{label:"菜单名称",name:"name"},{default:t(()=>[e(B,{modelValue:y.value.name,"onUpdate:modelValue":r[0]||(r[0]=u=>y.value.name=u),placeholder:"请输入菜单名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(U,{span:4},{default:t(()=>[e(ue,{label:"菜单编号",name:"code"},{default:t(()=>[e(B,{modelValue:y.value.code,"onUpdate:modelValue":r[1]||(r[1]=u=>y.value.code=u),placeholder:"请输入菜单编号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(U,{span:2,class:"operation-wrapper"},{default:t(()=>[e(L,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[m(" 查询 ")]),_:1}),e(L,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[m(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),ce("div",Re,[e(ve,{ref_key:"enhancedTable",ref:c,data:f(Y),columns:f(Ke),hover:!0,loading:f(Z),tree:h,"selected-row-keys":g.value,"header-affixed-top":{offsetTop:f(F),container:f(_)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onSelectChange:M},{"top-content":t(()=>[e(ee,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(U,{flex:"0 0 auto"},{default:t(()=>[O((v(),I(L,{onClick:r[2]||(r[2]=u=>s({row:{}},"add"))},{default:t(()=>[m("新增")]),_:1})),[[$,"menu_add"]]),O((v(),I(L,{theme:"danger",onClick:J},{default:t(()=>[m("删除")]),_:1})),[[$,"menu_delete"]])]),_:1}),e(U,{flex:"0 0 auto"},{default:t(()=>[e(L,{theme:"default",onClick:f(G)},{default:t(()=>[m(Te(i.value?"收起全部":"展开全部"),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),source:t(({row:u})=>[e(me,{name:u.source},null,8,["name"])]),isOpen:t(({row:u})=>[u.isOpen===0?(v(),I(se,{key:0,theme:"warning",variant:"light"},{default:t(()=>[m(" 否 ")]),_:1})):E("",!0),u.isOpen===1?(v(),I(se,{key:1,theme:"success",variant:"light"},{default:t(()=>[m(" 是 ")]),_:1})):E("",!0)]),op:t(u=>[O((v(),D("a",{class:"t-button-link",onClick:te=>s(u,"view")},[m("查看")],8,Be)),[[$,"menu_view"]]),O((v(),D("a",{class:"t-button-link",onClick:te=>s(u,"edit")},[m("编辑")],8,Le)),[[$,"menu_edit"]]),O((v(),D("a",{class:"t-button-link",onClick:te=>C(u)},[m("删除")],8,$e)),[[$,"menu_delete"]]),f(q)(["administrator","admin"])?(v(),D("a",{key:0,class:"t-button-link",onClick:te=>l(u)}," 新增子项 ",8,Fe)):E("",!0)]),_:1},8,["data","columns","loading","tree","selected-row-keys","header-affixed-top"]),e(fe,{visible:a.value,"onUpdate:visible":r[3]||(r[3]=u=>a.value=u),header:"确认删除当前所选数据？","on-cancel":P,onConfirm:Q},null,8,["visible"]),e(Ae,{visible:w.value,"onUpdate:visible":r[4]||(r[4]=u=>w.value=u),editId:x.value,"onUpdate:editId":r[5]||(r[5]=u=>x.value=u),actionType:V.value,"onUpdate:actionType":r[6]||(r[6]=u=>V.value=u),parentId:b.value,"onUpdate:parentId":r[7]||(r[7]=u=>b.value=u),onSubmit:o},null,8,["visible","editId","actionType","parentId"])])],2)}}});export{He as default};
