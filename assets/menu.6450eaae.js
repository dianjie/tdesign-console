import{d as re,r as d,C as se,ax as G,av as ue,aY as be,e as o,f,g as E,w as u,m as L,l as e,q as de,j as m,p,i as I,F as ge,H as Fe,n as ie,J as T,K as ye,aZ as Ce,M as le,a_ as De,_ as ce,aK as he,aE as Be,a$ as Ee,a as Ve,aG as we,t as ke,b0 as xe}from"./index.c2521a03.js";import{u as Ie}from"./useDesign.9d0ca2bc.js";import{u as Te}from"./useSetting.65510119.js";import{u as Ae}from"./useRequset.5f7a0394.js";import{m as Se}from"./manifest.d091b73e.js";import{u as te}from"./index.d71d3bee.js";const Ue=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"\u5E8F\u53F7",width:80,align:"center",fixed:"left"},{title:"\u83DC\u5355\u540D\u79F0",colKey:"name",ellipsis:!0,width:200},{title:"\u8DEF\u7531\u5730\u5740",colKey:"path",ellipsis:!0,width:200},{title:"\u83DC\u5355\u56FE\u6807",colKey:"source",width:80,ellipsis:!0,align:"center"},{title:"\u83DC\u5355\u7F16\u53F7",colKey:"code",width:150,ellipsis:!0},{title:"\u65B0\u7A97\u53E3",colKey:"isOpen",width:80,ellipsis:!0},{title:"\u83DC\u5355\u6392\u5E8F",width:80,colKey:"sort",ellipsis:!0},{fixed:"right",width:180,colKey:"op",title:"\u64CD\u4F5C",align:"center"}],Oe=re({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""},parentId:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","update:parentId","submit"],setup(J,{emit:D}){const _=J,M={name:"",path:"",parentId:null,source:null,code:"",category:void 0,alias:"",sort:void 0,isOpen:null,remark:""},A=d({name:[{required:!0,message:"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0",type:"error",trigger:"blur"}],path:[{required:!1,message:"\u8BF7\u8F93\u5165\u8DEF\u7531\u5730\u5740",type:"error",trigger:"blur"}],source:[{required:!0,message:"\u8BF7\u9009\u62E9\u83DC\u5355\u56FE\u6807",type:"error",trigger:"change"}],code:[{required:!0,message:"\u8BF7\u8F93\u5165\u83DC\u5355\u7F16\u53F7",type:"error",trigger:"blur"}],category:[{required:!0,message:"\u8BF7\u9009\u62E9\u83DC\u5355\u7C7B\u578B",type:"error",trigger:"change"}],alias:[{required:!0,message:"\u8BF7\u8F93\u5165\u83DC\u5355\u522B\u540D",type:"error",trigger:"blur"}],sort:[{required:!0,message:"\u8BF7\u8F93\u5165\u83DC\u5355\u6392\u5E8F",type:"error",trigger:"blur"}],isOpen:[{required:!0,message:"\u8BF7\u9009\u62E9\u662F\u5426\u65B0\u5F00\u7A97\u53E3",type:"error",trigger:"change"}]}),Y=se(()=>`${{view:"\u67E5\u770B",edit:"\u7F16\u8F91",add:"\u65B0\u589E"}[_.actionType]||""}\u83DC\u5355`),g=se(()=>({view:!0,edit:!1})[_.actionType]||!1),F=d(Se),y=d(!1),t=d({...M}),h=d([]),V=d(null),C=d(!1),S=({firstError:r})=>{if(r)le.warning(r);else{C.value=!0;const l={...t.value,id:_.editId};Ce(l).then(()=>{D("submit",l),le.success("\u63D0\u4EA4\u6210\u529F"),y.value=!1}).finally(()=>{C.value=!1})}},U=()=>{t.value={...M},ue(()=>{D("update:editId",""),D("update:actionType",""),D("update:parentId","")})},O=()=>{y.value=!1},Z=()=>{De().then(r=>{h.value=r})};return G(()=>y.value,r=>{D("update:visible",r)}),G(()=>_.parentId,r=>{t.value.parentId=r}),G(()=>_.visible,r=>{r&&Z(),r&&_.editId&&ue(()=>{be(_.editId).then(l=>{t.value={...l}})}),ue(()=>{var l;(l=V.value)==null||l.clearValidate()}),y.value=r}),G(()=>t.value.category,r=>{A.value.path[0].required=r===1,A.value.source[0].required=r===1}),(r,l)=>{const w=o("t-input"),v=o("t-form-item"),i=o("t-col"),b=o("t-radio"),N=o("t-radio-group"),K=o("t-tree-select"),j=o("t-icon"),Q=o("t-option"),ae=o("t-select"),z=o("t-input-number"),W=o("t-textarea"),k=o("t-button"),B=o("t-row"),H=o("t-form"),X=o("t-dialog");return f(),E(X,{visible:y.value,"onUpdate:visible":l[10]||(l[10]=a=>y.value=a),header:m(Y),width:780,footer:!1,onClosed:U},{body:u(()=>[L(" \u8868\u5355\u5185\u5BB9 "),e(H,{ref_key:"form",ref:V,class:de({"xy-form__detail":J.actionType==="view"}),data:t.value,rules:A.value,"label-width":100,disabled:m(g)||C.value,onSubmit:S},{default:u(()=>[e(B,{gutter:[0,28]},{default:u(()=>[e(i,{span:6},{default:u(()=>[e(v,{label:"\u83DC\u5355\u540D\u79F0",name:"name"},{default:u(()=>[e(w,{modelValue:t.value.name,"onUpdate:modelValue":l[0]||(l[0]=a=>t.value.name=a),placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:6},{default:u(()=>[e(v,{label:"\u83DC\u5355\u7C7B\u578B",name:"category",placeholder:"\u8BF7\u9009\u62E9\u83DC\u5355\u7C7B\u578B"},{default:u(()=>[e(N,{modelValue:t.value.category,"onUpdate:modelValue":l[1]||(l[1]=a=>t.value.category=a)},{default:u(()=>[e(b,{value:1},{default:u(()=>[p("\u83DC\u5355")]),_:1}),e(b,{value:2},{default:u(()=>[p("\u6309\u94AE")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(i,{span:6},{default:u(()=>[e(v,{label:"\u4E0A\u7EA7\u83DC\u5355",name:"parentId"},{default:u(()=>[e(K,{modelValue:t.value.parentId,"onUpdate:modelValue":l[2]||(l[2]=a=>t.value.parentId=a),data:h.value,"popup-props":{overlayStyle:{width:"300px"},overlayInnerStyle:{width:"300px"}},"tree-props":{keys:{label:"title",value:"id",children:"children"}},clearable:"",placeholder:"\u8BF7\u9009\u62E9\u4E0A\u7EA7\u83DC\u5355"},null,8,["modelValue","data"])]),_:1})]),_:1}),e(i,{span:6},{default:u(()=>[e(v,{label:"\u8DEF\u7531\u5730\u5740",name:"path"},{default:u(()=>[e(w,{modelValue:t.value.path,"onUpdate:modelValue":l[3]||(l[3]=a=>t.value.path=a),placeholder:"\u8BF7\u8F93\u5165\u8DEF\u7531\u5730\u5740",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:6},{default:u(()=>[e(v,{label:"\u83DC\u5355\u56FE\u6807",name:"source"},{default:u(()=>[e(ae,{modelValue:t.value.source,"onUpdate:modelValue":l[4]||(l[4]=a=>t.value.source=a),placeholder:"\u8BF7\u9009\u62E9\u83DC\u5355\u56FE\u6807",clearable:"","popup-props":{overlayStyle:{width:"350px"},overlayInnerStyle:{width:"350px"}}},{prefixIcon:u(()=>[t.value.source?(f(),E(j,{key:0,name:t.value.source,style:{marginRight:"8px"}},null,8,["name"])):L("v-if",!0)]),default:u(()=>[(f(!0),I(ge,null,Fe(F.value,a=>(f(),E(Q,{key:a.stem,value:a.stem,label:a.stem,style:{display:"inline-block","font-size":"20px"}},{default:u(()=>[ie("div",null,[e(j,{name:a.stem},null,8,["name"])])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(i,{span:6},{default:u(()=>[e(v,{label:"\u83DC\u5355\u7F16\u53F7",name:"code"},{default:u(()=>[e(w,{modelValue:t.value.code,"onUpdate:modelValue":l[5]||(l[5]=a=>t.value.code=a),theme:"column",placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u7F16\u53F7",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:6},{default:u(()=>[e(v,{label:"\u83DC\u5355\u522B\u540D",name:"alias"},{default:u(()=>[e(w,{modelValue:t.value.alias,"onUpdate:modelValue":l[6]||(l[6]=a=>t.value.alias=a),placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u522B\u540D",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:6},{default:u(()=>[e(v,{label:"\u83DC\u5355\u6392\u5E8F",name:"sort"},{default:u(()=>[e(z,{modelValue:t.value.sort,"onUpdate:modelValue":l[7]||(l[7]=a=>t.value.sort=a),theme:"column",placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u6392\u5E8F",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:6},{default:u(()=>[e(v,{label:"\u662F\u5426\u65B0\u7A97\u53E3",name:"isOpen"},{default:u(()=>[e(N,{modelValue:t.value.isOpen,"onUpdate:modelValue":l[8]||(l[8]=a=>t.value.isOpen=a),placeholder:"\u8BF7\u9009\u62E9\u662F\u5426\u65B0\u7A97\u53E3"},{default:u(()=>[e(b,{value:0},{default:u(()=>[p("\u5426")]),_:1}),e(b,{value:1},{default:u(()=>[p("\u662F")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(i,{span:12},{default:u(()=>[e(v,{label:"\u83DC\u5355\u5907\u6CE8",name:"remark"},{default:u(()=>[e(W,{modelValue:t.value.remark,"onUpdate:modelValue":l[9]||(l[9]=a=>t.value.remark=a),placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u5907\u6CE8",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),T(e(i,{span:12},{default:u(()=>[e(v,{style:{float:"right"}},{default:u(()=>[e(k,{variant:"outline",onClick:O},{default:u(()=>[p("\u53D6\u6D88")]),_:1}),e(k,{theme:"primary",type:"submit"},{default:u(()=>[p("\u786E\u5B9A")]),_:1})]),_:1})]),_:1},512),[[ye,!m(g)]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),Ke=ce(Oe,[["__file","D:/Study/tdesign-console/src/viewsBusiness/system/components/menu/DialogForm.vue"]]),qe={class:"table-wrapper"},Re=["onClick"],$e=["onClick"],Le=["onClick"],Me=["onClick"],Ne=re({__name:"menu",setup(J){const{tableVar:D}=Ie(),{getTableHeaderAffixedTop:_,getLayoutContainer:M}=Te(),{hasRole:A}=he(),Y={name:"",code:""},g=d([]),F=d({...Y}),y=Be({childrenKey:"children",treeNodeColumnIndex:2}),t=d(!1),h=d(!1),V=d(""),C=d(""),S=d(""),U=d({}),{fetchData:O,data:Z,dataLoading:r}=Ae(Ee,F.value,()=>{g.value=[]},!1);Ve(()=>{O()});const l=({row:c},s)=>{U.value=c,V.value=c.id,C.value=s,h.value=!0},w=({row:c})=>{S.value=c.id,C.value="add",h.value=!0},v=({row:c})=>{k.value=c.id,B.value="one",t.value=!0},i=d(!1),b=d(null),N=()=>{i.value=!i.value,i.value?b.value.expandAll():b.value.foldAll()},K=te(()=>{O()},300),j=te(N,300),Q=c=>{g.value=c},z=te(async c=>{try{await xe(c),t.value=!1,le.success("\u5220\u9664\u6210\u529F"),H(),K()}catch{t.value=!1}},300),W=()=>{!g.value.length||(B.value="check",t.value=!0)},k=d(-1),B=d(),H=()=>{k.value=-1,B.value=""},X=()=>{B.value==="check"&&z(g.value),B.value==="one"&&z([`${k.value}`])},a=()=>{H()},pe=c=>{var q;const{parentId:s}=m(U.value);c.parentId!==s?O():c.id&&((q=b.value)==null||q.setData(c.id,{...U.value,...c}))};return(c,s)=>{const q=o("t-input"),oe=o("t-form-item"),x=o("t-col"),P=o("t-row"),R=o("t-button"),me=o("t-form"),ve=o("t-icon"),ne=o("t-tag"),fe=o("t-enhanced-table"),_e=o("t-dialog"),$=we("auth");return f(),I("div",{class:de(m(D))},[e(me,{ref:"form",data:F.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:m(K),onSubmit:m(K)},{default:u(()=>[e(P,null,{default:u(()=>[e(x,{span:10},{default:u(()=>[e(P,{gutter:[16,24]},{default:u(()=>[e(x,{span:4},{default:u(()=>[e(oe,{label:"\u83DC\u5355\u540D\u79F0",name:"name"},{default:u(()=>[e(q,{modelValue:F.value.name,"onUpdate:modelValue":s[0]||(s[0]=n=>F.value.name=n),placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(x,{span:4},{default:u(()=>[e(oe,{label:"\u83DC\u5355\u7F16\u53F7",name:"code"},{default:u(()=>[e(q,{modelValue:F.value.code,"onUpdate:modelValue":s[1]||(s[1]=n=>F.value.code=n),placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u7F16\u53F7",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(x,{span:2,class:"operation-wrapper"},{default:u(()=>[e(R,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:u(()=>[p(" \u67E5\u8BE2 ")]),_:1}),e(R,{type:"reset",variant:"base",theme:"default"},{default:u(()=>[p(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),ie("div",qe,[e(fe,{ref_key:"enhancedTable",ref:b,data:m(Z),columns:m(Ue),hover:!0,loading:m(r),tree:y,"selected-row-keys":g.value,"header-affixed-top":{offsetTop:m(_),container:m(M)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onSelectChange:Q},{"top-content":u(()=>[e(P,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:u(()=>[e(x,{flex:"0 0 auto"},{default:u(()=>[T((f(),E(R,{onClick:s[2]||(s[2]=n=>l({row:{}},"add"))},{default:u(()=>[p("\u65B0\u589E")]),_:1})),[[$,"menu_add"]]),T((f(),E(R,{theme:"danger",onClick:W},{default:u(()=>[p("\u5220\u9664")]),_:1})),[[$,"menu_delete"]])]),_:1}),e(x,{flex:"0 0 auto"},{default:u(()=>[e(R,{theme:"default",onClick:m(j)},{default:u(()=>[p(ke(i.value?"\u6536\u8D77\u5168\u90E8":"\u5C55\u5F00\u5168\u90E8"),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),source:u(({row:n})=>[e(ve,{name:n.source},null,8,["name"])]),isOpen:u(({row:n})=>[n.isOpen===0?(f(),E(ne,{key:0,theme:"warning",variant:"light"},{default:u(()=>[p(" \u5426 ")]),_:1})):L("v-if",!0),n.isOpen===1?(f(),E(ne,{key:1,theme:"success",variant:"light"},{default:u(()=>[p(" \u662F ")]),_:1})):L("v-if",!0)]),op:u(n=>[T((f(),I("a",{class:"t-button-link",onClick:ee=>l(n,"view")},[p("\u67E5\u770B")],8,Re)),[[$,"menu_view"]]),T((f(),I("a",{class:"t-button-link",onClick:ee=>l(n,"edit")},[p("\u7F16\u8F91")],8,$e)),[[$,"menu_edit"]]),T((f(),I("a",{class:"t-button-link",onClick:ee=>v(n)},[p("\u5220\u9664")],8,Le)),[[$,"menu_delete"]]),m(A)(["administrator","admin"])?(f(),I("a",{key:0,class:"t-button-link",onClick:ee=>w(n)}," \u65B0\u589E\u5B50\u9879 ",8,Me)):L("v-if",!0)]),_:1},8,["data","columns","loading","tree","selected-row-keys","header-affixed-top"]),e(_e,{visible:t.value,"onUpdate:visible":s[3]||(s[3]=n=>t.value=n),header:"\u786E\u8BA4\u5220\u9664\u5F53\u524D\u6240\u9009\u6570\u636E\uFF1F","on-cancel":a,onConfirm:X},null,8,["visible"]),e(Ke,{visible:h.value,"onUpdate:visible":s[4]||(s[4]=n=>h.value=n),editId:V.value,"onUpdate:editId":s[5]||(s[5]=n=>V.value=n),actionType:C.value,"onUpdate:actionType":s[6]||(s[6]=n=>C.value=n),parentId:S.value,"onUpdate:parentId":s[7]||(s[7]=n=>S.value=n),onSubmit:pe},null,8,["visible","editId","actionType","parentId"])])],2)}}}),Ze=ce(Ne,[["__file","D:/Study/tdesign-console/src/views/system/menu.vue"]]);export{Ze as default};
