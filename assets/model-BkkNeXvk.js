import{e as Y,h as Z,r as ee}from"./flow-fOLvsXZF.js";import{u as te}from"./useSetting-BlFh-p_q.js";import{u as oe}from"./useDesign-CbWcZHFZ.js";import{u as ae}from"./useRequset-BqiZ8nsq.js";import{F as le}from"./index-BrNqF5BI.js";import{d as J,f as u,aG as ne,a7 as E,r as o,o as b,m as j,w as t,a as e,b as l,q as c,p as se,M as G,i as ie,aw as de,c as I,e as ue,$ as K,t as re,s as ce,ax as me}from"./index-OjS_2jsV.js";import{g as fe,a as pe}from"./flowHelper-BQUcMvxs.js";import{g as _e}from"./tenant-D0-jt9WM.js";import{u as k}from"./index-BiO29gyn.js";const ve=J({__name:"DialogDeploy",props:{visible:{type:Boolean,default:!1},modelId:{type:String,default:""}},emits:["update:visible","submit"],setup(H,{emit:F}){const M=u(!1),B=ne().getFlowDict,L=u([]);async function _(){const i=await _e();L.value=i,M.value=!0}const y={categoryValue:"",flowMode:1,tenantId:[]},D=H,N=u({categoryValue:[{required:!0,message:"请选择流程类型",type:"error",trigger:"change"}],flowMode:[{required:!0,message:"请选择流程模式",type:"error",trigger:"change"}],tenantId:[{required:!0,message:"请选择所属租户",type:"error",trigger:"change"}]}),f=u(!1),m=u({...y}),w=u(null),C=u(!1),h=F,T=k(({firstError:i})=>{if(i)G.warning(i);else{C.value=!0;const{categoryValue:n,flowMode:v,tenantId:g}=l(m),p={modelId:D.modelId,category:fe(n),tenantIds:v===2?g.join(","):""};Y(p).then(()=>{h("submit",p),G.success("部署成功"),f.value=!1}).finally(()=>{C.value=!1})}},300),q=()=>{var i;(i=w.value)==null||i.reset()},x=()=>{f.value=!1};return E(()=>f.value,i=>{h("update:visible",i)}),E(()=>D.visible,i=>{M.value||_(),f.value=i}),(i,n)=>{const v=o("t-select"),g=o("t-form-item"),p=o("t-col"),V=o("t-radio"),O=o("t-radio-group"),s=o("t-button"),r=o("t-row"),S=o("t-form"),$=o("t-dialog");return b(),j($,{visible:f.value,"onUpdate:visible":n[3]||(n[3]=d=>f.value=d),header:"流程部署",width:580,footer:!1,onClosed:q},{body:t(()=>[e(S,{ref_key:"form",ref:w,data:m.value,rules:N.value,"label-width":100,disabled:C.value,onSubmit:l(T)},{default:t(()=>[e(r,{gutter:[0,28]},{default:t(()=>[e(p,{span:12},{default:t(()=>[e(g,{label:"流程类型",name:"categoryValue"},{default:t(()=>[e(v,{modelValue:m.value.categoryValue,"onUpdate:modelValue":n[0]||(n[0]=d=>m.value.categoryValue=d),options:l(B),keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择流程类型"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(p,{span:12},{default:t(()=>[e(g,{label:"流程模式",name:"flowMode"},{default:t(()=>[e(O,{modelValue:m.value.flowMode,"onUpdate:modelValue":n[1]||(n[1]=d=>m.value.flowMode=d)},{default:t(()=>[e(V,{value:1},{default:t(()=>[c("通用流程")]),_:1}),e(V,{value:2},{default:t(()=>[c("定制流程")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),m.value.flowMode===2?(b(),j(p,{key:0,span:12},{default:t(()=>[e(g,{label:"所属租户",name:"tenantId"},{default:t(()=>[e(v,{modelValue:m.value.tenantId,"onUpdate:modelValue":n[2]||(n[2]=d=>m.value.tenantId=d),multiple:"",options:L.value,keys:{value:"tenantId",label:"tenantName"},clearable:"",placeholder:"请选择所属租户"},null,8,["modelValue","options"])]),_:1})]),_:1})):se("",!0),e(p,{span:12},{default:t(()=>[e(g,{style:{float:"right"}},{default:t(()=>[e(s,{variant:"outline",onClick:x},{default:t(()=>[c("关闭")]),_:1}),e(s,{theme:"primary",disabled:C.value,type:"submit"},{default:t(()=>[c("部署")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled","onSubmit"])]),_:1},8,["visible"])}}}),ge=[{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"模型主键",colKey:"id"},{title:"模型标识",colKey:"modelKey"},{title:"模型名称",colKey:"name"},{title:"流程版本",colKey:"version"},{title:"创建时间",colKey:"created"},{title:"更新时间",colKey:"lastUpdated"},{fixed:"right",width:210,colKey:"op",title:"操作",align:"center"}],be={class:"table-wrapper"},ye=["onClick"],we=["onClick"],he=["onClick"],Ce=["onClick"],$e=J({__name:"model",setup(H){const{tableVar:F}=oe(),{getTableHeaderAffixedTop:M,getLayoutContainer:B}=te(),_=u({...{modelKey:"",name:""}}),y=u(!1),{fetchData:D,data:N,pagination:f,dataLoading:m}=ae(Z,_.value,me);ie(()=>{D()});const w=k(()=>{D()},300),C=s=>{f.value={...f.value,current:s.current||1,pageSize:s.pageSize},w()},h=u(""),T=({row:s})=>{h.value=s.id,y.value=!0},q=k(async()=>{try{await ee(h.value),y.value=!1,G.success("删除成功"),w()}catch{y.value=!1}},300),x=pe(),i=k(({row:s})=>{window.open(`${x}/app/rest/models/${s.id}/bpmn20`)}),n=u(!1),v=u(""),g=k(()=>{v.value=`${x}/index.html`,n.value=!0},300),p=k(({row:s})=>{v.value=`${x}/index.html#/editor/${s.id}`,n.value=!0},300),V=u(!1),O=({row:s})=>{h.value=s.id,V.value=!0};return(s,r)=>{const S=o("t-input"),$=o("t-form-item"),d=o("t-col"),A=o("t-row"),z=o("t-button"),Q=o("t-form"),W=o("t-tag"),X=o("t-table"),P=o("t-dialog"),U=de("auth");return b(),I("div",{class:ce(l(F))},[e(Q,{ref:"form",data:_.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:l(w),onSubmit:l(w)},{default:t(()=>[e(A,null,{default:t(()=>[e(d,{span:10},{default:t(()=>[e(A,{gutter:[16,24]},{default:t(()=>[e(d,{span:4},{default:t(()=>[e($,{label:"模型标识",name:"modelKey"},{default:t(()=>[e(S,{modelValue:_.value.modelKey,"onUpdate:modelValue":r[0]||(r[0]=a=>_.value.modelKey=a),clearable:"",placeholder:"请输入模型标识"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:4},{default:t(()=>[e($,{label:"模型名称",name:"name"},{default:t(()=>[e(S,{modelValue:_.value.name,"onUpdate:modelValue":r[1]||(r[1]=a=>_.value.name=a),clearable:"",placeholder:"请输入模型名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(d,{span:2,class:"operation-wrapper"},{default:t(()=>[e(z,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[c(" 查询 ")]),_:1}),e(z,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[c(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),ue("div",be,[e(X,{data:l(N),columns:l(ge),hover:!0,loading:l(m),pagination:l(f),"header-affixed-top":{offsetTop:l(M),container:l(B)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:C},{"top-content":t(()=>[e(A,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(d,{flex:"0 0 auto"},{default:t(()=>[K((b(),j(z,{onClick:l(g)},{default:t(()=>[c("创建")]),_:1},8,["onClick"])),[[U,"flow_model_create"]])]),_:1})]),_:1})]),op:t(a=>[K((b(),I("a",{class:"t-button-link",onClick:R=>l(p)(a)},[c("配置")],8,ye)),[[U,"flow_model_update"]]),K((b(),I("a",{class:"t-button-link",onClick:R=>O(a)},[c("部署")],8,we)),[[U,"flow_model_deploy"]]),K((b(),I("a",{class:"t-button-link",onClick:R=>l(i)(a)},[c("下载")],8,he)),[[U,"flow_model_download"]]),K((b(),I("a",{class:"t-button-link",onClick:R=>T(a)},[c("删除")],8,Ce)),[[U,"flow_model_delete"]])]),version:t(({row:a})=>[e(W,{theme:"primary",variant:"light"},{default:t(()=>[c("v"+re(a.version),1)]),_:2},1024)]),_:1},8,["data","columns","loading","pagination","header-affixed-top"]),e(P,{visible:y.value,"onUpdate:visible":r[2]||(r[2]=a=>y.value=a),header:"确认删除当前所选数据？",onConfirm:l(q)},null,8,["visible","onConfirm"]),e(P,{visible:n.value,"onUpdate:visible":r[3]||(r[3]=a=>n.value=a),header:"流程配置",mode:"full-screen"},{default:t(()=>[e(le,{"frame-src":v.value},null,8,["frame-src"])]),_:1},8,["visible"]),e(ve,{visible:V.value,"onUpdate:visible":r[4]||(r[4]=a=>V.value=a),"model-id":h.value},null,8,["visible","model-id"])])],2)}}});export{$e as default};
