import{e as Y,h as Z,r as ee}from"./flow-DzSZmebQ.js";import{u as te}from"./useSetting-CnYQd1RY.js";import{u as oe}from"./useDesign-CbWcZHFZ.js";import{u as le}from"./useRequset-Bj5fiv5N.js";import{F as ae}from"./index-BZuf1Xz8.js";import{d as E,f as r,aC as ne,a2 as W,r as a,o as b,m as j,w as t,a as e,b as s,q as m,p as se,M as G,i as ie,as as de,c as I,e as ue,W as K,t as re,s as me,at as fe}from"./index-CqGaQ7t4.js";import{g as pe,a as ce}from"./flowHelper-BpDILVBW.js";import{g as ve}from"./tenant-BajJal67.js";import{u as D}from"./index-BidCcHov.js";const _e=E({__name:"DialogDeploy",props:{visible:{type:Boolean,default:!1},modelId:{type:String,default:""}},emits:["update:visible","submit"],setup(H,{emit:$}){const M=r(!1),B=ne().getFlowDict,L=r([]);async function v(){const d=await ve();L.value=d,M.value=!0}const y={categoryValue:"",flowMode:1,tenantId:[]},x=H,N=r({categoryValue:[{required:!0,message:"请选择流程类型",type:"error",trigger:"change"}],flowMode:[{required:!0,message:"请选择流程模式",type:"error",trigger:"change"}],tenantId:[{required:!0,message:"请选择所属租户",type:"error",trigger:"change"}]}),p=r(!1),f=r({...y}),w=r(null),V=r(!1),C=$,T=D(({firstError:d})=>{if(d)G.warning(d);else{V.value=!0;const{categoryValue:l,flowMode:_,tenantId:g}=s(f),c={modelId:x.modelId,category:pe(l),tenantIds:_===2?g.join(","):""};Y(c).then(()=>{C("submit",c),G.success("部署成功"),p.value=!1}).finally(()=>{V.value=!1})}},300),q=()=>{var d;(d=w.value)==null||d.reset()},U=()=>{p.value=!1};return W(()=>p.value,d=>{C("update:visible",d)}),W(()=>x.visible,d=>{M.value||v(),p.value=d}),(d,l)=>{const _=a("t-select"),g=a("t-form-item"),c=a("t-col"),k=a("t-radio"),O=a("t-radio-group"),i=a("t-button"),o=a("t-row"),S=a("t-form"),F=a("t-dialog");return b(),j(F,{visible:p.value,"onUpdate:visible":l[3]||(l[3]=u=>p.value=u),header:"流程部署",width:580,footer:!1,onClosed:q},{body:t(()=>[e(S,{ref_key:"form",ref:w,data:f.value,rules:N.value,"label-width":100,disabled:V.value,onSubmit:s(T)},{default:t(()=>[e(o,{gutter:[0,28]},{default:t(()=>[e(c,{span:12},{default:t(()=>[e(g,{label:"流程类型",name:"categoryValue"},{default:t(()=>[e(_,{modelValue:f.value.categoryValue,"onUpdate:modelValue":l[0]||(l[0]=u=>f.value.categoryValue=u),options:s(B),keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择流程类型"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(c,{span:12},{default:t(()=>[e(g,{label:"流程模式",name:"flowMode"},{default:t(()=>[e(O,{modelValue:f.value.flowMode,"onUpdate:modelValue":l[1]||(l[1]=u=>f.value.flowMode=u)},{default:t(()=>[e(k,{value:1},{default:t(()=>l[4]||(l[4]=[m("通用流程")])),_:1}),e(k,{value:2},{default:t(()=>l[5]||(l[5]=[m("定制流程")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),f.value.flowMode===2?(b(),j(c,{key:0,span:12},{default:t(()=>[e(g,{label:"所属租户",name:"tenantId"},{default:t(()=>[e(_,{modelValue:f.value.tenantId,"onUpdate:modelValue":l[2]||(l[2]=u=>f.value.tenantId=u),multiple:"",options:L.value,keys:{value:"tenantId",label:"tenantName"},clearable:"",placeholder:"请选择所属租户"},null,8,["modelValue","options"])]),_:1})]),_:1})):se("",!0),e(c,{span:12},{default:t(()=>[e(g,{style:{float:"right"}},{default:t(()=>[e(i,{variant:"outline",onClick:U},{default:t(()=>l[6]||(l[6]=[m("关闭")])),_:1}),e(i,{theme:"primary",disabled:V.value,type:"submit"},{default:t(()=>l[7]||(l[7]=[m("部署")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled","onSubmit"])]),_:1},8,["visible"])}}}),ge=[{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"模型主键",colKey:"id"},{title:"模型标识",colKey:"modelKey"},{title:"模型名称",colKey:"name"},{title:"流程版本",colKey:"version"},{title:"创建时间",colKey:"created"},{title:"更新时间",colKey:"lastUpdated"},{fixed:"right",width:210,colKey:"op",title:"操作",align:"center"}],be={class:"table-wrapper"},ye=["onClick"],we=["onClick"],Ce=["onClick"],Ve=["onClick"],Fe=E({__name:"model",setup(H){const{tableVar:$}=oe(),{getTableHeaderAffixedTop:M,getLayoutContainer:B}=te(),v=r({...{modelKey:"",name:""}}),y=r(!1),{fetchData:x,data:N,pagination:p,dataLoading:f}=le(Z,v.value,fe);ie(()=>{x()});const w=D(()=>{x()},300),V=i=>{p.value={...p.value,current:i.current||1,pageSize:i.pageSize},w()},C=r(""),T=({row:i})=>{C.value=i.id,y.value=!0},q=D(async()=>{try{await ee(C.value),y.value=!1,G.success("删除成功"),w()}catch{y.value=!1}},300),U=ce(),d=D(({row:i})=>{window.open(`${U}/app/rest/models/${i.id}/bpmn20`)}),l=r(!1),_=r(""),g=D(()=>{_.value=`${U}/index.html`,l.value=!0},300),c=D(({row:i})=>{_.value=`${U}/index.html#/editor/${i.id}`,l.value=!0},300),k=r(!1),O=({row:i})=>{C.value=i.id,k.value=!0};return(i,o)=>{const S=a("t-input"),F=a("t-form-item"),u=a("t-col"),A=a("t-row"),z=a("t-button"),J=a("t-form"),Q=a("t-tag"),X=a("t-table"),P=a("t-dialog"),h=de("auth");return b(),I("div",{class:me(s($))},[e(J,{ref:"form",data:v.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:s(w),onSubmit:s(w)},{default:t(()=>[e(A,null,{default:t(()=>[e(u,{span:10},{default:t(()=>[e(A,{gutter:[16,24]},{default:t(()=>[e(u,{span:4},{default:t(()=>[e(F,{label:"模型标识",name:"modelKey"},{default:t(()=>[e(S,{modelValue:v.value.modelKey,"onUpdate:modelValue":o[0]||(o[0]=n=>v.value.modelKey=n),clearable:"",placeholder:"请输入模型标识"},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:4},{default:t(()=>[e(F,{label:"模型名称",name:"name"},{default:t(()=>[e(S,{modelValue:v.value.name,"onUpdate:modelValue":o[1]||(o[1]=n=>v.value.name=n),clearable:"",placeholder:"请输入模型名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{span:2,class:"operation-wrapper"},{default:t(()=>[e(z,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>o[5]||(o[5]=[m(" 查询 ")])),_:1}),e(z,{type:"reset",variant:"base",theme:"default"},{default:t(()=>o[6]||(o[6]=[m(" 重置 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),ue("div",be,[e(X,{data:s(N),columns:s(ge),hover:!0,loading:s(f),pagination:s(p),"header-affixed-top":{offsetTop:s(M),container:s(B)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:V},{"top-content":t(()=>[e(A,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(u,{flex:"0 0 auto"},{default:t(()=>[K((b(),j(z,{onClick:s(g)},{default:t(()=>o[7]||(o[7]=[m("创建")])),_:1},8,["onClick"])),[[h,"flow_model_create"]])]),_:1})]),_:1})]),op:t(n=>[K((b(),I("a",{class:"t-button-link",onClick:R=>s(c)(n)},o[8]||(o[8]=[m("配置")]),8,ye)),[[h,"flow_model_update"]]),K((b(),I("a",{class:"t-button-link",onClick:R=>O(n)},o[9]||(o[9]=[m("部署")]),8,we)),[[h,"flow_model_deploy"]]),K((b(),I("a",{class:"t-button-link",onClick:R=>s(d)(n)},o[10]||(o[10]=[m("下载")]),8,Ce)),[[h,"flow_model_download"]]),K((b(),I("a",{class:"t-button-link",onClick:R=>T(n)},o[11]||(o[11]=[m("删除")]),8,Ve)),[[h,"flow_model_delete"]])]),version:t(({row:n})=>[e(Q,{theme:"primary",variant:"light"},{default:t(()=>[m("v"+re(n.version),1)]),_:2},1024)]),_:1},8,["data","columns","loading","pagination","header-affixed-top"]),e(P,{visible:y.value,"onUpdate:visible":o[2]||(o[2]=n=>y.value=n),header:"确认删除当前所选数据？",onConfirm:s(q)},null,8,["visible","onConfirm"]),e(P,{visible:l.value,"onUpdate:visible":o[3]||(o[3]=n=>l.value=n),header:"流程配置",mode:"full-screen"},{default:t(()=>[e(ae,{"frame-src":_.value},null,8,["frame-src"])]),_:1},8,["visible"]),e(_e,{visible:k.value,"onUpdate:visible":o[4]||(o[4]=n=>k.value=n),"model-id":C.value},null,8,["visible","model-id"])])],2)}}});export{Fe as default};
