import{d as Q,r as s,aQ as ee,ax as J,e as o,f as b,g as j,w as t,m as P,l as e,j as u,p as r,M as z,_ as W,a as te,aG as oe,i as A,n as ae,J as E,t as le,q as ue,aH as ne}from"./index.8ed3877a.js";import{F as se}from"./index.2ae4f88e.js";import{u as ie}from"./useDesign.9d0ca2bc.js";import{u as de}from"./useSetting.01b849d1.js";import{u as re}from"./useRequset.50973ce5.js";import{g as ce}from"./tenant.aad034d6.js";import{h as me,i as fe,r as pe}from"./flow.efe49ab3.js";import{g as _e,a as ve}from"./flowHelper.b40b68ad.js";import{u as w}from"./index.74383c1c.js";const ge=Q({__name:"DialogDeploy",props:{visible:{type:Boolean,default:!1},modelId:{type:String,default:""}},emits:["update:visible","submit"],setup(R,{emit:k}){const x=R,S=s(!1),G=ee().getFlowDict,_=s([]);async function y(){const a=await ce();_.value=a,S.value=!0}const U={categoryValue:"",flowMode:1,tenantId:[]},$=s({categoryValue:[{required:!0,message:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u7C7B\u578B",type:"error",trigger:"change"}],flowMode:[{required:!0,message:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u6A21\u5F0F",type:"error",trigger:"change"}],tenantId:[{required:!0,message:"\u8BF7\u9009\u62E9\u6240\u5C5E\u79DF\u6237",type:"error",trigger:"change"}]}),m=s(!1),c=s({...U}),B=s(null),F=s(!1),D=w(({firstError:a})=>{if(a)z.warning(a);else{F.value=!0;const{categoryValue:i,flowMode:v,tenantId:f}=u(c),g={modelId:x.modelId,category:_e(i),tenantIds:v===2?f.join(","):""};me(g).then(()=>{k("submit",g),z.success("\u90E8\u7F72\u6210\u529F"),m.value=!1}).finally(()=>{F.value=!1})}},300),L=()=>{var a;(a=B.value)==null||a.reset()},N=()=>{m.value=!1};return J(()=>m.value,a=>{k("update:visible",a)}),J(()=>x.visible,a=>{S.value||y(),m.value=a}),(a,i)=>{const v=o("t-select"),f=o("t-form-item"),g=o("t-col"),I=o("t-radio"),C=o("t-radio-group"),K=o("t-button"),n=o("t-row"),d=o("t-form"),M=o("t-dialog");return b(),j(M,{visible:m.value,"onUpdate:visible":i[3]||(i[3]=p=>m.value=p),header:"\u6D41\u7A0B\u90E8\u7F72",width:580,footer:!1,onClosed:L},{body:t(()=>[P(" \u8868\u5355\u5185\u5BB9 "),e(d,{ref_key:"form",ref:B,data:c.value,rules:$.value,"label-width":100,disabled:F.value,onSubmit:u(D)},{default:t(()=>[e(n,{gutter:[0,28]},{default:t(()=>[e(g,{span:12},{default:t(()=>[e(f,{label:"\u6D41\u7A0B\u7C7B\u578B",name:"categoryValue"},{default:t(()=>[e(v,{modelValue:c.value.categoryValue,"onUpdate:modelValue":i[0]||(i[0]=p=>c.value.categoryValue=p),options:u(G),keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6D41\u7A0B\u7C7B\u578B"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(g,{span:12},{default:t(()=>[e(f,{label:"\u6D41\u7A0B\u6A21\u5F0F",name:"flowMode"},{default:t(()=>[e(C,{modelValue:c.value.flowMode,"onUpdate:modelValue":i[1]||(i[1]=p=>c.value.flowMode=p)},{default:t(()=>[e(I,{value:1},{default:t(()=>[r("\u901A\u7528\u6D41\u7A0B")]),_:1}),e(I,{value:2},{default:t(()=>[r("\u5B9A\u5236\u6D41\u7A0B")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),c.value.flowMode===2?(b(),j(g,{key:0,span:12},{default:t(()=>[e(f,{label:"\u6240\u5C5E\u79DF\u6237",name:"tenantId"},{default:t(()=>[e(v,{modelValue:c.value.tenantId,"onUpdate:modelValue":i[2]||(i[2]=p=>c.value.tenantId=p),multiple:"",options:_.value,keys:{value:"tenantId",label:"tenantName"},clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6240\u5C5E\u79DF\u6237"},null,8,["modelValue","options"])]),_:1})]),_:1})):P("v-if",!0),e(g,{span:12},{default:t(()=>[e(f,{style:{float:"right"}},{default:t(()=>[e(K,{variant:"outline",onClick:N},{default:t(()=>[r("\u5173\u95ED")]),_:1}),e(K,{theme:"primary",disabled:F.value,type:"submit"},{default:t(()=>[r("\u90E8\u7F72")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled","onSubmit"])]),_:1},8,["visible"])}}}),be=W(ge,[["__file","D:/Study/tdesign-console/src/viewsBusiness/flow/components/DialogDeploy.vue"]]),ye=[{colKey:"serial-number",title:"\u5E8F\u53F7",width:80,align:"center",fixed:"left"},{title:"\u6A21\u578B\u4E3B\u952E",colKey:"id"},{title:"\u6A21\u578B\u6807\u8BC6",colKey:"modelKey"},{title:"\u6A21\u578B\u540D\u79F0",colKey:"name"},{title:"\u6D41\u7A0B\u7248\u672C",colKey:"version"},{title:"\u521B\u5EFA\u65F6\u95F4",colKey:"created"},{title:"\u66F4\u65B0\u65F6\u95F4",colKey:"lastUpdated"},{fixed:"right",width:210,colKey:"op",title:"\u64CD\u4F5C",align:"center"}],Be={class:"table-wrapper"},Fe=["onClick"],De=["onClick"],we=["onClick"],Ce=["onClick"],he=Q({__name:"model",setup(R){const{tableVar:k}=ie(),{getTableHeaderAffixedTop:x,getLayoutContainer:S}=de(),_=s({...{modelKey:"",name:""}}),y=s(!1),{fetchData:U,data:$,pagination:m,dataLoading:c}=re(fe,_.value,ne);te(()=>{U()});const B=w(()=>{U()},300),F=n=>{m.value={...m.value,current:n.current||1,pageSize:n.pageSize},B()},D=s(""),L=({row:n})=>{D.value=n.id,y.value=!0},N=w(async()=>{try{await pe(D.value),y.value=!1,z.success("\u5220\u9664\u6210\u529F"),B()}catch{y.value=!1}},300),a=ve(),i=w(({row:n})=>{window.open(`${a}/app/rest/models/${n.id}/bpmn20`)}),v=s(!1),f=s(""),g=w(()=>{f.value=`${a}/index.html`,v.value=!0},300),I=w(({row:n})=>{f.value=`${a}/index.html#/editor/${n.id}`,v.value=!0},300),C=s(!1),K=({row:n})=>{D.value=n.id,C.value=!0};return(n,d)=>{const M=o("t-input"),p=o("t-form-item"),h=o("t-col"),T=o("t-row"),q=o("t-button"),X=o("t-form"),Y=o("t-tag"),Z=o("t-table"),H=o("t-dialog"),V=oe("auth");return b(),A("div",{class:ue(u(k))},[e(X,{ref:"form",data:_.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:u(B),onSubmit:u(B)},{default:t(()=>[e(T,null,{default:t(()=>[e(h,{span:10},{default:t(()=>[e(T,{gutter:[16,24]},{default:t(()=>[e(h,{span:4},{default:t(()=>[e(p,{label:"\u6A21\u578B\u6807\u8BC6",name:"modelKey"},{default:t(()=>[e(M,{modelValue:_.value.modelKey,"onUpdate:modelValue":d[0]||(d[0]=l=>_.value.modelKey=l),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6A21\u578B\u6807\u8BC6"},null,8,["modelValue"])]),_:1})]),_:1}),e(h,{span:4},{default:t(()=>[e(p,{label:"\u6A21\u578B\u540D\u79F0",name:"name"},{default:t(()=>[e(M,{modelValue:_.value.name,"onUpdate:modelValue":d[1]||(d[1]=l=>_.value.name=l),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6A21\u578B\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(h,{span:2,class:"operation-wrapper"},{default:t(()=>[e(q,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[r(" \u67E5\u8BE2 ")]),_:1}),e(q,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[r(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),ae("div",Be,[e(Z,{data:u($),columns:u(ye),hover:!0,loading:u(c),pagination:u(m),"header-affixed-top":{offsetTop:u(x),container:u(S)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:F},{"top-content":t(()=>[e(T,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(h,{flex:"0 0 auto"},{default:t(()=>[E((b(),j(q,{onClick:u(g)},{default:t(()=>[r("\u521B\u5EFA")]),_:1},8,["onClick"])),[[V,"flow_model_create"]])]),_:1})]),_:1})]),op:t(l=>[E((b(),A("a",{class:"t-button-link",onClick:O=>u(I)(l)},[r("\u914D\u7F6E")],8,Fe)),[[V,"flow_model_update"]]),E((b(),A("a",{class:"t-button-link",onClick:O=>K(l)},[r("\u90E8\u7F72")],8,De)),[[V,"flow_model_deploy"]]),E((b(),A("a",{class:"t-button-link",onClick:O=>u(i)(l)},[r("\u4E0B\u8F7D")],8,we)),[[V,"flow_model_download"]]),E((b(),A("a",{class:"t-button-link",onClick:O=>L(l)},[r("\u5220\u9664")],8,Ce)),[[V,"flow_model_delete"]])]),version:t(({row:l})=>[e(Y,{theme:"primary",variant:"light"},{default:t(()=>[r("v"+le(l.version),1)]),_:2},1024)]),_:1},8,["data","columns","loading","pagination","header-affixed-top"]),e(H,{visible:y.value,"onUpdate:visible":d[2]||(d[2]=l=>y.value=l),header:"\u786E\u8BA4\u5220\u9664\u5F53\u524D\u6240\u9009\u6570\u636E\uFF1F",onConfirm:u(N)},null,8,["visible","onConfirm"]),e(H,{visible:v.value,"onUpdate:visible":d[3]||(d[3]=l=>v.value=l),header:"\u6D41\u7A0B\u914D\u7F6E",mode:"full-screen"},{default:t(()=>[e(se,{"frame-src":f.value},null,8,["frame-src"])]),_:1},8,["visible"]),e(be,{visible:C.value,"onUpdate:visible":d[4]||(d[4]=l=>C.value=l),"model-id":D.value},null,8,["visible","model-id"])])],2)}}}),Me=W(he,[["__file","D:/Study/tdesign-console/src/views/flow/model.vue"]]);export{Me as default};
