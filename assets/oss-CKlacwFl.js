import{b as ge,g as ye,s as _e,c as Ve,e as ke,r as Ce}from"./oss-2LbzLkrS.js";import{d as ee,f as i,a2 as X,r as n,o as _,m as O,w as t,a as e,b,q as y,M as q,J as se,av as Ke,Q as Y,s as de,c as N,F as we,K as De,t as ie,p as Z,W as h,X as Ue,aw as Ie,ax as xe,i as Te,as as Se,e as Ne,au as he,ao as ne,ap as ue,ab as Oe}from"./index-CqGaQ7t4.js";import{u as qe}from"./useSetting-CnYQd1RY.js";import{u as Be}from"./useDesign-CbWcZHFZ.js";import{u as Re}from"./useRequset-Bj5fiv5N.js";import{u as A}from"./index-BidCcHov.js";const $e=ee({__name:"DialogDebug",props:{visible:{type:Boolean,default:!1},code:{type:String,default:""}},emits:["update:visible","submit"],setup(F,{emit:L}){const x={backgroundUrl:[],code:""},V=F,j=i({backgroundUrl:[{required:!0,message:"请选择图片",type:"error",trigger:"change"}]}),K=i(!1),p=i({...x}),g=i(null),r=i(!1),o=i(),w=L,D=A(({firstError:a})=>{a?q.warning(a):(r.value=!0,o.value.uploadFiles())},300),U=()=>{p.value={...x}},M=()=>{K.value=!1};X(()=>K.value,a=>{w("update:visible",a)}),X(()=>V.visible,a=>{p.value.code=V.code,K.value=a});const T=({file:a})=>{q.error(`文件 ${a.name} 上传失败`),r.value=!1},z=async a=>{try{const c=await ge({code:p.value.code,file:a.raw});return{status:"success",response:{...c,url:c.link}}}catch{return{status:"fail",error:"上传失败"}}},v=()=>{w("submit",{}),q.success("上传成功"),r.value=!1};return(a,c)=>{const I=n("t-input"),m=n("t-form-item"),d=n("t-col"),k=n("t-upload"),B=n("t-button"),H=n("t-row"),R=n("t-form"),J=n("t-dialog");return _(),O(J,{visible:K.value,"onUpdate:visible":c[2]||(c[2]=C=>K.value=C),header:"对象存储上传调试",width:780,footer:!1,onClosed:U},{body:t(()=>[e(R,{ref_key:"form",ref:g,data:p.value,rules:j.value,"label-width":100,disabled:r.value,onSubmit:b(D)},{default:t(()=>[e(H,{gutter:[0,28]},{default:t(()=>[e(d,{span:12},{default:t(()=>[e(m,{label:"资源编号",name:"code"},{default:t(()=>[e(I,{modelValue:p.value.code,"onUpdate:modelValue":c[0]||(c[0]=C=>p.value.code=C),placeholder:"请输入资源编号",clearable:"",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:t(()=>[e(m,{label:"上传图片",name:"backgroundUrl"},{default:t(()=>[e(k,{ref_key:"uploadRef",ref:o,modelValue:p.value.backgroundUrl,"onUpdate:modelValue":c[1]||(c[1]=C=>p.value.backgroundUrl=C),theme:"image",tips:"单张图片文件上传",accept:"image/*",locale:{triggerUploadText:{image:"请选择图片"}},"request-method":z,disabled:r.value,onFail:T,onSuccess:v},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(d,{span:12},{default:t(()=>[e(m,{style:{float:"right"}},{default:t(()=>[e(B,{variant:"outline",onClick:M},{default:t(()=>c[3]||(c[3]=[y("关闭")])),_:1}),e(B,{theme:"primary",disabled:r.value,type:"submit"},{default:t(()=>c[4]||(c[4]=[y("上传")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled","onSubmit"])]),_:1},8,["visible"])}}}),Ae=ee({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","submit"],setup(F,{emit:L}){const x={category:void 0,ossCode:"",endpoint:"",bucketName:"",accessKey:"",secretKey:"",appId:"",region:"",remark:""},V=F,j=i({category:[{required:!0,message:"请选择分类",type:"error",trigger:"change"}],ossCode:[{required:!0,message:"请输入资源编号",type:"error",trigger:"blur"}],endpoint:[{required:!0,message:"请输入资源地址",type:"error",trigger:"blur"}],bucketName:[{required:!0,message:"请输入空间名",type:"error",trigger:"blur"}],accessKey:[{required:!0,message:"请输入accessKey",type:"error",trigger:"blur"}],secretKey:[{required:!0,message:"请输入secretKey",type:"error",trigger:"blur"}]}),K=se(()=>({view:"查看",edit:"编辑",add:"新增"})[V.actionType]||""),p=se(()=>({view:!0,edit:!1})[V.actionType]||!1),g=Ke("categoryOptions")||[],r=i(!1),o=i({...x}),w=i(null),D=i(!1),U=L,M=({firstError:v})=>{if(v)q.warning(v);else{D.value=!0;const{category:a,appId:c,region:I}=b(o),m={appId:a===4?c:"",region:a===4?I:""},d={...o.value,...m,id:V.editId};_e(d).then(()=>{U("submit",d),q.success("提交成功"),r.value=!1}).finally(()=>{D.value=!1})}},T=()=>{o.value={...x},Y(()=>{U("update:editId",""),U("update:actionType","")})},z=()=>{r.value=!1};return X(()=>r.value,v=>{U("update:visible",v)}),X(()=>V.visible,v=>{v&&V.editId&&Y(()=>{ye(V.editId).then(a=>{o.value={...a}})}),Y(()=>{var a;(a=w.value)==null||a.clearValidate()}),r.value=v}),(v,a)=>{const c=n("t-radio"),I=n("t-radio-group"),m=n("t-form-item"),d=n("t-col"),k=n("t-input"),B=n("t-textarea"),H=n("t-button"),R=n("t-row"),J=n("t-form"),C=n("t-dialog");return _(),O(C,{visible:r.value,"onUpdate:visible":a[9]||(a[9]=s=>r.value=s),header:K.value,width:780,footer:!1,onClosed:T},{body:t(()=>[e(J,{ref_key:"form",ref:w,class:de({"xy-form__detail":F.actionType==="view"}),data:o.value,rules:j.value,"label-width":100,disabled:p.value||D.value,onSubmit:M},{default:t(()=>[e(R,{gutter:[0,28]},{default:t(()=>[e(d,{span:12},{default:t(()=>[e(m,{label:"分类",name:"category"},{default:t(()=>[e(I,{modelValue:o.value.category,"onUpdate:modelValue":a[0]||(a[0]=s=>o.value.category=s),name:"category"},{default:t(()=>[(_(!0),N(we,null,De(b(g),s=>(_(),O(c,{key:s.dictKey,value:s.dictKey},{default:t(()=>[y(ie(s.dictValue),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:t(()=>[e(m,{label:"资源编号",name:"ossCode"},{default:t(()=>[e(k,{modelValue:o.value.ossCode,"onUpdate:modelValue":a[1]||(a[1]=s=>o.value.ossCode=s),placeholder:"请输入资源编号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:t(()=>[e(m,{label:"资源地址",name:"endpoint"},{default:t(()=>[e(k,{modelValue:o.value.endpoint,"onUpdate:modelValue":a[2]||(a[2]=s=>o.value.endpoint=s),placeholder:"请输入资源地址",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:t(()=>[e(m,{label:"空间名",name:"bucketName"},{default:t(()=>[e(k,{modelValue:o.value.bucketName,"onUpdate:modelValue":a[3]||(a[3]=s=>o.value.bucketName=s),placeholder:"请输入空间名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:t(()=>[e(m,{label:"accessKey",name:"accessKey"},{default:t(()=>[e(k,{modelValue:o.value.accessKey,"onUpdate:modelValue":a[4]||(a[4]=s=>o.value.accessKey=s),placeholder:"请输入accessKey",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:t(()=>[e(m,{label:"secretKey",name:"secretKey"},{default:t(()=>[e(k,{modelValue:o.value.secretKey,"onUpdate:modelValue":a[5]||(a[5]=s=>o.value.secretKey=s),placeholder:"请输入secretKey",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),o.value.category===4?(_(),O(d,{key:0,span:12},{default:t(()=>[e(m,{label:"appId",name:"appId"},{default:t(()=>[e(k,{modelValue:o.value.appId,"onUpdate:modelValue":a[6]||(a[6]=s=>o.value.appId=s),placeholder:"请输入appId",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})):Z("",!0),o.value.category===4?(_(),O(d,{key:1,span:12},{default:t(()=>[e(m,{label:"region",name:"region"},{default:t(()=>[e(k,{modelValue:o.value.region,"onUpdate:modelValue":a[7]||(a[7]=s=>o.value.region=s),placeholder:"请输入region",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})):Z("",!0),e(d,{span:12},{default:t(()=>[e(m,{label:"备注",name:"remark"},{default:t(()=>[e(B,{modelValue:o.value.remark,"onUpdate:modelValue":a[8]||(a[8]=s=>o.value.remark=s),placeholder:"请输入备注",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),h(e(d,{span:12},{default:t(()=>[e(m,{style:{float:"right"}},{default:t(()=>[e(H,{variant:"outline",onClick:z},{default:t(()=>a[10]||(a[10]=[y("取消")])),_:1}),e(H,{theme:"primary",type:"submit"},{default:t(()=>a[11]||(a[11]=[y("确定")])),_:1})]),_:1})]),_:1},512),[[Ue,!p.value]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),Fe=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"分类",colKey:"category"},{title:"资源编号",colKey:"ossCode"},{title:"资源地址",colKey:"endpoint"},{title:"空间名",colKey:"bucketName"},{title:"accessKey",colKey:"accessKey"},{title:"secretKey",colKey:"secretKey"},{title:"是否启用",colKey:"statusName"},{fixed:"right",width:280,colKey:"op",title:"操作",align:"center"}],Le={class:"table-wrapper"},je=["onClick"],Me=["onClick"],ze=["onClick"],He=["onClick"],Je=["onClick"],Ye=ee({__name:"oss",setup(F){const{tableVar:L}=Be(),{getTableHeaderAffixedTop:x,getLayoutContainer:V}=qe(),{hasRole:j}=Ie(),K={category:"",ossCode:"",accessKey:"",status:void 0},p=i([]),g=i({...K}),r=i(!1),o=i(!1),w=i(""),D=i(""),{fetchData:U,data:M,pagination:T,dataLoading:z}=Re(Ve,g.value,()=>{p.value=[]}),v=i([]),a=i([]);xe("categoryOptions",v);async function c(){const f=await ne("oss"),l=await ne("yes_no");v.value=ue(f),a.value=ue(l)}Te(()=>{c(),U()});const I=({row:f},l)=>{w.value=f.id,D.value=l,o.value=!0},m=({row:f})=>{C.value=f.id,s.value="one",r.value=!0},d=A(()=>{U()},300),k=f=>{p.value=f},B=f=>{T.value={...T.value,current:f.current||1,pageSize:f.pageSize},d()},R=A(async f=>{try{await Ce(f),r.value=!1,q.success("删除成功"),te(),d()}catch{r.value=!1}},300),J=()=>{p.value.length&&(s.value="check",r.value=!0)},C=i(-1),s=i(),te=()=>{C.value=-1,s.value=""},re=()=>{s.value==="check"&&R(p.value),s.value==="one"&&R([`${C.value}`])},ce=()=>{te()},E=i(!1),ae=i(""),me=A(({row:f})=>{ae.value=f.ossCode,E.value=!0},300),pe=A(({row:f})=>{const l=Oe.confirm({header:"提示",theme:"info",body:"是否确定启用这条配置?",onConfirm:A(()=>{ke(f.id).then(()=>{q.success("启用成功"),l.destroy(),d()})},300)})},300);return(f,l)=>{const le=n("t-select"),P=n("t-form-item"),S=n("t-col"),oe=n("t-input"),G=n("t-row"),Q=n("t-button"),ve=n("t-form"),fe=n("t-table"),be=n("t-dialog"),$=Se("auth");return _(),N("div",{class:de(b(L))},[e(ve,{ref:"form",data:g.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:b(d),onSubmit:b(d)},{default:t(()=>[e(G,null,{default:t(()=>[e(S,{span:10},{default:t(()=>[e(G,{gutter:[16,24]},{default:t(()=>[e(S,{span:4},{default:t(()=>[e(P,{label:"分类",name:"category"},{default:t(()=>[e(le,{modelValue:g.value.category,"onUpdate:modelValue":l[0]||(l[0]=u=>g.value.category=u),options:v.value,keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择分类"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(S,{span:4},{default:t(()=>[e(P,{label:"资源编号",name:"ossCode"},{default:t(()=>[e(oe,{modelValue:g.value.ossCode,"onUpdate:modelValue":l[1]||(l[1]=u=>g.value.ossCode=u),clearable:"",placeholder:"请输入资源编号"},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{span:4},{default:t(()=>[e(P,{label:"accessKey",name:"accessKey"},{default:t(()=>[e(oe,{modelValue:g.value.accessKey,"onUpdate:modelValue":l[2]||(l[2]=u=>g.value.accessKey=u),clearable:"",placeholder:"请输入accessKey"},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{span:4},{default:t(()=>[e(P,{label:"是否启用",name:"status"},{default:t(()=>[e(le,{modelValue:g.value.status,"onUpdate:modelValue":l[3]||(l[3]=u=>g.value.status=u),options:a.value,keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择是否启用"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{span:2,class:"operation-wrapper"},{default:t(()=>[e(Q,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>l[10]||(l[10]=[y(" 查询 ")])),_:1}),e(Q,{type:"reset",variant:"base",theme:"default"},{default:t(()=>l[11]||(l[11]=[y(" 重置 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),Ne("div",Le,[e(fe,{data:b(M),columns:b(Fe),hover:!0,loading:b(z),pagination:b(T),"selected-row-keys":p.value,"header-affixed-top":{offsetTop:b(x),container:b(V)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:B,onSelectChange:k},{"top-content":t(()=>[e(G,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(S,{flex:"0 0 auto"},{default:t(()=>[h((_(),O(Q,{onClick:l[4]||(l[4]=u=>I({row:{}},"add"))},{default:t(()=>l[12]||(l[12]=[y("新增")])),_:1})),[[$,"oss_add"]]),h((_(),O(Q,{theme:"danger",onClick:J},{default:t(()=>l[13]||(l[13]=[y("删除")])),_:1})),[[$,"oss_delete"]])]),_:1})]),_:1})]),category:t(({row:u})=>[y(ie(b(he)(v.value,u.category)),1)]),op:t(u=>[h((_(),N("a",{class:"t-button-link",onClick:W=>I(u,"view")},l[14]||(l[14]=[y("查看")]),8,je)),[[$,"oss_view"]]),h((_(),N("a",{class:"t-button-link",onClick:W=>I(u,"edit")},l[15]||(l[15]=[y("编辑")]),8,Me)),[[$,"oss_edit"]]),h((_(),N("a",{class:"t-button-link",onClick:W=>m(u)},l[16]||(l[16]=[y("删除")]),8,ze)),[[$,"oss_delete"]]),b(j)(["administrator","admin"])?(_(),N("a",{key:0,class:"t-button-link",onClick:W=>b(me)(u)},"调试",8,He)):Z("",!0),h((_(),N("a",{class:"t-button-link",onClick:W=>b(pe)(u)},l[17]||(l[17]=[y("启用")]),8,Je)),[[$,"oss_enable"]])]),_:1},8,["data","columns","loading","pagination","selected-row-keys","header-affixed-top"]),e(be,{visible:r.value,"onUpdate:visible":l[5]||(l[5]=u=>r.value=u),header:"确认删除当前所选数据？","on-cancel":ce,onConfirm:re},null,8,["visible"]),e(Ae,{visible:o.value,"onUpdate:visible":l[6]||(l[6]=u=>o.value=u),editId:w.value,"onUpdate:editId":l[7]||(l[7]=u=>w.value=u),actionType:D.value,"onUpdate:actionType":l[8]||(l[8]=u=>D.value=u),onSubmit:b(d)},null,8,["visible","editId","actionType","onSubmit"]),e($e,{visible:E.value,"onUpdate:visible":l[9]||(l[9]=u=>E.value=u),code:ae.value},null,8,["visible","code"])])],2)}}});export{Ye as default};
