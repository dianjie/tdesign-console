import{d as ee,r as d,C as se,aJ as ge,ax as W,av as Z,e as s,f as F,g as x,w as t,m as H,l as e,q as ie,j as c,i as U,F as ye,H as Fe,p as y,t as re,J as I,K as De,M as S,_ as te,aK as Ce,aL as Ve,a as ke,aG as Be,n as Ee,aI as we,aC as ne,aD as de,V as Ke}from"./index.8ed3877a.js";import{u as he}from"./useDesign.9d0ca2bc.js";import{u as Ae}from"./useSetting.01b849d1.js";import{u as Ue}from"./useRequset.50973ce5.js";import{g as Ie,s as xe,b as Se,c as Te,e as Ne,r as Oe}from"./oss.5c12abb8.js";import{u as $}from"./index.74383c1c.js";const qe=ee({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","submit"],setup(L,{emit:C}){const D=L,w={category:void 0,ossCode:"",endpoint:"",bucketName:"",accessKey:"",secretKey:"",appId:"",region:"",remark:""},j=d({category:[{required:!0,message:"\u8BF7\u9009\u62E9\u5206\u7C7B",type:"error",trigger:"change"}],ossCode:[{required:!0,message:"\u8BF7\u8F93\u5165\u8D44\u6E90\u7F16\u53F7",type:"error",trigger:"blur"}],endpoint:[{required:!0,message:"\u8BF7\u8F93\u5165\u8D44\u6E90\u5730\u5740",type:"error",trigger:"blur"}],bucketName:[{required:!0,message:"\u8BF7\u8F93\u5165\u7A7A\u95F4\u540D",type:"error",trigger:"blur"}],accessKey:[{required:!0,message:"\u8BF7\u8F93\u5165accessKey",type:"error",trigger:"blur"}],secretKey:[{required:!0,message:"\u8BF7\u8F93\u5165secretKey",type:"error",trigger:"blur"}]}),V=se(()=>({view:"\u67E5\u770B",edit:"\u7F16\u8F91",add:"\u65B0\u589E"})[D.actionType]||""),p=se(()=>({view:!0,edit:!1})[D.actionType]||!1),b=ge("categoryOptions")||[],i=d(!1),u=d({...w}),E=d(null),k=d(!1),T=({firstError:g})=>{if(g)S.warning(g);else{k.value=!0;const{category:a,appId:v,region:h}=c(u),r={appId:a===4?v:"",region:a===4?h:""},m={...u.value,...r,id:D.editId};xe(m).then(()=>{C("submit",m),S.success("\u63D0\u4EA4\u6210\u529F"),i.value=!1}).finally(()=>{k.value=!1})}},M=()=>{u.value={...w},Z(()=>{C("update:editId",""),C("update:actionType","")})},K=()=>{i.value=!1};return W(()=>i.value,g=>{C("update:visible",g)}),W(()=>D.visible,g=>{g&&D.editId&&Z(()=>{Ie(D.editId).then(a=>{u.value={...a}})}),Z(()=>{var a;(a=E.value)==null||a.clearValidate()}),i.value=g}),(g,a)=>{const v=s("t-radio"),h=s("t-radio-group"),r=s("t-form-item"),m=s("t-col"),_=s("t-input"),N=s("t-textarea"),O=s("t-button"),J=s("t-row"),q=s("t-form"),B=s("t-dialog");return F(),x(B,{visible:i.value,"onUpdate:visible":a[9]||(a[9]=l=>i.value=l),header:c(V),width:780,footer:!1,onClosed:M},{body:t(()=>[H(" \u8868\u5355\u5185\u5BB9 "),e(q,{ref_key:"form",ref:E,class:ie({"xy-form__detail":L.actionType==="view"}),data:u.value,rules:j.value,"label-width":100,disabled:c(p)||k.value,onSubmit:T},{default:t(()=>[e(J,{gutter:[0,28]},{default:t(()=>[e(m,{span:12},{default:t(()=>[e(r,{label:"\u5206\u7C7B",name:"category"},{default:t(()=>[e(h,{modelValue:u.value.category,"onUpdate:modelValue":a[0]||(a[0]=l=>u.value.category=l),name:"category"},{default:t(()=>[(F(!0),U(ye,null,Fe(c(b),l=>(F(),x(v,{key:l.dictKey,value:l.dictKey},{default:t(()=>[y(re(l.dictValue),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:t(()=>[e(r,{label:"\u8D44\u6E90\u7F16\u53F7",name:"ossCode"},{default:t(()=>[e(_,{modelValue:u.value.ossCode,"onUpdate:modelValue":a[1]||(a[1]=l=>u.value.ossCode=l),placeholder:"\u8BF7\u8F93\u5165\u8D44\u6E90\u7F16\u53F7",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:t(()=>[e(r,{label:"\u8D44\u6E90\u5730\u5740",name:"endpoint"},{default:t(()=>[e(_,{modelValue:u.value.endpoint,"onUpdate:modelValue":a[2]||(a[2]=l=>u.value.endpoint=l),placeholder:"\u8BF7\u8F93\u5165\u8D44\u6E90\u5730\u5740",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:t(()=>[e(r,{label:"\u7A7A\u95F4\u540D",name:"bucketName"},{default:t(()=>[e(_,{modelValue:u.value.bucketName,"onUpdate:modelValue":a[3]||(a[3]=l=>u.value.bucketName=l),placeholder:"\u8BF7\u8F93\u5165\u7A7A\u95F4\u540D",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:t(()=>[e(r,{label:"accessKey",name:"accessKey"},{default:t(()=>[e(_,{modelValue:u.value.accessKey,"onUpdate:modelValue":a[4]||(a[4]=l=>u.value.accessKey=l),placeholder:"\u8BF7\u8F93\u5165accessKey",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:t(()=>[e(r,{label:"secretKey",name:"secretKey"},{default:t(()=>[e(_,{modelValue:u.value.secretKey,"onUpdate:modelValue":a[5]||(a[5]=l=>u.value.secretKey=l),placeholder:"\u8BF7\u8F93\u5165secretKey",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),u.value.category===4?(F(),x(m,{key:0,span:12},{default:t(()=>[e(r,{label:"appId",name:"appId"},{default:t(()=>[e(_,{modelValue:u.value.appId,"onUpdate:modelValue":a[6]||(a[6]=l=>u.value.appId=l),placeholder:"\u8BF7\u8F93\u5165appId",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})):H("v-if",!0),u.value.category===4?(F(),x(m,{key:1,span:12},{default:t(()=>[e(r,{label:"region",name:"region"},{default:t(()=>[e(_,{modelValue:u.value.region,"onUpdate:modelValue":a[7]||(a[7]=l=>u.value.region=l),placeholder:"\u8BF7\u8F93\u5165region",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})):H("v-if",!0),e(m,{span:12},{default:t(()=>[e(r,{label:"\u5907\u6CE8",name:"remark"},{default:t(()=>[e(N,{modelValue:u.value.remark,"onUpdate:modelValue":a[8]||(a[8]=l=>u.value.remark=l),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),I(e(m,{span:12},{default:t(()=>[e(r,{style:{float:"right"}},{default:t(()=>[e(O,{variant:"outline",onClick:K},{default:t(()=>[y("\u53D6\u6D88")]),_:1}),e(O,{theme:"primary",type:"submit"},{default:t(()=>[y("\u786E\u5B9A")]),_:1})]),_:1})]),_:1},512),[[De,!c(p)]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),Re=te(qe,[["__file","D:/Study/tdesign-console/src/viewsBusiness/resource/components/oss/DialogForm.vue"]]),$e=ee({__name:"DialogDebug",props:{visible:{type:Boolean,default:!1},code:{type:String,default:""}},emits:["update:visible","submit"],setup(L,{emit:C}){const D=L,w={backgroundUrl:[],code:""},j=d({backgroundUrl:[{required:!0,message:"\u8BF7\u9009\u62E9\u56FE\u7247",type:"error",trigger:"change"}]}),V=d(!1),p=d({...w}),b=d(null),i=d(!1),u=d(),E=$(({firstError:a})=>{a?S.warning(a):(i.value=!0,u.value.uploadFiles())},300),k=()=>{p.value={...w}},T=()=>{V.value=!1};W(()=>V.value,a=>{C("update:visible",a)}),W(()=>D.visible,a=>{p.value.code=D.code,V.value=a});const M=({file:a})=>{S.error(`\u6587\u4EF6 ${a.name} \u4E0A\u4F20\u5931\u8D25`),i.value=!1},K=async a=>{try{const v=await Se({code:p.value.code,file:a.raw});return{status:"success",response:{...v,url:v.link}}}catch{return{status:"fail",error:"\u4E0A\u4F20\u5931\u8D25"}}},g=()=>{C("submit",{}),S.success("\u4E0A\u4F20\u6210\u529F"),i.value=!1};return(a,v)=>{const h=s("t-input"),r=s("t-form-item"),m=s("t-col"),_=s("t-upload"),N=s("t-button"),O=s("t-row"),J=s("t-form"),q=s("t-dialog");return F(),x(q,{visible:V.value,"onUpdate:visible":v[2]||(v[2]=B=>V.value=B),header:"\u5BF9\u8C61\u5B58\u50A8\u4E0A\u4F20\u8C03\u8BD5",width:780,footer:!1,onClosed:k},{body:t(()=>[H(" \u8868\u5355\u5185\u5BB9 "),e(J,{ref_key:"form",ref:b,data:p.value,rules:j.value,"label-width":100,disabled:i.value,onSubmit:c(E)},{default:t(()=>[e(O,{gutter:[0,28]},{default:t(()=>[e(m,{span:12},{default:t(()=>[e(r,{label:"\u8D44\u6E90\u7F16\u53F7",name:"code"},{default:t(()=>[e(h,{modelValue:p.value.code,"onUpdate:modelValue":v[0]||(v[0]=B=>p.value.code=B),placeholder:"\u8BF7\u8F93\u5165\u8D44\u6E90\u7F16\u53F7",clearable:"",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:t(()=>[e(r,{label:"\u4E0A\u4F20\u56FE\u7247",name:"backgroundUrl"},{default:t(()=>[e(_,{ref_key:"uploadRef",ref:u,modelValue:p.value.backgroundUrl,"onUpdate:modelValue":v[1]||(v[1]=B=>p.value.backgroundUrl=B),theme:"image",tips:"\u5355\u5F20\u56FE\u7247\u6587\u4EF6\u4E0A\u4F20",accept:"image/*",locale:{triggerUploadText:{image:"\u8BF7\u9009\u62E9\u56FE\u7247"}},"request-method":K,disabled:i.value,onFail:M,onSuccess:g},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(m,{span:12},{default:t(()=>[e(r,{style:{float:"right"}},{default:t(()=>[e(N,{variant:"outline",onClick:T},{default:t(()=>[y("\u5173\u95ED")]),_:1}),e(N,{theme:"primary",disabled:i.value,type:"submit"},{default:t(()=>[y("\u4E0A\u4F20")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled","onSubmit"])]),_:1},8,["visible"])}}}),Le=te($e,[["__file","D:/Study/tdesign-console/src/viewsBusiness/resource/components/oss/DialogDebug.vue"]]),je=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"\u5E8F\u53F7",width:80,align:"center",fixed:"left"},{title:"\u5206\u7C7B",colKey:"category"},{title:"\u8D44\u6E90\u7F16\u53F7",colKey:"ossCode"},{title:"\u8D44\u6E90\u5730\u5740",colKey:"endpoint"},{title:"\u7A7A\u95F4\u540D",colKey:"bucketName"},{title:"accessKey",colKey:"accessKey"},{title:"secretKey",colKey:"secretKey"},{title:"\u662F\u5426\u542F\u7528",colKey:"statusName"},{fixed:"right",width:280,colKey:"op",title:"\u64CD\u4F5C",align:"center"}],Me={class:"table-wrapper"},ze=["onClick"],He=["onClick"],Je=["onClick"],Ge=["onClick"],Pe=["onClick"],Qe=ee({__name:"oss",setup(L){const{tableVar:C}=he(),{getTableHeaderAffixedTop:D,getLayoutContainer:w}=Ae(),{hasRole:j}=Ce(),V={category:"",ossCode:"",accessKey:"",status:void 0},p=d([]),b=d({...V}),i=d(!1),u=d(!1),E=d(""),k=d(""),{fetchData:T,data:M,pagination:K,dataLoading:g}=Ue(Te,b.value,()=>{p.value=[]}),a=d([]),v=d([]);Ve("categoryOptions",a);async function h(){const f=await ne("oss"),o=await ne("yes_no");a.value=de(f),v.value=de(o)}ke(()=>{h(),T()});const r=({row:f},o)=>{E.value=f.id,k.value=o,u.value=!0},m=({row:f})=>{l.value=f.id,z.value="one",i.value=!0},_=$(()=>{T()},300),N=f=>{p.value=f},O=f=>{K.value={...K.value,current:f.current||1,pageSize:f.pageSize},_()},q=$(async f=>{try{await Oe(f),i.value=!1,S.success("\u5220\u9664\u6210\u529F"),ae(),_()}catch{i.value=!1}},300),B=()=>{!p.value.length||(z.value="check",i.value=!0)},l=d(-1),z=d(),ae=()=>{l.value=-1,z.value=""},ce=()=>{z.value==="check"&&q(p.value),z.value==="one"&&q([`${l.value}`])},me=()=>{ae()},X=d(!1),ue=d(""),pe=$(({row:f})=>{ue.value=f.ossCode,X.value=!0},300),ve=$(({row:f})=>{const o=Ke.confirm({header:"\u63D0\u793A",theme:"info",body:"\u662F\u5426\u786E\u5B9A\u542F\u7528\u8FD9\u6761\u914D\u7F6E?",onConfirm:$(()=>{Ne(f.id).then(()=>{S.success("\u542F\u7528\u6210\u529F"),o.destroy(),_()})},300)})},300);return(f,o)=>{const le=s("t-select"),G=s("t-form-item"),A=s("t-col"),oe=s("t-input"),Y=s("t-row"),P=s("t-button"),fe=s("t-form"),_e=s("t-table"),be=s("t-dialog"),R=Be("auth");return F(),U("div",{class:ie(c(C))},[e(fe,{ref:"form",data:b.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:c(_),onSubmit:c(_)},{default:t(()=>[e(Y,null,{default:t(()=>[e(A,{span:10},{default:t(()=>[e(Y,{gutter:[16,24]},{default:t(()=>[e(A,{span:4},{default:t(()=>[e(G,{label:"\u5206\u7C7B",name:"category"},{default:t(()=>[e(le,{modelValue:b.value.category,"onUpdate:modelValue":o[0]||(o[0]=n=>b.value.category=n),options:a.value,keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(A,{span:4},{default:t(()=>[e(G,{label:"\u8D44\u6E90\u7F16\u53F7",name:"ossCode"},{default:t(()=>[e(oe,{modelValue:b.value.ossCode,"onUpdate:modelValue":o[1]||(o[1]=n=>b.value.ossCode=n),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u8D44\u6E90\u7F16\u53F7"},null,8,["modelValue"])]),_:1})]),_:1}),e(A,{span:4},{default:t(()=>[e(G,{label:"accessKey",name:"accessKey"},{default:t(()=>[e(oe,{modelValue:b.value.accessKey,"onUpdate:modelValue":o[2]||(o[2]=n=>b.value.accessKey=n),clearable:"",placeholder:"\u8BF7\u8F93\u5165accessKey"},null,8,["modelValue"])]),_:1})]),_:1}),e(A,{span:4},{default:t(()=>[e(G,{label:"\u662F\u5426\u542F\u7528",name:"status"},{default:t(()=>[e(le,{modelValue:b.value.status,"onUpdate:modelValue":o[3]||(o[3]=n=>b.value.status=n),options:v.value,keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"\u8BF7\u9009\u62E9\u662F\u5426\u542F\u7528"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1}),e(A,{span:2,class:"operation-wrapper"},{default:t(()=>[e(P,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[y(" \u67E5\u8BE2 ")]),_:1}),e(P,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[y(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),Ee("div",Me,[e(_e,{data:c(M),columns:c(je),hover:!0,loading:c(g),pagination:c(K),"selected-row-keys":p.value,"header-affixed-top":{offsetTop:c(D),container:c(w)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:O,onSelectChange:N},{"top-content":t(()=>[e(Y,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(A,{flex:"0 0 auto"},{default:t(()=>[I((F(),x(P,{onClick:o[4]||(o[4]=n=>r({row:{}},"add"))},{default:t(()=>[y("\u65B0\u589E")]),_:1})),[[R,"oss_add"]]),I((F(),x(P,{theme:"danger",onClick:B},{default:t(()=>[y("\u5220\u9664")]),_:1})),[[R,"oss_delete"]])]),_:1})]),_:1})]),category:t(({row:n})=>[y(re(c(we)(a.value,n.category)),1)]),op:t(n=>[I((F(),U("a",{class:"t-button-link",onClick:Q=>r(n,"view")},[y("\u67E5\u770B")],8,ze)),[[R,"oss_view"]]),I((F(),U("a",{class:"t-button-link",onClick:Q=>r(n,"edit")},[y("\u7F16\u8F91")],8,He)),[[R,"oss_edit"]]),I((F(),U("a",{class:"t-button-link",onClick:Q=>m(n)},[y("\u5220\u9664")],8,Je)),[[R,"oss_delete"]]),c(j)(["administrator","admin"])?(F(),U("a",{key:0,class:"t-button-link",onClick:Q=>c(pe)(n)},"\u8C03\u8BD5",8,Ge)):H("v-if",!0),I((F(),U("a",{class:"t-button-link",onClick:Q=>c(ve)(n)},[y("\u542F\u7528")],8,Pe)),[[R,"oss_enable"]])]),_:1},8,["data","columns","loading","pagination","selected-row-keys","header-affixed-top"]),e(be,{visible:i.value,"onUpdate:visible":o[5]||(o[5]=n=>i.value=n),header:"\u786E\u8BA4\u5220\u9664\u5F53\u524D\u6240\u9009\u6570\u636E\uFF1F","on-cancel":me,onConfirm:ce},null,8,["visible"]),e(Re,{visible:u.value,"onUpdate:visible":o[6]||(o[6]=n=>u.value=n),editId:E.value,"onUpdate:editId":o[7]||(o[7]=n=>E.value=n),actionType:k.value,"onUpdate:actionType":o[8]||(o[8]=n=>k.value=n),onSubmit:c(_)},null,8,["visible","editId","actionType","onSubmit"]),e(Le,{visible:X.value,"onUpdate:visible":o[9]||(o[9]=n=>X.value=n),code:ue.value},null,8,["visible","code"])])],2)}}}),at=te(Qe,[["__file","D:/Study/tdesign-console/src/views/resource/oss.vue"]]);export{at as default};
