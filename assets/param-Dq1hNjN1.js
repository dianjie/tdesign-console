import{an as $,d as Y,f as i,J as X,a2 as E,Q as z,r as n,o as C,m as P,w as a,a as e,s as Z,W as N,q as v,X as ne,M as H,i as se,as as re,c as R,b as c,e as ue}from"./index-CqGaQ7t4.js";import{u as ie}from"./useSetting-CnYQd1RY.js";import{u as de}from"./useDesign-CbWcZHFZ.js";import{u as me}from"./useRequset-Bj5fiv5N.js";import{u as G}from"./index-BidCcHov.js";const pe=(d,I,k)=>$.get({url:"/blade-system/param/list",params:{...k,current:d,size:I}},{joinTime:!1}),ce=d=>$.get({url:"/blade-system/param/detail",params:{id:d}}),fe=d=>$.post({url:"/blade-system/param/remove",params:{ids:d}},{joinParamsToUrl:!0,errorMessageMode:"message"}),ve=d=>$.post({url:"/blade-system/param/submit",data:d}),be=Y({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","submit"],setup(d,{emit:I}){const k={paramName:"",paramKey:"",paramValue:""},b=d,q=i({paramName:[{required:!0,message:"请输入参数名称",type:"error",trigger:"blur"}],paramKey:[{required:!0,message:"请输入参数键名",type:"error",trigger:"blur"}],paramValue:[{required:!0,message:"请输入参数键值",type:"error",trigger:"blur"}]}),g=X(()=>`${{view:"查看",edit:"编辑",add:"新增"}[b.actionType]||""}参数`),f=X(()=>({view:!0,edit:!1})[b.actionType]||!1),u=i(!1),s=i({...k}),x=i(null),y=i(!1),V=I,A=({firstError:r})=>{if(r)H.warning(r);else{y.value=!0;const l={...s.value,id:b.editId};ve(l).then(()=>{V("submit",l),H.success("提交成功"),u.value=!1}).finally(()=>{y.value=!1})}},S=()=>{s.value={...k},z(()=>{V("update:editId",""),V("update:actionType","")})},L=()=>{u.value=!1};return E(()=>u.value,r=>{V("update:visible",r)}),E(()=>b.visible,r=>{r&&b.editId&&z(()=>{ce(b.editId).then(l=>{s.value={...l}})}),z(()=>{var l;(l=x.value)==null||l.clearValidate()}),u.value=r}),(r,l)=>{const _=n("t-input"),T=n("t-form-item"),D=n("t-col"),J=n("t-textarea"),h=n("t-button"),M=n("t-row"),K=n("t-form"),w=n("t-dialog");return C(),P(w,{visible:u.value,"onUpdate:visible":l[3]||(l[3]=p=>u.value=p),header:g.value,width:780,footer:!1,onClosed:S},{body:a(()=>[e(K,{ref_key:"form",ref:x,class:Z({"xy-form__detail":d.actionType==="view"}),data:s.value,rules:q.value,"label-width":100,disabled:f.value||y.value,onSubmit:A},{default:a(()=>[e(M,{gutter:[0,28]},{default:a(()=>[e(D,{span:12},{default:a(()=>[e(T,{label:"参数名称",name:"paramName"},{default:a(()=>[e(_,{modelValue:s.value.paramName,"onUpdate:modelValue":l[0]||(l[0]=p=>s.value.paramName=p),placeholder:"请输入参数名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(D,{span:12},{default:a(()=>[e(T,{label:"参数键名",name:"paramKey"},{default:a(()=>[e(_,{modelValue:s.value.paramKey,"onUpdate:modelValue":l[1]||(l[1]=p=>s.value.paramKey=p),placeholder:"请输入参数键名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(D,{span:12},{default:a(()=>[e(T,{label:"参数键值",name:"paramValue"},{default:a(()=>[e(J,{modelValue:s.value.paramValue,"onUpdate:modelValue":l[2]||(l[2]=p=>s.value.paramValue=p),placeholder:"请输入参数键值",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),N(e(D,{span:12},{default:a(()=>[e(T,{style:{float:"right"}},{default:a(()=>[e(h,{variant:"outline",onClick:L},{default:a(()=>l[4]||(l[4]=[v("取消")])),_:1}),e(h,{theme:"primary",type:"submit"},{default:a(()=>l[5]||(l[5]=[v("确定")])),_:1})]),_:1})]),_:1},512),[[ne,!f.value]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),_e=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"参数名称",colKey:"paramName"},{title:"参数键名",colKey:"paramKey"},{title:"参数键值",colKey:"paramValue"},{fixed:"right",width:180,colKey:"op",title:"操作",align:"center"}],ge={class:"table-wrapper"},ye=["onClick"],Ve=["onClick"],we=["onClick"],Ne=Y({__name:"param",setup(d){const{tableVar:I}=de(),{getTableHeaderAffixedTop:k,getLayoutContainer:b}=ie(),q={paramName:"",paramValue:""},g=i([]),f=i({...q}),u=i(!1),s=i(!1),x=i(""),y=i(""),{fetchData:V,data:A,pagination:S,dataLoading:L}=me(pe,f.value,()=>{g.value=[]});se(()=>{V()});const r=({row:m},t)=>{x.value=m.id,y.value=t,s.value=!0},l=({row:m})=>{K.value=m.id,w.value="one",u.value=!0},_=G(()=>{V()},300),T=m=>{g.value=m},D=m=>{S.value={...S.value,current:m.current||1,pageSize:m.pageSize},_()},h=G(async m=>{try{await fe(m),u.value=!1,H.success("删除成功"),p(),_()}catch{u.value=!1}},300),M=()=>{g.value.length&&(w.value="check",u.value=!0)},K=i(-1),w=i(),p=()=>{K.value=-1,w.value=""},ee=()=>{w.value==="check"&&h(g.value),w.value==="one"&&h([`${K.value}`])},te=()=>{p()};return(m,t)=>{const O=n("t-input"),Q=n("t-form-item"),U=n("t-col"),F=n("t-row"),B=n("t-button"),ae=n("t-form"),le=n("t-table"),oe=n("t-dialog"),j=re("auth");return C(),R("div",{class:Z(c(I))},[e(ae,{ref:"form",data:f.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:c(_),onSubmit:c(_)},{default:a(()=>[e(F,null,{default:a(()=>[e(U,{span:10},{default:a(()=>[e(F,{gutter:[16,24]},{default:a(()=>[e(U,{span:4},{default:a(()=>[e(Q,{label:"参数名称",name:"paramName"},{default:a(()=>[e(O,{modelValue:f.value.paramName,"onUpdate:modelValue":t[0]||(t[0]=o=>f.value.paramName=o),clearable:"",placeholder:"请输入参数名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(U,{span:4},{default:a(()=>[e(Q,{label:"参数键名",name:"paramValue"},{default:a(()=>[e(O,{modelValue:f.value.paramValue,"onUpdate:modelValue":t[1]||(t[1]=o=>f.value.paramValue=o),clearable:"",placeholder:"请输入参数键名"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(U,{span:2,class:"operation-wrapper"},{default:a(()=>[e(B,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:a(()=>t[7]||(t[7]=[v(" 查询 ")])),_:1}),e(B,{type:"reset",variant:"base",theme:"default"},{default:a(()=>t[8]||(t[8]=[v(" 重置 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),ue("div",ge,[e(le,{data:c(A),columns:c(_e),hover:!0,loading:c(L),pagination:c(S),"selected-row-keys":g.value,"header-affixed-top":{offsetTop:c(k),container:c(b)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:D,onSelectChange:T},{"top-content":a(()=>[e(F,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:a(()=>[e(U,{flex:"0 0 auto"},{default:a(()=>[N((C(),P(B,{onClick:t[2]||(t[2]=o=>r({row:{}},"add"))},{default:a(()=>t[9]||(t[9]=[v("新增")])),_:1})),[[j,"param_add"]]),N((C(),P(B,{theme:"danger",onClick:M},{default:a(()=>t[10]||(t[10]=[v("删除")])),_:1})),[[j,"param_delete"]])]),_:1})]),_:1})]),op:a(o=>[N((C(),R("a",{class:"t-button-link",onClick:W=>r(o,"view")},t[11]||(t[11]=[v("查看")]),8,ye)),[[j,"param_view"]]),N((C(),R("a",{class:"t-button-link",onClick:W=>r(o,"edit")},t[12]||(t[12]=[v("编辑")]),8,Ve)),[[j,"param_edit"]]),N((C(),R("a",{class:"t-button-link",onClick:W=>l(o)},t[13]||(t[13]=[v("删除")]),8,we)),[[j,"param_delete"]])]),_:1},8,["data","columns","loading","pagination","selected-row-keys","header-affixed-top"]),e(oe,{visible:u.value,"onUpdate:visible":t[3]||(t[3]=o=>u.value=o),header:"确认删除当前所选数据？","on-cancel":te,onConfirm:ee},null,8,["visible"]),e(be,{visible:s.value,"onUpdate:visible":t[4]||(t[4]=o=>s.value=o),editId:x.value,"onUpdate:editId":t[5]||(t[5]=o=>x.value=o),actionType:y.value,"onUpdate:actionType":t[6]||(t[6]=o=>y.value=o),onSubmit:c(_)},null,8,["visible","editId","actionType","onSubmit"])])],2)}}});export{Ne as default};
