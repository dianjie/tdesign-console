import{d as te,f as i,Q as X,az as re,a7 as Y,W as P,r as n,o as V,m as Q,w as t,a as e,s as ae,b as c,$ as x,q as f,a0 as de,M as W,aB as ce,ai as pe,i as me,aw as fe,c as L,e as ve,t as Z,aC as _e,ay as be,as as ge,at as ye}from"./index-vRs8n-Jv.js";import{g as Ce,s as we,a as Ve,r as he}from"./post-DrkbzWoi.js";import{g as ke}from"./tenant-CzFR4b2r.js";import{u as De}from"./useSetting-Bw9xnvhA.js";import{u as xe}from"./useDesign-CbWcZHFZ.js";import{u as Te}from"./useRequset-B1q_FhTb.js";import{u as ee}from"./index-4Wxy_Ir-.js";const Ie=te({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","submit"],setup(O,{emit:R}){const U={category:"",postCode:"",postName:"",sort:void 0,remark:""},b=O,j=i({category:[{required:!0,message:"请选择岗位类型",type:"error",trigger:"change"}],postCode:[{required:!0,message:"请输入岗位编号",type:"error",trigger:"blur"}],postName:[{required:!0,message:"请输入岗位名称",type:"error",trigger:"blur"}],sort:[{required:!0,message:"请输入岗位排序",type:"error",trigger:"blur"}]}),C=X(()=>`${{view:"查看",edit:"编辑",add:"新增"}[b.actionType]||""}岗位`),m=X(()=>({view:!0,edit:!1})[b.actionType]||!1),g=re("postCategoryOptions")||[],v=i(!1),s=i({...U}),h=i(null),k=i(!1),_=R,q=({firstError:u})=>{if(u)W.warning(u);else{k.value=!0;const a={...s.value,id:b.editId};we(a).then(()=>{_("submit",a),W.success("提交成功"),v.value=!1}).finally(()=>{k.value=!1})}},K=()=>{s.value={...U},P(()=>{_("update:editId",""),_("update:actionType","")})},A=()=>{v.value=!1};return Y(()=>v.value,u=>{_("update:visible",u)}),Y(()=>b.visible,u=>{u&&b.editId&&P(()=>{Ce(b.editId).then(a=>{s.value={...a}})}),P(()=>{var a;(a=h.value)==null||a.clearValidate()}),v.value=u}),(u,a)=>{const T=n("t-select"),y=n("t-form-item"),p=n("t-col"),B=n("t-input"),M=n("t-input-number"),E=n("t-textarea"),I=n("t-button"),z=n("t-row"),N=n("t-form"),w=n("t-dialog");return V(),Q(w,{visible:v.value,"onUpdate:visible":a[5]||(a[5]=r=>v.value=r),header:C.value,width:780,footer:!1,onClosed:K},{body:t(()=>[e(N,{ref_key:"form",ref:h,class:ae({"xy-form__detail":O.actionType==="view"}),data:s.value,rules:j.value,"label-width":100,disabled:m.value||k.value,onSubmit:q},{default:t(()=>[e(z,{gutter:[0,28]},{default:t(()=>[e(p,{span:6},{default:t(()=>[e(y,{label:"岗位类型",name:"category"},{default:t(()=>[e(T,{modelValue:s.value.category,"onUpdate:modelValue":a[0]||(a[0]=r=>s.value.category=r),options:c(g),keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择岗位类型"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(y,{label:"岗位编号",name:"postCode"},{default:t(()=>[e(B,{modelValue:s.value.postCode,"onUpdate:modelValue":a[1]||(a[1]=r=>s.value.postCode=r),placeholder:"请输入岗位编号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(y,{label:"岗位名称",name:"postName"},{default:t(()=>[e(B,{modelValue:s.value.postName,"onUpdate:modelValue":a[2]||(a[2]=r=>s.value.postName=r),placeholder:"请输入岗位名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(y,{label:"岗位排序",name:"sort"},{default:t(()=>[e(M,{modelValue:s.value.sort,"onUpdate:modelValue":a[3]||(a[3]=r=>s.value.sort=r),theme:"column",placeholder:"请输入岗位排序",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:t(()=>[e(y,{label:"岗位描述",name:"remark"},{default:t(()=>[e(E,{modelValue:s.value.remark,"onUpdate:modelValue":a[4]||(a[4]=r=>s.value.remark=r),placeholder:"请输入岗位描述",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),x(e(p,{span:12},{default:t(()=>[e(y,{style:{float:"right"}},{default:t(()=>[e(I,{variant:"outline",onClick:A},{default:t(()=>[f("取消")]),_:1}),e(I,{theme:"primary",type:"submit"},{default:t(()=>[f("确定")]),_:1})]),_:1})]),_:1},512),[[de,!m.value]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),Ne=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"所属租户",colKey:"tenantId"},{title:"岗位类型",colKey:"category"},{title:"岗位编号",colKey:"postCode"},{title:"岗位名称",colKey:"postName"},{title:"岗位排序",colKey:"sort"},{fixed:"right",width:180,colKey:"op",title:"操作",align:"center"}],Se={class:"table-wrapper"},Ue=["onClick"],Ke=["onClick"],Be=["onClick"],Me=te({__name:"post",setup(O){const{tableVar:R}=xe(),{getTableHeaderAffixedTop:U,getLayoutContainer:b}=De(),j={category:"",postCode:"",postName:""},C=i([]),m=i({...j}),g=i(!1),v=i(!1),s=i(""),h=i(""),k=i([]),_=i([]);async function q(){const d=await ke(),l=await ge("post_category");k.value=d,_.value=ye(l)}ce("postCategoryOptions",_),pe(()=>{q()});const{fetchData:K,data:A,pagination:u,dataLoading:a}=Te(Ve,m.value,()=>{C.value=[]});me(()=>{K()});const T=({row:d},l)=>{s.value=d.id,h.value=l,v.value=!0},y=({row:d})=>{N.value=d.id,w.value="one",g.value=!0},p=ee(()=>{K()},300),B=d=>{C.value=d},M=d=>{u.value={...u.value,current:d.current||1,pageSize:d.pageSize},p()},I=ee(async d=>{try{await he(d),g.value=!1,W.success("删除成功"),r(),p()}catch{g.value=!1}},300),z=()=>{C.value.length&&(w.value="check",g.value=!0)},N=i(-1),w=i(),r=()=>{N.value=-1,w.value=""},oe=()=>{w.value==="check"&&I(C.value),w.value==="one"&&I([`${N.value}`])},le=()=>{r()};return(d,l)=>{const ne=n("t-select"),F=n("t-form-item"),D=n("t-col"),G=n("t-input"),H=n("t-row"),$=n("t-button"),se=n("t-form"),ie=n("t-table"),ue=n("t-dialog"),S=fe("auth");return V(),L("div",{class:ae(c(R))},[e(se,{ref:"form",data:m.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:c(p),onSubmit:c(p)},{default:t(()=>[e(H,null,{default:t(()=>[e(D,{span:10},{default:t(()=>[e(H,{gutter:[16,24]},{default:t(()=>[e(D,{span:4},{default:t(()=>[e(F,{label:"岗位类型",name:"category"},{default:t(()=>[e(ne,{modelValue:m.value.category,"onUpdate:modelValue":l[0]||(l[0]=o=>m.value.category=o),options:_.value,keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择岗位类型"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(D,{span:4},{default:t(()=>[e(F,{label:"岗位编号",name:"postCode"},{default:t(()=>[e(G,{modelValue:m.value.postCode,"onUpdate:modelValue":l[1]||(l[1]=o=>m.value.postCode=o),clearable:"",placeholder:"请输入岗位编号"},null,8,["modelValue"])]),_:1})]),_:1}),e(D,{span:4},{default:t(()=>[e(F,{label:"岗位名称",name:"postName"},{default:t(()=>[e(G,{modelValue:m.value.postName,"onUpdate:modelValue":l[2]||(l[2]=o=>m.value.postName=o),clearable:"",placeholder:"请输入岗位名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(D,{span:2,class:"operation-wrapper"},{default:t(()=>[e($,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[f(" 查询 ")]),_:1}),e($,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[f(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),ve("div",Se,[e(ie,{data:c(A),columns:c(Ne),hover:!0,loading:c(a),pagination:c(u),"selected-row-keys":C.value,"header-affixed-top":{offsetTop:c(U),container:c(b)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:M,onSelectChange:B},{"top-content":t(()=>[e(H,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(D,{flex:"0 0 auto"},{default:t(()=>[x((V(),Q($,{onClick:l[3]||(l[3]=o=>T({row:{}},"add"))},{default:t(()=>[f("新增")]),_:1})),[[S,"post_add"]]),x((V(),Q($,{theme:"danger",onClick:z},{default:t(()=>[f("删除")]),_:1})),[[S,"post_delete"]])]),_:1})]),_:1})]),tenantId:t(({row:o})=>[f(Z(c(_e)(k.value,o.tenantId,{id:"tenantId",name:"tenantName"})),1)]),category:t(({row:o})=>[f(Z(c(be)(_.value,o.category)),1)]),op:t(o=>[x((V(),L("a",{class:"t-button-link",onClick:J=>T(o,"view")},[f("查看")],8,Ue)),[[S,"post_view"]]),x((V(),L("a",{class:"t-button-link",onClick:J=>T(o,"edit")},[f("编辑")],8,Ke)),[[S,"post_edit"]]),x((V(),L("a",{class:"t-button-link",onClick:J=>y(o)},[f("删除")],8,Be)),[[S,"post_delete"]])]),_:1},8,["data","columns","loading","pagination","selected-row-keys","header-affixed-top"]),e(ue,{visible:g.value,"onUpdate:visible":l[4]||(l[4]=o=>g.value=o),header:"确认删除当前所选数据？","on-cancel":le,onConfirm:oe},null,8,["visible"]),e(Ie,{visible:v.value,"onUpdate:visible":l[5]||(l[5]=o=>v.value=o),editId:s.value,"onUpdate:editId":l[6]||(l[6]=o=>s.value=o),actionType:h.value,"onUpdate:actionType":l[7]||(l[7]=o=>h.value=o),onSubmit:c(p)},null,8,["visible","editId","actionType","onSubmit"])])],2)}}});export{Me as default};
