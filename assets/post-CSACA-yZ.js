import{d as te,f as i,J as G,av as re,a2 as Y,Q as J,r as n,o as w,m as P,w as t,a as e,s as ae,b as p,W as T,q as f,X as de,M as Q,ax as pe,ad as me,i as ce,as as fe,c as O,e as ve,t as Z,ay as be,au as ge,ao as _e,ap as ye}from"./index-CqGaQ7t4.js";import{g as Ce,s as Ve,a as we,r as ke}from"./post-BzkjQPjB.js";import{g as xe}from"./tenant-BajJal67.js";import{u as De}from"./useSetting-CnYQd1RY.js";import{u as Te}from"./useDesign-CbWcZHFZ.js";import{u as Ie}from"./useRequset-Bj5fiv5N.js";import{u as ee}from"./index-BidCcHov.js";const Ne=te({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","submit"],setup(R,{emit:$}){const U={category:"",postCode:"",postName:"",sort:void 0,remark:""},g=R,j=i({category:[{required:!0,message:"请选择岗位类型",type:"error",trigger:"change"}],postCode:[{required:!0,message:"请输入岗位编号",type:"error",trigger:"blur"}],postName:[{required:!0,message:"请输入岗位名称",type:"error",trigger:"blur"}],sort:[{required:!0,message:"请输入岗位排序",type:"error",trigger:"blur"}]}),C=G(()=>`${{view:"查看",edit:"编辑",add:"新增"}[g.actionType]||""}岗位`),c=G(()=>({view:!0,edit:!1})[g.actionType]||!1),_=re("postCategoryOptions")||[],v=i(!1),s=i({...U}),k=i(null),x=i(!1),b=$,q=({firstError:u})=>{if(u)Q.warning(u);else{x.value=!0;const o={...s.value,id:g.editId};Ve(o).then(()=>{b("submit",o),Q.success("提交成功"),v.value=!1}).finally(()=>{x.value=!1})}},K=()=>{s.value={...U},J(()=>{b("update:editId",""),b("update:actionType","")})},A=()=>{v.value=!1};return Y(()=>v.value,u=>{b("update:visible",u)}),Y(()=>g.visible,u=>{u&&g.editId&&J(()=>{Ce(g.editId).then(o=>{s.value={...o}})}),J(()=>{var o;(o=k.value)==null||o.clearValidate()}),v.value=u}),(u,o)=>{const I=n("t-select"),y=n("t-form-item"),m=n("t-col"),B=n("t-input"),M=n("t-input-number"),W=n("t-textarea"),N=n("t-button"),F=n("t-row"),S=n("t-form"),V=n("t-dialog");return w(),P(V,{visible:v.value,"onUpdate:visible":o[5]||(o[5]=r=>v.value=r),header:C.value,width:780,footer:!1,onClosed:K},{body:t(()=>[e(S,{ref_key:"form",ref:k,class:ae({"xy-form__detail":R.actionType==="view"}),data:s.value,rules:j.value,"label-width":100,disabled:c.value||x.value,onSubmit:q},{default:t(()=>[e(F,{gutter:[0,28]},{default:t(()=>[e(m,{span:6},{default:t(()=>[e(y,{label:"岗位类型",name:"category"},{default:t(()=>[e(I,{modelValue:s.value.category,"onUpdate:modelValue":o[0]||(o[0]=r=>s.value.category=r),options:p(_),keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择岗位类型"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(y,{label:"岗位编号",name:"postCode"},{default:t(()=>[e(B,{modelValue:s.value.postCode,"onUpdate:modelValue":o[1]||(o[1]=r=>s.value.postCode=r),placeholder:"请输入岗位编号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(y,{label:"岗位名称",name:"postName"},{default:t(()=>[e(B,{modelValue:s.value.postName,"onUpdate:modelValue":o[2]||(o[2]=r=>s.value.postName=r),placeholder:"请输入岗位名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(y,{label:"岗位排序",name:"sort"},{default:t(()=>[e(M,{modelValue:s.value.sort,"onUpdate:modelValue":o[3]||(o[3]=r=>s.value.sort=r),theme:"column",placeholder:"请输入岗位排序",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:t(()=>[e(y,{label:"岗位描述",name:"remark"},{default:t(()=>[e(W,{modelValue:s.value.remark,"onUpdate:modelValue":o[4]||(o[4]=r=>s.value.remark=r),placeholder:"请输入岗位描述",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),T(e(m,{span:12},{default:t(()=>[e(y,{style:{float:"right"}},{default:t(()=>[e(N,{variant:"outline",onClick:A},{default:t(()=>o[6]||(o[6]=[f("取消")])),_:1}),e(N,{theme:"primary",type:"submit"},{default:t(()=>o[7]||(o[7]=[f("确定")])),_:1})]),_:1})]),_:1},512),[[de,!c.value]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),Se=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"所属租户",colKey:"tenantId"},{title:"岗位类型",colKey:"category"},{title:"岗位编号",colKey:"postCode"},{title:"岗位名称",colKey:"postName"},{title:"岗位排序",colKey:"sort"},{fixed:"right",width:180,colKey:"op",title:"操作",align:"center"}],he={class:"table-wrapper"},Ue=["onClick"],Ke=["onClick"],Be=["onClick"],Me=te({__name:"post",setup(R){const{tableVar:$}=Te(),{getTableHeaderAffixedTop:U,getLayoutContainer:g}=De(),j={category:"",postCode:"",postName:""},C=i([]),c=i({...j}),_=i(!1),v=i(!1),s=i(""),k=i(""),x=i([]),b=i([]);async function q(){const d=await xe(),a=await _e("post_category");x.value=d,b.value=ye(a)}pe("postCategoryOptions",b),me(()=>{q()});const{fetchData:K,data:A,pagination:u,dataLoading:o}=Ie(we,c.value,()=>{C.value=[]});ce(()=>{K()});const I=({row:d},a)=>{s.value=d.id,k.value=a,v.value=!0},y=({row:d})=>{S.value=d.id,V.value="one",_.value=!0},m=ee(()=>{K()},300),B=d=>{C.value=d},M=d=>{u.value={...u.value,current:d.current||1,pageSize:d.pageSize},m()},N=ee(async d=>{try{await ke(d),_.value=!1,Q.success("删除成功"),r(),m()}catch{_.value=!1}},300),F=()=>{C.value.length&&(V.value="check",_.value=!0)},S=i(-1),V=i(),r=()=>{S.value=-1,V.value=""},oe=()=>{V.value==="check"&&N(C.value),V.value==="one"&&N([`${S.value}`])},le=()=>{r()};return(d,a)=>{const ne=n("t-select"),z=n("t-form-item"),D=n("t-col"),X=n("t-input"),H=n("t-row"),L=n("t-button"),se=n("t-form"),ie=n("t-table"),ue=n("t-dialog"),h=fe("auth");return w(),O("div",{class:ae(p($))},[e(se,{ref:"form",data:c.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:p(m),onSubmit:p(m)},{default:t(()=>[e(H,null,{default:t(()=>[e(D,{span:10},{default:t(()=>[e(H,{gutter:[16,24]},{default:t(()=>[e(D,{span:4},{default:t(()=>[e(z,{label:"岗位类型",name:"category"},{default:t(()=>[e(ne,{modelValue:c.value.category,"onUpdate:modelValue":a[0]||(a[0]=l=>c.value.category=l),options:b.value,keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择岗位类型"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(D,{span:4},{default:t(()=>[e(z,{label:"岗位编号",name:"postCode"},{default:t(()=>[e(X,{modelValue:c.value.postCode,"onUpdate:modelValue":a[1]||(a[1]=l=>c.value.postCode=l),clearable:"",placeholder:"请输入岗位编号"},null,8,["modelValue"])]),_:1})]),_:1}),e(D,{span:4},{default:t(()=>[e(z,{label:"岗位名称",name:"postName"},{default:t(()=>[e(X,{modelValue:c.value.postName,"onUpdate:modelValue":a[2]||(a[2]=l=>c.value.postName=l),clearable:"",placeholder:"请输入岗位名称"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(D,{span:2,class:"operation-wrapper"},{default:t(()=>[e(L,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>a[8]||(a[8]=[f(" 查询 ")])),_:1}),e(L,{type:"reset",variant:"base",theme:"default"},{default:t(()=>a[9]||(a[9]=[f(" 重置 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),ve("div",he,[e(ie,{data:p(A),columns:p(Se),hover:!0,loading:p(o),pagination:p(u),"selected-row-keys":C.value,"header-affixed-top":{offsetTop:p(U),container:p(g)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:M,onSelectChange:B},{"top-content":t(()=>[e(H,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(D,{flex:"0 0 auto"},{default:t(()=>[T((w(),P(L,{onClick:a[3]||(a[3]=l=>I({row:{}},"add"))},{default:t(()=>a[10]||(a[10]=[f("新增")])),_:1})),[[h,"post_add"]]),T((w(),P(L,{theme:"danger",onClick:F},{default:t(()=>a[11]||(a[11]=[f("删除")])),_:1})),[[h,"post_delete"]])]),_:1})]),_:1})]),tenantId:t(({row:l})=>[f(Z(p(be)(x.value,l.tenantId,{id:"tenantId",name:"tenantName"})),1)]),category:t(({row:l})=>[f(Z(p(ge)(b.value,l.category)),1)]),op:t(l=>[T((w(),O("a",{class:"t-button-link",onClick:E=>I(l,"view")},a[12]||(a[12]=[f("查看")]),8,Ue)),[[h,"post_view"]]),T((w(),O("a",{class:"t-button-link",onClick:E=>I(l,"edit")},a[13]||(a[13]=[f("编辑")]),8,Ke)),[[h,"post_edit"]]),T((w(),O("a",{class:"t-button-link",onClick:E=>y(l)},a[14]||(a[14]=[f("删除")]),8,Be)),[[h,"post_delete"]])]),_:1},8,["data","columns","loading","pagination","selected-row-keys","header-affixed-top"]),e(ue,{visible:_.value,"onUpdate:visible":a[4]||(a[4]=l=>_.value=l),header:"确认删除当前所选数据？","on-cancel":le,onConfirm:oe},null,8,["visible"]),e(Ne,{visible:v.value,"onUpdate:visible":a[5]||(a[5]=l=>v.value=l),editId:s.value,"onUpdate:editId":a[6]||(a[6]=l=>s.value=l),actionType:k.value,"onUpdate:actionType":a[7]||(a[7]=l=>k.value=l),onSubmit:p(m)},null,8,["visible","editId","actionType","onSubmit"])])],2)}}});export{Me as default};
