import{d as W,J as S,a8 as pe,a9 as me,aa as ce,an as L,f as v,a2 as ae,Q as je,r as p,o as P,m as F,w as a,a as t,b as d,q as x,M as D,ad as Ie,as as Ue,c as oe,az as ze,e as ne,W as K,aA as Fe,aB as Le,F as qe,K as Ae,t as Be,s as Me,ao as Ne,ap as $e,ab as re,_ as Re}from"./index-CqGaQ7t4.js";import{u as Ke}from"./useSetting-CnYQd1RY.js";import{u as Ee}from"./useDesign-CbWcZHFZ.js";import{C as ve,d as fe}from"./download-BmLFIQ0n.js";import{u as w}from"./index-BidCcHov.js";function se(l,s){var r=Object.keys(l);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(l);s&&(u=u.filter(function(V){return Object.getOwnPropertyDescriptor(l,V).enumerable})),r.push.apply(r,u)}return r}function ue(l){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?se(Object(r),!0).forEach(function(u){ce(l,u,r[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(r)):se(Object(r)).forEach(function(u){Object.defineProperty(l,u,Object.getOwnPropertyDescriptor(r,u))})}return l}var He={tag:"svg",attrs:{fill:"none",viewBox:"0 0 24 24",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M4.6 6.28a7.5 7.5 0 0114.8 0 6.5 6.5 0 011.06 12.01l-.9.46-.9-1.78.88-.46a4.5 4.5 0 00-1.23-8.44l-.77-.14-.05-.78a5.5 5.5 0 00-10.98 0l-.05.78-.77.14a4.5 4.5 0 00-1.23 8.44l.89.46-.91 1.78-.9-.46a6.5 6.5 0 011.06-12zm7.4 3.3L17.41 15 16 16.41l-3-3V23h-2v-9.59l-3 3L6.59 15 12 9.59z"}}]},Je=W({name:"CloudUploadIcon",props:{size:{type:String},onClick:{type:Function}},setup(l,s){var{attrs:r}=s,u=S(()=>l.size),{className:V,style:g}=pe(u),b=S(()=>["t-icon","t-icon-cloud-upload",V.value]),O=S(()=>ue(ue({},g.value),r.style)),y=S(()=>({class:b.value,style:O.value,onClick:k=>{var C;return(C=l.onClick)===null||C===void 0?void 0:C.call(l,{e:k})}}));return()=>me(He,y.value)}});const Qe=Je;function ie(l,s){var r=Object.keys(l);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(l);s&&(u=u.filter(function(V){return Object.getOwnPropertyDescriptor(l,V).enumerable})),r.push.apply(r,u)}return r}function de(l){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?arguments[s]:{};s%2?ie(Object(r),!0).forEach(function(u){ce(l,u,r[u])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(r)):ie(Object(r)).forEach(function(u){Object.defineProperty(l,u,Object.getOwnPropertyDescriptor(r,u))})}return l}var We={tag:"svg",attrs:{fill:"none",viewBox:"0 0 24 24",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M18.25 12L8.5 17.63V6.37L18.25 12z"}}]},Ge=W({name:"PlayIcon",props:{size:{type:String},onClick:{type:Function}},setup(l,s){var{attrs:r}=s,u=S(()=>l.size),{className:V,style:g}=pe(u),b=S(()=>["t-icon","t-icon-play",V.value]),O=S(()=>de(de({},g.value),r.style)),y=S(()=>({class:b.value,style:O.value,onClick:k=>{var C;return(C=l.onClick)===null||C===void 0?void 0:C.call(l,{e:k})}}));return()=>me(We,y.value)}});const Xe=Ge,Q=(l,s)=>L.get({url:"/blade-system/region/lazy-tree",params:{...s,parentCode:l}},{joinTime:!1}),Ye=l=>L.get({url:"/blade-system/region/detail",params:{code:l}}),Ze=l=>L.post({url:"/blade-system/region/remove",params:{id:l}},{joinParamsToUrl:!0,errorMessageMode:"message"}),et=l=>L.post({url:"/blade-system/region/submit",data:l},{errorMessageMode:"message"}),tt=(l,s)=>L.uploadFile({url:"/blade-system/region/import-region",params:{isCovered:l},timeout:60*1e3},s),at=()=>L.get({url:"/blade-system/region/export-template",responseType:"blob"},{isTransformResponse:!1}),lt=()=>L.get({url:"/blade-system/region/export-region",responseType:"blob",timeout:60*1e3},{joinTime:!1,isTransformResponse:!1,errorMessageMode:"message"}),ot=W({__name:"DialogImport",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","submit"],setup(l,{emit:s}){const r={excelFile:[],isCovered:0},u=l,V=v({excelFile:[{required:!0,message:"请选择模板",type:"error",trigger:"change"}],isCovered:[{required:!0,message:"请选择数据覆盖",type:"error",trigger:"change"}]}),g=v(!1),b=v({...r}),O=v(null),y=v(!1),k=v(),C=s,o=w(({firstError:_})=>{_?D.warning(_):(y.value=!0,k.value.uploadFiles())},300),j=()=>{b.value={...r}},B=()=>{g.value=!1};ae(()=>g.value,_=>{C("update:visible",_)}),ae(()=>u.visible,_=>{je(()=>{var f;(f=O.value)==null||f.clearValidate()}),g.value=_});const G=({file:_})=>{D.error(`文件 ${_.name} 导入失败`),y.value=!1},q=async _=>{try{const{isCovered:f}=d(b);return{status:"success",response:{...await tt(f,{file:_.raw}),url:"success"}}}catch{return{status:"fail",error:"导入失败"}}},X=()=>{C("submit",{}),D.success("导入成功"),g.value=!1,y.value=!1},E=w(()=>{at().then(_=>{fe(_,"行政区划模板.xlsx")})},300);return(_,f)=>{const H=p("t-upload"),I=p("t-form-item"),A=p("t-col"),Y=p("t-switch"),M=p("t-button"),N=p("t-row"),Z=p("t-form"),$=p("t-dialog");return P(),F($,{visible:g.value,"onUpdate:visible":f[2]||(f[2]=U=>g.value=U),header:"行政区划数据导入",width:780,footer:!1,onClosed:j},{body:a(()=>[t(Z,{ref_key:"form",ref:O,data:b.value,rules:V.value,"label-width":100,disabled:y.value,onSubmit:d(o)},{default:a(()=>[t(N,{gutter:[0,28]},{default:a(()=>[t(A,{span:12},{default:a(()=>[t(I,{label:"模板上传",name:"excelFile"},{default:a(()=>[t(H,{ref_key:"uploadRef",ref:k,modelValue:b.value.excelFile,"onUpdate:modelValue":f[0]||(f[0]=U=>b.value.excelFile=U),"auto-upload":!1,accept:".xlsx, .xls, .csv","request-method":q,disabled:y.value,onFail:G,onSuccess:X},null,8,["modelValue","disabled"])]),_:1})]),_:1}),t(A,{span:12},{default:a(()=>[t(I,{label:"数据覆盖",name:"isCovered"},{default:a(()=>[t(Y,{modelValue:b.value.isCovered,"onUpdate:modelValue":f[1]||(f[1]=U=>b.value.isCovered=U),"custom-value":[1,0]},null,8,["modelValue"])]),_:1})]),_:1}),t(A,{span:12},{default:a(()=>[t(I,{label:"下载模板",name:"exportTemplate"},{default:a(()=>[t(M,{theme:"primary",onClick:d(E)},{icon:a(()=>[t(d(ve))]),default:a(()=>[f[3]||(f[3]=x(" 下载模板 "))]),_:1},8,["onClick"])]),_:1})]),_:1}),t(A,{span:12},{default:a(()=>[t(I,{style:{float:"right"}},{default:a(()=>[t(M,{variant:"outline",onClick:B},{default:a(()=>f[4]||(f[4]=[x("取消")])),_:1}),t(M,{theme:"primary",disabled:y.value,type:"submit"},{default:a(()=>f[5]||(f[5]=[x("确定")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled","onSubmit"])]),_:1},8,["visible"])}}}),nt={class:"x-button-group"},rt={class:"form-content"},st=W({__name:"region",setup(l){const{tableVar:s}=Ee(),{getTableHeaderAffixedTop:r,getLayoutContainer:u}=Ke(),V=v("00"),g=v(""),b=v("[]"),O=v([]),y=v(""),k=v(null),C={parentCode:"",parentName:"",code:"",subCode:"",name:"",regionLevel:void 0,sort:void 0,remark:""},o=v({...C}),j=v(null),B=v(!1),G=v({parentCode:[{required:!0,message:"请输入父区划编号",type:"error",trigger:"blur"}],parentName:[{required:!0,message:"请输入父区划名称",type:"error",trigger:"blur"}],code:[{required:!0,message:"请输入区划编号",type:"error",trigger:"blur"}],subCode:[{required:!0,message:"请输入区划子编号",type:"error",trigger:"blur"}],name:[{required:!0,message:"请输入区划名称",type:"error",trigger:"blur"}],regionLevel:[{required:!0,message:"请选择区划等级",type:"error",trigger:"change"}],sort:[{required:!0,message:"请输入区划排序",type:"error",trigger:"blur"}]}),q=()=>{Q(V.value).then(i=>{O.value=i.map(e=>({...e,children:e.hasChildren}))})},X=i=>new Promise(e=>{const m=i.data.id;Q(m).then(h=>{e(h.map(c=>({...c,children:c.hasChildren})))})}),E=v([]);async function _(){const i=await Ne("region");E.value=$e(i)}const f=w(()=>{k.value=i=>i.label.indexOf(y.value)>=0},350);Ie(()=>{q(),_()});const H=w((i,{node:e})=>{var m;if(!i.length){g.value="",b.value="",o.value={...C},(m=j.value)==null||m.clearValidate();return}g.value=e.data.id,b.value=e.data.parentId,Ye(g.value).then(h=>{var c;(c=j.value)==null||c.clearValidate(),o.value={...h,subCode:h.code.replace(h.parentCode,"")}})},300),I=w(i=>{const{parentCode:e}=d(o);o.value.code=e+i},300);ae(()=>o.value.subCode,I);const A=w(({firstError:i})=>{if(i)D.warning(i);else{B.value=!0;const{parentCode:e}=d(o),m={...o.value},h=e===V.value?"":e;m.code=h+m.subCode,et(m).then(()=>{var c;D.success("提交成功"),q(),(c=j.value)==null||c.reset()}).finally(()=>{B.value=!1})}},300),Y=w(()=>{const{code:i,name:e,regionLevel:m}=d(o);if(!i||!e){D.warning("请先选择一项区划");return}o.value={...C,parentCode:i,parentName:e,regionLevel:m===5?5:m+1}},300),M=w(()=>{const{code:i,name:e}=d(o);if(!i||!e){D.warning("请先选择一项区划");return}const m=re.confirm({header:"删除区划",theme:"warning",body:`确定将 [${e}] 数据删除?`,onConfirm:w(()=>Ze(g.value).then(()=>{var h;D.success("操作成功!"),m.destroy(),q(),(h=j.value)==null||h.reset()}),300)})},300),N=v([]),Z=()=>{N.value=[],g.value="",b.value=""},$=v(!1),U=w(()=>{$.value=!0},300),ge=w(()=>{const i=re.confirm({header:"提示",theme:"info",body:"是否导出行政区划数据?",onConfirm:w(()=>{lt().then(e=>{fe(e,`行政区划数据${+new Date}.xlsx`),D.success("操作成功!"),i.destroy()})},300)})},300),ee=v(!1),te=v([]),J=v(""),be=()=>{Q(V.value).then(i=>{te.value=i.map(e=>({...e,children:e.hasChildren}))})},_e=i=>new Promise(e=>{const m=i.data.id;Q(m).then(h=>{e(h.map(c=>({...c,children:c.hasChildren})))})}),ye=w(()=>{ee.value=!0,be()},300),Ce=()=>{J.value="",te.value=[]},he=()=>{D.success(`选中值为${J.value}`)};return(i,e)=>{const m=p("t-input"),h=p("t-tree"),c=p("t-col"),z=p("t-button"),T=p("t-form-item"),Ve=p("t-input-group"),we=p("t-radio"),xe=p("t-radio-group"),De=p("t-input-number"),Oe=p("t-textarea"),le=p("t-row"),ke=p("t-form"),Pe=p("t-affix"),Te=p("t-tree-select"),Se=p("t-dialog"),R=Ue("auth");return P(),oe("div",{class:Me(d(s))},[t(le,{gutter:[16,24]},{default:a(()=>[t(c,{span:4},{default:a(()=>[t(m,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=n=>y.value=n),placeholder:"请输入关键词",clearable:"",onChange:d(f)},{"suffix-icon":a(()=>[t(d(ze),{size:"20px"})]),_:1},8,["modelValue","onChange"]),t(h,{actived:N.value,"onUpdate:actived":e[1]||(e[1]=n=>N.value=n),style:{"margin-top":"14px"},data:O.value,hover:"",activable:!0,keys:{value:"value",label:"title"},lazy:!0,filter:k.value,load:X,onActive:d(H)},null,8,["actived","data","filter","onActive"])]),_:1}),t(c,{span:8},{default:a(()=>[t(Pe,{ref:"affix","offset-top":d(r),container:d(u)},{default:a(()=>[ne("div",nt,[K((P(),F(z,{theme:"primary",onClick:d(Y)},{icon:a(()=>[t(d(Fe))]),default:a(()=>[e[13]||(e[13]=x(" 新建下级 "))]),_:1},8,["onClick"])),[[R,"region_add"]]),K((P(),F(z,{theme:"primary",onClick:d(M)},{icon:a(()=>[t(d(Le))]),default:a(()=>[e[14]||(e[14]=x(" 删除 "))]),_:1},8,["onClick"])),[[R,"region_delete"]]),K((P(),F(z,{theme:"primary",onClick:d(U)},{icon:a(()=>[t(d(Qe))]),default:a(()=>[e[15]||(e[15]=x(" 导入 "))]),_:1},8,["onClick"])),[[R,"region_import"]]),K((P(),F(z,{theme:"primary",onClick:d(ge)},{icon:a(()=>[t(d(ve))]),default:a(()=>[e[16]||(e[16]=x(" 导出 "))]),_:1},8,["onClick"])),[[R,"region_export"]]),K((P(),F(z,{theme:"primary",onClick:d(ye)},{icon:a(()=>[t(d(Xe))]),default:a(()=>[e[17]||(e[17]=x(" 调试 "))]),_:1},8,["onClick"])),[[R,"region_debug"]])]),ne("div",rt,[t(ke,{ref_key:"form",ref:j,data:o.value,rules:G.value,"label-width":100,disabled:B.value,onReset:Z,onSubmit:d(A)},{default:a(()=>[t(le,{gutter:[0,28]},{default:a(()=>[t(c,{span:12},{default:a(()=>[t(T,{label:"父区划编号",name:"parentCode"},{default:a(()=>[t(m,{modelValue:o.value.parentCode,"onUpdate:modelValue":e[2]||(e[2]=n=>o.value.parentCode=n),disabled:!0,placeholder:"请输入父区划编号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{span:12},{default:a(()=>[t(T,{label:"父区划名称",name:"parentName"},{default:a(()=>[t(m,{modelValue:o.value.parentName,"onUpdate:modelValue":e[3]||(e[3]=n=>o.value.parentName=n),disabled:!0,placeholder:"请输入父区划名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{span:12},{default:a(()=>[t(T,{label:"区划编号",name:"subCode"},{default:a(()=>[t(Ve,{style:{width:"100%"}},{default:a(()=>[t(m,{modelValue:o.value.parentCode,"onUpdate:modelValue":e[4]||(e[4]=n=>o.value.parentCode=n),disabled:!0,style:{width:"80px"},placeholder:""},null,8,["modelValue"]),t(m,{modelValue:o.value.subCode,"onUpdate:modelValue":e[5]||(e[5]=n=>o.value.subCode=n),placeholder:"请输入子区划编号",onChange:d(I)},null,8,["modelValue","onChange"])]),_:1})]),_:1})]),_:1}),t(c,{span:12},{default:a(()=>[t(T,{label:"区划名称",name:"name"},{default:a(()=>[t(m,{modelValue:o.value.name,"onUpdate:modelValue":e[6]||(e[6]=n=>o.value.name=n),placeholder:"请输入区划名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{span:12},{default:a(()=>[t(T,{label:"区划等级",name:"regionLevel"},{default:a(()=>[t(xe,{modelValue:o.value.regionLevel,"onUpdate:modelValue":e[7]||(e[7]=n=>o.value.regionLevel=n),name:"regionLevel"},{default:a(()=>[(P(!0),oe(qe,null,Ae(E.value,n=>(P(),F(we,{key:n.dictKey,value:n.dictKey},{default:a(()=>[x(Be(n.dictValue),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(c,{span:12},{default:a(()=>[t(T,{label:"区划排序",name:"sort"},{default:a(()=>[t(De,{modelValue:o.value.sort,"onUpdate:modelValue":e[8]||(e[8]=n=>o.value.sort=n),theme:"column",placeholder:"请输入区划排序",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{span:12},{default:a(()=>[t(T,{label:"区划备注",name:"remark"},{default:a(()=>[t(Oe,{modelValue:o.value.remark,"onUpdate:modelValue":e[9]||(e[9]=n=>o.value.remark=n),placeholder:"请输入区划备注",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{span:12},{default:a(()=>[t(T,null,{default:a(()=>[t(z,{theme:"primary",type:"submit"},{default:a(()=>e[18]||(e[18]=[x("提交")])),_:1}),t(z,{type:"reset",variant:"base",theme:"default"},{default:a(()=>e[19]||(e[19]=[x("清空")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled","onSubmit"])])]),_:1},8,["offset-top","container"])]),_:1})]),_:1}),t(ot,{visible:$.value,"onUpdate:visible":e[10]||(e[10]=n=>$.value=n),onSubmit:q},null,8,["visible"]),t(Se,{visible:ee.value,"onUpdate:visible":e[12]||(e[12]=n=>ee.value=n),header:"行政区划数据调试","on-cancel":Ce,onConfirm:he},{default:a(()=>[t(Te,{modelValue:J.value,"onUpdate:modelValue":e[11]||(e[11]=n=>J.value=n),data:te.value,clearable:"",placeholder:"请选择","tree-props":{keys:{value:"value",label:"title"},lazy:!0,valueMode:"all",load:_e}},null,8,["modelValue","data","tree-props"])]),_:1},8,["visible"])],2)}}}),ct=Re(st,[["__scopeId","data-v-9d98b00d"]]);export{ct as default};
