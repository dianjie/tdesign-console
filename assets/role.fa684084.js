import{d as fe,r as u,C as me,aJ as xe,ax as ve,av as oe,e as i,f as y,g as z,w as t,m as _e,l as e,q as be,j as r,J as E,p as v,K as Be,M as I,_ as ge,aK as Ae,aE as Te,aL as Se,a as Ne,aG as Ue,i as J,n as Le,t as Ke,aM as Re}from"./index.8ed3877a.js";import{u as Oe}from"./useDesign.9d0ca2bc.js";import{u as je}from"./useSetting.01b849d1.js";import{u as $e}from"./useRequset.50973ce5.js";import{g as Me,a as qe,s as Ge,b as Je,c as ze,d as He,e as Pe,r as Qe}from"./role.19e76a26.js";import{u as U}from"./index.74383c1c.js";import{g as We}from"./tenant.aad034d6.js";const Xe=fe({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""},rowData:{type:Object,default:()=>({})}},emits:["update:visible","update:editId","update:actionType","submit"],setup(H,{emit:h}){const _=H,L={roleName:"",roleAlias:"",tenantId:"",parentId:"",sort:void 0},P=u({roleName:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",type:"error",trigger:"blur"}],roleAlias:[{required:!0,message:"\u8BF7\u8F93\u5165\u89D2\u8272\u522B\u540D",type:"error",trigger:"blur"}],tenantId:[{required:!0,message:"\u8BF7\u9009\u62E9\u6240\u5C5E\u79DF\u6237",type:"error",trigger:"change"}]}),Q=me(()=>`${{view:"\u67E5\u770B",edit:"\u7F16\u8F91",add:"\u65B0\u589E"}[_.actionType]||""}\u89D2\u8272`),K=me(()=>({view:!0,edit:!1})[_.actionType]||!1),R=xe("tenantOptions")||[],b=u([]);async function m(d){const{tenantId:n}=r(_.rowData),g=await qe(d||n);b.value=g}const c=u(!1),s=u({...L}),V=u(null),F=u(!1),k=({firstError:d})=>{if(d)I.warning(d);else{F.value=!0;const n={...s.value,id:_.editId};Ge(n).then(()=>{h("submit",n),I.success("\u63D0\u4EA4\u6210\u529F"),c.value=!1}).finally(()=>{F.value=!1})}},x=()=>{s.value={...L},oe(()=>{h("update:editId",""),h("update:actionType","")})},W=()=>{c.value=!1};ve(()=>c.value,d=>{h("update:visible",d)}),ve(()=>_.visible,d=>{d&&m(),d&&_.editId&&oe(()=>{Me(_.editId).then(n=>{s.value={...n}})}),oe(()=>{var n;(n=V.value)==null||n.clearValidate()}),c.value=d});const X=U(d=>{m(d),s.value.parentId="0"},500);return(d,n)=>{const g=i("t-input"),D=i("t-form-item"),f=i("t-col"),Y=i("t-select"),se=i("t-tree-select"),O=i("t-input-number"),j=i("t-button"),B=i("t-row"),C=i("t-form"),$=i("t-dialog");return y(),z($,{visible:c.value,"onUpdate:visible":n[5]||(n[5]=p=>c.value=p),header:r(Q),width:780,footer:!1,onClosed:x},{body:t(()=>[_e(" \u8868\u5355\u5185\u5BB9 "),e(C,{ref_key:"form",ref:V,class:be({"xy-form__detail":H.actionType==="view"}),data:s.value,rules:P.value,"label-width":100,disabled:r(K)||F.value,onSubmit:k},{default:t(()=>[e(B,{gutter:[0,28]},{default:t(()=>[e(f,{span:12},{default:t(()=>[e(D,{label:"\u89D2\u8272\u540D\u79F0",name:"roleName"},{default:t(()=>[e(g,{modelValue:s.value.roleName,"onUpdate:modelValue":n[0]||(n[0]=p=>s.value.roleName=p),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(D,{label:"\u89D2\u8272\u522B\u540D",name:"roleAlias"},{default:t(()=>[e(g,{modelValue:s.value.roleAlias,"onUpdate:modelValue":n[1]||(n[1]=p=>s.value.roleAlias=p),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u522B\u540D"},null,8,["modelValue"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(D,{label:"\u6240\u5C5E\u79DF\u6237",name:"tenantId"},{default:t(()=>[e(Y,{modelValue:s.value.tenantId,"onUpdate:modelValue":n[2]||(n[2]=p=>s.value.tenantId=p),options:r(R),keys:{value:"tenantId",label:"tenantName"},clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6240\u5C5E\u79DF\u6237",onChange:r(X)},null,8,["modelValue","options","onChange"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(D,{label:"\u4E0A\u7EA7\u89D2\u8272",name:"parentId"},{default:t(()=>[e(se,{modelValue:s.value.parentId,"onUpdate:modelValue":n[3]||(n[3]=p=>s.value.parentId=p),data:b.value,"tree-props":{keys:{label:"title",value:"id",children:"children"}},clearable:"",placeholder:"\u8BF7\u9009\u62E9\u4E0A\u7EA7\u89D2\u8272"},null,8,["modelValue","data"])]),_:1})]),_:1}),e(f,{span:12},{default:t(()=>[e(D,{label:"\u89D2\u8272\u6392\u5E8F",name:"sort"},{default:t(()=>[e(O,{modelValue:s.value.sort,"onUpdate:modelValue":n[4]||(n[4]=p=>s.value.sort=p),theme:"column",placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u6392\u5E8F",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),E(e(f,{span:12},{default:t(()=>[e(D,{style:{float:"right"}},{default:t(()=>[e(j,{variant:"outline",onClick:W},{default:t(()=>[v("\u53D6\u6D88")]),_:1}),e(j,{theme:"primary",type:"submit"},{default:t(()=>[v("\u786E\u5B9A")]),_:1})]),_:1})]),_:1},512),[[Be,!r(K)]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),Ye=ge(Xe,[["__file","D:/Study/tdesign-console/src/viewsBusiness/authority/components/role/DialogForm.vue"]]),Ze=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"\u5E8F\u53F7",width:80,align:"center",fixed:"left"},{colKey:"roleName",title:"\u89D2\u8272\u540D\u79F0"},{colKey:"tenantId",title:"\u6240\u5C5E\u79DF\u6237"},{colKey:"roleAlias",title:"\u89D2\u8272\u522B\u540D"},{colKey:"sort",title:"\u89D2\u8272\u6392\u5E8F"},{fixed:"right",width:180,colKey:"op",title:"\u64CD\u4F5C",align:"center"}],et={class:"table-wrapper"},tt=["onClick"],at=["onClick"],lt=["onClick"],ut=fe({__name:"role",setup(H){const{tableVar:h}=Oe(),{getTableHeaderAffixedTop:_,getLayoutContainer:L}=je(),{hasRole:P}=Ae(),Q={roleAlias:"",tenantId:"",roleName:""},K=Te({childrenKey:"children",treeNodeColumnIndex:2}),R=u(null),b=u({}),m=u([]),c=u({...Q}),s=u(!1),V=u(!1),F=u(""),k=u(""),{fetchData:x,data:W,dataLoading:X}=$e(Je,c.value,()=>{m.value=[]},!1),d=u([]);async function n(){const o=await We();d.value=o}Se("tenantOptions",d),Ne(()=>{n(),x()});const g=({row:o},a)=>{b.value=o,F.value=o.id,k.value=a,V.value=!0},D=({row:o})=>{B.value=o.id,C.value="one",s.value=!0},f=U(()=>{x()},300),Y=o=>{m.value=o},O=U(async o=>{try{await Qe(o),s.value=!1,I.success("\u5220\u9664\u6210\u529F"),$(),f()}catch{s.value=!1}},300),j=()=>{!m.value.length||(C.value="check",s.value=!0)},B=u(-1),C=u(),$=()=>{B.value=-1,C.value=""},p=()=>{C.value==="check"&&O(m.value),C.value==="one"&&O([`${B.value}`])},De=()=>{$()},M=u(!1),A=u([]),ie=u([]),Z=u([]),q=u([]),de=u([]),ee=u([]),G=u([]),re=u([]),te=u([]),ye=U(()=>{if(!m.value.length){I.warning("\u81F3\u5C11\u9009\u62E9\u4E00\u6761\u6570\u636E");return}if(m.value.length!==1){I.warning("\u53EA\u80FD\u9009\u62E9\u4E00\u6761\u6570\u636E");return}A.value=[],ze().then(o=>(ie.value=o.menu,de.value=o.dataScope,re.value=o.apiScope,He(m.value.join()))).then(o=>{A.value=o.menu,q.value=o.dataScope,G.value=o.apiScope,M.value=!0})},300),Fe=()=>{Pe(m.value,A.value,q.value,G.value).then(()=>{M.value=!1,I.success("\u64CD\u4F5C\u6210\u529F")})},Ce=()=>{Z.value=[],ee.value=[],te.value=[]},he=U(Fe,300),Ve=o=>{var T;const{parentId:a}=r(b.value);o.parentId!==a?x():o.id&&((T=R.value)==null||T.setData(o.id,{...b.value,...o})),b.value={}};return(o,a)=>{const T=i("t-input"),ae=i("t-form-item"),w=i("t-col"),we=i("t-select"),le=i("t-row"),S=i("t-button"),Ee=i("t-form"),Ie=i("t-enhanced-table"),ce=i("t-dialog"),ue=i("t-tree"),ne=i("t-tab-panel"),ke=i("t-tabs"),N=Ue("auth");return y(),J("div",{class:be(r(h))},[e(Ee,{ref:"form",data:c.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:r(f),onSubmit:r(f)},{default:t(()=>[e(le,null,{default:t(()=>[e(w,{span:10},{default:t(()=>[e(le,{gutter:[16,24]},{default:t(()=>[e(w,{span:4},{default:t(()=>[e(ae,{label:"\u89D2\u8272\u540D\u79F0",name:"roleName"},{default:t(()=>[e(T,{modelValue:c.value.roleName,"onUpdate:modelValue":a[0]||(a[0]=l=>c.value.roleName=l),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:4},{default:t(()=>[e(ae,{label:"\u6240\u5C5E\u79DF\u6237",name:"tenantId"},{default:t(()=>[e(we,{modelValue:c.value.tenantId,"onUpdate:modelValue":a[1]||(a[1]=l=>c.value.tenantId=l),options:d.value,keys:{value:"tenantId",label:"tenantName"},clearable:"",placeholder:"\u8BF7\u9009\u62E9\u6240\u5C5E\u79DF\u6237"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(w,{span:4},{default:t(()=>[e(ae,{label:"\u89D2\u8272\u522B\u540D",name:"roleAlias"},{default:t(()=>[e(T,{modelValue:c.value.roleAlias,"onUpdate:modelValue":a[2]||(a[2]=l=>c.value.roleAlias=l),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u522B\u540D"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(w,{span:2,class:"operation-wrapper"},{default:t(()=>[e(S,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[v(" \u67E5\u8BE2 ")]),_:1}),e(S,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[v(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),Le("div",et,[e(Ie,{ref_key:"enhancedTable",ref:R,data:r(W),columns:r(Ze),hover:!0,loading:r(X),tree:K,"selected-row-keys":m.value,"header-affixed-top":{offsetTop:r(_),container:r(L)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onSelectChange:Y},{"top-content":t(()=>[e(le,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(w,{flex:"0 0 auto"},{default:t(()=>[E((y(),z(S,{onClick:a[3]||(a[3]=l=>g({row:{}},"add"))},{default:t(()=>[v("\u65B0\u589E")]),_:1})),[[N,"role_add"]]),E((y(),z(S,{theme:"danger",onClick:j},{default:t(()=>[v("\u5220\u9664")]),_:1})),[[N,"role_delete"]]),r(P)(["administrator","admin"])?(y(),z(S,{key:0,variant:"outline",onClick:r(ye)},{default:t(()=>[v(" \u6743\u9650\u914D\u7F6E ")]),_:1},8,["onClick"])):_e("v-if",!0)]),_:1})]),_:1})]),tenantId:t(({row:l})=>[v(Ke(r(Re)(d.value,l.tenantId,{id:"tenantId",name:"tenantName"})),1)]),op:t(l=>[E((y(),J("a",{class:"t-button-link",onClick:pe=>g(l,"view")},[v("\u67E5\u770B")],8,tt)),[[N,"role_view"]]),E((y(),J("a",{class:"t-button-link",onClick:pe=>g(l,"edit")},[v("\u7F16\u8F91")],8,at)),[[N,"role_edit"]]),E((y(),J("a",{class:"t-button-link",onClick:pe=>D(l)},[v("\u5220\u9664")],8,lt)),[[N,"role_delete"]])]),_:1},8,["data","columns","loading","tree","selected-row-keys","header-affixed-top"]),e(ce,{visible:s.value,"onUpdate:visible":a[4]||(a[4]=l=>s.value=l),header:"\u786E\u8BA4\u5220\u9664\u5F53\u524D\u6240\u9009\u6570\u636E\uFF1F","on-cancel":De,onConfirm:p},null,8,["visible"]),e(Ye,{visible:V.value,"onUpdate:visible":a[5]||(a[5]=l=>V.value=l),editId:F.value,"onUpdate:editId":a[6]||(a[6]=l=>F.value=l),actionType:k.value,"onUpdate:actionType":a[7]||(a[7]=l=>k.value=l),"row-data":b.value,onSubmit:Ve},null,8,["visible","editId","actionType","row-data"]),e(ce,{visible:M.value,"onUpdate:visible":a[14]||(a[14]=l=>M.value=l),header:"\u89D2\u8272\u6743\u9650\u914D\u7F6E",onCancel:Ce,onConfirm:r(he)},{default:t(()=>[e(ke,{"default-value":1},{default:t(()=>[e(ne,{value:1,label:"\u83DC\u5355\u6743\u9650"},{default:t(()=>[e(ue,{modelValue:A.value,"onUpdate:modelValue":a[8]||(a[8]=l=>A.value=l),expanded:Z.value,"onUpdate:expanded":a[9]||(a[9]=l=>Z.value=l),data:ie.value,hover:"",keys:{value:"id",label:"title"},checkable:!0,style:{"margin-top":"15px"}},null,8,["modelValue","expanded","data"])]),_:1}),e(ne,{value:2,label:"\u6570\u636E\u6743\u9650"},{default:t(()=>[e(ue,{modelValue:q.value,"onUpdate:modelValue":a[10]||(a[10]=l=>q.value=l),expanded:ee.value,"onUpdate:expanded":a[11]||(a[11]=l=>ee.value=l),data:de.value,hover:"",keys:{value:"id",label:"title"},checkable:!0,style:{"margin-top":"15px"}},null,8,["modelValue","expanded","data"])]),_:1}),e(ne,{value:3,label:"\u63A5\u53E3\u6743\u9650"},{default:t(()=>[e(ue,{modelValue:G.value,"onUpdate:modelValue":a[12]||(a[12]=l=>G.value=l),expanded:te.value,"onUpdate:expanded":a[13]||(a[13]=l=>te.value=l),data:re.value,hover:"",keys:{value:"id",label:"title"},checkable:!0,style:{"margin-top":"15px"}},null,8,["modelValue","expanded","data"])]),_:1})]),_:1})]),_:1},8,["visible","onConfirm"])])],2)}}}),mt=ge(ut,[["__file","D:/Study/tdesign-console/src/views/authority/role.vue"]]);export{mt as default};
