import{an as H,d as se,f as d,a2 as Y,r as n,o as y,m as L,w as t,a as e,b as i,q as g,M as P,av as ye,J as Q,Q as le,s as me,c as B,F as _e,K as Ve,t as ce,p as oe,W as A,X as Ce,aw as ke,ax as Ie,i as we,as as De,e as Ke,au as Te,ao as de,ap as ie,ab as Ue}from"./index-CqGaQ7t4.js";import{u as xe}from"./useSetting-CnYQd1RY.js";import{u as he}from"./useDesign-CbWcZHFZ.js";import{u as Ne}from"./useRequset-Bj5fiv5N.js";import{u as z}from"./index-BidCcHov.js";const Se=(c,q,T)=>H.get({url:"/blade-resource/sms/list",params:{...T,current:c,size:q}},{joinTime:!1}),$e=c=>H.get({url:"/blade-resource/sms/detail",params:{id:c}}),qe=c=>H.post({url:"/blade-resource/sms/remove",params:{ids:c}},{joinParamsToUrl:!0,errorMessageMode:"message"}),Me=c=>H.post({url:"/blade-resource/sms/submit",data:c},{errorMessageMode:"message"}),je=c=>H.post({url:"/blade-resource/sms/enable",params:{id:c}},{joinParamsToUrl:!0}),Be=c=>H.post({url:"/blade-resource/sms/endpoint/send-message",params:c},{joinParamsToUrl:!0,errorMessageMode:"message"}),Ae=se({__name:"DialogDebug",props:{visible:{type:Boolean,default:!1},code:{type:String,default:""}},emits:["update:visible","submit"],setup(c,{emit:q}){const T={code:"",phones:"",params:""},_=c,J=d({phones:[{required:!0,message:"请输入发送手机",type:"error",trigger:"blur"}],params:[{required:!0,message:"请输入发送参数",type:"error",trigger:"blur"}]}),v=d(!1),a=d({...T}),f=d(null),b=d(!1),V=q,U=z(({firstError:C})=>{C?P.warning(C):(b.value=!0,Be(a.value).then(()=>{V("submit",a.value),P.success("提交成功"),v.value=!1}).finally(()=>{b.value=!1}))},300),x=()=>{a.value={...T}},S=()=>{v.value=!1};return Y(()=>v.value,C=>{V("update:visible",C)}),Y(()=>_.visible,C=>{a.value.code=_.code,v.value=C}),(C,m)=>{const $=n("t-input"),k=n("t-form-item"),h=n("t-col"),R=n("t-button"),u=n("t-row"),o=n("t-form"),D=n("t-dialog");return y(),L(D,{visible:v.value,"onUpdate:visible":m[3]||(m[3]=I=>v.value=I),header:"手机短信发送调试",width:780,footer:!1,onClosed:x},{body:t(()=>[e(o,{ref_key:"form",ref:f,data:a.value,rules:J.value,"label-width":100,disabled:b.value,onSubmit:i(U)},{default:t(()=>[e(u,{gutter:[0,28]},{default:t(()=>[e(h,{span:12},{default:t(()=>[e(k,{label:"资源编号",name:"code"},{default:t(()=>[e($,{modelValue:a.value.code,"onUpdate:modelValue":m[0]||(m[0]=I=>a.value.code=I),placeholder:"请输入资源编号",clearable:"",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(h,{span:12},{default:t(()=>[e(k,{label:"发送手机",name:"phones"},{default:t(()=>[e($,{modelValue:a.value.phones,"onUpdate:modelValue":m[1]||(m[1]=I=>a.value.phones=I),placeholder:"请输入发送手机",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(h,{span:12},{default:t(()=>[e(k,{label:"发送参数",name:"params"},{default:t(()=>[e($,{modelValue:a.value.params,"onUpdate:modelValue":m[2]||(m[2]=I=>a.value.params=I),placeholder:"例: {'code':2333,'title':'通知标题'}",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(h,{span:12},{default:t(()=>[e(k,{style:{float:"right"}},{default:t(()=>[e(R,{variant:"outline",onClick:S},{default:t(()=>m[4]||(m[4]=[g("取消")])),_:1}),e(R,{theme:"primary",disabled:b.value,type:"submit"},{default:t(()=>m[5]||(m[5]=[g("提交")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled","onSubmit"])]),_:1},8,["visible"])}}}),Le=se({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","submit"],setup(c,{emit:q}){const T={category:1,smsCode:"",templateId:"",accessKey:"",secretKey:"",regionId:"cn-hangzhou",signName:"",remark:""},_=c,J=ye("categoryOptions")||[],v=d(!1),a=d({...T}),f=d(null),b=d(!1),V=q,U=Q(()=>{const{category:u}=i(a);return u===1?"模版内容":"模版ID"}),x=Q(()=>{const{category:u}=i(a);return u===1?"apiKey":u===4?"appId":"accessKey"}),S=Q(()=>{const{category:u}=i(a);return u===4?"appKey":"secretKey"}),C=d({category:[{required:!0,message:"请选择分类",type:"error",trigger:"change"}],smsCode:[{required:!0,message:"请输入资源编号",type:"error",trigger:"blur"}],templateId:[{required:!0,message:`请输入${U.value}`,type:"error",trigger:"blur"}],accessKey:[{required:!0,message:`请输入${x.value}`,type:"error",trigger:"blur"}],secretKey:[{required:!0,message:`请输入${S.value}`,type:"error",trigger:"blur"}],regionId:[{required:!0,message:"请输入regionId",type:"error",trigger:"blur"}],signName:[{required:!0,message:"请输入短信签名",type:"error",trigger:"blur"}]}),m=Q(()=>`${{view:"查看",edit:"编辑",add:"新增"}[_.actionType]||""}短信配置`),$=Q(()=>({view:!0,edit:!1})[_.actionType]||!1),k=({firstError:u})=>{if(u)P.warning(u);else{b.value=!0;const o={...a.value,id:_.editId};Me(o).then(()=>{V("submit",o),P.success("提交成功"),v.value=!1}).finally(()=>{b.value=!1})}},h=()=>{a.value={...T},le(()=>{V("update:editId",""),V("update:actionType","")})},R=()=>{v.value=!1};return Y(()=>v.value,u=>{V("update:visible",u)}),Y(()=>_.visible,u=>{u&&_.editId&&le(()=>{$e(_.editId).then(o=>{a.value={...o}})}),le(()=>{var o;(o=f.value)==null||o.clearValidate()}),v.value=u}),(u,o)=>{const D=n("t-radio"),I=n("t-radio-group"),w=n("t-form-item"),K=n("t-col"),N=n("t-input"),Z=n("t-textarea"),O=n("t-button"),M=n("t-row"),W=n("t-form"),ee=n("t-dialog");return y(),L(ee,{visible:v.value,"onUpdate:visible":o[8]||(o[8]=r=>v.value=r),header:m.value,width:780,footer:!1,onClosed:h},{body:t(()=>[e(W,{ref_key:"form",ref:f,class:me({"xy-form__detail":c.actionType==="view"}),data:a.value,rules:C.value,"label-width":100,disabled:$.value||b.value,onSubmit:k},{default:t(()=>[e(M,{gutter:[0,28]},{default:t(()=>[e(K,{span:12},{default:t(()=>[e(w,{label:"分类",name:"category"},{default:t(()=>[e(I,{modelValue:a.value.category,"onUpdate:modelValue":o[0]||(o[0]=r=>a.value.category=r),name:"category"},{default:t(()=>[(y(!0),B(_e,null,Ve(i(J),r=>(y(),L(D,{key:r.dictKey,value:r.dictKey},{default:t(()=>[g(ce(r.dictValue),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(K,{span:12},{default:t(()=>[e(w,{label:"资源编号",name:"smsCode"},{default:t(()=>[e(N,{modelValue:a.value.smsCode,"onUpdate:modelValue":o[1]||(o[1]=r=>a.value.smsCode=r),placeholder:"请输入资源编号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(K,{span:12},{default:t(()=>[e(w,{label:U.value,name:"templateId"},{default:t(()=>[e(N,{modelValue:a.value.templateId,"onUpdate:modelValue":o[2]||(o[2]=r=>a.value.templateId=r),placeholder:`请输入${U.value}`,clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(K,{span:12},{default:t(()=>[e(w,{label:x.value,name:"accessKey"},{default:t(()=>[e(N,{modelValue:a.value.accessKey,"onUpdate:modelValue":o[3]||(o[3]=r=>a.value.accessKey=r),placeholder:`请输入${x.value}`,clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a.value.category!==1?(y(),L(K,{key:0,span:12},{default:t(()=>[e(w,{label:S.value,name:"secretKey"},{default:t(()=>[e(N,{modelValue:a.value.secretKey,"onUpdate:modelValue":o[4]||(o[4]=r=>a.value.secretKey=r),placeholder:`请输入${S.value}`,clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})):oe("",!0),a.value.category===3?(y(),L(K,{key:1,span:12},{default:t(()=>[e(w,{label:"regionId",name:"regionId"},{default:t(()=>[e(N,{modelValue:a.value.regionId,"onUpdate:modelValue":o[5]||(o[5]=r=>a.value.regionId=r),placeholder:"请输入regionId",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})):oe("",!0),e(K,{span:12},{default:t(()=>[e(w,{label:"短信签名",name:"signName"},{default:t(()=>[e(N,{modelValue:a.value.signName,"onUpdate:modelValue":o[6]||(o[6]=r=>a.value.signName=r),placeholder:"请输入短信签名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(K,{span:12},{default:t(()=>[e(w,{label:"备注",name:"remark"},{default:t(()=>[e(Z,{modelValue:a.value.remark,"onUpdate:modelValue":o[7]||(o[7]=r=>a.value.remark=r),placeholder:"请输入备注",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),A(e(K,{span:12},{default:t(()=>[e(w,{style:{float:"right"}},{default:t(()=>[e(O,{variant:"outline",onClick:R},{default:t(()=>o[9]||(o[9]=[g("取消")])),_:1}),e(O,{theme:"primary",type:"submit"},{default:t(()=>o[10]||(o[10]=[g("确定")])),_:1})]),_:1})]),_:1},512),[[Ce,!$.value]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),Re=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"分类",colKey:"category"},{title:"资源编号",colKey:"smsCode"},{title:"模版ID",colKey:"templateId"},{title:"accessKey",colKey:"accessKey"},{title:"短信签名",colKey:"signName"},{title:"是否启用",colKey:"statusName"},{fixed:"right",width:280,colKey:"op",title:"操作",align:"center"}],Oe={class:"table-wrapper"},Fe=["onClick"],ze=["onClick"],Pe=["onClick"],He=["onClick"],Je=["onClick"],Ye=se({__name:"sms",setup(c){const{tableVar:q}=he(),{getTableHeaderAffixedTop:T,getLayoutContainer:_}=xe(),{hasRole:J}=ke(),v={category:"",smsCode:"",templateId:"",status:void 0},a=d([]),f=d({...v}),b=d(!1),V=d(!1),U=d(""),x=d(""),{fetchData:S,data:C,pagination:m,dataLoading:$}=Ne(Se,f.value,()=>{a.value=[]}),k=d([]),h=d([]);Ie("categoryOptions",k);async function R(){const p=await de("sms"),l=await de("yes_no");k.value=ie(p),h.value=ie(l)}we(()=>{R(),S()});const u=({row:p},l)=>{U.value=p.id,x.value=l,V.value=!0},o=({row:p})=>{O.value=p.id,M.value="one",b.value=!0},D=z(()=>{S()},300),I=p=>{a.value=p},w=p=>{m.value={...m.value,current:p.current||1,pageSize:p.pageSize},D()},N=z(async p=>{try{await qe(p),b.value=!1,P.success("删除成功"),W(),D()}catch{b.value=!1}},300),Z=()=>{a.value.length&&(M.value="check",b.value=!0)},O=d(-1),M=d(),W=()=>{O.value=-1,M.value=""},ee=()=>{M.value==="check"&&N(a.value),M.value==="one"&&N([`${O.value}`])},r=()=>{W()},te=d(!1),ne=d(""),pe=z(({row:p})=>{ne.value=p.smsCode,te.value=!0},300),ve=z(({row:p})=>{const l=Ue.confirm({header:"提示",theme:"info",body:"是否确定启用这条配置?",onConfirm:z(()=>{je(p.id).then(()=>{P.success("启用成功"),l.destroy(),D()})},300)})},300);return(p,l)=>{const ue=n("t-select"),X=n("t-form-item"),j=n("t-col"),re=n("t-input"),ae=n("t-row"),E=n("t-button"),fe=n("t-form"),be=n("t-table"),ge=n("t-dialog"),F=De("auth");return y(),B("div",{class:me(i(q))},[e(fe,{ref:"form",data:f.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:i(D),onSubmit:i(D)},{default:t(()=>[e(ae,null,{default:t(()=>[e(j,{span:10},{default:t(()=>[e(ae,{gutter:[16,24]},{default:t(()=>[e(j,{span:4},{default:t(()=>[e(X,{label:"分类",name:"category"},{default:t(()=>[e(ue,{modelValue:f.value.category,"onUpdate:modelValue":l[0]||(l[0]=s=>f.value.category=s),options:k.value,keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择分类"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(j,{span:4},{default:t(()=>[e(X,{label:"资源编号",name:"smsCode"},{default:t(()=>[e(re,{modelValue:f.value.smsCode,"onUpdate:modelValue":l[1]||(l[1]=s=>f.value.smsCode=s),clearable:"",placeholder:"请输入资源编号"},null,8,["modelValue"])]),_:1})]),_:1}),e(j,{span:4},{default:t(()=>[e(X,{label:"模版ID",name:"templateId"},{default:t(()=>[e(re,{modelValue:f.value.templateId,"onUpdate:modelValue":l[2]||(l[2]=s=>f.value.templateId=s),clearable:"",placeholder:"请输入模版ID"},null,8,["modelValue"])]),_:1})]),_:1}),e(j,{span:4},{default:t(()=>[e(X,{label:"是否启用",name:"status"},{default:t(()=>[e(ue,{modelValue:f.value.status,"onUpdate:modelValue":l[3]||(l[3]=s=>f.value.status=s),options:h.value,keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择是否启用"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1}),e(j,{span:2,class:"operation-wrapper"},{default:t(()=>[e(E,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>l[10]||(l[10]=[g(" 查询 ")])),_:1}),e(E,{type:"reset",variant:"base",theme:"default"},{default:t(()=>l[11]||(l[11]=[g(" 重置 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),Ke("div",Oe,[e(be,{data:i(C),columns:i(Re),hover:!0,loading:i($),pagination:i(m),"selected-row-keys":a.value,"header-affixed-top":{offsetTop:i(T),container:i(_)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:w,onSelectChange:I},{"top-content":t(()=>[e(ae,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(j,{flex:"0 0 auto"},{default:t(()=>[A((y(),L(E,{onClick:l[4]||(l[4]=s=>u({row:{}},"add"))},{default:t(()=>l[12]||(l[12]=[g("新增")])),_:1})),[[F,"sms_add"]]),A((y(),L(E,{theme:"danger",onClick:Z},{default:t(()=>l[13]||(l[13]=[g("删除")])),_:1})),[[F,"sms_delete"]])]),_:1})]),_:1})]),category:t(({row:s})=>[g(ce(i(Te)(k.value,s.category)),1)]),op:t(s=>[A((y(),B("a",{class:"t-button-link",onClick:G=>u(s,"view")},l[14]||(l[14]=[g("查看")]),8,Fe)),[[F,"sms_view"]]),A((y(),B("a",{class:"t-button-link",onClick:G=>u(s,"edit")},l[15]||(l[15]=[g("编辑")]),8,ze)),[[F,"sms_edit"]]),A((y(),B("a",{class:"t-button-link",onClick:G=>o(s)},l[16]||(l[16]=[g("删除")]),8,Pe)),[[F,"sms_delete"]]),i(J)(["administrator","admin"])?(y(),B("a",{key:0,class:"t-button-link",onClick:G=>i(pe)(s)},"调试",8,He)):oe("",!0),A((y(),B("a",{class:"t-button-link",onClick:G=>i(ve)(s)},l[17]||(l[17]=[g("启用")]),8,Je)),[[F,"sms_enable"]])]),_:1},8,["data","columns","loading","pagination","selected-row-keys","header-affixed-top"]),e(ge,{visible:b.value,"onUpdate:visible":l[5]||(l[5]=s=>b.value=s),header:"确认删除当前所选数据？","on-cancel":r,onConfirm:ee},null,8,["visible"]),e(Le,{visible:V.value,"onUpdate:visible":l[6]||(l[6]=s=>V.value=s),editId:U.value,"onUpdate:editId":l[7]||(l[7]=s=>U.value=s),actionType:x.value,"onUpdate:actionType":l[8]||(l[8]=s=>x.value=s),onSubmit:i(D)},null,8,["visible","editId","actionType","onSubmit"]),e(Ae,{visible:te.value,"onUpdate:visible":l[9]||(l[9]=s=>te.value=s),code:ne.value},null,8,["visible","code"])])],2)}}});export{Ye as default};
