import{a1 as R,d as le,aJ as ye,r as d,C as H,j as l,ax as ee,av as ue,e as n,f as b,g as q,w as t,m as J,l as e,q as ce,i as N,F as Fe,H as De,p as _,t as me,J as $,K as Ce,M as L,_ as oe,aK as Be,aL as Ve,a as Ee,aG as ke,n as he,aI as Ie,aC as de,aD as ie,V as we}from"./index.c2521a03.js";import{u as Ke}from"./useDesign.9d0ca2bc.js";import{u as Ae}from"./useSetting.65510119.js";import{u as Te}from"./useRequset.5f7a0394.js";import{u as M}from"./index.d71d3bee.js";const Ue=(c,C,y)=>R.get({url:"/blade-resource/sms/list",params:{...y,current:c,size:C}},{joinTime:!1}),xe=c=>R.get({url:"/blade-resource/sms/detail",params:{id:c}}),Se=c=>R.post({url:"/blade-resource/sms/remove",params:{ids:c}},{joinParamsToUrl:!0,errorMessageMode:"message"}),Ne=c=>R.post({url:"/blade-resource/sms/submit",data:c},{errorMessageMode:"message"}),$e=c=>R.post({url:"/blade-resource/sms/enable",params:{id:c}},{joinParamsToUrl:!0}),qe=c=>R.post({url:"/blade-resource/sms/endpoint/send-message",params:c},{joinParamsToUrl:!0,errorMessageMode:"message"}),je=le({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","submit"],setup(c,{emit:C}){const y=c,A={category:1,smsCode:"",templateId:"",accessKey:"",secretKey:"",regionId:"cn-hangzhou",signName:"",remark:""},O=ye("categoryOptions")||[],v=d(!1),a=d({...A}),f=d(null),g=d(!1),h=H(()=>{const{category:i}=l(a);return i===1?"\u6A21\u7248\u5185\u5BB9":"\u6A21\u7248ID"}),I=H(()=>{const{category:i}=l(a);return i===1?"apiKey":i===4?"appId":"accessKey"}),w=H(()=>{const{category:i}=l(a);return i===4?"appKey":"secretKey"}),F=d({category:[{required:!0,message:"\u8BF7\u9009\u62E9\u5206\u7C7B",type:"error",trigger:"change"}],smsCode:[{required:!0,message:"\u8BF7\u8F93\u5165\u8D44\u6E90\u7F16\u53F7",type:"error",trigger:"blur"}],templateId:[{required:!0,message:`\u8BF7\u8F93\u5165${h.value}`,type:"error",trigger:"blur"}],accessKey:[{required:!0,message:`\u8BF7\u8F93\u5165${I.value}`,type:"error",trigger:"blur"}],secretKey:[{required:!0,message:`\u8BF7\u8F93\u5165${w.value}`,type:"error",trigger:"blur"}],regionId:[{required:!0,message:"\u8BF7\u8F93\u5165regionId",type:"error",trigger:"blur"}],signName:[{required:!0,message:"\u8BF7\u8F93\u5165\u77ED\u4FE1\u7B7E\u540D",type:"error",trigger:"blur"}]}),D=H(()=>`${{view:"\u67E5\u770B",edit:"\u7F16\u8F91",add:"\u65B0\u589E"}[y.actionType]||""}\u77ED\u4FE1\u914D\u7F6E`),k=H(()=>({view:!0,edit:!1})[y.actionType]||!1),K=({firstError:i})=>{if(i)L.warning(i);else{g.value=!0;const u={...a.value,id:y.editId};Ne(u).then(()=>{C("submit",u),L.success("\u63D0\u4EA4\u6210\u529F"),v.value=!1}).finally(()=>{g.value=!1})}},B=()=>{a.value={...A},ue(()=>{C("update:editId",""),C("update:actionType","")})},T=()=>{v.value=!1};return ee(()=>v.value,i=>{C("update:visible",i)}),ee(()=>y.visible,i=>{i&&y.editId&&ue(()=>{xe(y.editId).then(u=>{a.value={...u}})}),ue(()=>{var u;(u=f.value)==null||u.clearValidate()}),v.value=i}),(i,u)=>{const z=n("t-radio"),p=n("t-radio-group"),V=n("t-form-item"),E=n("t-col"),U=n("t-input"),G=n("t-textarea"),Q=n("t-button"),P=n("t-row"),x=n("t-form"),W=n("t-dialog");return b(),q(W,{visible:v.value,"onUpdate:visible":u[8]||(u[8]=r=>v.value=r),header:l(D),width:780,footer:!1,onClosed:B},{body:t(()=>[J(" \u8868\u5355\u5185\u5BB9 "),e(x,{ref_key:"form",ref:f,class:ce({"xy-form__detail":c.actionType==="view"}),data:a.value,rules:F.value,"label-width":100,disabled:l(k)||g.value,onSubmit:K},{default:t(()=>[e(P,{gutter:[0,28]},{default:t(()=>[e(E,{span:12},{default:t(()=>[e(V,{label:"\u5206\u7C7B",name:"category"},{default:t(()=>[e(p,{modelValue:a.value.category,"onUpdate:modelValue":u[0]||(u[0]=r=>a.value.category=r),name:"category"},{default:t(()=>[(b(!0),N(Fe,null,De(l(O),r=>(b(),q(z,{key:r.dictKey,value:r.dictKey},{default:t(()=>[_(me(r.dictValue),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(E,{span:12},{default:t(()=>[e(V,{label:"\u8D44\u6E90\u7F16\u53F7",name:"smsCode"},{default:t(()=>[e(U,{modelValue:a.value.smsCode,"onUpdate:modelValue":u[1]||(u[1]=r=>a.value.smsCode=r),placeholder:"\u8BF7\u8F93\u5165\u8D44\u6E90\u7F16\u53F7",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(E,{span:12},{default:t(()=>[e(V,{label:l(h),name:"templateId"},{default:t(()=>[e(U,{modelValue:a.value.templateId,"onUpdate:modelValue":u[2]||(u[2]=r=>a.value.templateId=r),placeholder:`\u8BF7\u8F93\u5165${l(h)}`,clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),e(E,{span:12},{default:t(()=>[e(V,{label:l(I),name:"accessKey"},{default:t(()=>[e(U,{modelValue:a.value.accessKey,"onUpdate:modelValue":u[3]||(u[3]=r=>a.value.accessKey=r),placeholder:`\u8BF7\u8F93\u5165${l(I)}`,clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),a.value.category!==1?(b(),q(E,{key:0,span:12},{default:t(()=>[e(V,{label:l(w),name:"secretKey"},{default:t(()=>[e(U,{modelValue:a.value.secretKey,"onUpdate:modelValue":u[4]||(u[4]=r=>a.value.secretKey=r),placeholder:`\u8BF7\u8F93\u5165${l(w)}`,clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1})):J("v-if",!0),a.value.category===3?(b(),q(E,{key:1,span:12},{default:t(()=>[e(V,{label:"regionId",name:"regionId"},{default:t(()=>[e(U,{modelValue:a.value.regionId,"onUpdate:modelValue":u[5]||(u[5]=r=>a.value.regionId=r),placeholder:"\u8BF7\u8F93\u5165regionId",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})):J("v-if",!0),e(E,{span:12},{default:t(()=>[e(V,{label:"\u77ED\u4FE1\u7B7E\u540D",name:"signName"},{default:t(()=>[e(U,{modelValue:a.value.signName,"onUpdate:modelValue":u[6]||(u[6]=r=>a.value.signName=r),placeholder:"\u8BF7\u8F93\u5165\u77ED\u4FE1\u7B7E\u540D",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(E,{span:12},{default:t(()=>[e(V,{label:"\u5907\u6CE8",name:"remark"},{default:t(()=>[e(G,{modelValue:a.value.remark,"onUpdate:modelValue":u[7]||(u[7]=r=>a.value.remark=r),placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),$(e(E,{span:12},{default:t(()=>[e(V,{style:{float:"right"}},{default:t(()=>[e(Q,{variant:"outline",onClick:T},{default:t(()=>[_("\u53D6\u6D88")]),_:1}),e(Q,{theme:"primary",type:"submit"},{default:t(()=>[_("\u786E\u5B9A")]),_:1})]),_:1})]),_:1},512),[[Ce,!l(k)]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),Me=oe(je,[["__file","D:/Study/tdesign-console/src/viewsBusiness/resource/components/sms/DialogForm.vue"]]),Le=le({__name:"DialogDebug",props:{visible:{type:Boolean,default:!1},code:{type:String,default:""}},emits:["update:visible","submit"],setup(c,{emit:C}){const y=c,A={code:"",phones:"",params:""},O=d({phones:[{required:!0,message:"\u8BF7\u8F93\u5165\u53D1\u9001\u624B\u673A",type:"error",trigger:"blur"}],params:[{required:!0,message:"\u8BF7\u8F93\u5165\u53D1\u9001\u53C2\u6570",type:"error",trigger:"blur"}]}),v=d(!1),a=d({...A}),f=d(null),g=d(!1),h=M(({firstError:F})=>{F?L.warning(F):(g.value=!0,qe(a.value).then(()=>{C("submit",a.value),L.success("\u63D0\u4EA4\u6210\u529F"),v.value=!1}).finally(()=>{g.value=!1}))},300),I=()=>{a.value={...A}},w=()=>{v.value=!1};return ee(()=>v.value,F=>{C("update:visible",F)}),ee(()=>y.visible,F=>{a.value.code=y.code,v.value=F}),(F,D)=>{const k=n("t-input"),K=n("t-form-item"),B=n("t-col"),T=n("t-button"),i=n("t-row"),u=n("t-form"),z=n("t-dialog");return b(),q(z,{visible:v.value,"onUpdate:visible":D[3]||(D[3]=p=>v.value=p),header:"\u624B\u673A\u77ED\u4FE1\u53D1\u9001\u8C03\u8BD5",width:780,footer:!1,onClosed:I},{body:t(()=>[J(" \u8868\u5355\u5185\u5BB9 "),e(u,{ref_key:"form",ref:f,data:a.value,rules:O.value,"label-width":100,disabled:g.value,onSubmit:l(h)},{default:t(()=>[e(i,{gutter:[0,28]},{default:t(()=>[e(B,{span:12},{default:t(()=>[e(K,{label:"\u8D44\u6E90\u7F16\u53F7",name:"code"},{default:t(()=>[e(k,{modelValue:a.value.code,"onUpdate:modelValue":D[0]||(D[0]=p=>a.value.code=p),placeholder:"\u8BF7\u8F93\u5165\u8D44\u6E90\u7F16\u53F7",clearable:"",disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(B,{span:12},{default:t(()=>[e(K,{label:"\u53D1\u9001\u624B\u673A",name:"phones"},{default:t(()=>[e(k,{modelValue:a.value.phones,"onUpdate:modelValue":D[1]||(D[1]=p=>a.value.phones=p),placeholder:"\u8BF7\u8F93\u5165\u53D1\u9001\u624B\u673A",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(B,{span:12},{default:t(()=>[e(K,{label:"\u53D1\u9001\u53C2\u6570",name:"params"},{default:t(()=>[e(k,{modelValue:a.value.params,"onUpdate:modelValue":D[2]||(D[2]=p=>a.value.params=p),placeholder:"\u4F8B: {'code':2333,'title':'\u901A\u77E5\u6807\u9898'}",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(B,{span:12},{default:t(()=>[e(K,{style:{float:"right"}},{default:t(()=>[e(T,{variant:"outline",onClick:w},{default:t(()=>[_("\u53D6\u6D88")]),_:1}),e(T,{theme:"primary",disabled:g.value,type:"submit"},{default:t(()=>[_("\u63D0\u4EA4")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled","onSubmit"])]),_:1},8,["visible"])}}}),Re=oe(Le,[["__file","D:/Study/tdesign-console/src/viewsBusiness/resource/components/sms/DialogDebug.vue"]]),Oe=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"\u5E8F\u53F7",width:80,align:"center",fixed:"left"},{title:"\u5206\u7C7B",colKey:"category"},{title:"\u8D44\u6E90\u7F16\u53F7",colKey:"smsCode"},{title:"\u6A21\u7248ID",colKey:"templateId"},{title:"accessKey",colKey:"accessKey"},{title:"\u77ED\u4FE1\u7B7E\u540D",colKey:"signName"},{title:"\u662F\u5426\u542F\u7528",colKey:"statusName"},{fixed:"right",width:280,colKey:"op",title:"\u64CD\u4F5C",align:"center"}],ze={class:"table-wrapper"},Pe=["onClick"],He=["onClick"],Je=["onClick"],Ge=["onClick"],Qe=["onClick"],We=le({__name:"sms",setup(c){const{tableVar:C}=Ke(),{getTableHeaderAffixedTop:y,getLayoutContainer:A}=Ae(),{hasRole:O}=Be(),v={category:"",smsCode:"",templateId:"",status:void 0},a=d([]),f=d({...v}),g=d(!1),h=d(!1),I=d(""),w=d(""),{fetchData:F,data:D,pagination:k,dataLoading:K}=Te(Ue,f.value,()=>{a.value=[]}),B=d([]),T=d([]);Ve("categoryOptions",B);async function i(){const m=await de("sms"),o=await de("yes_no");B.value=ie(m),T.value=ie(o)}Ee(()=>{i(),F()});const u=({row:m},o)=>{I.value=m.id,w.value=o,h.value=!0},z=({row:m})=>{P.value=m.id,x.value="one",g.value=!0},p=M(()=>{F()},300),V=m=>{a.value=m},E=m=>{k.value={...k.value,current:m.current||1,pageSize:m.pageSize},p()},G=M(async m=>{try{await Se(m),g.value=!1,L.success("\u5220\u9664\u6210\u529F"),W(),p()}catch{g.value=!1}},300),Q=()=>{!a.value.length||(x.value="check",g.value=!0)},P=d(-1),x=d(),W=()=>{P.value=-1,x.value=""},r=()=>{x.value==="check"&&G(a.value),x.value==="one"&&G([`${P.value}`])},pe=()=>{W()},te=d(!1),se=d(""),ve=M(({row:m})=>{se.value=m.smsCode,te.value=!0},300),fe=M(({row:m})=>{const o=we.confirm({header:"\u63D0\u793A",theme:"info",body:"\u662F\u5426\u786E\u5B9A\u542F\u7528\u8FD9\u6761\u914D\u7F6E?",onConfirm:M(()=>{$e(m.id).then(()=>{L.success("\u542F\u7528\u6210\u529F"),o.destroy(),p()})},300)})},300);return(m,o)=>{const ne=n("t-select"),X=n("t-form-item"),S=n("t-col"),re=n("t-input"),ae=n("t-row"),Y=n("t-button"),ge=n("t-form"),_e=n("t-table"),be=n("t-dialog"),j=ke("auth");return b(),N("div",{class:ce(l(C))},[e(ge,{ref:"form",data:f.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:l(p),onSubmit:l(p)},{default:t(()=>[e(ae,null,{default:t(()=>[e(S,{span:10},{default:t(()=>[e(ae,{gutter:[16,24]},{default:t(()=>[e(S,{span:4},{default:t(()=>[e(X,{label:"\u5206\u7C7B",name:"category"},{default:t(()=>[e(ne,{modelValue:f.value.category,"onUpdate:modelValue":o[0]||(o[0]=s=>f.value.category=s),options:B.value,keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"\u8BF7\u9009\u62E9\u5206\u7C7B"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(S,{span:4},{default:t(()=>[e(X,{label:"\u8D44\u6E90\u7F16\u53F7",name:"smsCode"},{default:t(()=>[e(re,{modelValue:f.value.smsCode,"onUpdate:modelValue":o[1]||(o[1]=s=>f.value.smsCode=s),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u8D44\u6E90\u7F16\u53F7"},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{span:4},{default:t(()=>[e(X,{label:"\u6A21\u7248ID",name:"templateId"},{default:t(()=>[e(re,{modelValue:f.value.templateId,"onUpdate:modelValue":o[2]||(o[2]=s=>f.value.templateId=s),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u6A21\u7248ID"},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{span:4},{default:t(()=>[e(X,{label:"\u662F\u5426\u542F\u7528",name:"status"},{default:t(()=>[e(ne,{modelValue:f.value.status,"onUpdate:modelValue":o[3]||(o[3]=s=>f.value.status=s),options:T.value,keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"\u8BF7\u9009\u62E9\u662F\u5426\u542F\u7528"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{span:2,class:"operation-wrapper"},{default:t(()=>[e(Y,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[_(" \u67E5\u8BE2 ")]),_:1}),e(Y,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[_(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),he("div",ze,[e(_e,{data:l(D),columns:l(Oe),hover:!0,loading:l(K),pagination:l(k),"selected-row-keys":a.value,"header-affixed-top":{offsetTop:l(y),container:l(A)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:E,onSelectChange:V},{"top-content":t(()=>[e(ae,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(S,{flex:"0 0 auto"},{default:t(()=>[$((b(),q(Y,{onClick:o[4]||(o[4]=s=>u({row:{}},"add"))},{default:t(()=>[_("\u65B0\u589E")]),_:1})),[[j,"sms_add"]]),$((b(),q(Y,{theme:"danger",onClick:Q},{default:t(()=>[_("\u5220\u9664")]),_:1})),[[j,"sms_delete"]])]),_:1})]),_:1})]),category:t(({row:s})=>[_(me(l(Ie)(B.value,s.category)),1)]),op:t(s=>[$((b(),N("a",{class:"t-button-link",onClick:Z=>u(s,"view")},[_("\u67E5\u770B")],8,Pe)),[[j,"sms_view"]]),$((b(),N("a",{class:"t-button-link",onClick:Z=>u(s,"edit")},[_("\u7F16\u8F91")],8,He)),[[j,"sms_edit"]]),$((b(),N("a",{class:"t-button-link",onClick:Z=>z(s)},[_("\u5220\u9664")],8,Je)),[[j,"sms_delete"]]),l(O)(["administrator","admin"])?(b(),N("a",{key:0,class:"t-button-link",onClick:Z=>l(ve)(s)},"\u8C03\u8BD5",8,Ge)):J("v-if",!0),$((b(),N("a",{class:"t-button-link",onClick:Z=>l(fe)(s)},[_("\u542F\u7528")],8,Qe)),[[j,"sms_enable"]])]),_:1},8,["data","columns","loading","pagination","selected-row-keys","header-affixed-top"]),e(be,{visible:g.value,"onUpdate:visible":o[5]||(o[5]=s=>g.value=s),header:"\u786E\u8BA4\u5220\u9664\u5F53\u524D\u6240\u9009\u6570\u636E\uFF1F","on-cancel":pe,onConfirm:r},null,8,["visible"]),e(Me,{visible:h.value,"onUpdate:visible":o[6]||(o[6]=s=>h.value=s),editId:I.value,"onUpdate:editId":o[7]||(o[7]=s=>I.value=s),actionType:w.value,"onUpdate:actionType":o[8]||(o[8]=s=>w.value=s),onSubmit:l(p)},null,8,["visible","editId","actionType","onSubmit"]),e(Re,{visible:te.value,"onUpdate:visible":o[9]||(o[9]=s=>te.value=s),code:se.value},null,8,["visible","code"])])],2)}}}),at=oe(We,[["__file","D:/Study/tdesign-console/src/views/resource/sms.vue"]]);export{at as default};
