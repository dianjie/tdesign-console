import{an as x,d as ae,f as i,J as ne,a2 as le,Q as E,r as a,o as v,m as K,w as o,a as e,s as se,p as be,c as N,F as _e,K as ge,e as ue,W as V,q as b,X as ye,M as L,i as Ce,as as we,b as c}from"./index-CqGaQ7t4.js";import{u as ke}from"./useSetting-CnYQd1RY.js";import{u as Ve}from"./useDesign-CbWcZHFZ.js";import{u as xe}from"./useRequset-Bj5fiv5N.js";import{m as Te}from"./manifest-Bm0FoDWf.js";import{u as O}from"./index-BidCcHov.js";const he=(r,C,T)=>x.get({url:"/blade-system/topmenu/list",params:{...T,current:r,size:C}},{joinTime:!1}),De=r=>x.get({url:"/blade-system/topmenu/detail",params:{id:r}}),Ie=r=>x.post({url:"/blade-system/topmenu/remove",params:{ids:r}},{joinParamsToUrl:!0,errorMessageMode:"message"}),Se=r=>x.post({url:"/blade-system/topmenu/submit",data:r}),Ue=()=>x.get({url:"blade-system/menu/grant-top-tree"}),Me=r=>x.get({url:"blade-system/menu/top-tree-keys",params:{topMenuIds:r}}),Le=(r,C)=>x.post({url:"blade-system/topmenu/grant",data:{topMenuIds:r,menuIds:C}}),Ke=ae({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","submit"],setup(r,{emit:C}){const T={name:"",source:null,code:"",sort:void 0},g=r,P=i({name:[{required:!0,message:"请输入菜单名称",type:"error",trigger:"blur"}],source:[{required:!0,message:"请选择菜单图标",type:"error",trigger:"change"}],code:[{required:!0,message:"请输入菜单编号",type:"error",trigger:"blur"}],sort:[{required:!0,message:"请输入菜单排序",type:"error",trigger:"blur"}]}),p=ne(()=>`${{view:"查看",edit:"编辑",add:"新增"}[g.actionType]||""}顶部菜单`),_=ne(()=>({view:!0,edit:!1})[g.actionType]||!1),y=i(Te),f=i(!1),u=i({...T}),h=i(null),D=i(!1),I=C,j=({firstError:m})=>{if(m)L.warning(m);else{D.value=!0;const n={...u.value,id:g.editId};Se(n).then(()=>{I("submit",n),L.success("提交成功"),f.value=!1}).finally(()=>{D.value=!1})}},G=()=>{u.value={...T},E(()=>{I("update:editId",""),I("update:actionType","")})},R=()=>{f.value=!1};return le(()=>f.value,m=>{I("update:visible",m)}),le(()=>g.visible,m=>{m&&g.editId&&E(()=>{De(g.editId).then(n=>{u.value={...n}})}),E(()=>{var n;(n=h.value)==null||n.clearValidate()}),f.value=m}),(m,n)=>{const z=a("t-input"),w=a("t-form-item"),S=a("t-col"),q=a("t-icon"),H=a("t-option"),B=a("t-select"),k=a("t-input-number"),$=a("t-button"),J=a("t-row"),Q=a("t-form"),U=a("t-dialog");return v(),K(U,{visible:f.value,"onUpdate:visible":n[4]||(n[4]=s=>f.value=s),header:p.value,width:780,footer:!1,onClosed:G},{body:o(()=>[e(Q,{ref_key:"form",ref:h,class:se({"xy-form__detail":r.actionType==="view"}),data:u.value,rules:P.value,"label-width":100,disabled:_.value||D.value,onSubmit:j},{default:o(()=>[e(J,{gutter:[0,28]},{default:o(()=>[e(S,{span:6},{default:o(()=>[e(w,{label:"菜单名称",name:"name"},{default:o(()=>[e(z,{modelValue:u.value.name,"onUpdate:modelValue":n[0]||(n[0]=s=>u.value.name=s),placeholder:"请输入菜单名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{span:6},{default:o(()=>[e(w,{label:"菜单图标",name:"source"},{default:o(()=>[e(B,{modelValue:u.value.source,"onUpdate:modelValue":n[1]||(n[1]=s=>u.value.source=s),placeholder:"请选择菜单图标",clearable:"","popup-props":{overlayStyle:{width:"350px"},overlayInnerStyle:{width:"350px"}}},{prefixIcon:o(()=>[u.value.source?(v(),K(q,{key:0,name:u.value.source,style:{marginRight:"8px"}},null,8,["name"])):be("",!0)]),default:o(()=>[(v(!0),N(_e,null,ge(y.value,s=>(v(),K(H,{key:s.stem,value:s.stem,label:s.stem,style:{display:"inline-block","font-size":"20px"}},{default:o(()=>[ue("div",null,[e(q,{name:s.stem},null,8,["name"])])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(S,{span:6},{default:o(()=>[e(w,{label:"菜单编号",name:"code"},{default:o(()=>[e(z,{modelValue:u.value.code,"onUpdate:modelValue":n[2]||(n[2]=s=>u.value.code=s),theme:"column",placeholder:"请输入菜单编号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{span:6},{default:o(()=>[e(w,{label:"菜单排序",name:"sort"},{default:o(()=>[e(k,{modelValue:u.value.sort,"onUpdate:modelValue":n[3]||(n[3]=s=>u.value.sort=s),theme:"column",placeholder:"请输入菜单排序",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),V(e(S,{span:12},{default:o(()=>[e(w,{style:{float:"right"}},{default:o(()=>[e($,{variant:"outline",onClick:R},{default:o(()=>n[5]||(n[5]=[b("取消")])),_:1}),e($,{theme:"primary",type:"submit"},{default:o(()=>n[6]||(n[6]=[b("确定")])),_:1})]),_:1})]),_:1},512),[[ye,!_.value]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),je=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{colKey:"name",title:"菜单名"},{colKey:"source",title:"菜单图标"},{colKey:"code",title:"菜单编号"},{colKey:"sort",title:"菜单排序"},{fixed:"right",width:180,colKey:"op",title:"操作",align:"center"}],Re={class:"table-wrapper"},qe=["onClick"],Be=["onClick"],$e=["onClick"],He=ae({__name:"topmenu",setup(r){const{tableVar:C}=Ve(),{getTableHeaderAffixedTop:T,getLayoutContainer:g}=ke(),P={name:"",code:""},p=i([]),_=i({...P}),y=i(!1),f=i(!1),u=i(""),h=i(""),{fetchData:D,data:I,pagination:j,dataLoading:G}=xe(he,_.value,()=>{p.value=[]});Ce(()=>{D()});const R=({row:d},t)=>{u.value=d.id,h.value=t,f.value=!0},m=({row:d})=>{B.value=d.id,k.value="one",y.value=!0},n=O(()=>{D()},300),z=d=>{p.value=d},w=d=>{j.value={...j.value,current:d.current||1,pageSize:d.pageSize},n()},q=O(async d=>{try{await Ie(d),y.value=!1,L.success("删除成功"),$(),n()}catch{y.value=!1}},300),H=()=>{p.value.length&&(k.value="check",y.value=!0)},B=i(-1),k=i(),$=()=>{B.value=-1,k.value=""},J=()=>{k.value==="check"&&q(p.value),k.value==="one"&&q([`${B.value}`])},Q=()=>{$()},U=i(!1),s=i([]),Y=i([]),W=i([]),ie=O(()=>{if(!p.value.length){L.warning("至少选择一条数据");return}if(p.value.length!==1){L.warning("只能选择一条数据");return}s.value=[],Ue().then(d=>(Y.value=d.menu,Me(p.value.join()))).then(d=>{s.value=d.menu,U.value=!0})},300),re=()=>{Le(p.value,s.value).then(()=>{U.value=!1,L.success("操作成功")})},de=()=>{W.value=[]},me=O(re,300);return(d,t)=>{const Z=a("t-input"),ee=a("t-form-item"),A=a("t-col"),X=a("t-row"),F=a("t-button"),ce=a("t-form"),pe=a("t-icon"),ve=a("t-table"),te=a("t-dialog"),fe=a("t-tree"),M=we("auth");return v(),N("div",{class:se(c(C))},[e(ce,{ref:"form",data:_.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:c(n),onSubmit:c(n)},{default:o(()=>[e(X,null,{default:o(()=>[e(A,{span:10},{default:o(()=>[e(X,{gutter:[16,24]},{default:o(()=>[e(A,{span:4},{default:o(()=>[e(ee,{label:"菜单名",name:"name"},{default:o(()=>[e(Z,{modelValue:_.value.name,"onUpdate:modelValue":t[0]||(t[0]=l=>_.value.name=l),clearable:"",placeholder:"请输入菜单名"},null,8,["modelValue"])]),_:1})]),_:1}),e(A,{span:4},{default:o(()=>[e(ee,{label:"菜单编号",name:"code"},{default:o(()=>[e(Z,{modelValue:_.value.code,"onUpdate:modelValue":t[1]||(t[1]=l=>_.value.code=l),clearable:"",placeholder:"请输入菜单编号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(A,{span:2,class:"operation-wrapper"},{default:o(()=>[e(F,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:o(()=>t[10]||(t[10]=[b(" 查询 ")])),_:1}),e(F,{type:"reset",variant:"base",theme:"default"},{default:o(()=>t[11]||(t[11]=[b(" 重置 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),ue("div",Re,[e(ve,{data:c(I),columns:c(je),hover:!0,loading:c(G),pagination:c(j),"selected-row-keys":p.value,"header-affixed-top":{offsetTop:c(T),container:c(g)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:w,onSelectChange:z},{"top-content":o(()=>[e(X,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:o(()=>[e(A,{flex:"0 0 auto"},{default:o(()=>[V((v(),K(F,{onClick:t[2]||(t[2]=l=>R({row:{}},"add"))},{default:o(()=>t[12]||(t[12]=[b("新增")])),_:1})),[[M,"topmenu_add"]]),V((v(),K(F,{theme:"danger",onClick:H},{default:o(()=>t[13]||(t[13]=[b("删除")])),_:1})),[[M,"topmenu_delete"]]),V((v(),K(F,{variant:"outline",onClick:c(ie)},{default:o(()=>t[14]||(t[14]=[b("菜单配置")])),_:1},8,["onClick"])),[[M,"topmenu_setting"]])]),_:1})]),_:1})]),source:o(({row:l})=>[e(pe,{name:l.source},null,8,["name"])]),op:o(l=>[V((v(),N("a",{class:"t-button-link",onClick:oe=>R(l,"view")},t[15]||(t[15]=[b("查看")]),8,qe)),[[M,"topmenu_view"]]),V((v(),N("a",{class:"t-button-link",onClick:oe=>R(l,"edit")},t[16]||(t[16]=[b("编辑")]),8,Be)),[[M,"topmenu_edit"]]),V((v(),N("a",{class:"t-button-link",onClick:oe=>m(l)},t[17]||(t[17]=[b("删除")]),8,$e)),[[M,"topmenu_delete"]])]),_:1},8,["data","columns","loading","pagination","selected-row-keys","header-affixed-top"]),e(te,{visible:y.value,"onUpdate:visible":t[3]||(t[3]=l=>y.value=l),header:"确认删除当前所选数据？","on-cancel":Q,onConfirm:J},null,8,["visible"]),e(Ke,{visible:f.value,"onUpdate:visible":t[4]||(t[4]=l=>f.value=l),editId:u.value,"onUpdate:editId":t[5]||(t[5]=l=>u.value=l),actionType:h.value,"onUpdate:actionType":t[6]||(t[6]=l=>h.value=l),onSubmit:c(n)},null,8,["visible","editId","actionType","onSubmit"]),e(te,{visible:U.value,"onUpdate:visible":t[9]||(t[9]=l=>U.value=l),header:"下级菜单配置",onCancel:de,onConfirm:c(me)},{default:o(()=>[e(fe,{modelValue:s.value,"onUpdate:modelValue":t[7]||(t[7]=l=>s.value=l),expanded:W.value,"onUpdate:expanded":t[8]||(t[8]=l=>W.value=l),data:Y.value,hover:"",keys:{value:"id",label:"title"},checkable:!0},null,8,["modelValue","expanded","data"])]),_:1},8,["visible","onConfirm"])])],2)}}});export{He as default};
