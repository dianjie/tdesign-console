import{ar as V,d as le,f as r,Q as oe,a2 as ne,W as X,r as l,o as v,m as R,w as t,a as e,s as se,p as _e,c as N,F as be,R as ge,e as ue,$ as k,q as _,a0 as ye,M as L,i as he,aw as Ce,b as m}from"./index-CEBUqFKN.js";import{u as we}from"./useSetting-0sw97et7.js";import{u as ke}from"./useDesign-CbWcZHFZ.js";import{u as Ve}from"./useRequset-C-O6OuSd.js";import{m as xe}from"./manifest-DE5it_94.js";import{u as O}from"./index-BPVHnpx-.js";const Te=(i,h,x)=>V.get({url:"/blade-system/topmenu/list",params:{...x,current:i,size:h}},{joinTime:!1}),De=i=>V.get({url:"/blade-system/topmenu/detail",params:{id:i}}),Ie=i=>V.post({url:"/blade-system/topmenu/remove",params:{ids:i}},{joinParamsToUrl:!0,errorMessageMode:"message"}),Se=i=>V.post({url:"/blade-system/topmenu/submit",data:i}),Ue=()=>V.get({url:"blade-system/menu/grant-top-tree"}),Me=i=>V.get({url:"blade-system/menu/top-tree-keys",params:{topMenuIds:i}}),Le=(i,h)=>V.post({url:"blade-system/topmenu/grant",data:{topMenuIds:i,menuIds:h}}),Re=le({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","submit"],setup(i,{emit:h}){const x={name:"",source:null,code:"",sort:void 0},g=i,P=r({name:[{required:!0,message:"请输入菜单名称",type:"error",trigger:"blur"}],source:[{required:!0,message:"请选择菜单图标",type:"error",trigger:"change"}],code:[{required:!0,message:"请输入菜单编号",type:"error",trigger:"blur"}],sort:[{required:!0,message:"请输入菜单排序",type:"error",trigger:"blur"}]}),p=oe(()=>`${{view:"查看",edit:"编辑",add:"新增"}[g.actionType]||""}顶部菜单`),b=oe(()=>({view:!0,edit:!1})[g.actionType]||!1),y=r(xe),f=r(!1),u=r({...x}),T=r(null),D=r(!1),I=h,j=({firstError:c})=>{if(c)L.warning(c);else{D.value=!0;const a={...u.value,id:g.editId};Se(a).then(()=>{I("submit",a),L.success("提交成功"),f.value=!1}).finally(()=>{D.value=!1})}},G=()=>{u.value={...x},X(()=>{I("update:editId",""),I("update:actionType","")})},K=()=>{f.value=!1};return ne(()=>f.value,c=>{I("update:visible",c)}),ne(()=>g.visible,c=>{c&&g.editId&&X(()=>{De(g.editId).then(a=>{u.value={...a}})}),X(()=>{var a;(a=T.value)==null||a.clearValidate()}),f.value=c}),(c,a)=>{const z=l("t-input"),C=l("t-form-item"),S=l("t-col"),$=l("t-icon"),H=l("t-option"),q=l("t-select"),w=l("t-input-number"),B=l("t-button"),Q=l("t-row"),W=l("t-form"),U=l("t-dialog");return v(),R(U,{visible:f.value,"onUpdate:visible":a[4]||(a[4]=s=>f.value=s),header:p.value,width:780,footer:!1,onClosed:G},{body:t(()=>[e(W,{ref_key:"form",ref:T,class:se({"xy-form__detail":i.actionType==="view"}),data:u.value,rules:P.value,"label-width":100,disabled:b.value||D.value,onSubmit:j},{default:t(()=>[e(Q,{gutter:[0,28]},{default:t(()=>[e(S,{span:6},{default:t(()=>[e(C,{label:"菜单名称",name:"name"},{default:t(()=>[e(z,{modelValue:u.value.name,"onUpdate:modelValue":a[0]||(a[0]=s=>u.value.name=s),placeholder:"请输入菜单名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{span:6},{default:t(()=>[e(C,{label:"菜单图标",name:"source"},{default:t(()=>[e(q,{modelValue:u.value.source,"onUpdate:modelValue":a[1]||(a[1]=s=>u.value.source=s),placeholder:"请选择菜单图标",clearable:"","popup-props":{overlayStyle:{width:"350px"},overlayInnerStyle:{width:"350px"}}},{prefixIcon:t(()=>[u.value.source?(v(),R($,{key:0,name:u.value.source,style:{marginRight:"8px"}},null,8,["name"])):_e("",!0)]),default:t(()=>[(v(!0),N(be,null,ge(y.value,s=>(v(),R(H,{key:s.stem,value:s.stem,label:s.stem,style:{display:"inline-block","font-size":"20px"}},{default:t(()=>[ue("div",null,[e($,{name:s.stem},null,8,["name"])])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(S,{span:6},{default:t(()=>[e(C,{label:"菜单编号",name:"code"},{default:t(()=>[e(z,{modelValue:u.value.code,"onUpdate:modelValue":a[2]||(a[2]=s=>u.value.code=s),theme:"column",placeholder:"请输入菜单编号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{span:6},{default:t(()=>[e(C,{label:"菜单排序",name:"sort"},{default:t(()=>[e(w,{modelValue:u.value.sort,"onUpdate:modelValue":a[3]||(a[3]=s=>u.value.sort=s),theme:"column",placeholder:"请输入菜单排序",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),k(e(S,{span:12},{default:t(()=>[e(C,{style:{float:"right"}},{default:t(()=>[e(B,{variant:"outline",onClick:K},{default:t(()=>[_("取消")]),_:1}),e(B,{theme:"primary",type:"submit"},{default:t(()=>[_("确定")]),_:1})]),_:1})]),_:1},512),[[ye,!b.value]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),je=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{colKey:"name",title:"菜单名"},{colKey:"source",title:"菜单图标"},{colKey:"code",title:"菜单编号"},{colKey:"sort",title:"菜单排序"},{fixed:"right",width:180,colKey:"op",title:"操作",align:"center"}],Ke={class:"table-wrapper"},$e=["onClick"],qe=["onClick"],Be=["onClick"],He=le({__name:"topmenu",setup(i){const{tableVar:h}=ke(),{getTableHeaderAffixedTop:x,getLayoutContainer:g}=we(),P={name:"",code:""},p=r([]),b=r({...P}),y=r(!1),f=r(!1),u=r(""),T=r(""),{fetchData:D,data:I,pagination:j,dataLoading:G}=Ve(Te,b.value,()=>{p.value=[]});he(()=>{D()});const K=({row:d},n)=>{u.value=d.id,T.value=n,f.value=!0},c=({row:d})=>{q.value=d.id,w.value="one",y.value=!0},a=O(()=>{D()},300),z=d=>{p.value=d},C=d=>{j.value={...j.value,current:d.current||1,pageSize:d.pageSize},a()},$=O(async d=>{try{await Ie(d),y.value=!1,L.success("删除成功"),B(),a()}catch{y.value=!1}},300),H=()=>{p.value.length&&(w.value="check",y.value=!0)},q=r(-1),w=r(),B=()=>{q.value=-1,w.value=""},Q=()=>{w.value==="check"&&$(p.value),w.value==="one"&&$([`${q.value}`])},W=()=>{B()},U=r(!1),s=r([]),Y=r([]),E=r([]),re=O(()=>{if(!p.value.length){L.warning("至少选择一条数据");return}if(p.value.length!==1){L.warning("只能选择一条数据");return}s.value=[],Ue().then(d=>(Y.value=d.menu,Me(p.value.join()))).then(d=>{s.value=d.menu,U.value=!0})},300),ie=()=>{Le(p.value,s.value).then(()=>{U.value=!1,L.success("操作成功")})},de=()=>{E.value=[]},ce=O(ie,300);return(d,n)=>{const Z=l("t-input"),ee=l("t-form-item"),A=l("t-col"),J=l("t-row"),F=l("t-button"),me=l("t-form"),pe=l("t-icon"),ve=l("t-table"),te=l("t-dialog"),fe=l("t-tree"),M=Ce("auth");return v(),N("div",{class:se(m(h))},[e(me,{ref:"form",data:b.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:m(a),onSubmit:m(a)},{default:t(()=>[e(J,null,{default:t(()=>[e(A,{span:10},{default:t(()=>[e(J,{gutter:[16,24]},{default:t(()=>[e(A,{span:4},{default:t(()=>[e(ee,{label:"菜单名",name:"name"},{default:t(()=>[e(Z,{modelValue:b.value.name,"onUpdate:modelValue":n[0]||(n[0]=o=>b.value.name=o),clearable:"",placeholder:"请输入菜单名"},null,8,["modelValue"])]),_:1})]),_:1}),e(A,{span:4},{default:t(()=>[e(ee,{label:"菜单编号",name:"code"},{default:t(()=>[e(Z,{modelValue:b.value.code,"onUpdate:modelValue":n[1]||(n[1]=o=>b.value.code=o),clearable:"",placeholder:"请输入菜单编号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(A,{span:2,class:"operation-wrapper"},{default:t(()=>[e(F,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[_(" 查询 ")]),_:1}),e(F,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[_(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),ue("div",Ke,[e(ve,{data:m(I),columns:m(je),hover:!0,loading:m(G),pagination:m(j),"selected-row-keys":p.value,"header-affixed-top":{offsetTop:m(x),container:m(g)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:C,onSelectChange:z},{"top-content":t(()=>[e(J,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(A,{flex:"0 0 auto"},{default:t(()=>[k((v(),R(F,{onClick:n[2]||(n[2]=o=>K({row:{}},"add"))},{default:t(()=>[_("新增")]),_:1})),[[M,"topmenu_add"]]),k((v(),R(F,{theme:"danger",onClick:H},{default:t(()=>[_("删除")]),_:1})),[[M,"topmenu_delete"]]),k((v(),R(F,{variant:"outline",onClick:m(re)},{default:t(()=>[_("菜单配置")]),_:1},8,["onClick"])),[[M,"topmenu_setting"]])]),_:1})]),_:1})]),source:t(({row:o})=>[e(pe,{name:o.source},null,8,["name"])]),op:t(o=>[k((v(),N("a",{class:"t-button-link",onClick:ae=>K(o,"view")},[_("查看")],8,$e)),[[M,"topmenu_view"]]),k((v(),N("a",{class:"t-button-link",onClick:ae=>K(o,"edit")},[_("编辑")],8,qe)),[[M,"topmenu_edit"]]),k((v(),N("a",{class:"t-button-link",onClick:ae=>c(o)},[_("删除")],8,Be)),[[M,"topmenu_delete"]])]),_:1},8,["data","columns","loading","pagination","selected-row-keys","header-affixed-top"]),e(te,{visible:y.value,"onUpdate:visible":n[3]||(n[3]=o=>y.value=o),header:"确认删除当前所选数据？","on-cancel":W,onConfirm:Q},null,8,["visible"]),e(Re,{visible:f.value,"onUpdate:visible":n[4]||(n[4]=o=>f.value=o),editId:u.value,"onUpdate:editId":n[5]||(n[5]=o=>u.value=o),actionType:T.value,"onUpdate:actionType":n[6]||(n[6]=o=>T.value=o),onSubmit:m(a)},null,8,["visible","editId","actionType","onSubmit"]),e(te,{visible:U.value,"onUpdate:visible":n[9]||(n[9]=o=>U.value=o),header:"下级菜单配置",onCancel:de,onConfirm:m(ce)},{default:t(()=>[e(fe,{modelValue:s.value,"onUpdate:modelValue":n[7]||(n[7]=o=>s.value=o),expanded:E.value,"onUpdate:expanded":n[8]||(n[8]=o=>E.value=o),data:Y.value,hover:"",keys:{value:"id",label:"title"},checkable:!0},null,8,["modelValue","expanded","data"])]),_:1},8,["visible","onConfirm"])])],2)}}});export{He as default};
