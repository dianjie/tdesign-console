import{a1 as k,d as le,r as i,C as oe,ax as ne,av as X,e as n,f as v,g as S,w as t,m as ae,l as e,q as se,j as c,i as j,F as ge,H as Ce,n as ie,J as E,p as g,K as ye,M as T,_ as re,a as Fe,aG as De}from"./index.c2521a03.js";import{u as he}from"./useDesign.9d0ca2bc.js";import{u as we}from"./useSetting.65510119.js";import{u as Ee}from"./useRequset.5f7a0394.js";import{m as ke}from"./manifest.d091b73e.js";import{u as $}from"./index.d71d3bee.js";const Ve=(r,f,_)=>k.get({url:"/blade-system/topmenu/list",params:{..._,current:r,size:f}},{joinTime:!1}),xe=r=>k.get({url:"/blade-system/topmenu/detail",params:{id:r}}),Be=r=>k.post({url:"/blade-system/topmenu/remove",params:{ids:r}},{joinParamsToUrl:!0,errorMessageMode:"message"}),Te=r=>k.post({url:"/blade-system/topmenu/submit",data:r}),Se=()=>k.get({url:"blade-system/menu/grant-top-tree"}),Ie=r=>k.get({url:"blade-system/menu/top-tree-keys",params:{topMenuIds:r}}),Ue=(r,f)=>k.post({url:"blade-system/topmenu/grant",data:{topMenuIds:r,menuIds:f}}),Me=le({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","submit"],setup(r,{emit:f}){const _=r,K={name:"",source:null,code:"",sort:void 0},N=i({name:[{required:!0,message:"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0",type:"error",trigger:"blur"}],source:[{required:!0,message:"\u8BF7\u9009\u62E9\u83DC\u5355\u56FE\u6807",type:"error",trigger:"change"}],code:[{required:!0,message:"\u8BF7\u8F93\u5165\u83DC\u5355\u7F16\u53F7",type:"error",trigger:"blur"}],sort:[{required:!0,message:"\u8BF7\u8F93\u5165\u83DC\u5355\u6392\u5E8F",type:"error",trigger:"blur"}]}),p=oe(()=>`${{view:"\u67E5\u770B",edit:"\u7F16\u8F91",add:"\u65B0\u589E"}[_.actionType]||""}\u9876\u90E8\u83DC\u5355`),C=oe(()=>({view:!0,edit:!1})[_.actionType]||!1),y=i(ke),b=i(!1),s=i({...K}),V=i(null),x=i(!1),z=({firstError:m})=>{if(m)T.warning(m);else{x.value=!0;const a={...s.value,id:_.editId};Te(a).then(()=>{f("submit",a),T.success("\u63D0\u4EA4\u6210\u529F"),b.value=!1}).finally(()=>{x.value=!1})}},I=()=>{s.value={...K},X(()=>{f("update:editId",""),f("update:actionType","")})},O=()=>{b.value=!1};return ne(()=>b.value,m=>{f("update:visible",m)}),ne(()=>_.visible,m=>{m&&_.editId&&X(()=>{xe(_.editId).then(a=>{s.value={...a}})}),X(()=>{var a;(a=V.value)==null||a.clearValidate()}),b.value=m}),(m,a)=>{const F=n("t-input"),h=n("t-form-item"),w=n("t-col"),G=n("t-icon"),R=n("t-option"),H=n("t-select"),U=n("t-input-number"),D=n("t-button"),q=n("t-row"),P=n("t-form"),J=n("t-dialog");return v(),S(J,{visible:b.value,"onUpdate:visible":a[4]||(a[4]=l=>b.value=l),header:c(p),width:780,footer:!1,onClosed:I},{body:t(()=>[ae(" \u8868\u5355\u5185\u5BB9 "),e(P,{ref_key:"form",ref:V,class:se({"xy-form__detail":r.actionType==="view"}),data:s.value,rules:N.value,"label-width":100,disabled:c(C)||x.value,onSubmit:z},{default:t(()=>[e(q,{gutter:[0,28]},{default:t(()=>[e(w,{span:6},{default:t(()=>[e(h,{label:"\u83DC\u5355\u540D\u79F0",name:"name"},{default:t(()=>[e(F,{modelValue:s.value.name,"onUpdate:modelValue":a[0]||(a[0]=l=>s.value.name=l),placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u540D\u79F0",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:6},{default:t(()=>[e(h,{label:"\u83DC\u5355\u56FE\u6807",name:"source"},{default:t(()=>[e(H,{modelValue:s.value.source,"onUpdate:modelValue":a[1]||(a[1]=l=>s.value.source=l),placeholder:"\u8BF7\u9009\u62E9\u83DC\u5355\u56FE\u6807",clearable:"","popup-props":{overlayStyle:{width:"350px"},overlayInnerStyle:{width:"350px"}}},{prefixIcon:t(()=>[s.value.source?(v(),S(G,{key:0,name:s.value.source,style:{marginRight:"8px"}},null,8,["name"])):ae("v-if",!0)]),default:t(()=>[(v(!0),j(ge,null,Ce(y.value,l=>(v(),S(R,{key:l.stem,value:l.stem,label:l.stem,style:{display:"inline-block","font-size":"20px"}},{default:t(()=>[ie("div",null,[e(G,{name:l.stem},null,8,["name"])])]),_:2},1032,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(w,{span:6},{default:t(()=>[e(h,{label:"\u83DC\u5355\u7F16\u53F7",name:"code"},{default:t(()=>[e(F,{modelValue:s.value.code,"onUpdate:modelValue":a[2]||(a[2]=l=>s.value.code=l),theme:"column",placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u7F16\u53F7",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:6},{default:t(()=>[e(h,{label:"\u83DC\u5355\u6392\u5E8F",name:"sort"},{default:t(()=>[e(U,{modelValue:s.value.sort,"onUpdate:modelValue":a[3]||(a[3]=l=>s.value.sort=l),theme:"column",placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u6392\u5E8F",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),E(e(w,{span:12},{default:t(()=>[e(h,{style:{float:"right"}},{default:t(()=>[e(D,{variant:"outline",onClick:O},{default:t(()=>[g("\u53D6\u6D88")]),_:1}),e(D,{theme:"primary",type:"submit"},{default:t(()=>[g("\u786E\u5B9A")]),_:1})]),_:1})]),_:1},512),[[ye,!c(C)]])]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),Ae=re(Me,[["__file","D:/Study/tdesign-console/src/viewsBusiness/system/components/topmenu/DialogForm.vue"]]),Le=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"\u5E8F\u53F7",width:80,align:"center",fixed:"left"},{colKey:"name",title:"\u83DC\u5355\u540D"},{colKey:"source",title:"\u83DC\u5355\u56FE\u6807"},{colKey:"code",title:"\u83DC\u5355\u7F16\u53F7"},{colKey:"sort",title:"\u83DC\u5355\u6392\u5E8F"},{fixed:"right",width:180,colKey:"op",title:"\u64CD\u4F5C",align:"center"}],je={class:"table-wrapper"},Ke=["onClick"],Re=["onClick"],qe=["onClick"],$e=le({__name:"topmenu",setup(r){const{tableVar:f}=he(),{getTableHeaderAffixedTop:_,getLayoutContainer:K}=we(),N={name:"",code:""},p=i([]),C=i({...N}),y=i(!1),b=i(!1),s=i(""),V=i(""),{fetchData:x,data:z,pagination:I,dataLoading:O}=Ee(Ve,C.value,()=>{p.value=[]});Fe(()=>{x()});const m=({row:d},o)=>{s.value=d.id,V.value=o,b.value=!0},a=({row:d})=>{U.value=d.id,D.value="one",y.value=!0},F=$(()=>{x()},300),h=d=>{p.value=d},w=d=>{I.value={...I.value,current:d.current||1,pageSize:d.pageSize},F()},R=$(async d=>{try{await Be(d),y.value=!1,T.success("\u5220\u9664\u6210\u529F"),q(),F()}catch{y.value=!1}},300),H=()=>{!p.value.length||(D.value="check",y.value=!0)},U=i(-1),D=i(),q=()=>{U.value=-1,D.value=""},P=()=>{D.value==="check"&&R(p.value),D.value==="one"&&R([`${U.value}`])},J=()=>{q()},l=i(!1),M=i([]),Y=i([]),Q=i([]),de=$(()=>{if(!p.value.length){T.warning("\u81F3\u5C11\u9009\u62E9\u4E00\u6761\u6570\u636E");return}if(p.value.length!==1){T.warning("\u53EA\u80FD\u9009\u62E9\u4E00\u6761\u6570\u636E");return}M.value=[],Se().then(d=>(Y.value=d.menu,Ie(p.value.join()))).then(d=>{M.value=d.menu,l.value=!0})},300),ce=()=>{Ue(p.value,M.value).then(()=>{l.value=!1,T.success("\u64CD\u4F5C\u6210\u529F")})},me=()=>{Q.value=[]},pe=$(ce,300);return(d,o)=>{const Z=n("t-input"),ee=n("t-form-item"),A=n("t-col"),W=n("t-row"),L=n("t-button"),ve=n("t-form"),fe=n("t-icon"),_e=n("t-table"),te=n("t-dialog"),be=n("t-tree"),B=De("auth");return v(),j("div",{class:se(c(f))},[e(ve,{ref:"form",data:C.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:c(F),onSubmit:c(F)},{default:t(()=>[e(W,null,{default:t(()=>[e(A,{span:10},{default:t(()=>[e(W,{gutter:[16,24]},{default:t(()=>[e(A,{span:4},{default:t(()=>[e(ee,{label:"\u83DC\u5355\u540D",name:"name"},{default:t(()=>[e(Z,{modelValue:C.value.name,"onUpdate:modelValue":o[0]||(o[0]=u=>C.value.name=u),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u540D"},null,8,["modelValue"])]),_:1})]),_:1}),e(A,{span:4},{default:t(()=>[e(ee,{label:"\u83DC\u5355\u7F16\u53F7",name:"code"},{default:t(()=>[e(Z,{modelValue:C.value.code,"onUpdate:modelValue":o[1]||(o[1]=u=>C.value.code=u),clearable:"",placeholder:"\u8BF7\u8F93\u5165\u83DC\u5355\u7F16\u53F7"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(A,{span:2,class:"operation-wrapper"},{default:t(()=>[e(L,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[g(" \u67E5\u8BE2 ")]),_:1}),e(L,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[g(" \u91CD\u7F6E ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),ie("div",je,[e(_e,{data:c(z),columns:c(Le),hover:!0,loading:c(O),pagination:c(I),"selected-row-keys":p.value,"header-affixed-top":{offsetTop:c(_),container:c(K)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:w,onSelectChange:h},{"top-content":t(()=>[e(W,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(A,{flex:"0 0 auto"},{default:t(()=>[E((v(),S(L,{onClick:o[2]||(o[2]=u=>m({row:{}},"add"))},{default:t(()=>[g("\u65B0\u589E")]),_:1})),[[B,"topmenu_add"]]),E((v(),S(L,{theme:"danger",onClick:H},{default:t(()=>[g("\u5220\u9664")]),_:1})),[[B,"topmenu_delete"]]),E((v(),S(L,{variant:"outline",onClick:c(de)},{default:t(()=>[g("\u83DC\u5355\u914D\u7F6E")]),_:1},8,["onClick"])),[[B,"topmenu_setting"]])]),_:1})]),_:1})]),source:t(({row:u})=>[e(fe,{name:u.source},null,8,["name"])]),op:t(u=>[E((v(),j("a",{class:"t-button-link",onClick:ue=>m(u,"view")},[g("\u67E5\u770B")],8,Ke)),[[B,"topmenu_view"]]),E((v(),j("a",{class:"t-button-link",onClick:ue=>m(u,"edit")},[g("\u7F16\u8F91")],8,Re)),[[B,"topmenu_edit"]]),E((v(),j("a",{class:"t-button-link",onClick:ue=>a(u)},[g("\u5220\u9664")],8,qe)),[[B,"topmenu_delete"]])]),_:1},8,["data","columns","loading","pagination","selected-row-keys","header-affixed-top"]),e(te,{visible:y.value,"onUpdate:visible":o[3]||(o[3]=u=>y.value=u),header:"\u786E\u8BA4\u5220\u9664\u5F53\u524D\u6240\u9009\u6570\u636E\uFF1F","on-cancel":J,onConfirm:P},null,8,["visible"]),e(Ae,{visible:b.value,"onUpdate:visible":o[4]||(o[4]=u=>b.value=u),editId:s.value,"onUpdate:editId":o[5]||(o[5]=u=>s.value=u),actionType:V.value,"onUpdate:actionType":o[6]||(o[6]=u=>V.value=u),onSubmit:c(F)},null,8,["visible","editId","actionType","onSubmit"]),e(te,{visible:l.value,"onUpdate:visible":o[9]||(o[9]=u=>l.value=u),header:"\u4E0B\u7EA7\u83DC\u5355\u914D\u7F6E",onCancel:me,onConfirm:c(pe)},{default:t(()=>[e(be,{modelValue:M.value,"onUpdate:modelValue":o[7]||(o[7]=u=>M.value=u),expanded:Q.value,"onUpdate:expanded":o[8]||(o[8]=u=>Q.value=u),data:Y.value,hover:"",keys:{value:"id",label:"title"},checkable:!0},null,8,["modelValue","expanded","data"])]),_:1},8,["visible","onConfirm"])])],2)}}}),Qe=re($e,[["__file","D:/Study/tdesign-console/src/views/system/topmenu.vue"]]);export{Qe as default};
