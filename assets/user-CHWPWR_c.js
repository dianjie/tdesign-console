import{a as Oe,b as $e}from"./dept-Ciu_4XbM.js";import{d as le,J as be,f as u,av as _e,a2 as H,Q as G,b1 as ge,ad as ye,r as s,o as U,m as B,w as t,a as e,s as Ie,e as te,b as d,p as ee,W as X,q as k,X as Pe,M as R,ao as Ve,ap as we,b2 as je,b3 as Me,_ as ze,b4 as Ee,b5 as Ge,b6 as He,b7 as Je,b8 as Qe,b9 as ke,at as We,aw as Xe,ax as Ye,as as Ze,az as et,c as me,ab as ce,ba as tt,bb as lt,bc as at,bd as ot}from"./index-CqGaQ7t4.js";import{u as nt}from"./useSetting-CnYQd1RY.js";import{u as st}from"./useDesign-CbWcZHFZ.js";import{u as Ce}from"./useRequset-Bj5fiv5N.js";import{C as ut,d as xe}from"./download-BmLFIQ0n.js";import{b as it}from"./post-BzkjQPjB.js";import{a as Te}from"./role-FMd1SLvK.js";import{g as dt}from"./tenant-BajJal67.js";import{u as F}from"./index-BidCcHov.js";const rt=le({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","submit"],setup(P,{emit:j}){const S={tenantId:"",account:"",userType:"",password:"",password2:"",name:"",realName:"",phone:"",email:"",sex:"",birthday:"",code:"",roleId:[],deptId:[],postId:[]},I=P,q=be(()=>`${{view:"查看",edit:"编辑",add:"新增"}[I.actionType]||""}用户`),f=be(()=>({view:!0,edit:!1})[I.actionType]||!1),n=u(!1),o=u({...S}),v=u(null),C=u(!1),h=u([]),N=u([]),K=u([]),x=u([]),r=u([]),V=_e("userTypeOptions")||[],T=j,p=u({tenantId:[{required:!0,message:"请选择所属租户",type:"error",trigger:"blur"}],account:[{required:!0,message:"请输入登录账号",type:"error",trigger:"blur"}],userType:[{required:!0,message:"请选择用户平台",type:"error",trigger:"change"}],password:[{required:!0,message:"请输入密码",type:"error",trigger:"blur"}],password2:[{required:!0,message:"请输入确认密码",type:"error",trigger:"blur"},{validator:b=>new Promise(l=>{l(o.value.password===b)}),message:"两次密码不一致",trigger:"blur"}],name:[{required:!0,message:"请输入用户昵称",type:"error",trigger:"blur"}],realName:[{required:!0,message:"请输入用户姓名",type:"error",trigger:"blur"}],roleId:[{required:!0,message:"请选择所属角色",type:"error",trigger:"change"}],deptId:[{required:!0,message:"请选择所属部门",type:"error",trigger:"change"}],postId:[{required:!0,message:"请选择所属岗位",type:"error",trigger:"change"}]}),i=({firstError:b})=>{if(b)R.warning(b);else{C.value=!0;const{deptId:l,roleId:D,postId:_}=d(o),m={...o.value,deptId:l.join(","),roleId:D.join(","),postId:_.join(","),id:I.editId},J={edit:je,add:Me}[I.actionType];J(m).then(()=>{T("submit",m),R.success("提交成功"),n.value=!1}).finally(()=>{C.value=!1})}},O=()=>{o.value={...S},$(""),G(()=>{T("update:editId",""),T("update:actionType","")})},A=()=>{n.value=!1};H(()=>n.value,b=>{T("update:visible",b)}),H(()=>I.visible,b=>{b&&I.editId&&G(()=>{ge(I.editId).then(l=>{o.value={...l,deptId:l.deptId.split(","),roleId:l.roleId.split(","),postId:l.postId.split(",")},$(l.tenantId)})}),G(()=>{var l;(l=v.value)==null||l.clearValidate()}),n.value=b});async function w(){const b=await dt(),l=await Ve("sex");h.value=b,N.value=we(l)}ye(()=>{w()});function $(b){if(!b){K.value=[],x.value=[],r.value=[];return}Te(b).then(l=>{K.value=l}),Oe(b).then(l=>{x.value=l}),it(b).then(l=>{r.value=l})}const M=F(b=>{$(b),o.value={...o.value,roleId:[],deptId:[],postId:[]}},300);return(b,l)=>{const D=s("t-select"),_=s("t-form-item"),m=s("t-col"),z=s("t-input"),J=s("t-row"),se=s("t-date-picker"),Z=s("t-tree-select"),Q=s("t-button"),oe=s("t-form"),ue=s("t-dialog");return U(),B(ue,{visible:n.value,"onUpdate:visible":l[15]||(l[15]=c=>n.value=c),header:q.value,width:780,footer:!1,onClosed:O},{body:t(()=>[e(oe,{ref_key:"form",ref:v,class:Ie({"xy-form__detail":P.actionType==="view"}),data:o.value,rules:p.value,"label-width":100,disabled:f.value||C.value,onSubmit:i},{default:t(()=>[l[18]||(l[18]=te("div",{class:"form-basic-container-title"},"基础信息",-1)),e(J,{gutter:[0,28]},{default:t(()=>[e(m,{span:12},{default:t(()=>[e(_,{label:"所属租户",name:"tenantId"},{default:t(()=>[e(D,{modelValue:o.value.tenantId,"onUpdate:modelValue":l[0]||(l[0]=c=>o.value.tenantId=c),options:h.value,keys:{value:"tenantId",label:"tenantName"},clearable:"",placeholder:"请选择所属租户",onChange:d(M)},null,8,["modelValue","options","onChange"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(_,{label:"登录账号",name:"account"},{default:t(()=>[e(z,{modelValue:o.value.account,"onUpdate:modelValue":l[1]||(l[1]=c=>o.value.account=c),placeholder:"请输入登录账号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(_,{label:"用户平台",name:"userType"},{default:t(()=>[e(D,{modelValue:o.value.userType,"onUpdate:modelValue":l[2]||(l[2]=c=>o.value.userType=c),options:d(V),keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择用户平台"},null,8,["modelValue","options"])]),_:1})]),_:1}),I.actionType==="add"?(U(),B(m,{key:0,span:6},{default:t(()=>[e(_,{label:"密码",name:"password"},{default:t(()=>[e(z,{modelValue:o.value.password,"onUpdate:modelValue":l[3]||(l[3]=c=>o.value.password=c),placeholder:"请输入密码",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})):ee("",!0),I.actionType==="add"?(U(),B(m,{key:1,span:6},{default:t(()=>[e(_,{label:"确认密码",name:"password2"},{default:t(()=>[e(z,{modelValue:o.value.password2,"onUpdate:modelValue":l[4]||(l[4]=c=>o.value.password2=c),placeholder:"请输入确认密码",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})):ee("",!0)]),_:1}),l[19]||(l[19]=te("div",{class:"form-basic-container-title"},"详细信息",-1)),e(J,{gutter:[0,28]},{default:t(()=>[e(m,{span:6},{default:t(()=>[e(_,{label:"用户昵称",name:"name"},{default:t(()=>[e(z,{modelValue:o.value.name,"onUpdate:modelValue":l[5]||(l[5]=c=>o.value.name=c),placeholder:"请输入用户昵称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(_,{label:"用户姓名",name:"realName"},{default:t(()=>[e(z,{modelValue:o.value.realName,"onUpdate:modelValue":l[6]||(l[6]=c=>o.value.realName=c),placeholder:"请输入用户姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(_,{label:"手机号码",name:"phone"},{default:t(()=>[e(z,{modelValue:o.value.phone,"onUpdate:modelValue":l[7]||(l[7]=c=>o.value.phone=c),placeholder:"请输入手机号码",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(_,{label:"电子邮箱",name:"email"},{default:t(()=>[e(z,{modelValue:o.value.email,"onUpdate:modelValue":l[8]||(l[8]=c=>o.value.email=c),placeholder:"请输入电子邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(_,{label:"用户性别",name:"sex"},{default:t(()=>[e(D,{modelValue:o.value.sex,"onUpdate:modelValue":l[9]||(l[9]=c=>o.value.sex=c),options:N.value,keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择用户性别"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(_,{label:"用户生日",name:"birthday"},{default:t(()=>[e(se,{modelValue:o.value.birthday,"onUpdate:modelValue":l[10]||(l[10]=c=>o.value.birthday=c),style:{width:"100%"},placeholder:"请选择用户生日",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l[20]||(l[20]=te("div",{class:"form-basic-container-title"},"职责信息",-1)),e(J,{gutter:[0,28]},{default:t(()=>[e(m,{span:6},{default:t(()=>[e(_,{label:"用户编号",name:"code"},{default:t(()=>[e(z,{modelValue:o.value.code,"onUpdate:modelValue":l[11]||(l[11]=c=>o.value.code=c),placeholder:"请输入用户编号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(_,{label:"所属角色",name:"roleId"},{default:t(()=>[e(Z,{modelValue:o.value.roleId,"onUpdate:modelValue":l[12]||(l[12]=c=>o.value.roleId=c),data:K.value,"tree-props":{keys:{value:"id",label:"title"},valueMode:"all",checkStrictly:!0},multiple:"",clearable:""},null,8,["modelValue","data"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(_,{label:"所属部门",name:"deptId"},{default:t(()=>[e(Z,{modelValue:o.value.deptId,"onUpdate:modelValue":l[13]||(l[13]=c=>o.value.deptId=c),data:x.value,"tree-props":{keys:{value:"id",label:"title"},valueMode:"all",checkStrictly:!0},multiple:"",clearable:""},null,8,["modelValue","data"])]),_:1})]),_:1}),e(m,{span:6},{default:t(()=>[e(_,{label:"所属岗位",name:"postId"},{default:t(()=>[e(D,{modelValue:o.value.postId,"onUpdate:modelValue":l[14]||(l[14]=c=>o.value.postId=c),options:r.value,keys:{value:"id",label:"postName"},multiple:"",clearable:""},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1}),X(e(_,{style:{float:"right","margin-top":"25px"}},{default:t(()=>[e(Q,{variant:"outline",onClick:A},{default:t(()=>l[16]||(l[16]=[k("取消")])),_:1}),e(Q,{theme:"primary",type:"submit"},{default:t(()=>l[17]||(l[17]=[k("确定")])),_:1})]),_:1},512),[[Pe,!f.value]])]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),pt=ze(rt,[["__scopeId","data-v-80ccc2aa"]]),mt=le({__name:"DialogImport",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","submit"],setup(P,{emit:j}){const S={excelFile:[],isCovered:0},I=P,q=u({excelFile:[{required:!0,message:"请选择模板",type:"error",trigger:"change"}],isCovered:[{required:!0,message:"请选择数据覆盖",type:"error",trigger:"change"}]}),f=u(!1),n=u({...S}),o=u(null),v=u(!1),C=u(),h=j,N=F(({firstError:p})=>{p?R.warning(p):(v.value=!0,C.value.uploadFiles())},300),K=()=>{n.value={...S}},x=()=>{f.value=!1};H(()=>f.value,p=>{h("update:visible",p)}),H(()=>I.visible,p=>{G(()=>{var i;(i=o.value)==null||i.clearValidate()}),f.value=p});const r=({file:p})=>{R.error(`文件 ${p.name} 导入失败`),v.value=!1},V=async p=>{try{const{isCovered:i}=d(n);return{status:"success",response:{...await Ee(i,{file:p.raw}),url:"success"}}}catch{return{status:"fail",error:"导入失败"}}},T=()=>{h("submit",{}),R.success("导入成功"),f.value=!1,v.value=!1},L=F(()=>{Ge().then(p=>{xe(p,"用户数据模板.xlsx")})},300);return(p,i)=>{const O=s("t-upload"),A=s("t-form-item"),w=s("t-col"),$=s("t-switch"),M=s("t-button"),b=s("t-row"),l=s("t-form"),D=s("t-dialog");return U(),B(D,{visible:f.value,"onUpdate:visible":i[2]||(i[2]=_=>f.value=_),header:"用户数据导入",width:780,footer:!1,onClosed:K},{body:t(()=>[e(l,{ref_key:"form",ref:o,data:n.value,rules:q.value,"label-width":100,disabled:v.value,onSubmit:d(N)},{default:t(()=>[e(b,{gutter:[0,28]},{default:t(()=>[e(w,{span:12},{default:t(()=>[e(A,{label:"模板上传",name:"excelFile"},{default:t(()=>[e(O,{ref_key:"uploadRef",ref:C,modelValue:n.value.excelFile,"onUpdate:modelValue":i[0]||(i[0]=_=>n.value.excelFile=_),"auto-upload":!1,accept:".xlsx, .xls, .csv","request-method":V,disabled:v.value,onFail:r,onSuccess:T},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(w,{span:12},{default:t(()=>[e(A,{label:"数据覆盖",name:"isCovered"},{default:t(()=>[e($,{modelValue:n.value.isCovered,"onUpdate:modelValue":i[1]||(i[1]=_=>n.value.isCovered=_),"custom-value":[1,0]},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:12},{default:t(()=>[e(A,{label:"下载模板",name:"exportTemplate"},{default:t(()=>[e(M,{theme:"primary",onClick:d(L)},{icon:t(()=>[e(d(ut))]),default:t(()=>[i[3]||(i[3]=k(" 下载模板 "))]),_:1},8,["onClick"])]),_:1})]),_:1}),e(w,{span:12},{default:t(()=>[e(A,{style:{float:"right"}},{default:t(()=>[e(M,{variant:"outline",onClick:x},{default:t(()=>i[4]||(i[4]=[k("取消")])),_:1}),e(M,{theme:"primary",disabled:v.value,type:"submit"},{default:t(()=>i[5]||(i[5]=[k("确定")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled","onSubmit"])]),_:1},8,["visible"])}}}),ct=le({__name:"DialogRole",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},tenantId:{type:String,default:""}},emits:["update:visible","update:editId","submit"],setup(P,{emit:j}){const S={roleId:[]},I=P,q=u({roleId:[{required:!0,message:"请选择所属角色",type:"error",trigger:"change"}]}),f=u(!1),n=u({...S}),o=u(null),v=u(!1),C=u([]),h=j,N=({firstError:r})=>{r?R.warning(r):(v.value=!0,He(I.editId,n.value.roleId).then(()=>{h("submit",{}),R.success("提交成功"),f.value=!1}).finally(()=>{v.value=!1}))},K=()=>{n.value={...S},G(()=>{h("update:editId","")})},x=()=>{f.value=!1};return H(()=>f.value,r=>{h("update:visible",r)}),H(()=>I.visible,r=>{r&&I.editId&&(Te(I.tenantId).then(V=>{C.value=V}),G(()=>{I.editId.split(",").length===1?ge(I.editId).then(V=>{n.value={roleId:V.roleId.split(",")}}):n.value={...S}})),G(()=>{var V;(V=o.value)==null||V.clearValidate()}),f.value=r}),(r,V)=>{const T=s("t-tree-select"),L=s("t-form-item"),p=s("t-col"),i=s("t-button"),O=s("t-row"),A=s("t-form"),w=s("t-dialog");return U(),B(w,{visible:f.value,"onUpdate:visible":V[1]||(V[1]=$=>f.value=$),header:"租户授权配置",width:480,footer:!1,onClosed:K},{body:t(()=>[e(A,{ref_key:"form",ref:o,data:n.value,rules:q.value,"label-width":100,disabled:v.value,onSubmit:N},{default:t(()=>[e(O,{gutter:[0,28]},{default:t(()=>[e(p,{span:12},{default:t(()=>[e(L,{label:"所属角色",name:"roleId"},{default:t(()=>[e(T,{modelValue:n.value.roleId,"onUpdate:modelValue":V[0]||(V[0]=$=>n.value.roleId=$),data:C.value,"tree-props":{keys:{value:"id",label:"title"},valueMode:"all",checkStrictly:!0},multiple:"",clearable:""},null,8,["modelValue","data"])]),_:1})]),_:1}),e(p,{span:12},{default:t(()=>[e(L,{style:{float:"right"}},{default:t(()=>[e(i,{variant:"outline",onClick:x},{default:t(()=>V[2]||(V[2]=[k("取消")])),_:1}),e(i,{theme:"primary",type:"submit"},{default:t(()=>V[3]||(V[3]=[k("确定")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled"])]),_:1},8,["visible"])}}}),vt=[{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"登录账号",colKey:"account"},{title:"所属租户",colKey:"tenantName"},{title:"用户姓名",colKey:"realName"},{title:"用户平台",colKey:"userTypeName"},{fixed:"right",width:180,colKey:"op",title:"操作",align:"center"}],ft=le({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""}},emits:["update:visible","update:editId","submit"],setup(P,{emit:j}){const S={userExt:"",userType:""},I=P,q=u({}),f=u(!1),n=u({...S}),o=u(null),v=u(!1),C=j,h=({firstError:x})=>{if(x)R.warning(x);else{v.value=!0;const r={...n.value,userId:I.editId};Qe(r).then(()=>{C("submit",r),R.success("提交成功"),f.value=!1}).finally(()=>{v.value=!1})}},N=()=>{n.value={...S},G(()=>{C("update:editId","")})},K=()=>{f.value=!1};return H(()=>f.value,x=>{C("update:visible",x)}),H(()=>I.visible,x=>{x&&I.editId&&G(()=>{Je(I.editId).then(r=>{n.value={userExt:r.userExt,userType:r.userType}})}),G(()=>{var r;(r=o.value)==null||r.clearValidate()}),f.value=x}),(x,r)=>{const V=s("t-textarea"),T=s("t-form-item"),L=s("t-col"),p=s("t-button"),i=s("t-row"),O=s("t-form"),A=s("t-dialog");return U(),B(A,{visible:f.value,"onUpdate:visible":r[1]||(r[1]=w=>f.value=w),header:"用户拓展编辑",width:1080,footer:!1,onClosed:N},{body:t(()=>[e(O,{ref_key:"form",ref:o,data:n.value,rules:q.value,"label-width":100,disabled:v.value,onSubmit:h},{default:t(()=>[e(i,{gutter:[0,28]},{default:t(()=>[e(L,{span:12},{default:t(()=>[e(T,{label:"用户拓展",name:"userExt"},{default:t(()=>[e(V,{modelValue:n.value.userExt,"onUpdate:modelValue":r[0]||(r[0]=w=>n.value.userExt=w),theme:"column",placeholder:"请输入用户拓展",clearable:"",autosize:{minRows:5}},null,8,["modelValue"])]),_:1})]),_:1}),e(L,{span:12},{default:t(()=>[e(T,{style:{float:"right"}},{default:t(()=>[e(p,{variant:"outline",onClick:K},{default:t(()=>r[2]||(r[2]=[k("取消")])),_:1}),e(p,{theme:"primary",type:"submit"},{default:t(()=>r[3]||(r[3]=[k("确定")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled"])]),_:1},8,["visible"])}}}),bt={class:"table-wrapper"},_t=["onClick"],gt=le({__name:"DialogList",props:{visible:{type:Boolean,default:!1},deptId:{type:String,default:""}},emits:["update:visible"],setup(P,{emit:j}){const S=P,I=j,q={account:"",realName:"",userType:""},f=u(!1),n=u({...q}),o=u(!1),v=u(""),C=_e("userTypeOptions")||[],{fetchData:h,data:N,pagination:K,dataLoading:x}=Ce(ke,n.value,We),r=()=>{h({...n.value,deptId:S.deptId})},V=({row:p})=>{v.value=p.id,o.value=!0},T=F(()=>{r()},300),L=p=>{K.value={...K.value,current:p.current||1,pageSize:p.pageSize},T()};return H(()=>f.value,p=>{I("update:visible",p)}),H(()=>S.visible,p=>{p&&r(),f.value=p}),(p,i)=>{const O=s("t-input"),A=s("t-form-item"),w=s("t-col"),$=s("t-select"),M=s("t-row"),b=s("t-button"),l=s("t-form"),D=s("t-table"),_=s("t-dialog");return U(),B(_,{visible:f.value,"onUpdate:visible":i[5]||(i[5]=m=>f.value=m),header:"用户平台配置",width:980,footer:!1},{default:t(()=>[e(l,{ref:"form",data:n.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:d(T),onSubmit:d(T)},{default:t(()=>[e(M,null,{default:t(()=>[e(w,{span:10},{default:t(()=>[e(M,{gutter:[16,24]},{default:t(()=>[e(w,{span:4},{default:t(()=>[e(A,{label:"登录账号",name:"account"},{default:t(()=>[e(O,{modelValue:n.value.account,"onUpdate:modelValue":i[0]||(i[0]=m=>n.value.account=m),clearable:"",placeholder:"请输入登录账号"},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:4},{default:t(()=>[e(A,{label:"用户姓名",name:"realName"},{default:t(()=>[e(O,{modelValue:n.value.realName,"onUpdate:modelValue":i[1]||(i[1]=m=>n.value.realName=m),clearable:"",placeholder:"请输入用户姓名"},null,8,["modelValue"])]),_:1})]),_:1}),e(w,{span:4},{default:t(()=>[e(A,{label:"用户平台",name:"userType"},{default:t(()=>[e($,{modelValue:n.value.userType,"onUpdate:modelValue":i[2]||(i[2]=m=>n.value.userType=m),options:d(C),keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择用户平台"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1}),e(w,{span:2,class:"operation-wrapper"},{default:t(()=>[e(b,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>i[6]||(i[6]=[k(" 查询 ")])),_:1}),e(b,{type:"reset",variant:"base",theme:"default"},{default:t(()=>i[7]||(i[7]=[k(" 重置 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),te("div",bt,[e(D,{data:d(N),columns:d(vt),hover:!0,loading:d(x),pagination:d(K),"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:L},{op:t(m=>[te("a",{class:"t-button-link",onClick:z=>V(m)},"配置",8,_t)]),_:1},8,["data","columns","loading","pagination"])]),e(ft,{visible:o.value,"onUpdate:visible":i[3]||(i[3]=m=>o.value=m),editId:v.value,"onUpdate:editId":i[4]||(i[4]=m=>v.value=m),onSubmit:d(T)},null,8,["visible","editId","onSubmit"])]),_:1},8,["visible"])}}}),yt=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"登录账号",colKey:"account"},{title:"所属租户",colKey:"tenantName"},{title:"用户姓名",colKey:"realName"},{title:"所属角色",colKey:"roleName"},{title:"所属部门",colKey:"deptName"},{title:"用户平台",colKey:"userTypeName"},{fixed:"right",width:180,colKey:"op",title:"操作",align:"center"}],It={class:"table-wrapper"},Vt=["onClick"],wt=["onClick"],kt=["onClick"],Rt=le({__name:"user",setup(P){const{tableVar:j}=st(),{getTableHeaderAffixedTop:S,getLayoutContainer:I}=nt(),{hasRole:q}=Xe(),f={account:"",realName:"",userType:""},n=u([]),o=u([]),v=u({...f}),C=u(!1),h=u(!1),N=u(""),K=u(""),x=u(""),r=u(null),V=u(""),T=u([]),L=u([]);Ye("userTypeOptions",L);async function p(){const g=await Ve("user_type");L.value=we(g)}const i=F(()=>{r.value=g=>g.label.indexOf(x.value)>=0},350),{fetchData:O,data:A,pagination:w,dataLoading:$}=Ce(ke,{},()=>{n.value=[]}),M=()=>{O({...v.value,deptId:V.value})};ye(()=>{$e({parentId:""}).then(g=>{T.value=g}),M(),p()});const b=({row:g},a)=>{N.value=g.id,K.value=a,h.value=!0},l=({row:g})=>{Z.value=g.id,Q.value="one",C.value=!0},D=F(()=>{M()},300),_=(g,a)=>{n.value=g,o.value=a.selectedRowData},m=g=>{w.value={...w.value,current:g.current||1,pageSize:g.pageSize},D()},J=F(async g=>{try{await ot(g),C.value=!1,R.success("删除成功"),oe(),D()}catch{C.value=!1}},300),se=()=>{n.value.length&&(Q.value="check",C.value=!0)},Z=u(-1),Q=u(),oe=()=>{Z.value=-1,Q.value=""},ue=()=>{Q.value==="check"&&J(n.value),Q.value==="one"&&J([`${Z.value}`])},c=()=>{oe()},De=F(g=>{V.value=g.join(),w.value={...w.value,current:1},D()},300),ie=u(!1),ve=u(""),de=u(!1),re=u(!1),Ue=F(()=>{if(!n.value.length){R.error("至少选择一条数据");return}const g=o.value[0].tenantId;let a=!0;if(n.value.length!==1&&(a=o.value.every(ae=>ae.tenantId===g),!a)){R.error("批量设置，需要勾选相同租户的用户");return}ve.value=g,N.value=n.value.join(","),ie.value=!0},300),Se=F(()=>{if(!n.value.length){R.error("至少选择一条数据");return}const g=ce.confirm({header:"密码重置",theme:"warning",body:"确定将选择账号密码重置为123456?",onConfirm:F(()=>{tt(n.value).then(()=>{R.success("操作成功!"),g.destroy()})},300)})},300),he=F(()=>{de.value=!0},300),Ne=F(()=>{if(!n.value.length){R.error("至少选择一条数据");return}const g=ce.confirm({header:"账号解封",theme:"warning",body:"确定将选择账号解封?",onConfirm:F(()=>{lt(n.value).then(()=>{R.success("操作成功!"),g.destroy()})},300)})},300),Ke=F(()=>{re.value=!0},300),Fe=F(()=>{const g=ce.confirm({header:"账号导出",theme:"info",body:"是否导出用户数据?",onConfirm:F(()=>{at(v.value).then(a=>{xe(a,`用户数据表${+new Date}.xlsx`),R.success("操作成功!"),g.destroy()})},300)})},300);return(g,a)=>{const ae=s("t-input"),Re=s("t-tree"),W=s("t-col"),pe=s("t-form-item"),Ae=s("t-select"),ne=s("t-row"),E=s("t-button"),Be=s("t-form"),qe=s("t-table"),Le=s("t-dialog"),Y=Ze("auth");return U(),B(ne,{class:Ie(d(j)),gutter:[16,24]},{default:t(()=>[e(W,{span:2},{default:t(()=>[e(ae,{modelValue:x.value,"onUpdate:modelValue":a[0]||(a[0]=y=>x.value=y),placeholder:"请输入关键词",clearable:"",onChange:d(i)},{"suffix-icon":t(()=>[e(d(et),{size:"20px"})]),_:1},8,["modelValue","onChange"]),e(Re,{style:{"margin-top":"14px"},data:T.value,hover:"",activable:!0,keys:{value:"id",label:"deptName"},filter:r.value,onActive:d(De)},null,8,["data","filter","onActive"])]),_:1}),e(W,{span:10},{default:t(()=>[e(Be,{ref:"form",data:v.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:d(D),onSubmit:d(D)},{default:t(()=>[e(ne,null,{default:t(()=>[e(W,{span:10},{default:t(()=>[e(ne,{gutter:[16,24]},{default:t(()=>[e(W,{span:4},{default:t(()=>[e(pe,{label:"登录账号",name:"account"},{default:t(()=>[e(ae,{modelValue:v.value.account,"onUpdate:modelValue":a[1]||(a[1]=y=>v.value.account=y),clearable:"",placeholder:"请输入登录账号"},null,8,["modelValue"])]),_:1})]),_:1}),e(W,{span:4},{default:t(()=>[e(pe,{label:"用户姓名",name:"realName"},{default:t(()=>[e(ae,{modelValue:v.value.realName,"onUpdate:modelValue":a[2]||(a[2]=y=>v.value.realName=y),clearable:"",placeholder:"请输入用户姓名"},null,8,["modelValue"])]),_:1})]),_:1}),e(W,{span:4},{default:t(()=>[e(pe,{label:"用户平台",name:"userType"},{default:t(()=>[e(Ae,{modelValue:v.value.userType,"onUpdate:modelValue":a[3]||(a[3]=y=>v.value.userType=y),options:L.value,keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择用户平台"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1}),e(W,{span:2,class:"operation-wrapper"},{default:t(()=>[e(E,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>a[13]||(a[13]=[k(" 查询 ")])),_:1}),e(E,{type:"reset",variant:"base",theme:"default"},{default:t(()=>a[14]||(a[14]=[k(" 重置 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),te("div",It,[e(qe,{data:d(A),columns:d(yt),hover:!0,loading:d($),pagination:d(w),"selected-row-keys":n.value,"header-affixed-top":{offsetTop:d(S),container:d(I)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:m,onSelectChange:_},{"top-content":t(()=>[e(ne,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(W,{flex:"0 0 auto"},{default:t(()=>[X((U(),B(E,{onClick:a[4]||(a[4]=y=>b({row:{}},"add"))},{default:t(()=>a[15]||(a[15]=[k("新增")])),_:1})),[[Y,"user_add"]]),X((U(),B(E,{theme:"danger",onClick:se},{default:t(()=>a[16]||(a[16]=[k("删除")])),_:1})),[[Y,"user_delete"]]),X((U(),B(E,{variant:"outline",onClick:d(Ue)},{default:t(()=>a[17]||(a[17]=[k("角色配置")])),_:1},8,["onClick"])),[[Y,"user_role"]]),X((U(),B(E,{variant:"outline",onClick:d(Se)},{default:t(()=>a[18]||(a[18]=[k("密码重置")])),_:1},8,["onClick"])),[[Y,"user_reset"]]),d(q)(["administrator","admin"])?(U(),B(E,{key:0,variant:"outline",onClick:d(he)},{default:t(()=>a[19]||(a[19]=[k(" 平台配置 ")])),_:1},8,["onClick"])):ee("",!0),d(q)(["administrator","admin"])?(U(),B(E,{key:1,variant:"outline",onClick:d(Ne)},{default:t(()=>a[20]||(a[20]=[k(" 账号解封 ")])),_:1},8,["onClick"])):ee("",!0),d(q)(["administrator","admin"])?(U(),B(E,{key:2,variant:"outline",onClick:d(Ke)},{default:t(()=>a[21]||(a[21]=[k(" 导入 ")])),_:1},8,["onClick"])):ee("",!0),d(q)(["administrator","admin"])?(U(),B(E,{key:3,variant:"outline",onClick:d(Fe)},{default:t(()=>a[22]||(a[22]=[k(" 导出 ")])),_:1},8,["onClick"])):ee("",!0)]),_:1})]),_:1})]),op:t(y=>[X((U(),me("a",{class:"t-button-link",onClick:fe=>b(y,"view")},a[23]||(a[23]=[k("查看")]),8,Vt)),[[Y,"user_view"]]),X((U(),me("a",{class:"t-button-link",onClick:fe=>b(y,"edit")},a[24]||(a[24]=[k("编辑")]),8,wt)),[[Y,"user_edit"]]),X((U(),me("a",{class:"t-button-link",onClick:fe=>l(y)},a[25]||(a[25]=[k("删除")]),8,kt)),[[Y,"user_delete"]])]),_:1},8,["data","columns","loading","pagination","selected-row-keys","header-affixed-top"]),e(Le,{visible:C.value,"onUpdate:visible":a[5]||(a[5]=y=>C.value=y),header:"确认删除当前所选数据？","on-cancel":c,onConfirm:ue},null,8,["visible"]),e(pt,{visible:h.value,"onUpdate:visible":a[6]||(a[6]=y=>h.value=y),editId:N.value,"onUpdate:editId":a[7]||(a[7]=y=>N.value=y),actionType:K.value,"onUpdate:actionType":a[8]||(a[8]=y=>K.value=y),onSubmit:d(D)},null,8,["visible","editId","actionType","onSubmit"]),e(ct,{visible:ie.value,"onUpdate:visible":a[9]||(a[9]=y=>ie.value=y),editId:N.value,"onUpdate:editId":a[10]||(a[10]=y=>N.value=y),"tenant-id":ve.value,onSubmit:d(D)},null,8,["visible","editId","tenant-id","onSubmit"]),e(gt,{visible:de.value,"onUpdate:visible":a[11]||(a[11]=y=>de.value=y),"dept-id":V.value},null,8,["visible","dept-id"]),e(mt,{visible:re.value,"onUpdate:visible":a[12]||(a[12]=y=>re.value=y),onSubmit:d(D)},null,8,["visible","onSubmit"])])]),_:1})]),_:1},8,["class"])}}});export{Rt as default};
