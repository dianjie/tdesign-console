import{a as Oe,b as Pe}from"./dept-1b3abf8a.js";import{d as ae,Q as be,f as s,az as ge,a7 as H,W as G,aZ as ye,ai as Ie,r as n,o as D,m as B,w as t,a as e,s as Ve,b as u,p as ee,$ as J,q as h,a0 as je,M as K,as as he,at as we,x as Me,y as ze,e as te,a_ as Ee,a$ as Ge,_ as He,b0 as Qe,b1 as We,b2 as Ze,b3 as Je,b4 as Xe,b5 as ke,ax as Ye,aA as et,aB as tt,ag as pe,b6 as at,b7 as lt,b8 as ot,aw as nt,aD as st,c as me,b9 as ut}from"./index-357a89bc.js";import{u as it}from"./useSetting-8eb1f197.js";import{u as dt}from"./useDesign-16212514.js";import{u as Ce}from"./useRequset-d4265618.js";import{d as xe,C as rt}from"./download-21c0fcb4.js";import{b as ct}from"./post-af2537e1.js";import{a as Te}from"./role-6aca96ac.js";import{g as pt}from"./tenant-e812739b.js";import{u as F}from"./index-1d3f8cec.js";const ve=R=>(Me("data-v-80ccc2aa"),R=R(),ze(),R),mt=ve(()=>te("div",{class:"form-basic-container-title"},"基础信息",-1)),vt=ve(()=>te("div",{class:"form-basic-container-title"},"详细信息",-1)),ft=ve(()=>te("div",{class:"form-basic-container-title"},"职责信息",-1)),_t=ae({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType","submit"],setup(R,{emit:j}){const U={tenantId:"",account:"",userType:"",password:"",password2:"",name:"",realName:"",phone:"",email:"",sex:"",birthday:"",code:"",roleId:[],deptId:[],postId:[]},I=R,q=be(()=>`${{view:"查看",edit:"编辑",add:"新增"}[I.actionType]||""}用户`),f=be(()=>({view:!0,edit:!1})[I.actionType]||!1),o=s(!1),l=s({...U}),v=s(null),k=s(!1),S=s([]),N=s([]),$=s([]),C=s([]),d=s([]),w=ge("userTypeOptions")||[],x=j,r=s({tenantId:[{required:!0,message:"请选择所属租户",type:"error",trigger:"blur"}],account:[{required:!0,message:"请输入登录账号",type:"error",trigger:"blur"}],userType:[{required:!0,message:"请选择用户平台",type:"error",trigger:"change"}],password:[{required:!0,message:"请输入密码",type:"error",trigger:"blur"}],password2:[{required:!0,message:"请输入确认密码",type:"error",trigger:"blur"},{validator:_=>new Promise(a=>{a(l.value.password===_)}),message:"两次密码不一致",trigger:"blur"}],name:[{required:!0,message:"请输入用户昵称",type:"error",trigger:"blur"}],realName:[{required:!0,message:"请输入用户姓名",type:"error",trigger:"blur"}],roleId:[{required:!0,message:"请选择所属角色",type:"error",trigger:"change"}],deptId:[{required:!0,message:"请选择所属部门",type:"error",trigger:"change"}],postId:[{required:!0,message:"请选择所属岗位",type:"error",trigger:"change"}]}),c=({firstError:_})=>{if(_)K.warning(_);else{k.value=!0;const{deptId:a,roleId:T,postId:b}=u(l),p={...l.value,deptId:a.join(","),roleId:T.join(","),postId:b.join(","),id:I.editId},Q={edit:Ee,add:Ge}[I.actionType];Q(p).then(()=>{x("submit",p),K.success("提交成功"),o.value=!1}).finally(()=>{k.value=!1})}},O=()=>{l.value={...U},P(""),G(()=>{x("update:editId",""),x("update:actionType","")})},A=()=>{o.value=!1};H(()=>o.value,_=>{x("update:visible",_)}),H(()=>I.visible,_=>{_&&I.editId&&G(()=>{ye(I.editId).then(a=>{l.value={...a,deptId:a.deptId.split(","),roleId:a.roleId.split(","),postId:a.postId.split(",")},P(a.tenantId)})}),G(()=>{var a;(a=v.value)==null||a.clearValidate()}),o.value=_});async function V(){const _=await pt(),a=await he("sex");S.value=_,N.value=we(a)}Ie(()=>{V()});function P(_){if(!_){$.value=[],C.value=[],d.value=[];return}Te(_).then(a=>{$.value=a}),Oe(_).then(a=>{C.value=a}),ct(_).then(a=>{d.value=a})}const M=F(_=>{P(_),l.value={...l.value,roleId:[],deptId:[],postId:[]}},300);return(_,a)=>{const T=n("t-select"),b=n("t-form-item"),p=n("t-col"),z=n("t-input"),Q=n("t-row"),se=n("t-date-picker"),Y=n("t-tree-select"),W=n("t-button"),oe=n("t-form"),ue=n("t-dialog");return D(),B(ue,{visible:o.value,"onUpdate:visible":a[15]||(a[15]=m=>o.value=m),header:q.value,width:780,footer:!1,onClosed:O},{body:t(()=>[e(oe,{ref_key:"form",ref:v,class:Ve({"xy-form__detail":R.actionType==="view"}),data:l.value,rules:r.value,"label-width":100,disabled:f.value||k.value,onSubmit:c},{default:t(()=>[mt,e(Q,{gutter:[0,28]},{default:t(()=>[e(p,{span:12},{default:t(()=>[e(b,{label:"所属租户",name:"tenantId"},{default:t(()=>[e(T,{modelValue:l.value.tenantId,"onUpdate:modelValue":a[0]||(a[0]=m=>l.value.tenantId=m),options:S.value,keys:{value:"tenantId",label:"tenantName"},clearable:"",placeholder:"请选择所属租户",onChange:u(M)},null,8,["modelValue","options","onChange"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(b,{label:"登录账号",name:"account"},{default:t(()=>[e(z,{modelValue:l.value.account,"onUpdate:modelValue":a[1]||(a[1]=m=>l.value.account=m),placeholder:"请输入登录账号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(b,{label:"用户平台",name:"userType"},{default:t(()=>[e(T,{modelValue:l.value.userType,"onUpdate:modelValue":a[2]||(a[2]=m=>l.value.userType=m),options:u(w),keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择用户平台"},null,8,["modelValue","options"])]),_:1})]),_:1}),I.actionType==="add"?(D(),B(p,{key:0,span:6},{default:t(()=>[e(b,{label:"密码",name:"password"},{default:t(()=>[e(z,{modelValue:l.value.password,"onUpdate:modelValue":a[3]||(a[3]=m=>l.value.password=m),placeholder:"请输入密码",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})):ee("",!0),I.actionType==="add"?(D(),B(p,{key:1,span:6},{default:t(()=>[e(b,{label:"确认密码",name:"password2"},{default:t(()=>[e(z,{modelValue:l.value.password2,"onUpdate:modelValue":a[4]||(a[4]=m=>l.value.password2=m),placeholder:"请输入确认密码",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})):ee("",!0)]),_:1}),vt,e(Q,{gutter:[0,28]},{default:t(()=>[e(p,{span:6},{default:t(()=>[e(b,{label:"用户昵称",name:"name"},{default:t(()=>[e(z,{modelValue:l.value.name,"onUpdate:modelValue":a[5]||(a[5]=m=>l.value.name=m),placeholder:"请输入用户昵称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(b,{label:"用户姓名",name:"realName"},{default:t(()=>[e(z,{modelValue:l.value.realName,"onUpdate:modelValue":a[6]||(a[6]=m=>l.value.realName=m),placeholder:"请输入用户姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(b,{label:"手机号码",name:"phone"},{default:t(()=>[e(z,{modelValue:l.value.phone,"onUpdate:modelValue":a[7]||(a[7]=m=>l.value.phone=m),placeholder:"请输入手机号码",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(b,{label:"电子邮箱",name:"email"},{default:t(()=>[e(z,{modelValue:l.value.email,"onUpdate:modelValue":a[8]||(a[8]=m=>l.value.email=m),placeholder:"请输入电子邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(b,{label:"用户性别",name:"sex"},{default:t(()=>[e(T,{modelValue:l.value.sex,"onUpdate:modelValue":a[9]||(a[9]=m=>l.value.sex=m),options:N.value,keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择用户性别"},null,8,["modelValue","options"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(b,{label:"用户生日",name:"birthday"},{default:t(()=>[e(se,{modelValue:l.value.birthday,"onUpdate:modelValue":a[10]||(a[10]=m=>l.value.birthday=m),style:{width:"100%"},placeholder:"请选择用户生日",clearable:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),ft,e(Q,{gutter:[0,28]},{default:t(()=>[e(p,{span:6},{default:t(()=>[e(b,{label:"用户编号",name:"code"},{default:t(()=>[e(z,{modelValue:l.value.code,"onUpdate:modelValue":a[11]||(a[11]=m=>l.value.code=m),placeholder:"请输入用户编号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(b,{label:"所属角色",name:"roleId"},{default:t(()=>[e(Y,{modelValue:l.value.roleId,"onUpdate:modelValue":a[12]||(a[12]=m=>l.value.roleId=m),data:$.value,"tree-props":{keys:{value:"id",label:"title"},valueMode:"all",checkStrictly:!0},multiple:"",clearable:""},null,8,["modelValue","data"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(b,{label:"所属部门",name:"deptId"},{default:t(()=>[e(Y,{modelValue:l.value.deptId,"onUpdate:modelValue":a[13]||(a[13]=m=>l.value.deptId=m),data:C.value,"tree-props":{keys:{value:"id",label:"title"},valueMode:"all",checkStrictly:!0},multiple:"",clearable:""},null,8,["modelValue","data"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(b,{label:"所属岗位",name:"postId"},{default:t(()=>[e(T,{modelValue:l.value.postId,"onUpdate:modelValue":a[14]||(a[14]=m=>l.value.postId=m),options:d.value,keys:{value:"id",label:"postName"},multiple:"",clearable:""},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1}),J(e(b,{style:{float:"right","margin-top":"25px"}},{default:t(()=>[e(W,{variant:"outline",onClick:A},{default:t(()=>[h("取消")]),_:1}),e(W,{theme:"primary",type:"submit"},{default:t(()=>[h("确定")]),_:1})]),_:1},512),[[je,!f.value]])]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}});const bt=He(_t,[["__scopeId","data-v-80ccc2aa"]]),gt=ae({__name:"DialogImport",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","submit"],setup(R,{emit:j}){const U={excelFile:[],isCovered:0},I=R,q=s({excelFile:[{required:!0,message:"请选择模板",type:"error",trigger:"change"}],isCovered:[{required:!0,message:"请选择数据覆盖",type:"error",trigger:"change"}]}),f=s(!1),o=s({...U}),l=s(null),v=s(!1),k=s(),S=j,N=F(({firstError:r})=>{r?K.warning(r):(v.value=!0,k.value.uploadFiles())},300),$=()=>{o.value={...U}},C=()=>{f.value=!1};H(()=>f.value,r=>{S("update:visible",r)}),H(()=>I.visible,r=>{G(()=>{var c;(c=l.value)==null||c.clearValidate()}),f.value=r});const d=({file:r})=>{K.error(`文件 ${r.name} 导入失败`),v.value=!1},w=async r=>{try{const{isCovered:c}=u(o);return{status:"success",response:{...await We(c,{file:r.raw}),url:"success"}}}catch{return{status:"fail",error:"导入失败"}}},x=()=>{S("submit",{}),K.success("导入成功"),f.value=!1,v.value=!1},L=F(()=>{Qe().then(r=>{xe(r,"用户数据模板.xlsx")})},300);return(r,c)=>{const O=n("t-upload"),A=n("t-form-item"),V=n("t-col"),P=n("t-switch"),M=n("t-button"),_=n("t-row"),a=n("t-form"),T=n("t-dialog");return D(),B(T,{visible:f.value,"onUpdate:visible":c[2]||(c[2]=b=>f.value=b),header:"用户数据导入",width:780,footer:!1,onClosed:$},{body:t(()=>[e(a,{ref_key:"form",ref:l,data:o.value,rules:q.value,"label-width":100,disabled:v.value,onSubmit:u(N)},{default:t(()=>[e(_,{gutter:[0,28]},{default:t(()=>[e(V,{span:12},{default:t(()=>[e(A,{label:"模板上传",name:"excelFile"},{default:t(()=>[e(O,{ref_key:"uploadRef",ref:k,modelValue:o.value.excelFile,"onUpdate:modelValue":c[0]||(c[0]=b=>o.value.excelFile=b),"auto-upload":!1,accept:".xlsx, .xls, .csv","request-method":w,disabled:v.value,onFail:d,onSuccess:x},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(V,{span:12},{default:t(()=>[e(A,{label:"数据覆盖",name:"isCovered"},{default:t(()=>[e(P,{modelValue:o.value.isCovered,"onUpdate:modelValue":c[1]||(c[1]=b=>o.value.isCovered=b),"custom-value":[1,0]},null,8,["modelValue"])]),_:1})]),_:1}),e(V,{span:12},{default:t(()=>[e(A,{label:"下载模板",name:"exportTemplate"},{default:t(()=>[e(M,{theme:"primary",onClick:u(L)},{icon:t(()=>[e(u(rt))]),default:t(()=>[h(" 下载模板 ")]),_:1},8,["onClick"])]),_:1})]),_:1}),e(V,{span:12},{default:t(()=>[e(A,{style:{float:"right"}},{default:t(()=>[e(M,{variant:"outline",onClick:C},{default:t(()=>[h("取消")]),_:1}),e(M,{theme:"primary",disabled:v.value,type:"submit"},{default:t(()=>[h("确定")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled","onSubmit"])]),_:1},8,["visible"])}}}),yt=ae({__name:"DialogRole",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},tenantId:{type:String,default:""}},emits:["update:visible","update:editId","submit"],setup(R,{emit:j}){const U={roleId:[]},I=R,q=s({roleId:[{required:!0,message:"请选择所属角色",type:"error",trigger:"change"}]}),f=s(!1),o=s({...U}),l=s(null),v=s(!1),k=s([]),S=j,N=({firstError:d})=>{d?K.warning(d):(v.value=!0,Ze(I.editId,o.value.roleId).then(()=>{S("submit",{}),K.success("提交成功"),f.value=!1}).finally(()=>{v.value=!1}))},$=()=>{o.value={...U},G(()=>{S("update:editId","")})},C=()=>{f.value=!1};return H(()=>f.value,d=>{S("update:visible",d)}),H(()=>I.visible,d=>{d&&I.editId&&(Te(I.tenantId).then(w=>{k.value=w}),G(()=>{I.editId.split(",").length===1?ye(I.editId).then(w=>{o.value={roleId:w.roleId.split(",")}}):o.value={...U}})),G(()=>{var w;(w=l.value)==null||w.clearValidate()}),f.value=d}),(d,w)=>{const x=n("t-tree-select"),L=n("t-form-item"),r=n("t-col"),c=n("t-button"),O=n("t-row"),A=n("t-form"),V=n("t-dialog");return D(),B(V,{visible:f.value,"onUpdate:visible":w[1]||(w[1]=P=>f.value=P),header:"租户授权配置",width:480,footer:!1,onClosed:$},{body:t(()=>[e(A,{ref_key:"form",ref:l,data:o.value,rules:q.value,"label-width":100,disabled:v.value,onSubmit:N},{default:t(()=>[e(O,{gutter:[0,28]},{default:t(()=>[e(r,{span:12},{default:t(()=>[e(L,{label:"所属角色",name:"roleId"},{default:t(()=>[e(x,{modelValue:o.value.roleId,"onUpdate:modelValue":w[0]||(w[0]=P=>o.value.roleId=P),data:k.value,"tree-props":{keys:{value:"id",label:"title"},valueMode:"all",checkStrictly:!0},multiple:"",clearable:""},null,8,["modelValue","data"])]),_:1})]),_:1}),e(r,{span:12},{default:t(()=>[e(L,{style:{float:"right"}},{default:t(()=>[e(c,{variant:"outline",onClick:C},{default:t(()=>[h("取消")]),_:1}),e(c,{theme:"primary",type:"submit"},{default:t(()=>[h("确定")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled"])]),_:1},8,["visible"])}}}),It=[{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"登录账号",colKey:"account"},{title:"所属租户",colKey:"tenantName"},{title:"用户姓名",colKey:"realName"},{title:"用户平台",colKey:"userTypeName"},{fixed:"right",width:180,colKey:"op",title:"操作",align:"center"}],Vt=ae({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""}},emits:["update:visible","update:editId","submit"],setup(R,{emit:j}){const U={userExt:"",userType:""},I=R,q=s({}),f=s(!1),o=s({...U}),l=s(null),v=s(!1),k=j,S=({firstError:C})=>{if(C)K.warning(C);else{v.value=!0;const d={...o.value,userId:I.editId};Xe(d).then(()=>{k("submit",d),K.success("提交成功"),f.value=!1}).finally(()=>{v.value=!1})}},N=()=>{o.value={...U},G(()=>{k("update:editId","")})},$=()=>{f.value=!1};return H(()=>f.value,C=>{k("update:visible",C)}),H(()=>I.visible,C=>{C&&I.editId&&G(()=>{Je(I.editId).then(d=>{o.value={userExt:d.userExt,userType:d.userType}})}),G(()=>{var d;(d=l.value)==null||d.clearValidate()}),f.value=C}),(C,d)=>{const w=n("t-textarea"),x=n("t-form-item"),L=n("t-col"),r=n("t-button"),c=n("t-row"),O=n("t-form"),A=n("t-dialog");return D(),B(A,{visible:f.value,"onUpdate:visible":d[1]||(d[1]=V=>f.value=V),header:"用户拓展编辑",width:1080,footer:!1,onClosed:N},{body:t(()=>[e(O,{ref_key:"form",ref:l,data:o.value,rules:q.value,"label-width":100,disabled:v.value,onSubmit:S},{default:t(()=>[e(c,{gutter:[0,28]},{default:t(()=>[e(L,{span:12},{default:t(()=>[e(x,{label:"用户拓展",name:"userExt"},{default:t(()=>[e(w,{modelValue:o.value.userExt,"onUpdate:modelValue":d[0]||(d[0]=V=>o.value.userExt=V),theme:"column",placeholder:"请输入用户拓展",clearable:"",autosize:{minRows:5}},null,8,["modelValue"])]),_:1})]),_:1}),e(L,{span:12},{default:t(()=>[e(x,{style:{float:"right"}},{default:t(()=>[e(r,{variant:"outline",onClick:$},{default:t(()=>[h("取消")]),_:1}),e(r,{theme:"primary",type:"submit"},{default:t(()=>[h("确定")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["data","rules","disabled"])]),_:1},8,["visible"])}}}),ht={class:"table-wrapper"},wt=["onClick"],kt=ae({__name:"DialogList",props:{visible:{type:Boolean,default:!1},deptId:{type:String,default:""}},emits:["update:visible"],setup(R,{emit:j}){const U=R,I=j,q={account:"",realName:"",userType:""},f=s(!1),o=s({...q}),l=s(!1),v=s(""),k=ge("userTypeOptions")||[],{fetchData:S,data:N,pagination:$,dataLoading:C}=Ce(ke,o.value,Ye),d=()=>{S({...o.value,deptId:U.deptId})},w=({row:r})=>{v.value=r.id,l.value=!0},x=F(()=>{d()},300),L=r=>{$.value={...$.value,current:r.current||1,pageSize:r.pageSize},x()};return H(()=>f.value,r=>{I("update:visible",r)}),H(()=>U.visible,r=>{r&&d(),f.value=r}),(r,c)=>{const O=n("t-input"),A=n("t-form-item"),V=n("t-col"),P=n("t-select"),M=n("t-row"),_=n("t-button"),a=n("t-form"),T=n("t-table"),b=n("t-dialog");return D(),B(b,{visible:f.value,"onUpdate:visible":c[5]||(c[5]=p=>f.value=p),header:"用户平台配置",width:980,footer:!1},{default:t(()=>[e(a,{ref:"form",data:o.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:u(x),onSubmit:u(x)},{default:t(()=>[e(M,null,{default:t(()=>[e(V,{span:10},{default:t(()=>[e(M,{gutter:[16,24]},{default:t(()=>[e(V,{span:4},{default:t(()=>[e(A,{label:"登录账号",name:"account"},{default:t(()=>[e(O,{modelValue:o.value.account,"onUpdate:modelValue":c[0]||(c[0]=p=>o.value.account=p),clearable:"",placeholder:"请输入登录账号"},null,8,["modelValue"])]),_:1})]),_:1}),e(V,{span:4},{default:t(()=>[e(A,{label:"用户姓名",name:"realName"},{default:t(()=>[e(O,{modelValue:o.value.realName,"onUpdate:modelValue":c[1]||(c[1]=p=>o.value.realName=p),clearable:"",placeholder:"请输入用户姓名"},null,8,["modelValue"])]),_:1})]),_:1}),e(V,{span:4},{default:t(()=>[e(A,{label:"用户平台",name:"userType"},{default:t(()=>[e(P,{modelValue:o.value.userType,"onUpdate:modelValue":c[2]||(c[2]=p=>o.value.userType=p),options:u(k),keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择用户平台"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1}),e(V,{span:2,class:"operation-wrapper"},{default:t(()=>[e(_,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[h(" 查询 ")]),_:1}),e(_,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[h(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),te("div",ht,[e(T,{data:u(N),columns:u(It),hover:!0,loading:u(C),pagination:u($),"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:L},{op:t(p=>[te("a",{class:"t-button-link",onClick:z=>w(p)},"配置",8,wt)]),_:1},8,["data","columns","loading","pagination"])]),e(Vt,{visible:l.value,"onUpdate:visible":c[3]||(c[3]=p=>l.value=p),editId:v.value,"onUpdate:editId":c[4]||(c[4]=p=>v.value=p),onSubmit:u(x)},null,8,["visible","editId","onSubmit"])]),_:1},8,["visible"])}}}),Ct=[{colKey:"row-select",type:"multiple",width:64,fixed:"left"},{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"登录账号",colKey:"account"},{title:"所属租户",colKey:"tenantName"},{title:"用户姓名",colKey:"realName"},{title:"所属角色",colKey:"roleName"},{title:"所属部门",colKey:"deptName"},{title:"用户平台",colKey:"userTypeName"},{fixed:"right",width:180,colKey:"op",title:"操作",align:"center"}],xt={class:"table-wrapper"},Tt=["onClick"],Dt=["onClick"],Ut=["onClick"],Ot=ae({__name:"user",setup(R){const{tableVar:j}=dt(),{getTableHeaderAffixedTop:U,getLayoutContainer:I}=it(),{hasRole:q}=et(),f={account:"",realName:"",userType:""},o=s([]),l=s([]),v=s({...f}),k=s(!1),S=s(!1),N=s(""),$=s(""),C=s(""),d=s(null),w=s(""),x=s([]),L=s([]);tt("userTypeOptions",L);async function r(){const g=await he("user_type");L.value=we(g)}const c=F(()=>{d.value=g=>g.label.indexOf(C.value)>=0},350),{fetchData:O,data:A,pagination:V,dataLoading:P}=Ce(ke,{},()=>{o.value=[]}),M=()=>{O({...v.value,deptId:w.value})};Ie(()=>{Pe({parentId:""}).then(g=>{x.value=g}),M(),r()});const _=({row:g},i)=>{N.value=g.id,$.value=i,S.value=!0},a=({row:g})=>{Y.value=g.id,W.value="one",k.value=!0},T=F(()=>{M()},300),b=(g,i)=>{o.value=g,l.value=i.selectedRowData},p=g=>{V.value={...V.value,current:g.current||1,pageSize:g.pageSize},T()},Q=F(async g=>{try{await ut(g),k.value=!1,K.success("删除成功"),oe(),T()}catch{k.value=!1}},300),se=()=>{o.value.length&&(W.value="check",k.value=!0)},Y=s(-1),W=s(),oe=()=>{Y.value=-1,W.value=""},ue=()=>{W.value==="check"&&Q(o.value),W.value==="one"&&Q([`${Y.value}`])},m=()=>{oe()},De=F(g=>{w.value=g.join(),V.value={...V.value,current:1},T()},300),ie=s(!1),fe=s(""),de=s(!1),re=s(!1),Ue=F(()=>{if(!o.value.length){K.error("至少选择一条数据");return}const g=l.value[0].tenantId;let i=!0;if(o.value.length!==1&&(i=l.value.every(le=>le.tenantId===g),!i)){K.error("批量设置，需要勾选相同租户的用户");return}fe.value=g,N.value=o.value.join(","),ie.value=!0},300),Se=F(()=>{if(!o.value.length){K.error("至少选择一条数据");return}const g=pe.confirm({header:"密码重置",theme:"warning",body:"确定将选择账号密码重置为123456?",onConfirm:F(()=>{at(o.value).then(()=>{K.success("操作成功!"),g.destroy()})},300)})},300),Ne=F(()=>{de.value=!0},300),$e=F(()=>{if(!o.value.length){K.error("至少选择一条数据");return}const g=pe.confirm({header:"账号解封",theme:"warning",body:"确定将选择账号解封?",onConfirm:F(()=>{lt(o.value).then(()=>{K.success("操作成功!"),g.destroy()})},300)})},300),Fe=F(()=>{re.value=!0},300),Ke=F(()=>{const g=pe.confirm({header:"账号导出",theme:"info",body:"是否导出用户数据?",onConfirm:F(()=>{ot(v.value).then(i=>{xe(i,`用户数据表${+new Date}.xlsx`),K.success("操作成功!"),g.destroy()})},300)})},300);return(g,i)=>{const le=n("t-input"),Ae=n("t-tree"),Z=n("t-col"),ce=n("t-form-item"),Be=n("t-select"),ne=n("t-row"),E=n("t-button"),Re=n("t-form"),qe=n("t-table"),Le=n("t-dialog"),X=nt("auth");return D(),B(ne,{class:Ve(u(j)),gutter:[16,24]},{default:t(()=>[e(Z,{span:2},{default:t(()=>[e(le,{modelValue:C.value,"onUpdate:modelValue":i[0]||(i[0]=y=>C.value=y),placeholder:"请输入关键词",clearable:"",onChange:u(c)},{"suffix-icon":t(()=>[e(u(st),{size:"20px"})]),_:1},8,["modelValue","onChange"]),e(Ae,{style:{"margin-top":"14px"},data:x.value,hover:"",activable:!0,keys:{value:"id",label:"deptName"},filter:d.value,onActive:u(De)},null,8,["data","filter","onActive"])]),_:1}),e(Z,{span:10},{default:t(()=>[e(Re,{ref:"form",data:v.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:u(T),onSubmit:u(T)},{default:t(()=>[e(ne,null,{default:t(()=>[e(Z,{span:10},{default:t(()=>[e(ne,{gutter:[16,24]},{default:t(()=>[e(Z,{span:4},{default:t(()=>[e(ce,{label:"登录账号",name:"account"},{default:t(()=>[e(le,{modelValue:v.value.account,"onUpdate:modelValue":i[1]||(i[1]=y=>v.value.account=y),clearable:"",placeholder:"请输入登录账号"},null,8,["modelValue"])]),_:1})]),_:1}),e(Z,{span:4},{default:t(()=>[e(ce,{label:"用户姓名",name:"realName"},{default:t(()=>[e(le,{modelValue:v.value.realName,"onUpdate:modelValue":i[2]||(i[2]=y=>v.value.realName=y),clearable:"",placeholder:"请输入用户姓名"},null,8,["modelValue"])]),_:1})]),_:1}),e(Z,{span:4},{default:t(()=>[e(ce,{label:"用户平台",name:"userType"},{default:t(()=>[e(Be,{modelValue:v.value.userType,"onUpdate:modelValue":i[3]||(i[3]=y=>v.value.userType=y),options:L.value,keys:{value:"dictKey",label:"dictValue"},clearable:"",placeholder:"请选择用户平台"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1})]),_:1}),e(Z,{span:2,class:"operation-wrapper"},{default:t(()=>[e(E,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[h(" 查询 ")]),_:1}),e(E,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[h(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),te("div",xt,[e(qe,{data:u(A),columns:u(Ct),hover:!0,loading:u(P),pagination:u(V),"selected-row-keys":o.value,"header-affixed-top":{offsetTop:u(U),container:u(I)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:p,onSelectChange:b},{"top-content":t(()=>[e(ne,{justify:"space-between",style:{"margin-bottom":"10px"}},{default:t(()=>[e(Z,{flex:"0 0 auto"},{default:t(()=>[J((D(),B(E,{onClick:i[4]||(i[4]=y=>_({row:{}},"add"))},{default:t(()=>[h("新增")]),_:1})),[[X,"user_add"]]),J((D(),B(E,{theme:"danger",onClick:se},{default:t(()=>[h("删除")]),_:1})),[[X,"user_delete"]]),J((D(),B(E,{variant:"outline",onClick:u(Ue)},{default:t(()=>[h("角色配置")]),_:1},8,["onClick"])),[[X,"user_role"]]),J((D(),B(E,{variant:"outline",onClick:u(Se)},{default:t(()=>[h("密码重置")]),_:1},8,["onClick"])),[[X,"user_reset"]]),u(q)(["administrator","admin"])?(D(),B(E,{key:0,variant:"outline",onClick:u(Ne)},{default:t(()=>[h(" 平台配置 ")]),_:1},8,["onClick"])):ee("",!0),u(q)(["administrator","admin"])?(D(),B(E,{key:1,variant:"outline",onClick:u($e)},{default:t(()=>[h(" 账号解封 ")]),_:1},8,["onClick"])):ee("",!0),u(q)(["administrator","admin"])?(D(),B(E,{key:2,variant:"outline",onClick:u(Fe)},{default:t(()=>[h(" 导入 ")]),_:1},8,["onClick"])):ee("",!0),u(q)(["administrator","admin"])?(D(),B(E,{key:3,variant:"outline",onClick:u(Ke)},{default:t(()=>[h(" 导出 ")]),_:1},8,["onClick"])):ee("",!0)]),_:1})]),_:1})]),op:t(y=>[J((D(),me("a",{class:"t-button-link",onClick:_e=>_(y,"view")},[h("查看")],8,Tt)),[[X,"user_view"]]),J((D(),me("a",{class:"t-button-link",onClick:_e=>_(y,"edit")},[h("编辑")],8,Dt)),[[X,"user_edit"]]),J((D(),me("a",{class:"t-button-link",onClick:_e=>a(y)},[h("删除")],8,Ut)),[[X,"user_delete"]])]),_:1},8,["data","columns","loading","pagination","selected-row-keys","header-affixed-top"]),e(Le,{visible:k.value,"onUpdate:visible":i[5]||(i[5]=y=>k.value=y),header:"确认删除当前所选数据？","on-cancel":m,onConfirm:ue},null,8,["visible"]),e(bt,{visible:S.value,"onUpdate:visible":i[6]||(i[6]=y=>S.value=y),editId:N.value,"onUpdate:editId":i[7]||(i[7]=y=>N.value=y),actionType:$.value,"onUpdate:actionType":i[8]||(i[8]=y=>$.value=y),onSubmit:u(T)},null,8,["visible","editId","actionType","onSubmit"]),e(yt,{visible:ie.value,"onUpdate:visible":i[9]||(i[9]=y=>ie.value=y),editId:N.value,"onUpdate:editId":i[10]||(i[10]=y=>N.value=y),"tenant-id":fe.value,onSubmit:u(T)},null,8,["visible","editId","tenant-id","onSubmit"]),e(kt,{visible:de.value,"onUpdate:visible":i[11]||(i[11]=y=>de.value=y),"dept-id":w.value},null,8,["visible","dept-id"]),e(gt,{visible:re.value,"onUpdate:visible":i[12]||(i[12]=y=>re.value=y),onSubmit:u(T)},null,8,["visible","onSubmit"])])]),_:1})]),_:1},8,["class"])}}});export{Ot as default};
