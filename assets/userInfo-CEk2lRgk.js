import{d as B,f as i,ai as F,r as d,o as M,c as L,a as e,w as l,b as f,q as U,s as j,M as w,aj as z,ak as G,al as O,am as b}from"./index-OjS_2jsV.js";import{u as R}from"./oss-AbAnaP9G.js";import{u as $}from"./useDesign-CbWcZHFZ.js";import{u as g}from"./index-BiO29gyn.js";const Y=B({__name:"userInfo",setup(H){const{tableVar:N}=$(),S={id:"",avatar:[],name:"",realName:"",phone:"",email:""},_=i(!1),t=i({...S}),V=i(null),T={oldPassword:"",newPassword:"",newPassword1:""},v=i(!1),r=i({...T}),D=i({oldPassword:[{required:!0,message:"请输入原密码",type:"error",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",type:"error"}],newPassword1:[{required:!0,message:"请输入确认密码",type:"error"},{validator:s=>new Promise(a=>{const m=setTimeout(()=>{a(r.value.newPassword===s),clearTimeout(m)})}),message:"确认密码与新密码不一致"}]}),c=g(s=>{s===1&&z().then(a=>{t.value={id:a.id,avatar:a.avatar?[{url:a.avatar}]:[],name:a.name,realName:a.realName,phone:a.phone,email:a.email}})},500),q=g(({firstError:s})=>{var a;if(s)w.warning(s);else{_.value=!0;const m={...t.value,avatar:t.value.avatar.length?(a=t.value.avatar[0])==null?void 0:a.url:""};G(m).then(()=>{w.success("更新成功"),c(1)}).finally(()=>{_.value=!1})}},300),A=({file:s})=>{w.error(`文件 ${s.name} 上传失败`)},C=async s=>{try{const a=await R({file:s.raw});return{status:"success",response:{...a,url:a.link}}}catch{return{status:"fail",error:"上传失败"}}},k=g(({firstError:s})=>{if(s)w.warning(s);else{v.value=!0;const{oldPassword:a,newPassword:m,newPassword1:u}=f(r);O(b(a).toString(),b(m).toString(),b(u).toString()).then(()=>{var n;w.success("修改密码成功!"),(n=V.value)==null||n.reset()}).finally(()=>{v.value=!1})}},300);return F(()=>{c(1)}),(s,a)=>{const m=d("t-upload"),u=d("t-form-item"),n=d("t-col"),p=d("t-input"),P=d("t-button"),y=d("t-row"),h=d("t-form"),I=d("t-tab-panel"),x=d("t-tabs");return M(),L("div",{class:j(f(N))},[e(x,{placement:"left","default-value":1,onChange:f(c)},{default:l(()=>[e(I,{value:1,label:"个人信息"},{default:l(()=>[e(h,{ref:"form",data:t.value,"label-width":100,disabled:_.value,style:{width:"55%"},onSubmit:f(q)},{default:l(()=>[e(y,{gutter:[0,28]},{default:l(()=>[e(n,{span:12},{default:l(()=>[e(u,{label:"头像",name:"avatar"},{default:l(()=>[e(m,{ref:"uploadRef",modelValue:t.value.avatar,"onUpdate:modelValue":a[0]||(a[0]=o=>t.value.avatar=o),theme:"image",tips:"单张图片文件上传",accept:"image/*",locale:{triggerUploadText:{image:"请选择图片"}},"request-method":C,disabled:_.value,onFail:A},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(n,{span:12},{default:l(()=>[e(u,{label:"姓名",name:"name"},{default:l(()=>[e(p,{modelValue:t.value.name,"onUpdate:modelValue":a[1]||(a[1]=o=>t.value.name=o),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:l(()=>[e(u,{label:"用户名",name:"realName"},{default:l(()=>[e(p,{modelValue:t.value.realName,"onUpdate:modelValue":a[2]||(a[2]=o=>t.value.realName=o),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:l(()=>[e(u,{label:"手机号",name:"phone"},{default:l(()=>[e(p,{modelValue:t.value.phone,"onUpdate:modelValue":a[3]||(a[3]=o=>t.value.phone=o),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:l(()=>[e(u,{label:"邮箱",name:"email"},{default:l(()=>[e(p,{modelValue:t.value.email,"onUpdate:modelValue":a[4]||(a[4]=o=>t.value.email=o),theme:"column",placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:l(()=>[e(u,null,{default:l(()=>[e(P,{theme:"primary",type:"submit"},{default:l(()=>[U("更新基础信息")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["data","disabled","onSubmit"])]),_:1}),e(I,{value:2,label:"修改密码"},{default:l(()=>[e(h,{ref_key:"form2",ref:V,data:r.value,"label-width":100,disabled:v.value,rules:D.value,style:{width:"55%"},onSubmit:f(k)},{default:l(()=>[e(y,{gutter:[0,28]},{default:l(()=>[e(n,{span:12},{default:l(()=>[e(u,{label:"原密码",name:"oldPassword"},{default:l(()=>[e(p,{modelValue:r.value.oldPassword,"onUpdate:modelValue":a[5]||(a[5]=o=>r.value.oldPassword=o),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:l(()=>[e(u,{label:"新密码",name:"newPassword"},{default:l(()=>[e(p,{modelValue:r.value.newPassword,"onUpdate:modelValue":a[6]||(a[6]=o=>r.value.newPassword=o),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:l(()=>[e(u,{label:"确认密码",name:"newPassword1"},{default:l(()=>[e(p,{modelValue:r.value.newPassword1,"onUpdate:modelValue":a[7]||(a[7]=o=>r.value.newPassword1=o),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:l(()=>[e(u,null,{default:l(()=>[e(P,{theme:"primary",type:"submit"},{default:l(()=>[U("修改密码")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["data","disabled","rules","onSubmit"])]),_:1})]),_:1},8,["onChange"])],2)}}});export{Y as default};
