import{d as B,f,ad as F,r as d,o as M,c as L,a,w as l,b as i,q as U,s as z,M as w,ae as G,af as O,ag as R,ah as c}from"./index-CqGaQ7t4.js";import{u as $}from"./oss-2LbzLkrS.js";import{u as j}from"./useDesign-CbWcZHFZ.js";import{u as g}from"./index-BidCcHov.js";const Y=B({__name:"userInfo",setup(H){const{tableVar:N}=j(),S={id:"",avatar:[],name:"",realName:"",phone:"",email:""},_=f(!1),t=f({...S}),V=f(null),T={oldPassword:"",newPassword:"",newPassword1:""},v=f(!1),r=f({...T}),D=f({oldPassword:[{required:!0,message:"请输入原密码",type:"error",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",type:"error"}],newPassword1:[{required:!0,message:"请输入确认密码",type:"error"},{validator:s=>new Promise(e=>{const m=setTimeout(()=>{e(r.value.newPassword===s),clearTimeout(m)})}),message:"确认密码与新密码不一致"}]}),b=g(s=>{s===1&&G().then(e=>{t.value={id:e.id,avatar:e.avatar?[{url:e.avatar}]:[],name:e.name,realName:e.realName,phone:e.phone,email:e.email}})},500),q=g(({firstError:s})=>{var e;if(s)w.warning(s);else{_.value=!0;const m={...t.value,avatar:t.value.avatar.length?(e=t.value.avatar[0])==null?void 0:e.url:""};O(m).then(()=>{w.success("更新成功"),b(1)}).finally(()=>{_.value=!1})}},300),A=({file:s})=>{w.error(`文件 ${s.name} 上传失败`)},C=async s=>{try{const e=await $({file:s.raw});return{status:"success",response:{...e,url:e.link}}}catch{return{status:"fail",error:"上传失败"}}},x=g(({firstError:s})=>{if(s)w.warning(s);else{v.value=!0;const{oldPassword:e,newPassword:m,newPassword1:u}=i(r);R(c(e).toString(),c(m).toString(),c(u).toString()).then(()=>{var n;w.success("修改密码成功!"),(n=V.value)==null||n.reset()}).finally(()=>{v.value=!1})}},300);return F(()=>{b(1)}),(s,e)=>{const m=d("t-upload"),u=d("t-form-item"),n=d("t-col"),p=d("t-input"),P=d("t-button"),y=d("t-row"),h=d("t-form"),I=d("t-tab-panel"),k=d("t-tabs");return M(),L("div",{class:z(i(N))},[a(k,{placement:"left","default-value":1,onChange:i(b)},{default:l(()=>[a(I,{value:1,label:"个人信息"},{default:l(()=>[a(h,{ref:"form",data:t.value,"label-width":100,disabled:_.value,style:{width:"55%"},onSubmit:i(q)},{default:l(()=>[a(y,{gutter:[0,28]},{default:l(()=>[a(n,{span:12},{default:l(()=>[a(u,{label:"头像",name:"avatar"},{default:l(()=>[a(m,{ref:"uploadRef",modelValue:t.value.avatar,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.avatar=o),theme:"image",tips:"单张图片文件上传",accept:"image/*",locale:{triggerUploadText:{image:"请选择图片"}},"request-method":C,disabled:_.value,onFail:A},null,8,["modelValue","disabled"])]),_:1})]),_:1}),a(n,{span:12},{default:l(()=>[a(u,{label:"姓名",name:"name"},{default:l(()=>[a(p,{modelValue:t.value.name,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.name=o),placeholder:"请输入姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{span:12},{default:l(()=>[a(u,{label:"用户名",name:"realName"},{default:l(()=>[a(p,{modelValue:t.value.realName,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.realName=o),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{span:12},{default:l(()=>[a(u,{label:"手机号",name:"phone"},{default:l(()=>[a(p,{modelValue:t.value.phone,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.phone=o),placeholder:"请输入手机号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{span:12},{default:l(()=>[a(u,{label:"邮箱",name:"email"},{default:l(()=>[a(p,{modelValue:t.value.email,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.email=o),theme:"column",placeholder:"请输入邮箱",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{span:12},{default:l(()=>[a(u,null,{default:l(()=>[a(P,{theme:"primary",type:"submit"},{default:l(()=>e[8]||(e[8]=[U("更新基础信息")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["data","disabled","onSubmit"])]),_:1}),a(I,{value:2,label:"修改密码"},{default:l(()=>[a(h,{ref_key:"form2",ref:V,data:r.value,"label-width":100,disabled:v.value,rules:D.value,style:{width:"55%"},onSubmit:i(x)},{default:l(()=>[a(y,{gutter:[0,28]},{default:l(()=>[a(n,{span:12},{default:l(()=>[a(u,{label:"原密码",name:"oldPassword"},{default:l(()=>[a(p,{modelValue:r.value.oldPassword,"onUpdate:modelValue":e[5]||(e[5]=o=>r.value.oldPassword=o),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{span:12},{default:l(()=>[a(u,{label:"新密码",name:"newPassword"},{default:l(()=>[a(p,{modelValue:r.value.newPassword,"onUpdate:modelValue":e[6]||(e[6]=o=>r.value.newPassword=o),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{span:12},{default:l(()=>[a(u,{label:"确认密码",name:"newPassword1"},{default:l(()=>[a(p,{modelValue:r.value.newPassword1,"onUpdate:modelValue":e[7]||(e[7]=o=>r.value.newPassword1=o),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1}),a(n,{span:12},{default:l(()=>[a(u,null,{default:l(()=>[a(P,{theme:"primary",type:"submit"},{default:l(()=>e[9]||(e[9]=[U("修改密码")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["data","disabled","rules","onSubmit"])]),_:1})]),_:1},8,["onChange"])],2)}}});export{Y as default};
