import{ar as $,d as B,f as p,Q as k,a7 as q,W as K,r as u,o as A,m as z,w as t,a as e,s as h,i as R,aw as M,c as S,q as L,b as m,e as P,$ as E,ax as O}from"./index-c2e89b2e.js";import{u as Q}from"./useSetting-9ed5cec4.js";import{u as W}from"./useDesign-16212514.js";import{u as G}from"./useRequset-d7ecab22.js";import{g as J}from"./api-172d8dac.js";import{u as X}from"./index-d5763e7f.js";const Y=(V,y,b)=>$.get({url:"/blade-log/usual/list",params:{...b,current:V,size:y}},{joinTime:!1}),Z=B({__name:"DialogForm",props:{visible:{type:Boolean,default:!1},editId:{type:String,default:""},actionType:{type:String,default:""}},emits:["update:visible","update:editId","update:actionType"],setup(V,{emit:y}){const b={serviceId:"",serverHost:"",serverIp:"",env:"",logLevel:"",logId:"",requestUri:"",createTime:"",userAgent:"",params:""},c=V,H=p({}),v=k(()=>`${{view:"查看",edit:"编辑",add:"新增"}[c.actionType]||""}通用日志`),I=k(()=>({view:!0,edit:!1})[c.actionType]||!1),f=p(!1),a=p({...b}),T=p(null),D=p(!1),_=y,C=()=>{a.value={...b},K(()=>{_("update:editId",""),_("update:actionType","")})};return q(()=>f.value,i=>{_("update:visible",i)}),q(()=>c.visible,i=>{i&&c.editId&&K(()=>{J(c.editId).then(l=>{a.value={...l}})}),K(()=>{var l;(l=T.value)==null||l.clearValidate()}),f.value=i}),(i,l)=>{const r=u("t-input"),s=u("t-form-item"),n=u("t-col"),U=u("t-textarea"),w=u("t-row"),g=u("t-form"),x=u("t-dialog");return A(),z(x,{visible:f.value,"onUpdate:visible":l[10]||(l[10]=o=>f.value=o),header:v.value,width:780,footer:!1,onClosed:C},{body:t(()=>[e(g,{ref_key:"form",ref:T,class:h({"xy-form__detail":V.actionType==="view"}),data:a.value,rules:H.value,"label-width":100,disabled:I.value||D.value},{default:t(()=>[e(w,{gutter:[0,28]},{default:t(()=>[e(n,{span:6},{default:t(()=>[e(s,{label:"服务id",name:"serviceId"},{default:t(()=>[e(r,{modelValue:a.value.serviceId,"onUpdate:modelValue":l[0]||(l[0]=o=>a.value.serviceId=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:6},{default:t(()=>[e(s,{label:"服务host",name:"serverHost"},{default:t(()=>[e(r,{modelValue:a.value.serverHost,"onUpdate:modelValue":l[1]||(l[1]=o=>a.value.serverHost=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:6},{default:t(()=>[e(s,{label:"服务ip",name:"serverIp"},{default:t(()=>[e(r,{modelValue:a.value.serverIp,"onUpdate:modelValue":l[2]||(l[2]=o=>a.value.serverIp=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:6},{default:t(()=>[e(s,{label:"软件环境",name:"env"},{default:t(()=>[e(r,{modelValue:a.value.env,"onUpdate:modelValue":l[3]||(l[3]=o=>a.value.env=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:6},{default:t(()=>[e(s,{label:"日志级别",name:"logLevel"},{default:t(()=>[e(r,{modelValue:a.value.logLevel,"onUpdate:modelValue":l[4]||(l[4]=o=>a.value.logLevel=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:6},{default:t(()=>[e(s,{label:"日志id",name:"logId"},{default:t(()=>[e(r,{modelValue:a.value.logId,"onUpdate:modelValue":l[5]||(l[5]=o=>a.value.logId=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:6},{default:t(()=>[e(s,{label:"请求接口",name:"requestUri"},{default:t(()=>[e(r,{modelValue:a.value.requestUri,"onUpdate:modelValue":l[6]||(l[6]=o=>a.value.requestUri=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:6},{default:t(()=>[e(s,{label:"日志时间",name:"createTime"},{default:t(()=>[e(r,{modelValue:a.value.createTime,"onUpdate:modelValue":l[7]||(l[7]=o=>a.value.createTime=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:t(()=>[e(s,{label:"用户代理",name:"userAgent"},{default:t(()=>[e(U,{modelValue:a.value.userAgent,"onUpdate:modelValue":l[8]||(l[8]=o=>a.value.userAgent=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:t(()=>[e(s,{label:"请求数据",name:"params"},{default:t(()=>[e(U,{modelValue:a.value.params,"onUpdate:modelValue":l[9]||(l[9]=o=>a.value.params=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["class","data","rules","disabled"])]),_:1},8,["visible","header"])}}}),ee=[{colKey:"serial-number",title:"序号",width:80,align:"center",fixed:"left"},{title:"服务id",colKey:"serviceId"},{title:"服务host",colKey:"serverHost"},{title:"服务ip",colKey:"serverIp"},{title:"软件环境",colKey:"env"},{title:"日志级别",colKey:"logLevel"},{title:"日志id",colKey:"logId"},{title:"请求接口",colKey:"requestUri"},{title:"请求接口",colKey:"requestUri"},{title:"日志时间",colKey:"createTime"},{fixed:"right",width:80,colKey:"op",title:"操作",align:"center"}],te={class:"table-wrapper"},le=["onClick"],ie=B({__name:"usual",setup(V){const{tableVar:y}=W(),{getTableHeaderAffixedTop:b,getLayoutContainer:c}=Q(),v=p({...{serviceId:"",serverHost:""}}),I=p(!1),f=p(""),a=p(""),{fetchData:T,data:D,pagination:_,dataLoading:C}=G(Y,v.value,O);R(()=>{T()});const i=({row:s},n)=>{f.value=s.id,a.value=n,I.value=!0},l=X(()=>{T()},300),r=s=>{_.value={..._.value,current:s.current||1,pageSize:s.pageSize},l()};return(s,n)=>{const U=u("t-input"),w=u("t-form-item"),g=u("t-col"),x=u("t-row"),o=u("t-button"),j=u("t-form"),F=u("t-table"),N=M("auth");return A(),S("div",{class:h(m(y))},[e(j,{ref:"form",data:v.value,"label-width":80,colon:"",style:{marginBottom:"8px"},onReset:m(l),onSubmit:m(l)},{default:t(()=>[e(x,null,{default:t(()=>[e(g,{span:10},{default:t(()=>[e(x,{gutter:[16,24]},{default:t(()=>[e(g,{span:4},{default:t(()=>[e(w,{label:"服务id",name:"serviceId"},{default:t(()=>[e(U,{modelValue:v.value.serviceId,"onUpdate:modelValue":n[0]||(n[0]=d=>v.value.serviceId=d),clearable:"",placeholder:"请输入服务id"},null,8,["modelValue"])]),_:1})]),_:1}),e(g,{span:4},{default:t(()=>[e(w,{label:"服务host",name:"serverHost"},{default:t(()=>[e(U,{modelValue:v.value.serverHost,"onUpdate:modelValue":n[1]||(n[1]=d=>v.value.serverHost=d),clearable:"",placeholder:"请输入服务host"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(g,{span:2,class:"operation-wrapper"},{default:t(()=>[e(o,{theme:"primary",type:"submit",style:{marginLeft:"8px"}},{default:t(()=>[L(" 查询 ")]),_:1}),e(o,{type:"reset",variant:"base",theme:"default"},{default:t(()=>[L(" 重置 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["data","onReset","onSubmit"]),P("div",te,[e(F,{data:m(D),columns:m(ee),hover:!0,loading:m(C),pagination:m(_),"header-affixed-top":{offsetTop:m(b),container:m(c)},"vertical-align":"top","row-key":"id",bordered:"",stripe:"",onPageChange:r},{op:t(d=>[E((A(),S("a",{class:"t-button-link",onClick:ae=>i(d,"view")},[L("查看")],8,le)),[[N,"log_usual_view"]])]),_:1},8,["data","columns","loading","pagination","header-affixed-top"]),e(Z,{visible:I.value,"onUpdate:visible":n[2]||(n[2]=d=>I.value=d),editId:f.value,"onUpdate:editId":n[3]||(n[3]=d=>f.value=d),actionType:a.value,"onUpdate:actionType":n[4]||(n[4]=d=>a.value=d)},null,8,["visible","editId","actionType"])])],2)}}});export{ie as default};
